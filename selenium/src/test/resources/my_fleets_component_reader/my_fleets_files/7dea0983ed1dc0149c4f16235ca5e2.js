ogame.messagemarker={type_chatbar:10,type_chattab:11,action_remove:20,action_add:21,currentCount:"",currentSelector:"",currentPlayernameObject:"",currentListPlayernameObject:"",currentPartnerId:"",currentListItemSelector:"",totalNewMessages:0,playerlist:new Array(),newsInitialized:false,effect:"none",initialize:function(){$(".new_msg_count[data-playerid]").each(function(){var b=ogame.messagemarker;var a=$(this).data("playerid");if(a&&$.inArray(a,b.playerlist)===-1){b.playerlist.push(a);b.setPartnerId(a);b.updateNewMarker()}});ogame.messagemarker.effect="highlight"},initMarker:function(a){var b=ogame.messagemarker;var c=0;$.each(a,function(e,f){b.setPartnerId(f);var d=$('.new_msg_count[data-playerid="'+f+'"]').data("new-messages");if(d!=null&&d>0){b.setSelectorByType(b.type_chatbar);b.mark(b.currentSelector,b.currentPlayernameObject,d);b.mark(b.currentListItemSelector,b.currentListPlayernameObject,d);b.setSelectorByType(b.type_chattab);b.mark(b.currentSelector,b.currentPlayernameObject,d)}c=c+1});return c},setCounter:function(b,a){this.setPartnerId(b);$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages",a);this.updateNewMarker()},toggle:function(c,b,d,a){this.setPartnerId(d);this.currentCount=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages"));if(c===this.action_add){this.updateNewMarker()}if(c===this.action_remove){this.removeNewMarker()}},mark:function(a,b,c){$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css("font-weight","bold");$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css("font-weight","bold")},addNewMarker:function(){var a=false;if(!$(this.currentSelector).find(".newMsgMarker").length){this.mark(this.currentSelector,this.currentPlayernameObject,this.currentCount);a=true}if(!$(this.currentListItemSelector).find(".newMsgMarker").length){this.mark(this.currentListItemSelector,this.currentListPlayernameObject,this.currentCount);a=true}if(!a){this.updateNewMarker()}},removeNewMarker:function(){$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css("font-weight","normal");$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css("font-weight","normal")},updateNewMarker:function(){var b=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data("new-messages"));var a=$(".new_msg_count.totalChatMessages").text();var c=ogame.chat.updateTotalNewChatCounter();if(b===0){if(isNaN(this.currentPartnerId)){$(".new_msg_count.totalMessages.news").text(b).addClass("noMessage")}else{$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(b).addClass("noMessage");if(c===0){$(".new_msg_count.totalChatMessages").text(c).addClass("noMessage")}else{if(a!=c){$(".new_msg_count.totalChatMessages").text(c).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}}}else{if(isNaN(this.currentPartnerId)){if(isNaN(b)){$(".new_msg_count.totalMessages.news").text(0).addClass("noMessage")}else{$(".new_msg_count.totalMessages.news").text(b).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}else{$('.msg[data-playerid="'+this.currentPartnerId+'"]').addClass("msg_new");$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(b).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500);if(a!=c){$(".new_msg_count.totalChatMessages").text(c).removeClass("noMessage").effect(ogame.messagemarker.effect,{},500)}}}},setSelectorByType:function(a){selector="";if(a==this.type_chatbar){selector='ul.chat_bar_list li.chat_bar_list_item[data-playerid="'+this.currentPartnerId+'"]'}if(a==this.type_chattab){selector='ul#chatMsgList li.msg[data-playerid="'+this.currentPartnerId+'"]'}this.currentListItemSelector='.js_playerlist ul.playerlist li.playerlist_item[data-playerid="'+this.currentPartnerId+'"]';this.currentSelector=selector;this.currentPlayernameObject=$(selector).find(".cb_playername");this.currentListPlayernameObject=$(this.currentListItemSelector).find(".playername")},setPartnerId:function(a){this.currentPartnerId=a}};