function initItemActivation(b){inventoryObj.initalizeSlider(inventoryObj.items_inventory,"js_activeItemSlider",395,172," ",true," ",true,true);if(typeof(b)=="undefined"||b.length==0||b==1){var a=$(".item_img_box .detail_button").filter(":first");if(a.length===0){$("#noItems").show();$("#itemDetailBox").hide();return}else{$.bbq.pushState({item:a.attr("ref")})}}else{$.bbq.pushState({item:b});$(window).trigger("hashchange")}$("#activeBuffDetails .js_is_active").each(function(){$durationEl=$(this).parent().siblings(".js_duration");$pusherEl=$(this).parent().siblings(".pusher");startCooldown($durationEl,$pusherEl,75)});$(document).undelegate("#activeBuffDetails .detail_button","click.updateItemDetails").delegate("#activeBuffDetails .detail_button","click.updateItemDetails",function(){if($(this).hasClass("active")){return}$("#activeBuffDetails .detail_button").removeClass("active");$(this).addClass("active");$.bbq.pushState({item:$(this).attr("ref")})}).undelegate("#activeBuffDetails .build-it","click.activateItem").delegate("#activeBuffDetails .build-it","click.activateItem",function(){activateItem($(this).attr("ref"))}).undelegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem").delegate("#activeBuffDetails .buyAndActivate.dm.build-it_disabled","click.activateItem",function(){if(vacation){return}var c=$(this).attr("ref");if($("#js_activeItemSlider>li a[ref='"+c+"']").length==0){return}errorBoxDecision(LocalizationStrings.error,translation.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=$("#darkmatter_box a").attr("href")})}).undelegate("#activeBuffDetails .close_detail","click.changeHash").delegate("#activeBuffDetails .close_detail","click.changeHash",function(){$.bbq.pushState({item:""})})}function initBuffBar(){$(".sliderWrapper .active_items").anythingSlider({resizeContents:false,buildNavigation:false,buildStartStop:false,infiniteSlides:false,stopAtEnd:true});$(".sliderWrapper .active_items").removeClass("hidden");$(window).unbind("hashchange.openBuffBar").bind("hashchange.openBuffBar",function(d){var c=$.deparam.fragment(d.fragment);if(typeof(c.item)!="undefined"){var b=$("#buffBar .activate_item");$("#buffBar a").removeClass("active");var e=c.item;if(e!=""){if($("#activeBuffDetails:visible").length){if(typeof(inventoryObj.items_inventory[e])=="undefined"){var a=$("#activeBuffDetails .detail_button").filter(":first");$.bbq.pushState({item:a.attr("ref")});return}$("#buffBar a[ref='"+c.item+"']").addClass("active");b.addClass("active");$("#noItems").hide();$("#itemDetailBox").show();updateItemDetails(e)}else{$("#buffBar a[ref='"+c.item+"']").addClass("active");b.addClass("active");gfSlider.slideIn(getElementByIdWithCache("detail"),e)}}else{if($("#activeBuffDetails .detail_button").filter(":first").length===0){$("#noItems").show();$("#itemDetailBox").hide()}$("#activeBuffDetails .close_details").click();b.removeClass("active")}}});$(document).undelegate("#buffBar a","click.openDetails").delegate("#buffBar a","click.openDetails",function(){if($(this).hasClass("active")){$.bbq.pushState({item:""})}else{$.bbq.pushState({item:$(this).attr("ref")})}});$("#buffBar").unbind("click.openDetails").bind("click.openDetails",function(a){if(!$(a.target).is("#buffBar .activate_item")&&!$(a.target).is(".arrow a")){$("#buffBar .activate_item").click()}});$("#buffBar .active_items div:not(.activate_item)").each(function(){$durationEl=$(this).find(".js_duration");$pusherEl=$(this).find(".pusher");startCooldown($durationEl,$pusherEl,32)});$(window).trigger("hashchange")}function getItem(a){if(typeof(inventoryObj.items_inventory[a])!="undefined"){return inventoryObj.items_inventory[a]}return null}function updateItemDetails(b){var c=getItem(b);$("#activeBuffDetails .detail_button").removeClass("active");$('#activeBuffDetails .detail_button[ref="'+b+'"]').addClass("active");$("#activeBuffDetails .js_itemName").html(c.name);$("#activeBuffDetails .js_itemEffect").html(c.effect);$("#activeBuffDetails .js_itemAmount").html(c.amount);if(c.firstStatus){$("#activeBuffDetails .js_itemDurationStatus").html(translation.durationType[c.firstStatus])}else{$("#activeBuffDetails .js_itemDurationStatus").html(translation.durationType.effecting)}if(c.duration){if(c.durationExtension){$("#activeBuffDetails .js_itemDuration").html(formatTimeWrapper(c.duration,2,true," ",false,"")+c.durationExtension)}else{$("#activeBuffDetails .js_itemDuration").html(formatTimeWrapper(c.duration,2,true," ",false,""))}}else{if(c.duration===null){if(c.moonOnlyItem){$("#activeBuffDetails .js_itemDuration").html(translation.permanentMoon)}else{$("#activeBuffDetails .js_itemDuration").html(translation.permanent)}}else{$("#activeBuffDetails .js_itemDuration").html(translation.now)}}if(c.timeLeft){$("#activeBuffDetails .js_itemTimeLeftTxt").show();$("#activeBuffDetails .js_itemTimeLeft").html(formatTimeWrapper(c.timeLeft,2,true," ",false,""))}else{$("#activeBuffDetails .js_itemTimeLeftTxt").hide()}var d=$("#activationButton");d.attr("ref",b);d.removeClass("buyAndActivate activateItem build-it_disabled build-it dm bp").addClass(c.currency);if(c.amount>0){d.addClass("activateItem").html("<span>"+((c.timeLeft>0&&c.extendable)?translation.extend:translation.activate)+"</span>").addClass(c.canBeActivated?"build-it":"build-it_disabled")}else{var a=(c.timeLeft>0&&c.extendable)?translation.buyAndExtend:translation.buyAndActivate;a=a.replace(/%price%/,tsdpkt(c.costs));a=a.replace(/%currency%/,translation.currencies[c.currency]);d.addClass("buyAndActivate").html("<span>"+a+"</span>").addClass(c.canBeBoughtAndActivated&&c.hasEnoughCurrency?"build-it":"build-it_disabled")}}function activateItem(b){var a={ajax:1,token:activateToken,referrerPage:$.deparam.querystring().page};var c=getItem(b);if(c.amount>0){a.item=b}else{a.buyAndActivate=b}function d(){$.ajax({cache:false,url:inventoryObj.inventoryUrl,data:a,type:"POST",dataType:"json",success:function(x,g,q){activateToken=x.newToken;if(x.error){fadeBox(x.message,true);return}if(x.message.reload){location.href=getRedirectLink();return}fadeBox(x.message.message,false);if(x.message.buff!=false){var v=getItem(x.message.buff);var w=true;var f=$(".active_items");var t=f.data("AnythingSlider");var n;f.find("li a").removeClass("active");f.find("li a.activate_item").addClass("active");f.find("div[data-id="+x.message.buffId+"]").each(function(){$(this).hide().show("pulsate").find("a").addClass("active");w=false;n=$(this)});if(w==true){var i=$('<div data-uuid="'+v.ref+'" data-id="'+x.message.buffId+'"><div class="js_duration" style="display: none;"></div><a href="javascript:void(0);" ref="'+v.ref+'" class="detail_button slideIn active_item active r_'+x.message.item.rarity+' border3px tooltipHTML" title="'+x.message.item.toolTip+'"><div class="pusher" style="height: 0%; "></div><img src="/cdn/img/item-images/'+v.image+'-small.png" alt=""/></a></div>');var p=14;var s=t.currentPage;var u=t.options.animationTime;if(typeof(x.message.upgraded)!="undefined"){for(var e in x.message.upgraded){var o=x.message.upgraded[e];f.find("div[data-uuid="+o+"]").remove()}var l=$(document.createDocumentFragment());var h=f.find("li > div");h.each(function(y,z){if(y%p==0){}$(this).appendTo(l.children().last())});t.updateSlider()}var m=f.children().last().children().length;if(m<p){i.hide().appendTo(f.children().last()).show("pulsate");if(s==t.pages){t.options.animationTime=0}t.gotoPage(t.pages);if(s==t.pages){t.options.animationTime=u}}else{i=i.hide().wrap("<li/>");i.parent().appendTo(f).children().last();t.updateSlider();if(s==t.pages){t.options.animationTime=0}t.gotoPage(t.pages);if(s==t.pages){t.options.animationTime=u}i.show("pulsate")}n=i}else{console.log(v.ref);var k=$('<div data-uuid="'+v.ref+'" data-id="'+x.message.buffId+'"><div class="js_duration" style="display: none;"></div><a href="javascript:void(0);" ref="'+v.ref+'" class="detail_button slideIn active_item active r_'+x.message.item.rarity+' border3px tooltipHTML" title="'+x.message.item.toolTip+'"><div class="pusher" style="height: 0%; "></div><img src="/cdn/img/item-images/'+v.image+'-small.png" alt=""/></a></div>');var o=v.ref;f.find("div[data-uuid="+o+"]").remove();k.hide().appendTo(f.children().last()).show("pulsate");n=k}}var r=n.find(".pusher");var j=n.find(".js_duration");j.attr("data-total-duration",x.message.totalDuration).text(x.message.item.timeLeft);startCooldown(j,r,32);getAjaxResourcebox();$.ajax({type:"POST",url:detailUrl,data:{type:b},beforeSend:function(){$("#detailWrapper .detail_screen").html('<p class="ajaxLoad">'+LocalizationStrings.loading+"</p>")},success:function(y){$("#detailWrapper .detail_screen").html(y)}})},error:function(e){fadeBox("Error!",true)}})}if(c.isAnUpgrade){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,d)}else{if(c.isCharacterClassItem){if(c.amount>0){errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.activateItemQuestion.replace("#characterClassName#",c.name),LocalizationStrings.yes,LocalizationStrings.no,d)}else{errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.buyAndActivateItemQuestion.replace("#characterClassName#",c.name).replace("#darkmatter#",tsdpkt(c.costs)),LocalizationStrings.yes,LocalizationStrings.no,d)}}else{d()}}}function initEmpireEquipment(){$(".overview_equipment .item_img_box .hidden").each(function(){startCooldown($(this),$(this).parent().parent().find(".pusher"),32)})}function startCooldown(b,a,d){if($.trim(b.text()).match(/^\d+$/)){var c=new countdownWithTickFunction(b[0],parseInt($.trim(b.text())),parseInt(b.attr("data-total-duration")),function(){location.href=getRedirectLink()},function(g,h){var e=1-(g/h);var f=Math.floor(d*e);a.css("height",f+"px")})}};