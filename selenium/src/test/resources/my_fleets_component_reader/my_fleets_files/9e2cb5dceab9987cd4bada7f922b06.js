function initResourceTrader(){$(".big_tabs").tabs({activate:hideTipsOnTabChange});$(".resource_link").on("click",onSelectResource);$(".btn_calltrader").on("click",callTrader)}function onSelectResource(c){var a=$(c.currentTarget);if(!a.hasClass("active")){$(".resource_link").removeClass("active");a.addClass("active");$(".btn_calltrader").attr("disabled",false).data("offerId",a.data("resourceId"));var b=$(".getNewTraderDiv");if(b.hasClass("hidden")&&!a.hasClass("oldTraderActive")||!b.hasClass("hidden")&&a.hasClass("oldTraderActive")){b.parent().children().toggleClass("hidden")}}}function showTradeNowButton(){if($("#callTrader").hasClass("traderActive")){$("#callTrader").show()}else{$("#callTrader").hide()}}function calcCosts(b,a){return Math.ceil(a*factor[offer_id]/factor[b])}function calcInputFromCosts(b,a){return Math.max(Math.floor(a/factor[offer_id]*factor[b]),0)}function setValue(b,a){if(offer_id==b){$("#"+b+"_value_label").html(number_format(a,0,loca.decimalPoint,loca.thousandsSeparator))}else{formatNumber("#"+b+"_value",a)}}function checkValue(a){setValue(a,Math.min(getValue($("#"+a+"_value").val()),Math.round(storage[a])));free_id=6-a-offer_id;offer_costs=calcCosts(free_id,getValue($("#"+free_id+"_value").val()));costs=calcCosts(a,getValue($("#"+a+"_value").val()));freeOfferCosts=Math.round(offer_amount-(offer_costs));if(costs>freeOfferCosts){setValue(a,calcInputFromCosts(a,freeOfferCosts));costs=calcCosts(a,getValue($("#"+a+"_value").val()))}offer_costs=offer_costs+costs;setValue(offer_id,offer_costs);document.getElementById(a+"_storage").innerHTML=number_format((storage[a]-getValue($("#"+a+"_value").val())),0,loca.decimalPoint,loca.thousandsSeparator)}function setMaxValue(a){setValue(a,storage[a]);checkValue(a)}function callTrader(c){if($(c.currentTarget).attr("disabled")=="disabled"){return}var d=$(c.currentTarget).data("offerId"),b=$(c.currentTarget).data("askOverwrite");if(typeof(b)=="undefined"){b=true}if(darkMatter<traderCosts){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return}function a(){if(!$(".call_trader_box .getNewTraderDiv").hasClass("hidden")){$(".call_trader_box").children().toggleClass("hidden")}$(".resource_list .resource_link").removeClass("oldTraderActive").filter(function(e){return $(this).data("resourceId")==d}).addClass("oldTraderActive");$.post(traderCallLink,{offer_id:d,token:traderResourcesToken},function(h){h=$.parseJSON(h);traderResourcesToken=h.newToken;if(h.status=="1"){$("#callTrader").show().addClass("traderActive");traderObj.reloadResources();$("#callTrader").addClass("traderActive").show();openOverlay(traderOverlayLink,{"class":"traderlayer"});var e=$("#activeTrader");var g="metal";var f=loca.traderResourceTitleMetal;switch(d){case 2:g="crystal";f=loca.traderResourceTitleCrystal;break;case 3:g="deut";f=loca.traderResourceTitleDeuterium;break}e.find(".left_content #material").attr("class",g);e.find("p.stimulus").html(f);e.show();$("#boxHeader, #boxFooter").show()}else{errorBoxAsArray(h.errorbox)}})}if(b&&$("#callTrader").is(":visible")){errorBoxDecision(loca.traderResourceNewQuestionHeadline,loca.traderResourceNewQuestion,LocalizationStrings.yes,LocalizationStrings.no,a)}else{a()}}function tradeDone(a){a=$.parseJSON(a);traderResourcesToken=a.newToken;if(a.status=="1"){$(".overlayDiv.traderlayer").dialog("close");$(".call_trader_box").children().toggleClass("hidden");traderObj.reloadResources();$("#callTrader").removeClass("traderActive").hide();$(".resource_link").removeClass("oldTraderActive active");$(".btn_calltrader").attr("disabled",true);$("#activeTrader").hide()}errorBoxAsArray(a.errorbox)};