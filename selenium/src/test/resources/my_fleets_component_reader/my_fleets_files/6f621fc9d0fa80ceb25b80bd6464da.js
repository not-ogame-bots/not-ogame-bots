"use strict";var pushButton=null;var applicationServerPublicKey="BA_ADqzYuy45TlLLbSQcBmOwbjYYaU1snQM8UtO6ZLgUon7HAOELOS_Wnwyv4kAIARi2jrLmXxtDTnx7htApqyc";var isSubscribed=false;var swRegistration=null;function urlB64ToUint8Array(f){var d="=".repeat((4-f.length%4)%4);var a=(f+d).replace(/\-/g,"+").replace(/_/g,"/");var e=window.atob(a);var c=new Uint8Array(e.length);for(var b=0;b<e.length;++b){c[b]=e.charCodeAt(b)}return c}function initializeUI(){pushButton.addEventListener("click",function(){pushButton.disabled=true;if(isSubscribed){unsubscribeUser()}else{subscribeUser()}});swRegistration.pushManager.getSubscription().then(function(a){isSubscribed=!(a===null);updateSubscriptionOnServer(a);updateBtn()})}function updateBtn(){if(Notification.permission==="denied"){pushButton.textContent="Push Messaging Blocked.";pushButton.disabled=true;updateSubscriptionOnServer(null);return}if(isSubscribed){pushButton.textContent="Disable Push Messaging";pushButton.checked=true}else{pushButton.textContent="Enable Push Messaging";pushButton.checked=false}pushButton.disabled=false}function subscribeUser(){var a=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:a}).then(function(b){updateSubscriptionOnServer(b);isSubscribed=true;updateBtn()})["catch"](function(b){updateBtn()})}function unsubscribeUser(){swRegistration.pushManager.getSubscription().then(function(a){if(a){return a.unsubscribe()}})["catch"](function(a){}).then(function(){updateSubscriptionOnServer(null);isSubscribed=false;updateBtn()})}function updateSubscriptionOnServer(a){if(a){$.post("?page=ajax&component=subscription&action=subscribe",{subscription:JSON.stringify(a),})}}function initSubscriptionSystem(){pushButton=document.querySelector(".onoffswitch-checkbox");console.log(pushButton);if("serviceWorker" in navigator&&"PushManager" in window){pushButton.setAttribute("disabled","disabled");pushButton.classList.add("disabled");console.log(pushButton);navigator.serviceWorker.register("sw.js").then(function(a){swRegistration=a;initializeUI()})["catch"](function(a){})}else{pushButton.textContent="Push Not Supported"}};