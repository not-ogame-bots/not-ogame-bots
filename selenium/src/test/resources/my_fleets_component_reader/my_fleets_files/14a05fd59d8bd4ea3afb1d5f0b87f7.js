function initBBCodeEditor(p,c,h,f,g,n){var j;if(typeof(f)=="undefined"||f==null){j=$("textarea:not(.markItUpEditor)")}else{j=$(f).filter(":not(.markItUpEditor)")}if(j.length==0){return}var h=h||false;var o=[];for(var i=6;i<=30;i+=2){o.push({name:i,openWith:"[size="+i+"]",closeWith:"[/size]",placeHolder:"Text",className:"fontSize"+i})}var d=[];$.each(c,function(r,q){d.push({name:q,replaceWith:"[item]"+r+"[/item]"})});function a(u){if(u.selection.length==0){return}var w=$(u.textarea);var r=w.getSelection();var v=w.val().indexOf(u.openWith,r.start);var t=v+u.openWith.length;var q=typeof(u.placeHolder)=="string"?u.placeHolder.length:0;var s={start:t,end:t+q};w.setSelection(s)}function b(t){var r=t.openWith;var u=$(t.textarea);var q=u.getSelection();u.siblings(".colorpicker").val("").colorpicker("open").colorpicker("option","close",function(y,w){var x=r.replace(/%colorCode%/,w.formatted);var v="%colorCode%".length-w.formatted.length;q.start=q.start-v;q.end=q.end-v;u.val(u.val().replace(r,x)).setSelection(q)});var s=u.siblings(".markItUpHeader").find("."+t.className);$(".ui-colorpicker:visible").css("top",s.offset().top+s.height()).css("left",s.offset().left);$(".ui-colorpicker").draggable();$(".ui-colorpicker-rgb-r .ui-colorpicker-number").focus();return t}function m(u){var v=$(u.textarea);var q=v.getSelection();var r=u.openWith;var t=$("#backgroundImagePicker");if(t.is(":visible")){t.dialog("close")}t.find("input:checked").prop("checked",false);t.find(".url").val("http://").focus();openOverlay(t,{type:"inline",title:p.backgroundImage,close:function(){var w=t.find(".url").val();var z=t.find(".repeatX:checked").length;var y=t.find(".repeatY:checked").length;var B="";if(z&&y){B="yes"}else{if(z){B="yes-x"}else{if(y){B="yes-y"}}}if(B.length){w+=" image-repeat="+B}var A=r.replace(/%image%/,w);var x="%image%".length-w.length;q.start=q.start-x;q.end=q.end-x;v.val(v.val().replace(r,A)).setSelection(q)}});var s=v.siblings(".markItUpHeader").find("."+u.className);t.parent().css("top",s.offset().top+s.height()).css("left",s.offset().left);return u}var k=n?[{name:p.bold,key:"B",openWith:"[b]",closeWith:"[/b]",className:"bold"},{name:p.italic,key:"I",openWith:"[i]",closeWith:"[/i]",className:"italic"},{name:p.fontColor,afterInsert:b,openWith:"[color=%colorCode%]",closeWith:"[/color]",placeHolder:p.textPlaceHolder,className:"fontColor"},{name:p.fontSize,className:"fontSize",dropMenu:o},{name:p.list,openWith:"[*]",multiline:true,openBlockWith:"[list]\n",closeBlockWith:"\n[/list]",className:"list",afterMultiInsert:a,placeHolder:p.textPlaceHolder},{name:p.coordinates,openWith:"[coordinates]",closeWith:"[/coordinates]",placeHolder:p.coordinatePlaceHolder,className:"coordinates"}]:[{name:p.bold,key:"B",openWith:"[b]",closeWith:"[/b]",className:"bold"},{name:p.italic,key:"I",openWith:"[i]",closeWith:"[/i]",className:"italic"},{name:p.fontColor,afterInsert:b,openWith:"[color=%colorCode%]",closeWith:"[/color]",placeHolder:p.textPlaceHolder,className:"fontColor"},{name:p.fontSize,className:"fontSize",dropMenu:o},{name:p.list,openWith:"[*]",multiline:true,openBlockWith:"[list]\n",closeBlockWith:"\n[/list]",className:"list",afterMultiInsert:a,placeHolder:p.textPlaceHolder},{name:p.link,key:"L",openWith:"[url=[!["+p.link+":!:http://]!]]",closeWith:"[/url]",placeHolder:p.textPlaceHolder,className:"link"},{name:p.coordinates,openWith:"[coordinates]",closeWith:"[/coordinates]",placeHolder:p.coordinatePlaceHolder,className:"coordinates"}];var e=n?[{name:p.underline,key:"U",openWith:"[u]",closeWith:"[/u]",className:"underline"},{name:p.stroke,key:"S",openWith:"[s]",closeWith:"[/s]",className:"strikeThrough"},{name:p.sub,openWith:"[sub]",closeWith:"[/sub]",className:"sub"},{name:p.sup,openWith:"[sup]",closeWith:"[/sup]",className:"sup"},{separator:"-"},{name:p.item,className:"item",dropMenu:d},{name:p.player,openWith:"[player]",closeWith:"[/player]",placeHolder:p.playerPlaceHolder,className:"player"},{separator:"-"},{name:p.alignLeft,openWith:"[align=left]",closeWith:"[/align]",className:"leftAlign"},{name:p.alignCenter,openWith:"[align=center]",closeWith:"[/align]",className:"centerAlign"},{name:p.alignRight,openWith:"[align=right]",closeWith:"[/align]",className:"rightAlign"},{name:p.alignJustify,openWith:"[align=justify]",closeWith:"[/align]",className:"justifyAlign"},{separator:"-"},{name:p.code,openWith:"[code]",closeWith:"[/code]",className:"code"},{separator:"-"},{name:p.email,key:"E",openWith:"[email=[!["+p.email+":!:]!]]",closeWith:"[/email]",placeHolder:p.textPlaceHolder,className:"email"},{name:p.preview,className:"preview",call:"preview"}]:[{name:p.underline,key:"U",openWith:"[u]",closeWith:"[/u]",className:"underline"},{name:p.stroke,key:"S",openWith:"[s]",closeWith:"[/s]",className:"strikeThrough"},{name:p.sub,openWith:"[sub]",closeWith:"[/sub]",className:"sub"},{name:p.sup,openWith:"[sup]",closeWith:"[/sup]",className:"sup"},{name:p.backgroundColor,afterInsert:b,openWith:"[background color=%colorCode%]",closeWith:"[/background]",placeHolder:p.textPlaceHolder,className:"backgroundColor"},{name:p.backgroundImage,afterInsert:m,openWith:"[background image=%image%]",closeWith:"[/background]",placeHolder:p.textPlaceHolder,className:"backgroundImage"},{separator:"-"},{name:p.item,className:"item",dropMenu:d},{name:p.player,openWith:"[player]",closeWith:"[/player]",placeHolder:p.playerPlaceHolder,className:"player"},{name:p.tooltip,openWith:'[tooltip position="top" text="[![Tooltip Text:!:Tooltip Text]!]"]',closeWith:"[/tooltip]",placeHolder:p.textPlaceHolder,className:"tooltip"},{separator:"-"},{name:p.alignLeft,openWith:"[align=left]",closeWith:"[/align]",className:"leftAlign"},{name:p.alignCenter,openWith:"[align=center]",closeWith:"[/align]",className:"centerAlign"},{name:p.alignRight,openWith:"[align=right]",closeWith:"[/align]",className:"rightAlign"},{name:p.alignJustify,openWith:"[align=justify]",closeWith:"[/align]",className:"justifyAlign"},{separator:"-"},{name:p.block,openWith:"[p]",closeWith:"[/p]",className:"block"},{name:p.code,openWith:"[code]",closeWith:"[/code]",className:"code"},{name:p.spoiler,openWith:"[spoiler]",closeWith:"[/spoiler]",className:"spoiler"},{separator:"-"},{name:p.hr,openWith:"[hr]",className:"hr"},{separator:"-"},{name:p.picture,key:"Z",replaceWith:"[img][!["+p.picture+":!:http://]!][/img]",className:"picture"},{name:p.email,key:"E",openWith:"[email=[!["+p.email+":!:]!]]",closeWith:"[/email]",placeHolder:p.textPlaceHolder,className:"email"},{name:p.preview,className:"preview",call:"preview"}];if(!h){$.each(e,function(q){if(this.className=="picture"||this.className=="backgroundImage"){e.splice(q,1)}})}if(isMobile){$.each(k,function(q){if(this.className=="fontColor"||this.className=="backgroundColor"){k.splice(q,1)}});$.each(e,function(q){if(this.className=="fontColor"||this.className=="backgroundColor"){e.splice(q,1)}})}var l={onShiftEnter:{keepDefault:false,replaceWith:"\n"},onCtrlEnter:{keepDefault:false,openWith:"\n[p]",closeWith:"[/p]"},onTab:{keepDefault:false,replaceWith:"\t"},markupSet:[k,e],resizeHandle:false,previewParserPath:bbcodePreviewUrl+"&imgAllowed="+(h?1:0),previewAutoRefresh:true,previewParserVar:"text",previewInElement:$('<div class="miu_preview_container"></div>'),afterInsert:function(q){$(q.textarea).trigger("keyup")}};$.colorpicker.regional.custom=p.colorPicker;j.each(function(){var r=$(this);r.markItUp(l).after($('<input type="hidden" class="colorpicker"/>').colorpicker({color:"#000000",colorFormat:"#HEX",hsv:false,parts:"popup",regional:"custom",showCancelButton:false}));l.previewInElement.insertAfter(r);$(".miu_advanced .preview").hide();var q=$('<div class="miu_footer clearfix"></div>');q.append('<a role="button" class="fright txt_link btn_blue preview_link">'+p.preview+"</a>").append('<span class="fleft"><span class="cnt_chars">'+g+"</span> "+p.charsLeft+"</span>");q.insertAfter(r);r.on("keyup.bbCodeEditor",function(){if(r.val().length>g){r.val(r.val().substr(0,g))}r.closest(".markItUpContainer").find(".cnt_chars").html(g-r.val().length)});$(".miu_preview_container").hide();$(".preview_link").on("click.bbCodeEditor",function(){l.previewInElement.insertAfter($(event.target).closest(".markItUpContainer").find(".miu_footer"));$(event.target).closest(".markItUpContainer").find(".miu_preview_container").show();$(event.target).closest(".markItUpContainer").find(".preview").click()});if(isMobile){r.siblings(".markItUpHeader").find("a").attr("title","");r.siblings(".markItUpHeader").find("li:not(.markItUpDropMenu) a").bind("mouseup",function(){r.focus()})}else{r.siblings(".markItUpHeader").find("ul ul a").attr("title","")}if($("#backgroundImagePicker").length==0){$("body").append($('<div id="backgroundImagePicker" style="display: none;"><table><tr><td>'+p.backgroundImage+':</td><td><input type="text" class="url"/></td></tr><tr><td>'+p.backgroundImagePicker.repeatX+':</td><td><input type="checkbox" class="repeatX"/></td></tr><tr><td>'+p.backgroundImagePicker.repeatY+':</td><td><input type="checkbox" class="repeatY"/></td></tr></table><div><a href="javascript:void(0);" class="btn_blue">'+p.backgroundImagePicker.ok+"</a></div></div>"));$("#backgroundImagePicker").find("a").bind("click",function(){$("#backgroundImagePicker").dialog("close")})}});$(".toggle_miu_advanced").on("click.bbCodeEditor",function(){if($(".miu_advanced").is(":visible")){$(".miu_advanced").hide();$(this).removeClass("hide_miu_advanced").addClass("show_miu_advanced")}else{$(".miu_advanced").show();$(this).removeClass("show_miu_advanced").addClass("hide_miu_advanced")}})}function initBBCodes(){$(document).undelegate(".spoilerHeader","click").delegate(".spoilerHeader","click",function(){var a=this;$(this).next(".spoilerText").toggle(0,function(){Tipped.refresh(a)})})};