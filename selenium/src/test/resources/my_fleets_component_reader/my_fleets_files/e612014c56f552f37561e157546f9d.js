function scrollToTopOfDialog(a){$("html, body").stop().animate({scrollTop:Math.max(0,a.offset().top-300)},200)}function openOverlay(i,p){if($(".ui-dialog span.ui-dialog-title:contains('"+p.title+"')").length){return}if(typeof(openOverlay.index)=="undefined"){openOverlay.index=0}else{openOverlay.index++}var c=openOverlay.index;var p=p||{};if((typeof(p.type)=="undefined"||p.type!="inline")&&!i.match(new RegExp("^("+ogameUrl+"|"+startpageUrl+")"))){window.open("redir.php?url="+encodeURIComponent(i),"_newtab");return}if(typeof(p.height)=="undefined"){p.height="auto"}if(typeof(p.width)=="undefined"){p.width="auto"}if(typeof(p.position)=="undefined"){if(isMobile&&!isMobileApp){p.position={my:"top",at:"top"}}else{p.position={my:"center",at:"center"}}}p.closeText="";if($(".overlayDiv").length&&!isMobile){var l=$(".overlayDiv:last");var j=l.offset();p.position={my:"left top",at:"left+"+(j.left+10)+" top+"+(j.top+10)}}function u(w){var x=w.parent(".ui-dialog");if(x.length){x.css("top",Math.max(0,parseInt(x.css("top").replace(/px$/,"")))).css("left",Math.max(0,parseInt(x.css("left").replace(/px$/,""))))}}var f=p.type;delete p.type;if(f!="inline"){var g=$(document.createElement("img")).attr("src","//gf1.geo.gfsrv.net/cdnc6/4161a64a933a5345d00cb9fdaa25c7.gif").attr("alt",LocalizationStrings.loading);var k=$(document.createElement("div")).css("text-align","center").css("margin-top","20px").append(g);var t=$(document.createElement("div")).addClass("overlayDiv").css("display","none").append(k).appendTo("body");var o=function(){t.find("select").ogameDropDown("destroy");t.remove();Tipped.hideAll()};switch(typeof(p.close)){case"function":break;case"string":var v=p.close.split(" ");p.close=function(){$.each(v,function(w,x){if(x=="__default"){o()}else{window[x]()}})};break;default:p.close=o;break}}if(typeof(i)=="string"){var e=$.deparam($.param.querystring(i));if(typeof(e.page)!="undefined"){t.attr("data-page",e.page)}if(!isMobile&&$.inArray(e.page,popupWindows)!=-1){var m=Math.max(0,Math.floor($(window).height()/2-p.popupHeight/2));var h=Math.max(0,Math.floor($(window).width()/2-p.popupWidth/2));var b=window.open(i+"&popup=1",e.page,"width="+p.popupWidth+",height="+p.popupHeight+",scrollbars=yes,resizable=yes,top="+m+",left="+h);t.remove();b.focus();return}}if(typeof(p["class"])!="undefined"){var d=p["class"].split(" ").join(".");if($(".overlayDiv."+d).length){$.get(i,{},function(w){$(".overlayDiv."+p["class"]).empty().append(w).dialog("moveToTop")});t.remove();t=$(".overlayDiv."+d);if(typeof(e.page)!="undefined"){t.attr("data-page",e.page)}if(typeof(p.title)!="undefined"){t.dialog("option","title",p.title)}scrollToTopOfDialog(t);return true}else{t.addClass(p["class"])}}if(f=="inline"){t=$(i)}if(isNaN(p.dragStart)&&isNaN(p.dragStop)){var s;p.dragStart=function(){$("html").data("noclick",true);t.dialog("option","width",t.width()).dialog("option","height",t.height());s={bg:t.css("background"),image:t.css("background-image"),x:t.css("background-position-x"),y:t.css("background-position-y"),position:t.css("background-position")};t.find("select").ogameDropDown("hide");t.children().hide();var y=t.find(".markItUpDropMenu[id]");for(var x=0;x<y.length;++x){var w=$("body>ul[rel="+y[x].id+"]");var z=(typeof w.attr("old_left")=="undefined"?-18:0);var A=(typeof w.attr("old_left")=="undefined"?-6:0);w.attr("old_top",t.offset()["top"]+z).attr("old_left",t.offset()["left"]+A).hide()}t.css("background","#000000")};p.dragStop=function(){setTimeout(function(){$("html").data("noclick",false)},100);if(typeof(t.bg)=="undefined"||t.bg.length==0){t.css("background-image",s.image);if(typeof(s.position)=="undefined"||s.position.length==0){t.css("background-position-x",s.x).css("background-position-y",s.y)}else{t.css("background-position",s.position)}}else{t.css("background",s.bg)}t.children().show();var x=t.find(".markItUpDropMenu[id]");for(var w=0;w<x.length;++w){var y=$("body>ul[rel="+x[w].id+"]");y.css({top:(parseInt(y.css("top"))-y.attr("old_top")+t.offset()["top"])+"px",left:(parseInt(y.css("left"))-y.attr("old_left")+t.offset()["left"])+"px"});if($(x[w]).attr("data-opened")==1){y.show()}}t.dialog("option","width",p.width).dialog("option","height",p.height);u(t)}}if(isNaN(p.resizable)){p.resizable=false}if(isMobile){p.draggable=false}if(p.modal){p.open=function(){$(".ui-widget-overlay").css("height","").css("width","")}}switch(f){case"iframe":var r=overlayWidth;var n=overlayHeight;if(typeof(p.iframeWidth)!="undefined"){r=p.iframeWidth;delete p.iframeWidth}if(typeof(p.iframeHeight)!="undefined"){n=p.iframeHeight;delete p.iframeHeight}t.html("<iframe allowTransparency='true'frameborder='0' hspace='0' src='"+i+"' id='TB_iframeContent' name='TB_iframeContent"+Math.round(Math.random()*1000)+"' style='width:"+(r+25)+"px;height:"+(n+1)+"px;' ></iframe>").dialog(p).dialog("moveToTop");u(t);break;case"inline":var q=$(i);var a=q.parent();q.addClass("overlayDiv").dialog(p).dialog("moveToTop");u(q);break;default:t.dialog(p).dialog("moveToTop");$.get(i,{}).done(function(w){t.empty().append(w).dialog("option","position",t.dialog("option","position"));setTimeout(function(){t.dialog("option","position",t.dialog("option","position"));u(t)},100);$(document).trigger("ajaxShowOverlay")}).fail(function(){})}Tipped.hideAll();$("select").ogameDropDown("hide");if(!isMobile){$(window).bind("resize.overlay"+c,function(){if(t.is(":data(dialog)")){t.dialog("option","position",t.dialog("option","position"));u(t)}else{$(window).unbind("resize.overlay"+c)}})}}function isOverlayOpen(){return $(".overlayDiv").length>0}function initOverlays(){$(document).undelegate('a[href*="overlay=1"], button[data-target*="overlay=1"], a.overlay, button.overlay',"click").delegate('a[href*="overlay=1"], button[data-target*="overlay=1"], a.overlay, button.overlay',"click",function(d){d.preventDefault();var b=$(this).attr("href")||$(this).attr("data-target");if($(this).data("overlay-same")){var f=$(this).parents(".ui-dialog");var c=f.find(".overlayDiv");if($(this).data("overlay-same")&&c.length>0){$.get(b,{},function(e){removeTooltip(c.find(getTooltipSelector()));c.empty().append(e).dialog("moveToTop");c.dialog("option","position",c.dialog("option","position"));f.hide();f.show()});return false}}var a={zIndex:4000};if($(this).data("overlay-title")){a.title=$(this).data("overlay-title")}else{if(typeof($(this).attr("title"))!="undefined"&&$(this).attr("title").length){a.title=$(this).attr("title")}else{if($(this).data("tipped_restore_title")){a.title=$(this).data("tipped_restore_title").replace(/^.+\|/,"")}}}if($(this).data("overlay-class")){a["class"]=$(this).data("overlay-class")}if($(this).data("overlay-width")){a.width=$(this).data("overlay-width")}if($(this).data("overlay-height")){a.height=$(this).data("overlay-height")}if($(this).data("overlay-popup-width")){a.popupWidth=$(this).data("overlay-popup-width")}if($(this).data("overlay-popup-height")){a.popupHeight=$(this).data("overlay-popup-height")}if($(this).data("overlay-modal")){a.modal=$(this).data("overlay-modal");a.resizable=false;a.draggable=false}if($(this).data("overlay-iframe")){a.type="iframe";if($(this).data("iframe-width")){a.iframeWidth=$(this).data("iframe-width")}if($(this).data("iframe-height")){a.iframeHeight=$(this).data("iframe-height")}}else{if($(this).data("overlay-inline")){a.type="inline";b=$(this).data("overlay-inline")}}if($(this).data("overlay-close")){a.close=$(this).data("overlay-close")}openOverlay(b,a);return false})};