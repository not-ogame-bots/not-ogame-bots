inventoryObj={currentPage:null,currentItems:null,currentItem:null,currentCategory:null,initalizeSlider:function(s,u,t,r,D,a,l,d,B){if(inventoryObj.currentItems==s&&typeof(a)=="undefined"||a==false){return}inventoryObj.currentItems=s;D=D||"slideIn";l=l||"tooltipHTML js_hideTipOnMobile";if(typeof(d)=="undefined"){d=true}if(typeof(B)=="undefined"){B=true}$("#"+u+"Box").remove(".anythingSlider");var f=[];var g=0;for(var E in s){var z=s[E];if(typeof(z.hide)!="undefined"&&z.hide){continue}if(inventoryObj.currentPage=="shop"||inventoryObj.currentPage=="inventory"){var A=g%inventoryObj.itemsPerSlide;f[g+(2*(A%3))-2*Math.floor(A/3)]=z}else{f[g]=z}g++}var C=0,x=0,F=$('<ul id="'+u+'" />');for(var b=f.length;x<b;x++){if(typeof(f[x])=="undefined"){v.append('<div class="item_img"><div class="empty border5px"></div></div>');continue}var z=f[x];if(x%inventoryObj.itemsPerSlide==0){var v=$('<li class="slide_'+C+'" />').appendTo(F);C++}var c,q,o;if(inventoryObj.currentPage=="shop"){c=getNumberFormatShort(z.costs,null)+" "+loca.currency[z.currency];q="price"}else{c=getNumberFormatShort(z.amount);q="amount"}var y;if(d){y=z.imageLarge+"-75x.png"}else{y=z.imageLarge+"-100x.png"}var p;if(z.canBeActivated||z.canBeBoughtAndActivated){p="enabled"}else{p="disabled"}if(z.isReduced){o='<div class="sale_badge '+p+'"></div>'}else{o=""}var k=(z.timeLeft!=null)?" js_is_active ":"";var h="";var n=z.title;if(u.indexOf("js_activeItemSlider")!=-1){n="";h=(z.timeLeft!=null)?'<span class="js_duration undermark" data-total-duration="'+z.totalTime+'">'+z.timeLeft+"</span>":""}var m="";if(z.timeLeft!=null&&u.indexOf("js_activeItemSlider")!=-1){m='<div class="pusher"></div>'}var e="";if($.inArray(birthdayCategory,z.category)!=-1){e='<div class="event_active_hint"></div>'}v.append('<div class="item_img r_'+z.rarity+'" style="background-image: url(/cdn/img/item-images/'+y+');"><div class="item_img_box">'+e+'<div class="activation '+p+k+'"></div><a href="javascript:void(0);" tabindex="1" title="'+n+'" class="detail_button '+l+" "+D+'" ref="'+z.ref+'">'+o+'<span class="ecke"><span class="level '+q+'">'+c+"</span></span></a></div>"+h+m+"</div>")}$("#"+u+"Box").prepend(F);if(x%inventoryObj.itemsPerSlide!=0){for(var w=x%inventoryObj.itemsPerSlide;w<inventoryObj.itemsPerSlide;w++){$("#"+u+" li:last").append('<div class="item_img"><div class="empty border5px"></div></div>')}}return mySlider=$("#"+u).anythingSlider({startStopped:true,buildStartStop:false,expand:true,resizeContents:false,theme:"default",infiniteSlides:false,autoPlay:false,easing:"swing",resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,hashTags:true,buildNavigation:B,onInitialized:function(J,j){if(isMobile){var G=1000,I=50,K=0,M=0,H="ontouchend" in document,N=(H)?"touchstart":"mousedown",L=(H)?"touchmove":"mousemove",i=(H)?"touchend":"mouseup";j.$window.bind(N,function(O){M=(new Date()).getTime();K=O.originalEvent.touches?O.originalEvent.touches[0].pageX:O.pageX}).bind(i,function(O){M=0;K=0}).bind(L,function(Q){var R=Q.originalEvent.touches?Q.originalEvent.touches[0].pageX:Q.pageX,P=(K===0)?0:Math.abs(R-K),O=(new Date()).getTime();if(M!==0&&O-M<G&&P>I){if(R<K){j.goForward()}if(R>K){j.goBack()}M=0;K=0}})}}})},initShop:function(){var a=this;$(window).unbind(".shop");$(document).undelegate(".slideIn","click.shop").delegate(".slideIn","click.shop",function(){if(a.currentItem==$(this).attr("ref")){a.currentItem=null;$.bbq.pushState({item:""})}else{a.currentItem=$(this).attr("ref");$.bbq.pushState({item:$(this).attr("ref")})}});$("button.to_shop").bind("click.shop",function(){$.bbq.pushState({page:"shop"})});$("button.to_inventory").bind("click.shop",function(){$.bbq.pushState({page:"inventory"})});$("button.buyResourcesLink").bind("click",function(){reload_page($(this).data("link"))});$(".to_shop, .to_inventory").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$(".categoryFilter li a").bind("click.shop",function(){$.bbq.pushState({category:$(this).attr("rel")})});$(window).unbind("hashchange.shop").bind("hashchange.shop",function(b){a.onHashChange($.deparam.fragment(b.fragment))});a.onHashChange($.deparam.fragment());inventoryObj.refreshResources()},onHashChange:function(c){if(typeof(c.page)=="undefined"){var e={page:"shop",category:$(".categoryFilter a:first").attr("rel")};if(typeof(c.item)!="undefined"&&c.item!=""){var d=inventoryObj.items_shop[c.item];if(d.category.length>0){e.category=d.category[d.category.length-1]}}$.bbq.pushState(e);return}var b=this.currentPage!=c.page;if(b){if(c.page=="inventory"){this.openInventory();$(".planetlink, .moonlink").fragment({page:c.inventory})}else{this.openShop();$(".planetlink, .moonlink").fragment({page:c.shop})}this.updateCategoryAmount()}if(typeof(c.category)=="undefined"){$.bbq.pushState({category:$(".categoryFilter a:first").attr("rel")});return}else{if(c.category!=this.currentCategory||b){this.changeCategory(c.category)}}if(typeof(c.item)=="undefined"||c.item==""&&this.currentItem!=null){$("#itemDetails a.close_details").click();$(".planetlink, .moonlink").fragment({item:""})}else{if(this.currentItem!=c.item){var a=$(".slideIn[ref='"+c.item+"']");if(a.length){a.click()}else{gfSlider.slideIn(getElementByIdWithCache("detail"),c.item)}$(".planetlink, .moonlink").fragment({item:c.item})}}},initShopDetails:function(){var b=this;var a=$.deparam.querystring().page;$(document).undelegate("#itemDetails .close_details","click").delegate("#itemDetails .close_details","click",function(){gfSlider.hide(getElementByIdWithCache("itemDetails"))}).undelegate("#itemDetails a.item.build-it","click").delegate("#itemDetails a.item.build-it","click",function(){$.ajax({url:$(this).attr("rel"),data:{ajax:1,token:buyToken},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true)},success:function(c){buyToken=c.newToken;if(c.error){fadeBox(c.message,true)}else{fadeBox(c.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(c.item)}}});return false}).undelegate("#itemDetails a.item.build-it_disabled.dm","click").delegate("#itemDetails a.item.build-it_disabled.dm","click",function(){errorBoxDecision(LocalizationStrings.error,loca.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){if($("a.dm_button").length>0){$("a.dm_button").click()}else{window.location.href=$("#darkmatter_box a").attr("href")}})}).undelegate("#itemDetails a.activateItem.build-it","click").delegate("#itemDetails a.activateItem.build-it","click",function(){var e=$(this);function c(){$.ajax({url:e.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:a},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(g){activateToken=g.newToken;if(g.error){fadeBox(g.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{var f=g.message.reload;g=g.message;fadeBox(g.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(g.item);if(f){location.reload();return}}}})}if(e.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,c)}else{if(e.hasClass("isCharacterClassItem")){var d=e.data("itemName");errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.activateItemQuestion.replace("#characterClassName#",d),LocalizationStrings.yes,LocalizationStrings.no,c)}else{c()}}return false}).undelegate("#itemDetails a.buyAndActivate.build-it","click").delegate("#itemDetails a.buyAndActivate.build-it","click",function(){var f=$(this);function c(){$.ajax({url:f.attr("rel"),data:{ajax:1,token:activateToken,referrerPage:a},type:"POST",dataType:"json",error:function(){fadeBox(translation.buyError,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")},success:function(g){activateToken=g.newToken;if(g.error){fadeBox(g.message,true);$("#itemDetails a.activateItem").removeClass("build-it").addClass("build-it_disabled")}else{if(g.message.reload){location.reload();return}g=g.message;fadeBox(g.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(g.item)}}})}if(f.hasClass("isUpgrade")){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,c)}else{if(f.hasClass("isCharacterClassItem")){var d=f.data("itemName");var e=f.data("itemPrice");errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.buyAndActivateItemQuestion.replace("#characterClassName#",d).replace("#darkmatter#",tsdpkt(e)),LocalizationStrings.yes,LocalizationStrings.no,c)}else{c()}}return false})},refreshResources:function(){getAjaxResourcebox(function(a){$(".to_dark_matter .level").text(gfNumberGetHumanReadable(a.darkmatter.amount,isMobile))})},refreshItemData:function(a){var b=a.ref;changeTooltip($(".detail_button[ref='"+b+"']"),a.title);$(".detail_button[ref='"+b+"'] span.amount, #itemDetails[data-uuid='"+b+"'] span.amount").html(tsdpkt(a.amount));if(typeof(inventoryObj.items_inventory)!="undefined"){if(inventoryObj.items_inventory.length==0){inventoryObj.items_inventory={}}else{if(a.amount<=0){delete inventoryObj.items_inventory[b]}else{inventoryObj.items_inventory[b]=a}}}if(typeof(inventoryObj.items_shop)!="undefined"){if(inventoryObj.items_shop.length==0){inventoryObj.items_shop={}}inventoryObj.items_shop[b]=a}changeTooltip($('#itemDetails[data-uuid="'+b+'"] a.activateItem, #itemDetails[data-uuid="'+b+'"] a.buyAndActivate'),a.activationTitle);if(a.hasEnoughCurrency){$('#itemDetails[data-uuid="'+b+'"] a.item').addClass("build-it").removeClass("build-it_disabled")}else{$('#itemDetails[data-uuid="'+b+'"] a.item').removeClass("build-it").addClass("build-it_disabled")}if(a.amount>0){$('#itemDetails[data-uuid="'+b+'"] a.activateItem').show();$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate').hide();if(a.canBeActivated){$('#itemDetails[data-uuid="'+b+'"] a.activateItem').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem').addClass("build-it_disabled").removeClass("build-it")}}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem').hide();$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate').show();if(a.canBeBoughtAndActivated&&a.hasEnoughCurrency){$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate').removeClass("build-it_disabled").addClass("build-it")}else{$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate').addClass("build-it_disabled").removeClass("build-it")}}if(isMobile){var c="";if($('#itemDetails[data-uuid="'+b+'"] a.activateItem:visible,#itemDetails[data-uuid="'+b+'"] a.buyAndActivate:visible').hasClass("build-it_disabled")){c+=a.activationTitle}if(a.buyTitle.length&&a.buyTitle!=a.activationTitle){c+=a.buyTitle}$('#itemDetails[data-uuid="'+b+'"] .info_txt').text(c)}if(a.timeLeft>0&&a.extendable){$('#itemDetails[data-uuid="'+b+'"] a.activateItem span').html(loca.extend);$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate span').html(loca.buyAndExtend)}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem span').html(loca.activate);$('#itemDetails[data-uuid="'+b+'"] a.buyAndActivate span').html(loca.buyAndActivate)}if(a.isAnUpgrade){$('#itemDetails[data-uuid="'+b+'"] a.activateItem, #itemDetails[data-uuid="'+b+'"] a.buyAndActivate').addClass("isUpgrade")}else{$('#itemDetails[data-uuid="'+b+'"] a.activateItem, #itemDetails[data-uuid="'+b+'"] a.buyAndActivate').removeClass("isUpgrade")}if(this.inShop===true){this.changeCategory($(".categoryFilter a.active").attr("rel"))}this.updateCategoryAmount()},boughtItemHint:function(){$(".to_inventory .bought_item_notice").show().fadeOut(1000)},openShop:function(){this.currentPage="shop";$("#js_inventorySliderBox").hide();$("#js_shopSliderBox").show();$(".to_inventory").removeClass("active");$(".to_shop").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_SHOP);if(isMobile){$(".js_shopCurrentPage").html(loca.shopText)}},openInventory:function(){this.currentPage="inventory";$("#js_shopSliderBox").hide();$("#js_inventorySliderBox").show();$(".to_shop").removeClass("active");$(".to_inventory").addClass("active");$("#buttonz h2").text(loca.LOCA_PREMIUM_INVENTORY);if(isMobile){$(".js_shopCurrentPage").html(loca.inventoryText)}},changeCategory:function(b){inventoryObj.currentCategory=b;$(".planetlink, .moonlink").fragment({category:b});$(".categoryFilter li, .categoryFilter li a").removeClass("active");$('.categoryFilter li a[rel="'+b+'"]').addClass("active").parent().addClass("active");$(".anythingSlider").remove();var a=function(d,h){var c=[];var e=[];var g=0;$.each(d,function(i){if(this.category!=null){var j="$"+this.category.join("$")+"$";if(j.toLowerCase().indexOf("$"+b+"$")!=-1){c[inventoryObj.item_orders[b][this.ref]]=this;if(inventoryObj.item_orders[b][this.ref]>g){g=inventoryObj.item_orders[b][this.ref]}}}});for(var f=0;f<=g;++f){if(c[f]){e[f]=c[f]}}inventoryObj.initalizeSlider(e,h,340,340,null,null,null,false)};if(inventoryObj.currentPage=="shop"){a(inventoryObj.items_shop,"js_shopSlider")}else{if(inventoryObj.currentPage=="inventory"){a(inventoryObj.items_inventory,"js_inventorySlider")}}},updateCategoryAmount:function(){var a;if(inventoryObj.currentPage=="shop"){a=inventoryObj.items_shop}else{if(inventoryObj.currentPage=="inventory"){a=inventoryObj.items_inventory}else{return}}var b=$(".categoryFilter");b.find(".amount").text(0);$.each(a,function(c){if(this.category!=null){for(var g in this.category){var f=this.category[g];var e=b.find('a[rel="'+f+'"] .amount');var d;if(inventoryObj.currentPage=="shop"){d=1}else{if(inventoryObj.currentPage=="inventory"){d=this.amount}}e.text(tsdpkt(getValue(e.text())+d))}}});$.each(b.find("li"),function(c){var d=inventoryObj.currentPage.slice(0,1).toUpperCase()+inventoryObj.currentPage.slice(1);if($(this).hasClass("in"+d)){$(this).show()}else{$(this).hide();if(!b.find("li:visible .active").length){b.find("li:visible:first a").click()}}})}};