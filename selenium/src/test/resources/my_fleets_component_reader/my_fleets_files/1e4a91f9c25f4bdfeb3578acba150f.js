ogame.messages.combatreport={data:[{combatReportId:$(".detailReport").attr("data-combatreportid")}],loca:[{weapon:"",shield:"",cover:""}],getCombatValueByCombatMember:function(){var c=ogame.messages.combatreport;var d=c.data.activeMember;var a={armorPercentage:0,weaponPercentage:0,shieldPercentage:0,characterClassName:"-"};var b=0;$.each(c.data.combatArray,function(e,f){if(c.check(true,d,{values:{is:{0:"all"}}})){a.armorPercentage+=f.armorPercentage;a.weaponPercentage+=f.weaponPercentage;a.shieldPercentage+=f.shieldPercentage;b++}else{if(f.ownerName==d){a.armorPercentage=f.armorPercentage;a.weaponPercentage=f.weaponPercentage;a.shieldPercentage=f.shieldPercentage;a.characterClassName=f.ownerCharacterClassName;b=1}}});a.armorPercentage=Math.round(a.armorPercentage/b);a.weaponPercentage=Math.round(a.weaponPercentage/b);a.shieldPercentage=Math.round(a.shieldPercentage/b);return a},setCombatValue:function(){var b=ogame.messages.combatreport;var a=b.getCombatValueByCombatMember();$("."+b.data.combatside+"CharacterClass").text(b.loca.characterClass+" "+a.characterClassName);$("."+b.data.combatside+"Weapon").text(b.loca.weapon+" "+a.weaponPercentage+"%");$("."+b.data.combatside+"Shield").text(b.loca.shield+" "+a.shieldPercentage+"%");$("."+b.data.combatside+"Cover").text(b.loca.cover+" "+a.armorPercentage+"%")},setCombatLoca:function(a,b,e,c){var d=ogame.messages.combatreport;d.loca.weapon=a;d.loca.shield=b;d.loca.cover=e;d.loca.characterClass=c},isActive:function(d,b){var c=ogame.messages.combatreport;for(var a in b){if(a=="length"){continue}if(c.check(true,b[a][d])){return"on"}}if(c.check(true,b[d])){return"on"}return"off"},setActiveFlag4Fleet:function(a,c){var b=ogame.messages.combatreport;var d=b.getAllShipClasses(a);$.each(d,function(h,k){var f=b.getShipIdByClass(k);var l=b.isActive(f,c);var e=b.getShipSelectors(f);b.changeShipState(l,e.ship);if(l=="off"){var j=e.shipCount;var i=e.loss;var g={ships:{},losses:{}};g.ships[j]=0;g.losses[i]="";b.setShipCount(g)}b.toggleShipShowState(e.ship)})},search4Class:function(b,d){for(var a in b){if($("."+b[a]+d)[0]){var c=b[a]+d;return c}}return false},getShipSelectors:function(b){var h=ogame.messages.combatreport;var c=["military","civil","defense"];var g=h.search4Class(c,b);var e="."+h.data.combatside+" ."+g;var f="."+h.data.combatside+" ."+g+" .ecke";var d="."+h.data.combatside+" ."+g+" .lost_ships";var a={ship:e,shipCount:f,loss:d};return a},getShipIdByClass:function(c){var a=c.length;var b=c.substr(a-3);return b},changeShipState:function(b,a){if($(a).hasClass("off")&&b!="off"){$(a).removeClass("off")}if($(a).hasClass("on")&&b!="on"){$(a).removeClass("on")}if(!$(a).hasClass(b)){$(a).addClass(b)}},toggleShipShowState:function(a){if($(a).hasClass("off")){$(a).parent().hide()}if($(a).hasClass("on")){$(a).parent().show()}},getShipsByMembers:function(c){var b=ogame.messages.combatreport;var a=[];if(!b.check(true,b.data.combatArray.shipDetails)){$.each(b.data.combatArray,function(d,e){if(typeof e=="object"&&typeof e.shipDetails!="undefined"){if(typeof a[e.ownerName]!="undefined"){$.extend(a[e.ownerName],e.shipDetails)}else{a[e.ownerName]=e.shipDetails}}else{if(typeof a[e.ownerName]=="undefined"){a[e.ownerName]={}}}})}else{if(typeof a[b.data.combatArray.ownerName]!="undefined"){$.extend(a[b.data.combatArray.ownerName],b.data.combatArray.shipDetails)}else{a[b.data.combatArray.ownerName]=b.data.combatArray.shipDetails}}if(c=="all"){return a}else{return a[c]}},getShipsByMembersAndCoords:function(e,c,b){var d=ogame.messages.combatreport;var a=[];if(!d.check(true,d.data.combatArray.shipDetails)){$.each(d.data.combatArray,function(f,g){if(c!==0){if(typeof g=="object"&&typeof g.shipDetails!="undefined"){if(g.ownerCoordinates===c&&g.ownerName==e&&g.ownerPlanetType==b){if(typeof a[g.ownerName]!="undefined"){$.extend(a[g.ownerName],g.shipDetails)}else{a[g.ownerName]=g.shipDetails}}}}else{if(typeof g=="object"&&typeof g.shipDetails!="undefined"){if(typeof a[g.ownerName]!="undefined"){$.extend(a[g.ownerName],g.shipDetails)}else{a[g.ownerName]=g.shipDetails}}}})}else{if(typeof a[d.data.combatArray.ownerName]!="undefined"){$.extend(a[d.data.combatArray.ownerName],d.data.combatArray.shipDetails)}else{a[d.data.combatArray.ownerName]=d.data.combatArray.shipDetails}}if(e=="all"){return a}else{return a[e]}},getShipCountArray:function(j,e){var h=ogame.messages.combatreport;var a=h.check(true,e,{types:{0:"isEmpty"}})?false:true;var i={};var g={};for(var k in j){var d=h.getShipSelectors(k);var c=d.shipCount;i[c]=parseInt(j[k]);if(!a){var f=d.loss;if(h.check(true,e[k])){g[f]=parseInt(e[k])}}}var b={ships:i,losses:g};return b},setShipCount4All:function(m){var k=ogame.messages.combatreport;var l=m.ships;var h=k.check(true,m.losses)?m.losses:{};var a={};for(var i in l){var c=l[i];var n=(k.check(true,h,{types:{0:"isEmpty"}})&&k.check(true,h[i]))?h[i]:{};a[i]=k.getShipCountArray(c,n)}var g={};var d={};for(var j in a){var b=a[j]["ships"];var f=a[j]["losses"];for(var e in b){if(k.check(true,g[e])){g[e]=g[e]+b[e]}else{g[e]=b[e]}}for(var e in f){if(k.check(true,d[e])){d[e]=d[e]+f[e]}else{d[e]=f[e]}}}var o={ships:g,losses:d};k.setShipCount(o)},setShipCountByActiveMember:function(l,i,e,k,n){k=k||0;n=n||1;var j=ogame.messages.combatreport;var b={};var a={};for(var c in i){var m=i[c]["ownerName"];var d=i[c]["ownerCoordinates"];var f=i[c]["ownerPlanetType"];if(m==e){for(var h in l.ships[c]){if(k!==0){if(k==d&&n==f){if(!(b.hasOwnProperty(h))){b[h]=l.ships[c][h]}else{b[h]=b[h]+l.ships[c][h]}}}else{if(!(b.hasOwnProperty(h))){b[h]=l.ships[c][h]}else{b[h]=b[h]+l.ships[c][h]}}}if(j.check(true,l.losses)){for(var h in l.losses[c]){if(k!==0){if(k==d&&n==f){if(!(a.hasOwnProperty(h))){a[h]=parseInt(l.losses[c][h])}else{a[h]=a[h]+parseInt(l.losses[c][h])}}}else{if(!(a.hasOwnProperty(h))){a[h]=parseInt(l.losses[c][h])}else{a[h]=a[h]+parseInt(l.losses[c][h])}}}}}}if(j.check(true,b,{types:{0:"isEmpty"}})){var g=j.getShipCountArray(b,a);j.setShipCount(g)}},setShipCount:function(d){var e=ogame.messages.combatreport.data.combatside;var b=d.ships;var c=d.losses;if(!$.isEmptyObject(b)){for(var a in b){$(a).text(b[a].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))}}else{$("."+e+" .ecke").text("0")}if(!$.isEmptyObject(c)){for(var a in c){$(a).text("-"+c[a].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))}}else{$("."+e+" .lost_ships").text("-")}},getAllShipClasses:function(a){var c=a.map(function(){var d=$(this).attr("class");return d}).get().join();var b=[];$.each(c.split(","),function(e,f){var d=f.split(" ");b.push(d[1])});return b},displayShipData:function(a,g,f,c,d,b){d=typeof d!=="undefined"?d:0;var e=ogame.messages.combatreport;if(e.check(true,a,{values:{isNot:{0:"all"}}})){e.setShipCountByActiveMember(f,c,a,d,b)}else{e.setShipCount4All(e.data.combatRounds[g][e.data.combatRounds[g].length-1])}},initCombatText:function(c){var b=ogame.messages.combatreport;var a=c.combatRounds.length-1;$(".combat_round_list .round_id").find("a").removeClass("active");$(".combat_round_list .round_id[data-round="+a+"]").find("a").addClass("active");b.loadDataBySelectedRound(c.attackerJSON,c.defenderJSON,a)},setCombatText:function(n,d,p){var l=ogame.messages.combatreport;var j=".statistic_attacker";var o=".statistic_defender";var h=".hits";var b=".strength";var f=".absorbed";var a=0;var i=0;var c=0;var e=0;var m=0;var g=0;if(l.check(true,n,{length:p})){for(var k in n){a=a+parseInt(n[k]["statistic"]["hits"]);i=i+parseInt(n[k]["statistic"]["absorbedDamage"]);c=c+parseInt(n[k]["statistic"]["fullStrength"]);e=e+parseInt(d[k]["statistic"]["hits"]);m=m+parseInt(d[k]["statistic"]["absorbedDamage"]);g=g+parseInt(d[k]["statistic"]["fullStrength"])}}else{a=parseInt(n[p]["statistic"]["hits"]);i=parseInt(n[p]["statistic"]["absorbedDamage"]);c=parseInt(n[p]["statistic"]["fullStrength"]);e=parseInt(d[p]["statistic"]["hits"]);m=parseInt(d[p]["statistic"]["absorbedDamage"]);g=parseInt(d[p]["statistic"]["fullStrength"])}$(j+h).text(a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(j+f).text(i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(j+b).text(c.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(o+h).text(e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(o+f).text(m.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(o+b).text(g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."))},setCombatArray:function(a,d){var b=jQuery.extend(true,{},a);var c=ogame.messages.combatreport;c.data.combatside=d;c.data.memberSelection=false;if($("#"+c.data.combatside+"_select_combatreport").find(":selected").length>0){c.data.memberSelection=true}if(c.data.memberSelection){c.data.activeMember=""+$("#"+c.data.combatside+"_select_combatreport").find(":selected").val()}else{c.data.activeMember=""+$("#"+c.data.combatside+"_select_combatreport").data("memberName")}c.data.activeMember=c.data.activeMember.split("|",1)[0];c.data.combatArray=b.member;c.data.combatRounds=[];c.data.combatRounds[d]=b.combatRounds},setCombatside:function(b){var a=ogame.messages.combatreport;a.data.combatside=b},check:function(d,c,a){var a=(a!=null&&typeof a!="undefined"&&typeof a=="object")?a:false;var k=false;var m=0;var o=0;var h=0;var g=0;var n=false;if(a!=false){var f=a.values!=null&&typeof a.values!="undefined"&&typeof a.values=="object"?a.values:{};var q=a.types!=null&&typeof a.types!="undefined"&&typeof a.types=="object"?a.types:{};var r=a.length!=null&&typeof a.length!="undefined"?a.length:false;if(!jQuery.isEmptyObject(f)){for(j in f){var b=f[j];if(j=="is"&&!jQuery.isEmptyObject(b)){for(var p in b){if(c!=b[p]){m=m+1}}}if(j=="isNot"&&!jQuery.isEmptyObject(b)){for(var i in b){if(c==b[i]){m=m+1}}}}}if(!jQuery.isEmptyObject(q)){if(q.isEmpty){if(jQuery.isEmptyObject(c)){o=o+1}}for(var j in q){if(typeof c==q[j]){o=o+1}}}if(typeof c=="object"){for(var j in c){if(typeof c[j]!="undefined"){g=g+1}}}else{var e=c+"";g=e.length}if(r!==false&&typeof r=="number"&&typeof g=="number"){if(g!=r){h=h+1}n=true}}if(typeof c=="undefined"||c==null){o=o+1}var s=m+o;if(n!=false){s=s+h}if(s==0){k=true}var l={success:k,allErrors:s,valueErrors:m,typeErrors:o,type:typeof c,length:g,lengthChecked:n,lengthError:h};if(d){return k}else{return l}},loadData:function(a,c){var b=ogame.messages.combatreport;b.setCombatArray(a,c);b.loadDataBySelectedCombatMember(a,c);b.setCombatValue()},loadDataBySelectedRound:function(g,f,j){var k=ogame.messages.combatreport;var h=parseInt(j);var a=$(".attacker .participant_select option:selected").val();var e=$(".defender .participant_select option:selected").val();var b=$(".attacker .participant_select option:selected").data("coords");var q=$(".defender .participant_select option:selected").data("coords");var c=[];var d=[];if(typeof b!="undefined"){ids=a.split("|")[1].split(":");c.push(ids);a=a.split("|")[0]}else{if(a!="all"&&typeof a!="undefined"){b=0;$(".attacker .participant_select option").each(function(){if(a==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){c.push($(this).val().split("|")[1].split(":"))}})}else{c=[]}}if(typeof q!="undefined"){ids=e.split("|")[1].split(":");d.push(ids);e=e.split("|")[0]}else{if(e!="all"&&typeof e!="undefined"){q=0;$(".defender .participant_select option").each(function(){if(e==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){d.push($(this).val().split("|")[1].split(":"))}})}else{d=[]}}if(c.length>0){for(var m in g){if(m=="combatRounds"){for(var l in g[m][h]){if(l=="ships"){for(var p in g[m][h][l]){var i=$.inArray(p,c[0]);if(i==-1){delete g[m][h][l][p]}}}}}}}if(d.length>0){for(var m in f){if(m=="combatRounds"){for(var l in f[m][h]){if(l=="ships"){for(var p in f[m][h][l]){var i=$.inArray(p,d[0]);if(i==-1){delete f[m][h][l][p]}}}}}}}var n=g.combatRounds;var o=f.combatRounds;if(k.check(true,n,{length:j})){h=h-1}h=h+"";k.setCombatside("attacker");k.setShipCount4All(n[h]);k.setCombatside("defender");k.setShipCount4All(o[h]);if(k.data.memberSelection){}k.setCombatText(n,o,j)},resetDropDowns:function(){$("#attacker_select_combatreport").val("all").ogameDropDown("refresh");$("#defender_select_combatreport").val("all").ogameDropDown("refresh")},loadDataBySelectedCombatMember:function(a,d,g,i){var h=jQuery.extend(true,{},a);g=g||0;i=i||1;var e=ogame.messages.combatreport;e.setCombatArray(h,d);var f=$("."+e.data.combatside+" .buildingimg");var c=$("."+e.data.combatside+" .defenseimg");f=$.merge(f,c);var b=e.getShipsByMembersAndCoords(e.data.activeMember,g,i);e.setActiveFlag4Fleet(f,b);e.displayShipData(e.data.activeMember,e.data.combatside,h.combatRounds[h.combatRounds.length-1],h.member,g,i);e.setCombatValue()}};