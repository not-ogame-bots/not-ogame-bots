// Copyright 2006 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
document.createElement("canvas").getContext||function(){function C(){}function B(a){this.type_=a,this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0,this.colors_=[];}function A(a,b,c){!z(b)||(a.m_=b,c&&(a.lineScale_=f(e(b[0][0]*b[1][1]-b[0][1]*b[1][0]))));}function z(a){var b=0;for(;b<3;b++){var c=0;for(;c<2;c++)if(!isFinite(a[b][c])||isNaN(a[b][c]))return!1;}return!0;}function y(a,b,c,d){a.currentPath_.push({type:"bezierCurveTo",cp1x:b.x,cp1y:b.y,cp2x:c.x,cp2y:c.y,x:d.x,y:d.y}),a.currentX_=d.x,a.currentY_=d.y;}function w(a){this.m_=r(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.fillStyle=this.strokeStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=g*1,this.globalAlpha=1,this.canvas=a;var b=a.ownerDocument.createElement("div");b.style.width=a.clientWidth+"px",b.style.height=a.clientHeight+"px",b.style.overflow="hidden",b.style.position="absolute",a.appendChild(b),this.element_=b,this.lineScale_=this.arcScaleY_=this.arcScaleX_=1;}function v(a){switch(a){case"butt":return"flat";case"round":return"round";case"square":default:return"square";}}function u(a){var b,c=1;a=String(a);if(a.substring(0,3)=="rgb"){var d=a.indexOf("(",3),e=a.indexOf(")",d+1),f=a.substring(d+1,e).split(",");b="#";var g=0;for(;g<3;g++)b+=o[Number(f[g])];f.length==4&&a.substr(3,1)=="a"&&(c=f[3]);}else b=a;return{color:b,alpha:c};}function t(a,b){b.fillStyle=a.fillStyle,b.lineCap=a.lineCap,b.lineJoin=a.lineJoin,b.lineWidth=a.lineWidth,b.miterLimit=a.miterLimit,b.shadowBlur=a.shadowBlur,b.shadowColor=a.shadowColor,b.shadowOffsetX=a.shadowOffsetX,b.shadowOffsetY=a.shadowOffsetY,b.strokeStyle=a.strokeStyle,b.globalAlpha=a.globalAlpha,b.arcScaleX_=a.arcScaleX_,b.arcScaleY_=a.arcScaleY_,b.lineScale_=a.lineScale_;}function s(a,b){var c=r(),d=0;for(;d<3;d++){var e=0;for(;e<3;e++){var f=0,g=0;for(;g<3;g++)f+=a[d][g]*b[g][e];c[d][e]=f;}}return c;}function r(){return[[1,0,0],[0,1,0],[0,0,1]];}function n(a){var b=a.srcElement;b.firstChild&&(b.firstChild.style.width=b.clientWidth+"px",b.firstChild.style.height=b.clientHeight+"px");}function m(a){var b=a.srcElement;switch(a.propertyName){case"width":b.style.width=b.attributes.width.nodeValue+"px",b.getContext().clearRect();break;case"height":b.style.height=b.attributes.height.nodeValue+"px",b.getContext().clearRect();}}function k(a,b){var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)));};}function i(){return this.context_||(this.context_=new w(this));}var a=Math,b=a.round,c=a.sin,d=a.cos,e=a.abs,f=a.sqrt,g=10,h=g/2,j=Array.prototype.slice,l={init:function(a){if(/MSIE/.test(navigator.userAgent)&&!window.opera){var b=a||document;b.createElement("canvas"),b.attachEvent("onreadystatechange",k(this.init_,this,b));}},init_:function(a){a.namespaces.g_vml_||a.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML"),a.namespaces.g_o_||a.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!a.styleSheets.ex_canvas_){var b=a.createStyleSheet();b.owningElement.id="ex_canvas_",b.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}";}var c=a.getElementsByTagName("canvas"),d=0;for(;d<c.length;d++)this.initElement(c[d]);},initElement:function(a){if(!a.getContext){a.getContext=i,a.innerHTML="",a.attachEvent("onpropertychange",m),a.attachEvent("onresize",n);var b=a.attributes;b.width&&b.width.specified?a.style.width=b.width.nodeValue+"px":a.width=a.clientWidth,b.height&&b.height.specified?a.style.height=b.height.nodeValue+"px":a.height=a.clientHeight;}return a;}};l.init();var o=[],p=0;for(;p<16;p++){var q=0;for(;q<16;q++)o[p*16+q]=p.toString(16)+q.toString(16);}var x=w.prototype;x.clearRect=function(){this.element_.innerHTML="";},x.beginPath=function(){this.currentPath_=[];},x.moveTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"moveTo",x:c.x,y:c.y}),this.currentX_=c.x,this.currentY_=c.y;},x.lineTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"lineTo",x:c.x,y:c.y}),this.currentX_=c.x,this.currentY_=c.y;},x.bezierCurveTo=function(a,b,c,d,e,f){var g=this.getCoords_(e,f),h=this.getCoords_(a,b),i=this.getCoords_(c,d);y(this,h,i,g);},x.quadraticCurveTo=function(a,b,c,d){var e=this.getCoords_(a,b),f=this.getCoords_(c,d),g={x:this.currentX_+.6666666666666666*(e.x-this.currentX_),y:this.currentY_+.6666666666666666*(e.y-this.currentY_)};y(this,g,{x:g.x+(f.x-this.currentX_)/3,y:g.y+(f.y-this.currentY_)/3},f);},x.arc=function(a,b,e,f,i,j){e*=g;var k=j?"at":"wa",l=a+d(f)*e-h,m=b+c(f)*e-h,n=a+d(i)*e-h,o=b+c(i)*e-h;l==n&&!j&&(l+=.125);var p=this.getCoords_(a,b),q=this.getCoords_(l,m),r=this.getCoords_(n,o);this.currentPath_.push({type:k,x:p.x,y:p.y,radius:e,xStart:q.x,yStart:q.y,xEnd:r.x,yEnd:r.y});},x.rect=function(a,b,c,d){this.moveTo(a,b),this.lineTo(a+c,b),this.lineTo(a+c,b+d),this.lineTo(a,b+d),this.closePath();},x.strokeRect=function(a,b,c,d){var e=this.currentPath_;this.beginPath(),this.moveTo(a,b),this.lineTo(a+c,b),this.lineTo(a+c,b+d),this.lineTo(a,b+d),this.closePath(),this.stroke(),this.currentPath_=e;},x.fillRect=function(a,b,c,d){var e=this.currentPath_;this.beginPath(),this.moveTo(a,b),this.lineTo(a+c,b),this.lineTo(a+c,b+d),this.lineTo(a,b+d),this.closePath(),this.fill(),this.currentPath_=e;},x.createLinearGradient=function(a,b,c,d){var e=new B("gradient");e.x0_=a,e.y0_=b,e.x1_=c,e.y1_=d;return e;},x.createRadialGradient=function(a,b,c,d,e,f){var g=new B("gradientradial");g.x0_=a,g.y0_=b,g.r0_=c,g.x1_=d,g.y1_=e,g.r1_=f;return g;},x.drawImage=function(c){var d,e,f,h,i,j,k,l,m=c.runtimeStyle.width,n=c.runtimeStyle.height;c.runtimeStyle.width="auto",c.runtimeStyle.height="auto";var o=c.width,p=c.height;c.runtimeStyle.width=m,c.runtimeStyle.height=n;if(arguments.length==3)d=arguments[1],e=arguments[2],i=j=0,k=f=o,l=h=p;else if(arguments.length==5)d=arguments[1],e=arguments[2],f=arguments[3],h=arguments[4],i=j=0,k=o,l=p;else if(arguments.length==9)i=arguments[1],j=arguments[2],k=arguments[3],l=arguments[4],d=arguments[5],e=arguments[6],f=arguments[7],h=arguments[8];else throw Error("Invalid number of arguments");var q=this.getCoords_(d,e),r=[];r.push(" <g_vml_:group",' coordsize="',g*10,",",g*10,'"',' coordorigin="0,0"',' style="width:',10,"px;height:",10,"px;position:absolute;");if(this.m_[0][0]!=1||this.m_[0][1]){var s=[];s.push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",b(q.x/g),",","Dy=",b(q.y/g),"");var t=q,u=this.getCoords_(d+f,e),v=this.getCoords_(d,e+h),w=this.getCoords_(d+f,e+h);t.x=a.max(t.x,u.x,v.x,w.x),t.y=a.max(t.y,u.y,v.y,w.y),r.push("padding:0 ",b(t.x/g),"px ",b(t.y/g),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",s.join(""),", sizingmethod='clip');");}else r.push("top:",b(q.y/g),"px;left:",b(q.x/g),"px;");r.push(' ">','<g_vml_:image src="',c.src,'"',' style="width:',g*f,"px;"," height:",g*h,'px;"',' cropleft="',i/o,'"',' croptop="',j/p,'"',' cropright="',(o-i-k)/o,'"',' cropbottom="',(p-j-l)/p,'"'," />","</g_vml_:group>"),this.element_.insertAdjacentHTML("BeforeEnd",r.join(""));},x.stroke=function(c){var d=[],e=u(c?this.fillStyle:this.strokeStyle),f=e.color,h=e.alpha*this.globalAlpha;d.push("<g_vml_:shape",' filled="',!!c,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',g*10," ",g*10,'"',' stroked="',!c,'"',' path="');var i={x:null,y:null},j={x:null,y:null},k=0;for(;k<this.currentPath_.length;k++){var l=this.currentPath_[k];switch(l.type){case"moveTo":d.push(" m ",b(l.x),",",b(l.y));break;case"lineTo":d.push(" l ",b(l.x),",",b(l.y));break;case"close":d.push(" x "),l=null;break;case"bezierCurveTo":d.push(" c ",b(l.cp1x),",",b(l.cp1y),",",b(l.cp2x),",",b(l.cp2y),",",b(l.x),",",b(l.y));break;case"at":case"wa":d.push(" ",l.type," ",b(l.x-this.arcScaleX_*l.radius),",",b(l.y-this.arcScaleY_*l.radius)," ",b(l.x+this.arcScaleX_*l.radius),",",b(l.y+this.arcScaleY_*l.radius)," ",b(l.xStart),",",b(l.yStart)," ",b(l.xEnd),",",b(l.yEnd));}if(l){if(i.x==null||l.x<i.x)i.x=l.x;if(j.x==null||l.x>j.x)j.x=l.x;if(i.y==null||l.y<i.y)i.y=l.y;if(j.y==null||l.y>j.y)j.y=l.y;}}d.push(' ">');if(c){if(typeof this.fillStyle=="object"){var m=this.fillStyle,n=0,o={x:0,y:0},p=0,q=1;if(m.type_=="gradient"){var r=m.x1_/this.arcScaleX_,s=m.y1_/this.arcScaleY_,t=this.getCoords_(m.x0_/this.arcScaleX_,m.y0_/this.arcScaleY_),w=this.getCoords_(r,s);n=Math.atan2(w.x-t.x,w.y-t.y)*180/Math.PI,n<0&&(n+=360),n<1e-6&&(n=0);}else{var t=this.getCoords_(m.x0_,m.y0_),x=j.x-i.x,y=j.y-i.y;o={x:(t.x-i.x)/x,y:(t.y-i.y)/y},x/=this.arcScaleX_*g,y/=this.arcScaleY_*g;var z=a.max(x,y);p=2*m.r0_/z,q=2*m.r1_/z-p;}var A=m.colors_;A.sort(function(a,b){return a.offset-b.offset;});var B=A.length,C=A[0].color,D=A[B-1].color,E=A[0].alpha*this.globalAlpha,F=A[B-1].alpha*this.globalAlpha,G=[],k=0;for(;k<B;k++){var H=A[k];G.push(H.offset*q+p+" "+H.color);}d.push('<g_vml_:fill type="',m.type_,'"',' method="none" focus="100%"',' color="',C,'"',' color2="',D,'"',' colors="',G.join(","),'"',' opacity="',F,'"',' g_o_:opacity2="',E,'"',' angle="',n,'"',' focusposition="',o.x,",",o.y,'" />');}else d.push('<g_vml_:fill color="',f,'" opacity="',h,'" />');}else{var I=this.lineScale_*this.lineWidth;I<1&&(h*=I),d.push("<g_vml_:stroke",' opacity="',h,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',v(this.lineCap),'"',' weight="',I,'px"',' color="',f,'" />');}d.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",d.join(""));},x.fill=function(){this.stroke(!0);},x.closePath=function(){this.currentPath_.push({type:"close"});},x.getCoords_=function(a,b){var c=this.m_;return{x:g*(a*c[0][0]+b*c[1][0]+c[2][0])-h,y:g*(a*c[0][1]+b*c[1][1]+c[2][1])-h};},x.save=function(){var a={};t(this,a),this.aStack_.push(a),this.mStack_.push(this.m_),this.m_=s(r(),this.m_);},x.restore=function(){t(this.aStack_.pop(),this),this.m_=this.mStack_.pop();},x.translate=function(a,b){A(this,s([[1,0,0],[0,1,0],[a,b,1]],this.m_),!1);},x.rotate=function(a){var b=d(a),e=c(a);A(this,s([[b,e,0],[-e,b,0],[0,0,1]],this.m_),!1);},x.scale=function(a,b){this.arcScaleX_*=a,this.arcScaleY_*=b,A(this,s([[a,0,0],[0,b,0],[0,0,1]],this.m_),!0);},x.transform=function(a,b,c,d,e,f){A(this,s([[a,b,0],[c,d,0],[e,f,1]],this.m_),!0);},x.setTransform=function(a,b,c,d,e,f){A(this,[[a,b,0],[c,d,0],[e,f,1]],!0);},x.clip=function(){},x.arcTo=function(){},x.createPattern=function(){return new C();},B.prototype.addColorStop=function(a,b){b=u(b),this.colors_.push({offset:a,color:b.color,alpha:b.alpha});},G_vmlCanvasManager=l,CanvasRenderingContext2D=w,CanvasGradient=B,CanvasPattern=C;}();/*! jQuery UI - v1.11.4 - 2015-03-11
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, draggable.js, droppable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js, menu.js, progressbar.js, resizable.js, selectable.js, selectmenu.js, slider.js, sortable.js, spinner.js, tabs.js, tooltip.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery);})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t);}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility");}).length;}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent();}return 0;}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover");}).delegate(i,"mouseover",o);}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"));}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t;}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change");};}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"));}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document);},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e);});};}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id");});}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t);};}):function(t,i,s){return!!e.data(t,s[3]);},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")));},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n);}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0);}),i;}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px");});},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px");});};}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e));}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this);};}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t);},i);}):t.apply(this,arguments);};}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault();});};}(),enableSelection:function(){return this.unbind(".ui-disableSelection");},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent();}return 0;}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]]);},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i);}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove");}catch(o){}t(i);};}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n);},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t);},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i(),r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments);},n=function(e){return i.prototype[t].apply(this,e);};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t;};}(),void 0):(h[t]=s,void 0);}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto);}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o;},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t;},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=u.call(arguments,1),r=this;return a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'");}):(o.length&&(n=e.widget.extend.apply(null,[n].concat(o))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this));})),r;};},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy();}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init();},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus");},_destroy:e.noop,widget:function(){return this.element;},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i;}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i;}return this._setOptions(o),this;},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this;},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this;},enable:function(){return this._setOptions({disabled:!1});},disable:function(){return this._setOptions({disabled:!0});},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0;}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r);});},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get());},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments);}var s=this;return setTimeout(i,t||0);},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover");},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus");},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented());}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i();});};}),e.widget;var d=!1;e(document).mouseup(function(){d=!1;}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e);}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0;}),this.started=!1;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0;},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e);},this._mouseUpDelegate=function(e){return i._mouseUp(e);},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0;}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t);}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted);},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),d=!1,!1;},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance;},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0;}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)];}function i(t,i){return parseInt(e.css(t,i),10)||0;}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()};}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i;},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0};},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()};}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]];}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?M.left-=d:"center"===n.my[0]&&(M.left-=d/2),"bottom"===n.my[1]?M.top-=c:"center"===n.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u});}),n.using&&(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h);}),u.offset(e.extend(M,{using:l}));});},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left);},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top);}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f));},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m));}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments);},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments);}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t);}();}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh();},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()};},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"));},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove();},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","");},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)),void 0);},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1];}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault());}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus();},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh();},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)));},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");t.attr("aria-controls",n),s.attr("aria-labelledby",i);}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0));}),this.headers.each(function(){t-=e(this).outerHeight(!0);}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()));}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height());}).height(t));},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}));},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e();},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler";}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers);},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&&i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")));},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10);}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.css("box-sizing"),l=e.length&&(!t.length||e.index()<t.index()),u=this.options.animate||{},d=l&&u.down||u,c=function(){o._toggleComplete(i);};return"number"==typeof d&&(a=d),"string"==typeof d&&(n=d),n=n||d.easing||u.easing,a=a||d.duration||u.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e);}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:c,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===h&&(r+=i.now):"content"!==o.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0);}}),void 0):t.animate(this.hideProps,a,n,c):e.animate(this.showProps,a,n,c);},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e);}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault();},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)));},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i);}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i);},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t);});},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1;}});},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove();}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content");},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter;},1e3)):delete this.previousFilter;}o&&t.preventDefault();},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e));},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"));}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider");}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur();},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t);},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close();},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t});},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r));},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}));},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e);},this.delay));},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i);},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s;},this.delay);},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active");},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length;},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text());},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t));},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t);}));},next:function(e){this._move("next","first",e);},previous:function(e){this._move("prev","last",e);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s);},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n;}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0);},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0;}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0);},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i);},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()));});}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n);}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s);}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0);},focus:function(){this.selectedItem=null,this.previous=this._value();},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0);}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur;});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close();});});},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent);}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0);},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i;})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i;}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove();},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort();},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t;},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term));}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e);},error:function(){n([]);}});}):this.source=this.options.source;},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e));},this.options.delay);},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0;},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response());},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading");},this);},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close();},close:function(e){this.cancelSearch=!0,this._close(e);},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e));},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem});},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label});});},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next();},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i);});},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t);},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t);},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault());}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e);});}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion));}}),e.ui.autocomplete;var c,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",m=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh");},1);},g=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form;})),n;};e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,m),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===c&&e(this).addClass("ui-state-active");}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n);}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation());}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus");},blur:function(){this.buttonElement.removeClass("ui-state-focus");}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh();}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0;}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];g(s).not(s).map(function(){return e(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed","false");}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),c=this,t.document.one("mouseup",function(){c=null;}),void 0);}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0);}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0);}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active");}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click();})),this._setOption("disabled",i.disabled),this._resetButton();},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element;},widget:function(){return this.buttonElement;},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title");},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0);},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?g(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false");}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"));},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "));}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t);},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end();},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}});var v;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(e){return r(this._defaults,e||{}),this;},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a);},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv};},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t));},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1;}));},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s;},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length);}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"));},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this;},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),v===n&&(v=null));},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1;}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e;}));},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0;}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e;}),this._disabledInputs[this._disabledInputs.length]=t);},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1;},_getInst:function(t){try{return e.data(t,"datepicker");}catch(i){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0);},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i);},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t);},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i));},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null;},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1;}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation());},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0;},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s));}catch(n){}return!0;},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o;}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i));}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null;},0));},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus");},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i;},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top];},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o);},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1);},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar");},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker();}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a));},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date(),n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s);},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n);},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)));},_clearDate:function(t){var i=e(t);this._selectDate(i,"");},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null);},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n);}));},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""];},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1;},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:new Date().getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i;},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10);},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]];}).sort(function(e,t){return-(e[1].length-t[1].length);});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0;}),-1!==a)return a+1;throw"Unknown name at position "+h;},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++;};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k();}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=new Date().getFullYear():100>m&&(m+=new Date().getFullYear()-new Date().getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a;}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i;},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s;},u=function(e,t,i,s){return h(e)?s[t]:i[t];},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s);}return d;},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s;};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t);}return i;},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t];},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n;}catch(r){s=t?"":s;}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e);}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date()));},_determineDate:function(t,i,s){var n=function(e){var t=new Date();return t.setDate(t.getDate()+e),t;},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t));}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date(),a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));}l=h.exec(i);}return new Date(a,o,r);},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o);},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null;},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date()));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e));},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t;},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M");},next:function(){e.datepicker._adjustDate(s,+i,"M");},hide:function(){e.datepicker._hideDatepicker();},today:function(){e.datepicker._gotoToday(s);},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1;},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1;},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1;}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")]);});},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,H,z,F,E,O,j,W,L=new Date(),R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),J=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),K=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),U=this._get(e,"stepMonths"),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-V,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;K[0]>w;w++){for(k="",this.maxRows=4,T=0;K[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",M="",Q){if(M+="<div class='ui-datepicker-group",K[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case K[1]-1:M+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",S="";}M+="'>";}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,X,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",C=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+u)%7,C+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[N]+"'>"+p[N]+"</span></th>";for(M+=C+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),H=Q?this.maxRows>I?this.maxRows:I:I,this.maxRows=H,z=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;H>F;F++){for(M+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",x=0;7>x;x++)O=g?g.apply(e.input?e.input[0]:null,[z]):[!0,""],j=z.getMonth()!==Z,W=j&&!y||!O[0]||X&&X>z||$&&z>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(z.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===z.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+O[1]+(z.getTime()===G.getTime()?" "+this._currentClass:"")+(z.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===R.getTime()?" ui-state-highlight":"")+(z.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);M+=E+"</tr>";}Z++,Z>11&&(Z=0,et++),M+="</tbody></table>"+(Q?"</div>"+(K[0]>0&&T===K[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=M;}_+=k;}return _+=l,e._keyEvent=!1,_;},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>";}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=new Date().getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t;},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null;}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>";},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e);},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n;},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e]);},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t;},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null);},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate();},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay();},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a);},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=new Date().getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear());},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:new Date().getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")};},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e));}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t);}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i));},e.datepicker=new n(),e.datepicker.initialized=!1,e.datepicker.uuid=new Date().getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit();},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName());},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0);},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1);},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0];});},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks);},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur();}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position");}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0);},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top};},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position;}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1;},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear();}):this._trigger("stop",t)!==!1&&this._clear(),!1;},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t);},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this;},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0;},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle");},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle");},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n;},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative");},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);},_isRootNode:function(e){return /(html|body)/i.test(e.tagName)||e===this.document[0];},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())};},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0);},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i};},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)};},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy();},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"));},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n));});},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n));});},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n;})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0];},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions();}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions();}));});}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor);},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor);}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity);},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity);}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset());},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t);}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left});});},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p);}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0);});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t);}),this.css("zIndex",n+o.length));}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex);},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex);}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0;},_isNumber:function(e){return!isNaN(parseInt(e,10));},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n);},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i]);},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se");}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show());}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide());})),this._mouseInit();},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove();};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this;},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n;},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0;},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1;},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1;},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height};},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e;},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a;},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width);},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e;},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e;},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]};},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0});},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element;},_change:{e:function(e,t){return{width:this.originalSize.width+t};},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t};},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i};},s:function(e,t,i){return{height:this.originalSize.height+i};},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]));},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]));},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]));},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]));}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui());},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t);}});}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s));}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}));},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height);},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l});}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)});});},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},a=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null);}),t.css(n);});},stop:function(){e(this).removeData("resizable-alsoresize");}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper);},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width});},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0));}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p));}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i);}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus();},_init:function(){this.options.autoOpen&&this.open();},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0);},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element);},widget:function(){return this.uiDialog;},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur();}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t);});}},isOpen:function(){return this._isOpen;},moveToTop:function(){this._moveToTop();},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index");}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s;},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus");}),this._makeFocusTarget(),this._trigger("open"),void 0);},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus();},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable();}t.preventDefault(),i.call(this),this._delay(i);},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus();}),t.preventDefault()):(this._delay(function(){s.focus();}),t.preventDefault());}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable();}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")});},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus();}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e);}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")});},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title);},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons();},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments);},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet);}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0);},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset};}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n));},drag:function(e,s){i._trigger("drag",e,t(s));},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a));}});},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size};}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n));},resize:function(e,s){i._trigger("resize",e,t(s));},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a));}}).css("position",a);},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target);}});},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this);},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1);},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e;},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height);},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide();},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t);}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n);},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")));},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight());},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0];});},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks);},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length;},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1;}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable());}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1);}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null;}}}),e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s);},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable");},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this);},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1);},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled");},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i);};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i);}this._super(t,i);},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i));},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i));},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)));},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)));},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0;}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1;},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs};}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e;}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1;}};}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e;}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}));}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)));}),s;},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i);});},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n;}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)));}});},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i);}},e.ui.droppable;var y="ui-effects-",b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e);}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t;}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i];}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e;}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]];}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n);},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1};}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t);}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice());}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba);}d[a][t.idx]=i(n[e],t,!0);}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])));}),this):t;},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t;})),s;}),s;},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i);}),e.pop();},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)));}),this[n](h);},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e;}));},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e;});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")";},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e;});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")";},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e;}).join("");},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString();}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o];},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a];},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t);}),u?(n=l(u(c)),n[o]=c,n):l(c);},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)));});});}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode;}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default");}n=n.toRgbaString();}try{t.style[i]=n;}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos));};});},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e;}),t;}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a;}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o;}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(b.style(e.elem,i,e.end),e.setAttr=!0);};}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e));}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)};}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t]);});},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this;}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t);}});return this.el.animate(this.diff,s),i.promise();}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"");});}),h.complete.call(o[0]);});});},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments);};}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments);};}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a);};}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a);}});}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t;}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0;}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(y+t[i],e[0].style[t[i]]);},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(y+t[s]),void 0===i&&(i=""),e.css(t[s],i));},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t;},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height;}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width;}return{x:s,y:i};},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id;}catch(o){a=document.body;}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto");}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show();},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t;},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1]);}),n;}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t();}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i);}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this);}):a===!1?this.each(i):this.queue(a||"fx",i);},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n);};}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n);};}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n);};}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t]);}),s;}});}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2);};}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2);},Circ:function(e){return 1-Math.sqrt(1-e*e);},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15);},Back:function(e){return e*e*(3*e-2);},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2);}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e);},e.easing["easeInOut"+t]=function(e){return .5>e?i(2*e)/2:1-i(-2*e+2)/2;};});}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i();}});},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i();}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue();},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i();}});},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i();}});},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n();}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i();}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s);},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i});},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i();});},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i();}});},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l);});})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px";});})),e.effects.removeWrapper(o),i();}});},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n);},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t);},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i();}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue();},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i();}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue();},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i();}});},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i();});},e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue();},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove();},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0);},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e));},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue();},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t);},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min);},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete");}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")});});},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>");},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy();},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}));}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0;}));},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))));}),!1;}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element});}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element});}),this._trigger("stop",t),this.helper.remove(),!1;}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable();},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault();}}),this.element.hide(),this.button=e("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu();}),this._hoverable(this.button),this._focusable(this.button);},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e);},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"));}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1;},this.menuInstance._isDivider=function(){return!1;};},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton();},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")));},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e));},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position));},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e));},widget:function(){return this.button;},menuWidget:function(){return this.menu;},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,a){a.optgroup!==n&&(e("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(a.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a);});},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t);},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t);},_setText:function(e,t){t?e.text(t):e.html("&#160;");},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0),s.length&&this.menuInstance.focus(t,s);},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex);},_toggle:function(e){this[this.isOpen?"close":"open"](e);},_setSelection:function(){var e;this.range&&(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus());},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t));}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&&(this.range=e.getRangeAt(0))):this.range=document.selection.createRange();},click:function(e){this._setSelection(),this._toggle(e);},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1;}i&&t.preventDefault();}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e);},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t);},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t);},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton();},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t;},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen);},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e);},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1));},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")};},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:a.attr("label")||"",disabled:a.prop("disabled")||n.prop("disabled")});}),this.items=i;},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element);}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1;},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue();},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t);});},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null);},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles);},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy();},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t);}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0));},_mouseStart:function(){return!0;},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1;},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1;},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal";},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a);},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i);},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i));},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i);},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i);}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value();},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue();},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1;}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e);},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i;}return[];},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5));},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()));},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e;},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1;},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.max;},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i;}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}));},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return;}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a);}this._slide(t,o,n);},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"));}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e;},_isFloating:function(e){return /left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"));},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0;},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName();},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle");});},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this;},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0;}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0);}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1);},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0;},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break;}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1;},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t);});}else this._clear(t,i);return!1;}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0);}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this;},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]));}),!s.length&&t.key&&s.push(t.key+"="),s.join("&");},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"");}),s;},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2;},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1;},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t);},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up");},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left");},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this;},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith;},_getItemsAsjQuery:function(t){function i(){r.push(this);}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r);},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0;});},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0});},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this;},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n;},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)));}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder);},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i);});},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i;}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1;}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s;},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}return{top:0,left:0};},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]);},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s};},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())};},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s);});},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t));};}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside));}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash());}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash());}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this));};}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this));};}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash());}return this.fromOutside=!1,!this.cancelHelperRemoval;},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel();},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null};}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n);}),t;},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault();},keyup:"_stop",focus:function(){this.previous=this.element.val();},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0);},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e);},100),e.preventDefault();}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s;}));}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this);}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t);},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0;},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable();},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0;}return!1;},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>";},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>";},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1;},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i);},e),this._spin(t*this.options.step,i);},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++);},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1;},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e;},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1;},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e;},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e));},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0;}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"));},_setOptions:h(function(e){this._super(e);}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e;},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e;},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e);},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh();},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element);},stepUp:h(function(e){this._stepUp(e);}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop());},stepDown:h(function(e){this._stepDown(e);}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop());},pageUp:h(function(e){this._stepUp((e||1)*this.options.page);}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page);}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val());},widget:function(){return this.uiSpinner;}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i);}catch(n){}try{s=decodeURIComponent(s);}catch(n){}return t.hash.length>1&&i===s;};}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e);}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active);},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===s?(t=i,!1):void 0;}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t;},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()};},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return;}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s);},this.delay));}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus());},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0;},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t;}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t;},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e;},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0);},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e);}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh();},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0);},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault();}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur();}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0];}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr("id"),h=e(s).closest("li"),l=h.attr("aria-controls");t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":o,"aria-labelledby":r}),a.attr("aria-labelledby",r);}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)));},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0);},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0);},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t;},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler";}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault();}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs);},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0));}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0);}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()));}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height());}).height(i));},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest("li"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u));},_toggle:function(t,i){function s(){a.running=!1,a._trigger("activate",t,i);}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s());}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n();}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&r.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex");}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}));},_findActive:function(t){return t===!1?e():this.tabs.eq(t);},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e;},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls");}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","");},enable:function(t){var i=this.options.disabled;i!==!1&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null;}):e.map(this.tabs,function(e,i){return i!==t?i:null;})),this._setupDisabled(i));},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t];}this._setupDisabled(i);}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),r={tab:n,panel:o},h=function(e,t){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr;};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){o.html(e),s._trigger("load",i,r),h(n,t);},1);}).fail(function(e,t){setTimeout(function(){h(e,t);},1);})));},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},s));}};},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i));}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html();},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")));},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby");},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body);},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element);}),void 0);},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0);}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title");});},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"));});},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""));}),this._registerCloseHandlers(t,s),this._updateContent(s,t));},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=a),this._open(t,e,i));});}),i&&this._open(t,e,i),void 0);},_open:function(t,i,s){function n(e){l.of=e,o.is(":hidden")||o.position(l);}var a,o,r,h,l=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(h=s.clone(),h.removeAttr("id").find("[id]").removeAttr("id")):h=s,e("<div>").html(h).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(l.of),clearInterval(r));},e.fx.interval)),this._trigger("open",t,{tooltip:o});}},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0);}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip);}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s);},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);return a?(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this));}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t];}),a.closing=!0,this._trigger("close",t,{tooltip:i}),a.hiding||(a.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0);},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i};},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null;},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")];},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e("#"+i).remove(),a.data("ui-tooltip-title")&&(a.attr("title")||a.attr("title",a.data("ui-tooltip-title")),a.removeData("ui-tooltip-title"));}),this.liveRegion.remove();}});});/*!
	AnythingSlider v1.8.6
	Original by Chris Coyier: http://css-tricks.com
	Get the latest version: https://github.com/ProLoser/AnythingSlider

	To use the navigationFormatter function, you must have a function that
	accepts two paramaters, and returns a string of HTML text.

	index = integer index (1 based);
	panel = jQuery wrapped LI item this tab references
	@return = Must return a string of HTML/Text

	navigationFormatter: function(index, panel){
		return "Panel #" + index; // This would have each tab with the text 'Panel #X' where X = index
	}
*/;(function($){$.anythingSlider=function(el,options){var base=this,o,t;// Wraps the ul in the necessary divs and then gives Access to jQuery element
base.el=el;base.$el=$(el).addClass('anythingBase').wrap('<div class="anythingSlider"><div class="anythingWindow" /></div>');// Add a reverse reference to the DOM object
base.$el.data("AnythingSlider",base);base.init=function(){// Added "o" to be used in the code instead of "base.options" which doesn't get modifed by the compiler - reduces size by ~1k
base.options=o=$.extend({},$.anythingSlider.defaults,options);base.initialized=false;if($.isFunction(o.onBeforeInitialize)){base.$el.bind('before_initialize',o.onBeforeInitialize);}base.$el.trigger('before_initialize',base);// Add "as-oldie" class to body for css purposes
$('<!--[if lte IE 8]><script>jQuery("body").addClass("as-oldie");</script><![endif]-->').appendTo('body').remove();// Cache existing DOM elements for later
// base.$el = original ul
// for wrap - get parent() then closest in case the ul has "anythingSlider" class
base.$wrapper=base.$el.parent().closest('div.anythingSlider').addClass('anythingSlider-'+o.theme);base.$window=base.$el.closest('div.anythingWindow');base.win=window;base.$win=$(base.win);base.$controls=$('<div class="anythingControls"></div>');base.$nav=$('<ul class="thumbNav"><li><a><span></span></a></li></ul>');base.$startStop=$('<a href="#" class="start-stop"></a>');if(o.buildStartStop||o.buildNavigation){base.$controls.appendTo(o.appendControlsTo&&$(o.appendControlsTo).length?$(o.appendControlsTo):base.$wrapper);}if(o.buildNavigation){base.$nav.appendTo(o.appendNavigationTo&&$(o.appendNavigationTo).length?$(o.appendNavigationTo):base.$controls);}if(o.buildStartStop){base.$startStop.appendTo(o.appendStartStopTo&&$(o.appendStartStopTo).length?$(o.appendStartStopTo):base.$controls);}// Figure out how many sliders are on the page for indexing
base.runTimes=$('.anythingBase').length;base.regex=new RegExp('panel'+base.runTimes+'-(\\d+)','i');// hash tag regex
if(base.runTimes===1){base.makeActive();}// make the first slider on the page active
// Set up a few defaults & get details
base.flag=false;// event flag to prevent multiple calls (used in control click/focusin)
base.playing=o.autoPlay;// slideshow state; removed "startStopped" option
base.slideshow=false;// slideshow flag needed to correctly trigger slideshow events
base.hovered=false;// actively hovering over the slider
base.panelSize=[];// will contain dimensions and left position of each panel
base.currentPage=base.targetPage=o.startPanel=parseInt(o.startPanel,10)||1;// make sure this isn't a string
o.changeBy=parseInt(o.changeBy,10)||1;// set slider type, but keep backward compatibility with the vertical option
t=(o.mode||'h').toLowerCase().match(/(h|v|f)/);t=o.vertical?'v':(t||['h'])[0];o.mode=t==='v'?'vertical':t==='f'?'fade':'horizontal';if(t==='f'){o.showMultiple=1;// all slides are stacked in fade mode
o.infiniteSlides=false;// no cloned slides
}base.adj=o.infiniteSlides?0:1;// adjust page limits for infinite or limited modes
base.adjustMultiple=0;base.width=base.$el.width();base.height=base.$el.height();base.outerPad=[base.$wrapper.innerWidth()-base.$wrapper.width(),base.$wrapper.innerHeight()-base.$wrapper.height()];if(o.playRtl){base.$wrapper.addClass('rtl');}// Expand slider to fit parent
if(o.expand){base.$outer=base.$wrapper.parent();base.$window.css({width:'100%',height:'100%'});// needed for Opera
base.checkResize();}// Build start/stop button
if(o.buildStartStop){base.buildAutoPlay();}// Build forwards/backwards buttons
if(o.buildArrows){base.buildNextBackButtons();}// can't lock autoplay it if it's not enabled
if(!o.autoPlay){o.autoPlayLocked=false;}base.$lastPage=base.$targetPage=base.$currentPage;base.updateSlider();// Make sure easing function exists.
if(!$.isFunction($.easing[o.easing])){o.easing="swing";}// If pauseOnHover then add hover effects
if(o.pauseOnHover){base.$wrapper.hover(function(){if(base.playing){base.$el.trigger('slideshow_paused',base);base.clearTimer(true);}},function(){if(base.playing){base.$el.trigger('slideshow_unpaused',base);base.startStop(base.playing,true);}});}// Hide/Show navigation & play/stop controls
base.slideControls(false);base.$wrapper.bind('mouseenter mouseleave',function(e){// add hovered class to outer wrapper
$(this)[e.type==='mouseenter'?'addClass':'removeClass']('anythingSlider-hovered');base.hovered=e.type==='mouseenter'?true:false;base.slideControls(base.hovered);});// Add keyboard navigation
$(document).keyup(function(e){// Stop arrow keys from working when focused on form items
if(o.enableKeyboard&&base.$wrapper.hasClass('activeSlider')&&!e.target.tagName.match('TEXTAREA|INPUT|SELECT')){if(o.mode!=='vertical'&&(e.which===38||e.which===40)){return;}switch(e.which){case 39:case 40:// right & down arrow
base.goForward();break;case 37:case 38:// left & up arrow
base.goBack();break;}}});// If a hash can not be used to trigger the plugin, then go to start panel
base.currentPage=base.gotoHash()||o.startPanel||1;base.gotoPage(base.currentPage,false,null,-1);// Binds events
var triggers="slideshow_paused slideshow_unpaused slide_init slide_begin slideshow_stop slideshow_start initialized swf_completed".split(" ");$.each("onShowPause onShowUnpause onSlideInit onSlideBegin onShowStop onShowStart onInitialized onSWFComplete".split(" "),function(i,f){if($.isFunction(o[f])){base.$el.bind(triggers[i],o[f]);}});if($.isFunction(o.onSlideComplete)){// Added setTimeout (zero time) to ensure animation is complete... see this bug report: http://bugs.jquery.com/ticket/7157
base.$el.bind('slide_complete',function(){setTimeout(function(){o.onSlideComplete(base);},0);return false;});}base.initialized=true;base.$el.trigger('initialized',base);// trigger the slideshow
base.startStop(o.autoPlay);};// called during initialization & to update the slider if a panel is added or deleted
base.updateSlider=function(){// needed for updating the slider
base.$el.children('.cloned').remove();base.navTextVisible=base.$nav.find('span:first').css('visibility')!=='hidden';base.$nav.empty();// set currentPage to 1 in case it was zero - occurs when adding slides after removing them all
base.currentPage=base.currentPage||1;base.$items=base.$el.children();base.pages=base.$items.length;base.dir=o.mode==='vertical'?'top':'left';o.showMultiple=o.mode==='vertical'?1:parseInt(o.showMultiple,10)||1;// only integers allowed
o.navigationSize=o.navigationSize===false?0:parseInt(o.navigationSize,10)||0;// Fix tabbing through the page, but don't change the view if the link is in view (showMultiple = true)
base.$items.find('a').unbind('focus.AnythingSlider').bind('focus.AnythingSlider',function(e){var panel=$(this).closest('.panel'),indx=base.$items.index(panel)+base.adj;// index can be -1 in nested sliders - issue #208
base.$items.find('.focusedLink').removeClass('focusedLink');$(this).addClass('focusedLink');base.$window.scrollLeft(0).scrollTop(0);if(indx!==-1&&(indx>=base.currentPage+o.showMultiple||indx<base.currentPage)){base.gotoPage(indx);e.preventDefault();}});if(o.showMultiple>1){if(o.showMultiple>base.pages){o.showMultiple=base.pages;}base.adjustMultiple=o.infiniteSlides&&base.pages>1?0:o.showMultiple-1;}// Hide navigation & player if there is only one page
base.$controls.add(base.$nav).add(base.$startStop).add(base.$forward).add(base.$back)[base.pages<=1?'hide':'show']();if(base.pages>1){// Build/update navigation tabs
base.buildNavigation();}// Top and tail the list with 'visible' number of items, top has the last section, and tail has the first
// This supports the "infinite" scrolling, also ensures any cloned elements don't duplicate an ID
// Moved removeAttr before addClass otherwise IE7 ignores the addClass: http://bugs.jquery.com/ticket/9871
if(o.mode!=='fade'&&o.infiniteSlides&&base.pages>1){base.$el.prepend(base.$items.filter(':last').clone().addClass('cloned'));// Add support for multiple sliders shown at the same time
if(o.showMultiple>1){base.$el.append(base.$items.filter(':lt('+o.showMultiple+')').clone().addClass('cloned multiple'));}else{base.$el.append(base.$items.filter(':first').clone().addClass('cloned'));}base.$el.find('.cloned').each(function(){// disable all focusable elements in cloned panels to prevent shifting the panels by tabbing
$(this).find('a,input,textarea,select,button,area,form').attr({disabled:'disabled',name:''});$(this).find('[id]').andSelf().removeAttr('id');});}// We just added two items, time to re-cache the list, then get the dimensions of each panel
base.$items=base.$el.addClass(o.mode).children().addClass('panel');base.setDimensions();// Set the dimensions of each panel
if(o.resizeContents){base.$items.css('width',base.width);base.$wrapper.css('width',base.getDim(base.currentPage)[0]).add(base.$items).css('height',base.height);}else{base.$win.load(function(){// set dimensions after all images load
base.setDimensions();// make sure the outer wrapper is set properly
t=base.getDim(base.currentPage);base.$wrapper.css({width:t[0],height:t[1]});base.setCurrentPage(base.currentPage,false);});}if(base.currentPage>base.pages){base.currentPage=base.pages;}base.setCurrentPage(base.currentPage,false);base.$nav.find('a').eq(base.currentPage-1).addClass('cur');// update current selection
if(o.mode==='fade'){var t=base.$items.eq(base.currentPage-1);if(o.resumeOnVisible){// prevent display: none;
t.css({opacity:1}).siblings().css({opacity:0});}else{// allow display: none; - resets video
base.$items.css('opacity',1);t.fadeIn(0).siblings().fadeOut(0);}}};// Creates the numbered navigation links
base.buildNavigation=function(){if(o.buildNavigation&&base.pages>1){var a,c,i,t,$li;base.$items.filter(':not(.cloned)').each(function(j){$li=$('<li/>');i=j+1;c=(i===1?' first':'')+(i===base.pages?' last':'');a='<a class="panel'+i+(base.navTextVisible?'"':' '+o.tooltipClass+'" title="@"')+' href="#"><span>@</span></a>';// If a formatter function is present, use it
if($.isFunction(o.navigationFormatter)){t=o.navigationFormatter(i,$(this));if(typeof t==="string"){$li.html(a.replace(/@/g,t));}else{$li=$('<li/>',t);}}else{$li.html(a.replace(/@/g,i));}$li.appendTo(base.$nav).addClass(c).data('index',i);});base.$nav.children('li').bind(o.clickControls,function(e){if(!base.flag&&o.enableNavigation){// prevent running functions twice (once for click, second time for focusin)
base.flag=true;setTimeout(function(){base.flag=false;},100);base.gotoPage($(this).data('index'));}e.preventDefault();});// Add navigation tab scrolling - use !! in case someone sets the size to zero
if(!!o.navigationSize&&o.navigationSize<base.pages){if(!base.$controls.find('.anythingNavWindow').length){base.$nav.before('<ul><li class="prev"><a href="#"><span>'+o.backText+'</span></a></li></ul>').after('<ul><li class="next"><a href="#"><span>'+o.forwardText+'</span></a></li></ul>').wrap('<div class="anythingNavWindow"></div>');}// include half of the left position to include extra width from themes like tabs-light and tabs-dark (still not perfect)
base.navWidths=base.$nav.find('li').map(function(){return $(this).outerWidth(true)+Math.ceil(parseInt($(this).find('span').css('left'),10)/2||0);}).get();base.navLeft=base.currentPage;// add 25 pixels (old IE needs more than 5) to make sure the tabs don't wrap to the next line
base.$nav.width(base.navWidth(1,base.pages+1)+25);base.$controls.find('.anythingNavWindow').width(base.navWidth(1,o.navigationSize+1)).end().find('.prev,.next').bind(o.clickControls,function(e){if(!base.flag){base.flag=true;setTimeout(function(){base.flag=false;},200);base.navWindow(base.navLeft+o.navigationSize*($(this).is('.prev')?-1:1));}e.preventDefault();});}}};base.navWidth=function(x,y){var i,s=Math.min(x,y),e=Math.max(x,y),w=0;for(i=s;i<e;i++){w+=base.navWidths[i-1]||0;}return w;};base.navWindow=function(n){if(!!o.navigationSize&&o.navigationSize<base.pages&&base.navWidths){var p=base.pages-o.navigationSize+1;n=n<=1?1:n>1&&n<p?n:p;if(n!==base.navLeft){base.$controls.find('.anythingNavWindow').animate({scrollLeft:base.navWidth(1,n),width:base.navWidth(n,n+o.navigationSize)},{queue:false,duration:o.animationTime});base.navLeft=n;}}};// Creates the Forward/Backward buttons
base.buildNextBackButtons=function(){base.$forward=$('<span class="arrow forward"><a href="#"><span>'+o.forwardText+'</span></a></span>');base.$back=$('<span class="arrow back"><a href="#"><span>'+o.backText+'</span></a></span>');// Bind to the forward and back buttons
base.$back.bind(o.clickBackArrow,function(e){// prevent running functions twice (once for click, second time for swipe)
if(o.enableArrows&&!base.flag){base.flag=true;setTimeout(function(){base.flag=false;},100);base.goBack();}e.preventDefault();});base.$forward.bind(o.clickForwardArrow,function(e){// prevent running functions twice (once for click, second time for swipe)
if(o.enableArrows&&!base.flag){base.flag=true;setTimeout(function(){base.flag=false;},100);base.goForward();}e.preventDefault();});// using tab to get to arrow links will show they have focus (outline is disabled in css)
base.$back.add(base.$forward).find('a').bind('focusin focusout',function(){$(this).toggleClass('hover');});// Append elements to page
base.$back.appendTo(o.appendBackTo&&$(o.appendBackTo).length?$(o.appendBackTo):base.$wrapper);base.$forward.appendTo(o.appendForwardTo&&$(o.appendForwardTo).length?$(o.appendForwardTo):base.$wrapper);base.arrowWidth=base.$forward.width();// assuming the left & right arrows are the same width - used for toggle
base.arrowRight=parseInt(base.$forward.css('right'),10);base.arrowLeft=parseInt(base.$back.css('left'),10);};// Creates the Start/Stop button
base.buildAutoPlay=function(){base.$startStop.html('<span>'+(base.playing?o.stopText:o.startText)+'</span>').bind(o.clickSlideshow,function(e){if(o.enableStartStop){base.startStop(!base.playing);base.makeActive();if(base.playing&&!o.autoPlayDelayed){base.goForward(true);}}e.preventDefault();})// show button has focus while tabbing
.bind('focusin focusout',function(){$(this).toggleClass('hover');});};// Adjust slider dimensions on parent element resize
base.checkResize=function(stopTimer){clearTimeout(base.resizeTimer);base.resizeTimer=setTimeout(function(){var w=base.$outer.width()-base.outerPad[0],h=(base.$outer[0].tagName==="BODY"?base.$win.height():base.$outer.height())-base.outerPad[1];// base.width = width of one panel, so multiply by # of panels; outerPad is padding added for arrows.
if(base.width*o.showMultiple!==w||base.height!==h){base.setDimensions();// adjust panel sizes
// make sure page is lined up (use -1 animation time, so we can differeniate it from when animationTime = 0)
base.gotoPage(base.currentPage,base.playing,null,-1);}if(typeof stopTimer==='undefined'){base.checkResize();}},500);};// Set panel dimensions to either resize content or adjust panel to content
base.setDimensions=function(){var w,h,c,t,edge=0,fullsize={width:'100%',height:'100%'},// determine panel width
pw=o.showMultiple>1?base.width||base.$window.width()/o.showMultiple:base.$window.width(),winw=base.$win.width();if(o.expand){w=base.$outer.width()-base.outerPad[0];base.height=h=base.$outer.height()-base.outerPad[1];base.$wrapper.add(base.$window).add(base.$items).css({width:w,height:h});base.width=pw=o.showMultiple>1?w/o.showMultiple:w;}base.$items.each(function(i){t=$(this);c=t.children();if(o.resizeContents){// resize panel
w=base.width;h=base.height;t.css({width:w,height:h});if(c.length){if(c[0].tagName==="EMBED"){c.attr(fullsize);}// needed for IE7; also c.length > 1 in IE7
if(c[0].tagName==="OBJECT"){c.find('embed').attr(fullsize);}// resize panel contents, if solitary (wrapped content or solitary image)
if(c.length===1){c.css(fullsize);}}}else{// get panel width & height and save it
w=t.width()||base.width;// if image hasn't finished loading, width will be zero, so set it to base width instead
if(c.length===1&&w>=winw){w=c.width()>=winw?pw:c.width();// get width of solitary child
c.css('max-width',w);// set max width for all children
}t.css('width',w);// set width of panel
h=c.length===1?c.outerHeight(true):t.height();// get height after setting width
if(h<=base.outerPad[1]){h=base.height;}// if height less than the outside padding, then set it to the preset height
t.css('height',h);}base.panelSize[i]=[w,h,edge];edge+=o.mode==='vertical'?h:w;});// Set total width of slider
base.$el.css(o.mode==='vertical'?'height':'width',o.mode==='fade'?base.width:edge);};// get dimension of multiple panels, as needed
base.getDim=function(page){var i,w=base.width,h=base.height;if(base.pages<1||isNaN(page)){return[w,h];}// prevent errors when base.panelSize is empty
page=o.infiniteSlides&&base.pages>1?page:page-1;i=base.panelSize[page];if(i){w=i[0]||w;h=i[1]||h;}if(o.showMultiple>1){for(i=1;i<o.showMultiple;i++){w+=base.panelSize[page+i][0];h=Math.max(h,base.panelSize[page+i][1]);}}return[w,h];};base.goForward=function(autoplay){// targetPage changes before animation so if rapidly changing pages, it will have the correct current page
base.gotoPage(base[o.allowRapidChange?'targetPage':'currentPage']+o.changeBy*(o.playRtl?-1:1),autoplay);};base.goBack=function(autoplay){base.gotoPage(base[o.allowRapidChange?'targetPage':'currentPage']+o.changeBy*(o.playRtl?1:-1),autoplay);};base.gotoPage=function(page,autoplay,callback,time){if(autoplay!==true){autoplay=false;base.startStop(false);base.makeActive();}// check if page is an id or class name
if(/^[#|.]/.test(page)&&$(page).length){page=$(page).closest('.panel').index()+base.adj;}// rewind effect occurs here when changeBy > 1
if(o.changeBy!==1){var adj=base.pages-base.adjustMultiple;if(page<1){page=o.stopAtEnd?1:o.infiniteSlides?base.pages+page:o.showMultiple>1-page?1:adj;}if(page>base.pages){//
page=o.stopAtEnd?base.pages:o.showMultiple>1-page?1:page-=adj;}else if(page>=adj){// show multiple adjustments
page=adj;}}if(base.pages<=1){return;}// prevents animation
base.$lastPage=base.$currentPage;if(typeof page!=="number"){page=parseInt(page,10)||o.startPanel;base.setCurrentPage(page);}// pause YouTube videos before scrolling or prevent change if playing
if(autoplay&&o.isVideoPlaying(base)){return;}base.exactPage=page;if(page>base.pages+1-base.adj){page=!o.infiniteSlides&&!o.stopAtEnd?1:base.pages;}if(page<base.adj){page=!o.infiniteSlides&&!o.stopAtEnd?base.pages:1;}if(!o.infiniteSlides){base.exactPage=page;}// exact page used by the fx extension
base.currentPage=page>base.pages?base.pages:page<1?1:base.currentPage;base.$currentPage=base.$items.eq(base.currentPage-base.adj);base.targetPage=page===0?base.pages:page>base.pages?1:page;base.$targetPage=base.$items.eq(base.targetPage-base.adj);time=typeof time!=='undefined'?time:o.animationTime;// don't trigger events when time < 0 - to prevent FX from firing multiple times on page resize
if(time>=0){base.$el.trigger('slide_init',base);}// toggle arrows/controls only if there is time to see it - fix issue #317
if(time>0){base.slideControls(true);}// Set visual
if(o.buildNavigation){base.setNavigation(base.targetPage);}// When autoplay isn't passed, we stop the timer
if(autoplay!==true){autoplay=false;}// Stop the slider when we reach the last page, if the option stopAtEnd is set to true
if(!autoplay||o.stopAtEnd&&page===base.pages){base.startStop(false);}if(time>=0){base.$el.trigger('slide_begin',base);}// delay starting slide animation
setTimeout(function(d){var p,empty=true;if(o.allowRapidChange){base.$wrapper.add(base.$el).add(base.$items).stop(true,true);}// resize slider if content size varies
if(!o.resizeContents){// animating the wrapper resize before the window prevents flickering in Firefox
// don't animate the dimension if it hasn't changed - fix for issue #264
p=base.getDim(page);d={};// prevent animating a dimension to zero
if(base.$wrapper.width()!==p[0]){d.width=p[0]||base.width;empty=false;}if(base.$wrapper.height()!==p[1]){d.height=p[1]||base.height;empty=false;}if(!empty){base.$wrapper.filter(':not(:animated)').animate(d,{queue:false,duration:time<0?0:time,easing:o.easing});}}if(o.mode==='fade'){if(base.$lastPage[0]!==base.$targetPage[0]){base.fadeIt(base.$lastPage,0,time);base.fadeIt(base.$targetPage,1,time,function(){base.endAnimation(page,callback,time);});}else{base.endAnimation(page,callback,time);}}else{d={};d[base.dir]=-base.panelSize[o.infiniteSlides&&base.pages>1?page:page-1][2];// Animate Slider
base.$el.filter(':not(:animated)').animate(d,{queue:false,duration:time<0?0:time,easing:o.easing,complete:function(){base.endAnimation(page,callback,time);}});}},parseInt(o.delayBeforeAnimate,10)||0);};base.endAnimation=function(page,callback,time){if(page===0){base.$el.css(base.dir,o.mode==='fade'?0:-base.panelSize[base.pages][2]);page=base.pages;}else if(page>base.pages){// reset back to start position
base.$el.css(base.dir,o.mode==='fade'?0:-base.panelSize[1][2]);page=1;}base.exactPage=page;base.setCurrentPage(page,false);if(o.mode==='fade'){// make sure non current panels are hidden (rapid slide changes)
base.fadeIt(base.$items.not(':eq('+(page-base.adj)+')'),0,0);}if(!base.hovered){base.slideControls(false);}if(o.hashTags){base.setHash(page);}if(time>=0){base.$el.trigger('slide_complete',base);}// callback from external slide control: $('#slider').anythingSlider(4, function(slider){ })
if(typeof callback==='function'){callback(base);}// Continue slideshow after a delay
if(o.autoPlayLocked&&!base.playing){setTimeout(function(){base.startStop(true);// subtract out slide delay as the slideshow waits that additional time.
},o.resumeDelay-(o.autoPlayDelayed?o.delay:0));}};base.fadeIt=function(el,toOpacity,time,callback){var t=time<0?0:time;if(o.resumeOnVisible){el.filter(':not(:animated)').fadeTo(t,toOpacity,callback);}else{el.filter(':not(:animated)')[toOpacity===0?'fadeOut':'fadeIn'](t,callback);}};base.setCurrentPage=function(page,move){page=parseInt(page,10);if(base.pages<1||page===0||isNaN(page)){return;}if(page>base.pages+1-base.adj){page=base.pages-base.adj;}if(page<base.adj){page=1;}// hide/show arrows based on infinite scroll mode
if(o.buildArrows&&!o.infiniteSlides&&o.stopAtEnd){base.$forward[page===base.pages-base.adjustMultiple?'addClass':'removeClass']('disabled');base.$back[page===1?'addClass':'removeClass']('disabled');if(page===base.pages&&base.playing){base.startStop();}}// Only change left if move does not equal false
if(!move){var d=base.getDim(page);base.$wrapper.css({width:d[0],height:d[1]}).add(base.$window).scrollLeft(0).scrollTop(0);// reset in case tabbing changed this scrollLeft - probably overly redundant
base.$el.css(base.dir,o.mode==='fade'?0:-base.panelSize[o.infiniteSlides&&base.pages>1?page:page-1][2]);}// Update local variable
base.currentPage=page;base.$currentPage=base.$items.removeClass('activePage').eq(page-base.adj).addClass('activePage');if(o.buildNavigation){base.setNavigation(page);}};base.setNavigation=function(page){base.$nav.find('.cur').removeClass('cur').end().find('a').eq(page-1).addClass('cur');};base.makeActive=function(){// Set current slider as active so keyboard navigation works properly
if(!base.$wrapper.hasClass('activeSlider')){$('.activeSlider').removeClass('activeSlider');base.$wrapper.addClass('activeSlider');}};// This method tries to find a hash that matches an ID and panel-X
// If either found, it tries to find a matching item
// If that is found as well, then it returns the page number
base.gotoHash=function(){var h=base.win.location.hash,i=h.indexOf('&'),n=h.match(base.regex);// test for "/#/" or "/#!/" used by the jquery address plugin - $('#/') breaks jQuery
if(n===null&&!/^#&/.test(h)&&!/#!?\//.test(h)){// #quote2&panel1-3&panel3-3
h=h.substring(0,i>=0?i:h.length);try{n=$(h).length&&$(h).closest('.anythingBase')[0]===base.el?base.$items.index($(h).closest('.panel'))+base.adj:null;}catch(e){n=null;}// ensure the element is in the same slider
}else if(n!==null){// #&panel1-3&panel3-3
n=o.hashTags?parseInt(n[1],10):null;}return n;};base.setHash=function(n){var s='panel'+base.runTimes+'-',h=base.win.location.hash;if(typeof h!=='undefined'){base.win.location.hash=h.indexOf(s)>0?h.replace(base.regex,s+n):h+"&"+s+n;}};// Slide controls (nav and play/stop button up or down)
base.slideControls=function(toggle){var dir=toggle?'slideDown':'slideUp',t1=toggle?0:o.animationTime,t2=toggle?o.animationTime:0,op=toggle?1:0,sign=toggle?0:1;// 0 = visible, 1 = hidden
if(o.toggleControls){base.$controls.stop(true,true).delay(t1)[dir](o.animationTime/2).delay(t2);}if(o.buildArrows&&o.toggleArrows){if(!base.hovered&&base.playing){sign=1;op=0;}// don't animate arrows during slideshow
base.$forward.stop(true,true).delay(t1).animate({right:base.arrowRight+sign*base.arrowWidth,opacity:op},o.animationTime/2);base.$back.stop(true,true).delay(t1).animate({left:base.arrowLeft+sign*base.arrowWidth,opacity:op},o.animationTime/2);}};base.clearTimer=function(paused){// Clear the timer only if it is set
if(base.timer){base.win.clearInterval(base.timer);if(!paused&&base.slideshow){base.$el.trigger('slideshow_stop',base);base.slideshow=false;}}};// Pass startStop(false) to stop and startStop(true) to play
base.startStop=function(playing,paused){if(playing!==true){playing=false;}// Default if not supplied is false
base.playing=playing;if(playing&&!paused){base.$el.trigger('slideshow_start',base);base.slideshow=true;}// Toggle playing and text
if(o.buildStartStop){base.$startStop.toggleClass('playing',playing).find('span').html(playing?o.stopText:o.startText);// add button text to title attribute if it is hidden by text-indent
if(base.$startStop.find('span').css('visibility')==="hidden"){base.$startStop.addClass(o.tooltipClass).attr('title',playing?o.stopText:o.startText);}}// Pause slideshow while video is playing
if(playing){base.clearTimer(true);// Just in case this was triggered twice in a row
base.timer=base.win.setInterval(function(){// prevent autoplay if video is playing
if(!o.isVideoPlaying(base)){base.goForward(true);// stop slideshow if resume if false
}else if(!o.resumeOnVideoEnd){base.startStop();}},o.delay);}else{base.clearTimer();}};// Trigger the initialization
base.init();};$.anythingSlider.defaults={// Appearance
theme:"default",// Theme name, add the css stylesheet manually
mode:"horiz",// Set mode to "horizontal", "vertical" or "fade" (only first letter needed); replaces vertical option
expand:false,// If true, the entire slider will expand to fit the parent element
resizeContents:true,// If true, solitary images/objects in the panel will expand to fit the viewport
showMultiple:false,// Set this value to a number and it will show that many slides at once
easing:"swing",// Anything other than "linear" or "swing" requires the easing plugin or jQuery UI
buildArrows:true,// If true, builds the forwards and backwards buttons
buildNavigation:true,// If true, builds a list of anchor links to link to each panel
buildStartStop:true,// ** If true, builds the start/stop button
/*
		// commented out as this will reduce the size of the minified version
		appendForwardTo     : null,      // Append forward arrow to a HTML element (jQuery Object, selector or HTMLNode), if not null
		appendBackTo        : null,      // Append back arrow to a HTML element (jQuery Object, selector or HTMLNode), if not null
		appendControlsTo    : null,      // Append controls (navigation + start-stop) to a HTML element (jQuery Object, selector or HTMLNode), if not null
		appendNavigationTo  : null,      // Append navigation buttons to a HTML element (jQuery Object, selector or HTMLNode), if not null
		appendStartStopTo   : null,      // Append start-stop button to a HTML element (jQuery Object, selector or HTMLNode), if not null
*/toggleArrows:false,// If true, side navigation arrows will slide out on hovering & hide @ other times
toggleControls:false,// if true, slide in controls (navigation + play/stop button) on hover and slide change, hide @ other times
startText:"Start",// Start button text
stopText:"Stop",// Stop button text
forwardText:"&raquo;",// Link text used to move the slider forward (hidden by CSS, replaced with arrow image)
backText:"&laquo;",// Link text used to move the slider back (hidden by CSS, replace with arrow image)
tooltipClass:"tooltip",// Class added to navigation & start/stop button (text copied to title if it is hidden by a negative text indent)
// Function
enableArrows:true,// if false, arrows will be visible, but not clickable.
enableNavigation:true,// if false, navigation links will still be visible, but not clickable.
enableStartStop:true,// if false, the play/stop button will still be visible, but not clickable. Previously "enablePlay"
enableKeyboard:true,// if false, keyboard arrow keys will not work for this slider.
// Navigation
startPanel:1,// This sets the initial panel
changeBy:1,// Amount to go forward or back when changing panels.
hashTags:true,// Should links change the hashtag in the URL?
infiniteSlides:true,// if false, the slider will not wrap & not clone any panels
navigationFormatter:null,// Details at the top of the file on this use (advanced use)
navigationSize:false,// Set this to the maximum number of visible navigation tabs; false to disable
// Slideshow options
autoPlay:false,// If true, the slideshow will start running; replaces "startStopped" option
autoPlayLocked:false,// If true, user changing slides will not stop the slideshow
autoPlayDelayed:false,// If true, starting a slideshow will delay advancing slides; if false, the slider will immediately advance to the next slide when slideshow starts
pauseOnHover:true,// If true & the slideshow is active, the slideshow will pause on hover
stopAtEnd:false,// If true & the slideshow is active, the slideshow will stop on the last page. This also stops the rewind effect when infiniteSlides is false.
playRtl:false,// If true, the slideshow will move right-to-left
// Times
delay:3000,// How long between slideshow transitions in AutoPlay mode (in milliseconds)
resumeDelay:15000,// Resume slideshow after user interaction, only if autoplayLocked is true (in milliseconds).
animationTime:600,// How long the slideshow transition takes (in milliseconds)
delayBeforeAnimate:0,// How long to pause slide animation before going to the desired slide (used if you want your "out" FX to show).
/*
		// Callbacks - commented out to reduce size of the minified version - they still work
		onBeforeInitialize  : function(e, slider) {}, // Callback before the plugin initializes
		onInitialized       : function(e, slider) {}, // Callback when the plugin finished initializing
		onShowStart         : function(e, slider) {}, // Callback on slideshow start
		onShowStop          : function(e, slider) {}, // Callback after slideshow stops
		onShowPause         : function(e, slider) {}, // Callback when slideshow pauses
		onShowUnpause       : function(e, slider) {}, // Callback when slideshow unpauses - may not trigger properly if user clicks on any controls
		onSlideInit         : function(e, slider) {}, // Callback when slide initiates, before control animation
		onSlideBegin        : function(e, slider) {}, // Callback before slide animates
		onSlideComplete     : function(slider) {},    // Callback when slide completes - no event variable!
*/ // Interactivity
clickForwardArrow:"click",// Event used to activate forward arrow functionality (e.g. add jQuery mobile's "swiperight")
clickBackArrow:"click",// Event used to activate back arrow functionality (e.g. add jQuery mobile's "swipeleft")
clickControls:"click focusin",// Events used to activate navigation control functionality
clickSlideshow:"click",// Event used to activate slideshow play/stop button
allowRapidChange:false,// If true, allow rapid changing of the active pane, instead of ignoring activity during animation
// Video
resumeOnVideoEnd:true,// If true & the slideshow is active & a supported video is playing, it will pause the autoplay until the video is complete
resumeOnVisible:true,// If true the video will resume playing (if previously paused, except for YouTube iframe - known issue); if false, the video remains paused.
addWmodeToObject:"opaque",// If your slider has an embedded object, the script will automatically add a wmode parameter with this setting
isVideoPlaying:function(base){return false;}// return true if video is playing or false if not - used by video extension
};$.fn.anythingSlider=function(options,callback){return this.each(function(){var page,anySlide=$(this).data('AnythingSlider');// initialize the slider but prevent multiple initializations
if((typeof options).match('object|undefined')){if(!anySlide){new $.anythingSlider(this,options);}else{anySlide.updateSlider();}// If options is a number, process as an external link to page #: $(element).anythingSlider(#)
}else if(/\d/.test(options)&&!isNaN(options)&&anySlide){page=typeof options==="number"?options:parseInt($.trim(options),10);// accepts "  2  "
// ignore out of bound pages
if(page>=1&&page<=anySlide.pages){anySlide.gotoPage(page,false,callback);// page #, autoplay, one time callback
}// Accept id or class name
}else if(/^[#|.]/.test(options)&&$(options).length){anySlide.gotoPage(options,false,callback);}});};})(jQuery);/*!
 * jQuery BBQ: Back Button & Query Library - v1.4pre - 1/15/2013
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010-2013 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */ // Script: jQuery BBQ: Back Button & Query Library
//
// *Version: 1.4pre, Last updated: 1/15/2013*
// 
// Project Home - http://benalman.com/projects/jquery-bbq-plugin/
// GitHub       - http://github.com/cowboy/jquery-bbq/
// Source       - http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.js
// (Minified)   - http://github.com/cowboy/jquery-bbq/raw/master/jquery.ba-bbq.min.js (2.2kb gzipped)
// 
// About: License
// 
// Copyright (c) 2010-2013 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Examples
// 
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
// 
// Basic AJAX     - http://benalman.com/code/projects/jquery-bbq/examples/fragment-basic/
// Advanced AJAX  - http://benalman.com/code/projects/jquery-bbq/examples/fragment-advanced/
// jQuery UI Tabs - http://benalman.com/code/projects/jquery-bbq/examples/fragment-jquery-ui-tabs/
// Deparam        - http://benalman.com/code/projects/jquery-bbq/examples/deparam/
// 
// About: Support and Testing
// 
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
// 
// jQuery Versions - 1.2.6, 1.3.2, 1.4.1, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-4, Chrome 5-6, Safari 3.2-5,
//                   Opera 9.6-10.60, iPhone 3.1, Android 1.6-2.2, BlackBerry 4.6-5.
// Unit Tests      - http://benalman.com/code/projects/jquery-bbq/unit/
// 
// About: Release History
// 
// 1.4pre - (1/15/2013) Removed $.browser reference to work with jQuery 1.9
// 1.3pre - (8/26/2010) Integrated <jQuery hashchange event> v1.3, which adds
//         document.title and document.domain support in IE6/7, BlackBerry
//         support, better Iframe hiding for accessibility reasons, and the new
//         <jQuery.fn.hashchange> "shortcut" method. Added the
//         <jQuery.param.sorted> method which reduces the possibility of
//         extraneous hashchange event triggering. Added the
//         <jQuery.param.fragment.ajaxCrawlable> method which can be used to
//         enable Google "AJAX Crawlable mode."
// 1.2.1 - (2/17/2010) Actually fixed the stale window.location Safari bug from
//         <jQuery hashchange event> in BBQ, which was the main reason for the
//         previous release!
// 1.2   - (2/16/2010) Integrated <jQuery hashchange event> v1.2, which fixes a
//         Safari bug, the event can now be bound before DOM ready, and IE6/7
//         page should no longer scroll when the event is first bound. Also
//         added the <jQuery.param.fragment.noEscape> method, and reworked the
//         <hashchange event (BBQ)> internal "add" method to be compatible with
//         changes made to the jQuery 1.4.2 special events API.
// 1.1.1 - (1/22/2010) Integrated <jQuery hashchange event> v1.1, which fixes an
//         obscure IE8 EmulateIE7 meta tag compatibility mode bug.
// 1.1   - (1/9/2010) Broke out the jQuery BBQ event.special <hashchange event>
//         functionality into a separate plugin for users who want just the
//         basic event & back button support, without all the extra awesomeness
//         that BBQ provides. This plugin will be included as part of jQuery BBQ,
//         but also be available separately. See <jQuery hashchange event>
//         plugin for more information. Also added the <jQuery.bbq.removeState>
//         method and added additional <jQuery.deparam> examples.
// 1.0.3 - (12/2/2009) Fixed an issue in IE 6 where location.search and
//         location.hash would report incorrectly if the hash contained the ?
//         character. Also <jQuery.param.querystring> and <jQuery.param.fragment>
//         will no longer parse params out of a URL that doesn't contain ? or #,
//         respectively.
// 1.0.2 - (10/10/2009) Fixed an issue in IE 6/7 where the hidden IFRAME caused
//         a "This page contains both secure and nonsecure items." warning when
//         used on an https:// page.
// 1.0.1 - (10/7/2009) Fixed an issue in IE 8. Since both "IE7" and "IE8
//         Compatibility View" modes erroneously report that the browser
//         supports the native window.onhashchange event, a slightly more
//         robust test needed to be added.
// 1.0   - (10/2/2009) Initial release
(function($,window){'$:nomunge';// Used by YUI compressor.
// Some convenient shortcuts.
var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,// Method / object references.
jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,// Reused strings.
str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',// Reused RegExp.
re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,// Used by jQuery.elemUrlAttr.
elemUrlAttr_cache={};// A few commonly used bits, broken out to help reduce minified file size.
function is_string(arg){return typeof arg==='string';};// Why write the same function twice? Let's curry! Mmmm, curry..
function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};// Get location.hash (or what you'd expect location.hash to be) sans any
// leading #. Thanks for making this necessary, Firefox!
function get_fragment(url){return url.replace(re_fragment,'$2');};// Get location.search (or what you'd expect location.search to be) sans any
// leading #. Thanks for making this necessary, IE6!
function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};// Section: Param (to string)
//
// Method: jQuery.param.querystring
//
// Retrieve the query string from a URL or if no arguments are passed, the
// current window.location.href.
//
// Usage:
//
// > jQuery.param.querystring( [ url ] );
//
// Arguments:
//
//  url - (String) A URL containing query string params to be parsed. If url
//    is not passed, the current window.location.href is used.
//
// Returns:
//
//  (String) The parsed query string, with any leading "?" removed.
//
// Method: jQuery.param.querystring (build url)
//
// Merge a URL, with or without pre-existing query string params, plus any
// object, params string or URL containing query string params into a new URL.
//
// Usage:
//
// > jQuery.param.querystring( url, params [, merge_mode ] );
//
// Arguments:
//
//  url - (String) A valid URL for params to be merged into. This URL may
//    contain a query string and/or fragment (hash).
//  params - (String) A params string or URL containing query string params to
//    be merged into url.
//  params - (Object) A params object to be merged into url.
//  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
//    specified, and is as-follows:
//
//    * 0: params in the params argument will override any query string
//         params in url.
//    * 1: any query string params in url will override params in the params
//         argument.
//    * 2: params argument will completely replace any query string in url.
//
// Returns:
//
//  (String) A URL with a urlencoded query string in the format '?a=b&c=d&e=f'.
// Method: jQuery.param.fragment
//
// Retrieve the fragment (hash) from a URL or if no arguments are passed, the
// current window.location.href.
//
// Usage:
//
// > jQuery.param.fragment( [ url ] );
//
// Arguments:
//
//  url - (String) A URL containing fragment (hash) params to be parsed. If
//    url is not passed, the current window.location.href is used.
//
// Returns:
//
//  (String) The parsed fragment (hash) string, with any leading "#" removed.
// Method: jQuery.param.fragment (build url)
//
// Merge a URL, with or without pre-existing fragment (hash) params, plus any
// object, params string or URL containing fragment (hash) params into a new
// URL.
//
// Usage:
//
// > jQuery.param.fragment( url, params [, merge_mode ] );
//
// Arguments:
//
//  url - (String) A valid URL for params to be merged into. This URL may
//    contain a query string and/or fragment (hash).
//  params - (String) A params string or URL containing fragment (hash) params
//    to be merged into url.
//  params - (Object) A params object to be merged into url.
//  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
//    specified, and is as-follows:
//
//    * 0: params in the params argument will override any fragment (hash)
//         params in url.
//    * 1: any fragment (hash) params in url will override params in the
//         params argument.
//    * 2: params argument will completely replace any query string in url.
//
// Returns:
//
//  (String) A URL with a urlencoded fragment (hash) in the format '#a=b&c=d&e=f'.
function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){// Build URL by merging params into url string.
// matches[1] = url part that precedes params, not including trailing ?/#
// matches[2] = params, not including leading ?/#
// matches[3] = if in 'querystring' mode, hash including leading #, otherwise ''
matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);// Get the hash if in 'querystring' mode, and it exists.
hash=matches[3]||'';if(merge_mode===2&&is_string(params)){// If merge_mode is 2 and params is a string, merge the fragment / query
// string into the URL wholesale, without converting it into an object.
qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{// Convert relevant params in url to object.
url_params=jq_deparam(matches[2]);params=is_string(params)// Convert passed params string into object.
?jq_deparam[is_fragment?str_fragment:str_querystring](params)// Passed params object.
:params;qs=merge_mode===2?params// passed params replace url params
:merge_mode===1?$.extend({},params,url_params)// url params override passed params
:$.extend({},url_params,params);// passed params override url params
// Convert params object into a sorted params string.
qs=jq_param_sorted(qs);// Unescape characters specified via $.param.noEscape. Since only hash-
// history users have requested this feature, it's only enabled for
// fragment-related params strings.
if(is_fragment){qs=qs.replace(re_no_escape,decode);}}// Build URL from the base url, querystring and hash. In 'querystring'
// mode, ? is only added if a query string exists. In 'fragment' mode, #
// is always added.
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{// If URL was passed in, parse params from URL string, otherwise parse
// params from window.location.href.
result=get_func(url!==undefined?url:location.href);}return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);// Method: jQuery.param.sorted
//
// Returns a params string equivalent to that returned by the internal
// jQuery.param method, but sorted, which makes it suitable for use as a
// cache key.
//
// For example, in most browsers jQuery.param({z:1,a:2}) returns "z=1&a=2"
// and jQuery.param({a:2,z:1}) returns "a=2&z=1". Even though both the
// objects being serialized and the resulting params strings are equivalent,
// if these params strings were set into the location.hash fragment
// sequentially, the hashchange event would be triggered unnecessarily, since
// the strings are different (even though the data described by them is the
// same). By sorting the params string, unecessary hashchange event triggering
// can be avoided.
//
// Usage:
//
// > jQuery.param.sorted( obj [, traditional ] );
//
// Arguments:
//
//  obj - (Object) An object to be serialized.
//  traditional - (Boolean) Params deep/shallow serialization mode. See the
//    documentation at http://api.jquery.com/jQuery.param/ for more detail.
//
// Returns:
//
//  (String) A sorted params string.
jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};// Method: jQuery.param.fragment.noEscape
//
// Specify characters that will be left unescaped when fragments are created
// or merged using <jQuery.param.fragment>, or when the fragment is modified
// using <jQuery.bbq.pushState>. This option only applies to serialized data
// object fragments, and not set-as-string fragments. Does not affect the
// query string. Defaults to ",/" (comma, forward slash).
//
// Note that this is considered a purely aesthetic option, and will help to
// create URLs that "look pretty" in the address bar or bookmarks, without
// affecting functionality in any way. That being said, be careful to not
// unescape characters that are used as delimiters or serve a special
// purpose, such as the "#?&=+" (octothorpe, question mark, ampersand,
// equals, plus) characters.
//
// Usage:
//
// > jQuery.param.fragment.noEscape( [ chars ] );
//
// Arguments:
//
//  chars - (String) The characters to not escape in the fragment. If
//    unspecified, defaults to empty string (escape all characters).
//
// Returns:
//
//  Nothing.
jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};// A sensible default. These are the characters people seem to complain about
// "uglifying up the URL" the most.
jq_param_fragment.noEscape(',/');// Method: jQuery.param.fragment.ajaxCrawlable
//
// TODO: DESCRIBE
//
// Usage:
//
// > jQuery.param.fragment.ajaxCrawlable( [ state ] );
//
// Arguments:
//
//  state - (Boolean) TODO: DESCRIBE
//
// Returns:
//
//  (Boolean) The current ajaxCrawlable state.
jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}ajax_crawlable=!!state;}return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);// Section: Deparam (from string)
//
// Method: jQuery.deparam
//
// Deserialize a params string into an object, optionally coercing numbers,
// booleans, null and undefined values; this method is the counterpart to the
// internal jQuery.param method.
//
// Usage:
//
// > jQuery.deparam( params [, coerce ] );
//
// Arguments:
//
//  params - (String) A params string to be parsed.
//  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
//    undefined to their actual value. Defaults to false if omitted.
//
// Returns:
//
//  (Object) An object representing the deserialized params string.
$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};// Iterate over all name=value pairs.
$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,// If key is more complex than 'foo', like 'a[]' or 'a[b][c]', split it
// into its component parts.
keys=key.split(']['),keys_last=keys.length-1;// If the first keys part contains [ and the last ends with ], then []
// are correctly balanced.
if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){// Remove the trailing ] from the last keys part.
keys[keys_last]=keys[keys_last].replace(/\]$/,'');// Split first keys part into two parts on the [ and add them back onto
// the beginning of the keys array.
keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{// Basic 'foo' style key.
keys_last=0;}// Are we dealing with a name=value pair, or just a name?
if(param.length===2){val=decode(param[1]);// Coerce values.
if(coerce){val=val&&!isNaN(val)?+val// number
:val==='undefined'?undefined// undefined
:coerce_types[val]!==undefined?coerce_types[val]// true, false, null
:val;// string
}if(keys_last){// Complex key, build deep object structure based on a few rules:
// * The 'cur' pointer starts at the object top-level.
// * [] = array push (n is set to array length), [n] = array if n is
//   numeric, otherwise object.
// * If at the last keys part, set the value.
// * For each keys part, if the current level is undefined create an
//   object or array based on the type of the next keys part.
// * Move the 'cur' pointer to the next level.
// * Rinse & repeat.
for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{// Simple key, even simpler rules, since only scalars and shallow
// arrays are allowed.
if($.isArray(obj[key])){// val is already an array, so push on the next value.
obj[key].push(val);}else if(obj[key]!==undefined){// val isn't an array, but since a second value has been specified,
// convert val into an array.
obj[key]=[obj[key],val];}else{// val is a scalar.
obj[key]=val;}}}else if(key){// No value was defined, so set something meaningful.
obj[key]=coerce?undefined:'';}});return obj;};// Method: jQuery.deparam.querystring
//
// Parse the query string from a URL or the current window.location.href,
// deserializing it into an object, optionally coercing numbers, booleans,
// null and undefined values.
//
// Usage:
//
// > jQuery.deparam.querystring( [ url ] [, coerce ] );
//
// Arguments:
//
//  url - (String) An optional params string or URL containing query string
//    params to be parsed. If url is omitted, the current
//    window.location.href is used.
//  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
//    undefined to their actual value. Defaults to false if omitted.
//
// Returns:
//
//  (Object) An object representing the deserialized params string.
// Method: jQuery.deparam.fragment
//
// Parse the fragment (hash) from a URL or the current window.location.href,
// deserializing it into an object, optionally coercing numbers, booleans,
// null and undefined values.
//
// Usage:
//
// > jQuery.deparam.fragment( [ url ] [, coerce ] );
//
// Arguments:
//
//  url - (String) An optional params string or URL containing fragment (hash)
//    params to be parsed. If url is omitted, the current window.location.href
//    is used.
//  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
//    undefined to their actual value. Defaults to false if omitted.
//
// Returns:
//
//  (Object) An object representing the deserialized params string.
function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){// url_or_params not specified.
coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);// Section: Element manipulation
//
// Method: jQuery.elemUrlAttr
//
// Get the internal "Default URL attribute per tag" list, or augment the list
// with additional tag-attribute pairs, in case the defaults are insufficient.
//
// In the <jQuery.fn.querystring> and <jQuery.fn.fragment> methods, this list
// is used to determine which attribute contains the URL to be modified, if
// an "attr" param is not specified.
//
// Default Tag-Attribute List:
//
//  a      - href
//  base   - href
//  iframe - src
//  img    - src
//  input  - src
//  form   - action
//  link   - href
//  script - src
//
// Usage:
//
// > jQuery.elemUrlAttr( [ tag_attr ] );
//
// Arguments:
//
//  tag_attr - (Object) An object containing a list of tag names and their
//    associated default attribute names in the format { tag: 'attr', ... } to
//    be merged into the internal tag-attribute list.
//
// Returns:
//
//  (Object) An object containing all stored tag-attribute values.
// Only define function and set defaults if function doesn't already exist, as
// the urlInternal plugin will provide this method as well.
$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];// Method: jQuery.fn.querystring
//
// Update URL attribute in one or more elements, merging the current URL (with
// or without pre-existing query string params) plus any params object or
// string into a new URL, which is then set into that attribute. Like
// <jQuery.param.querystring (build url)>, but for all elements in a jQuery
// collection.
//
// Usage:
//
// > jQuery('selector').querystring( [ attr, ] params [, merge_mode ] );
//
// Arguments:
//
//  attr - (String) Optional name of an attribute that will contain a URL to
//    merge params or url into. See <jQuery.elemUrlAttr> for a list of default
//    attributes.
//  params - (Object) A params object to be merged into the URL attribute.
//  params - (String) A URL containing query string params, or params string
//    to be merged into the URL attribute.
//  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
//    specified, and is as-follows:
//
//    * 0: params in the params argument will override any params in attr URL.
//    * 1: any params in attr URL will override params in the params argument.
//    * 2: params argument will completely replace any query string in attr
//         URL.
//
// Returns:
//
//  (jQuery) The initial jQuery collection of elements, but with modified URL
//  attribute values.
// Method: jQuery.fn.fragment
//
// Update URL attribute in one or more elements, merging the current URL (with
// or without pre-existing fragment/hash params) plus any params object or
// string into a new URL, which is then set into that attribute. Like
// <jQuery.param.fragment (build url)>, but for all elements in a jQuery
// collection.
//
// Usage:
//
// > jQuery('selector').fragment( [ attr, ] params [, merge_mode ] );
//
// Arguments:
//
//  attr - (String) Optional name of an attribute that will contain a URL to
//    merge params into. See <jQuery.elemUrlAttr> for a list of default
//    attributes.
//  params - (Object) A params object to be merged into the URL attribute.
//  params - (String) A URL containing fragment (hash) params, or params
//    string to be merged into the URL attribute.
//  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
//    specified, and is as-follows:
//
//    * 0: params in the params argument will override any params in attr URL.
//    * 1: any params in attr URL will override params in the params argument.
//    * 2: params argument will completely replace any fragment (hash) in attr
//         URL.
//
// Returns:
//
//  (jQuery) The initial jQuery collection of elements, but with modified URL
//  attribute values.
function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){// force_attr not specified.
merge_mode=params;params=force_attr;force_attr=undefined;}return this.each(function(){var that=$(this),// Get attribute specified, or default specified via $.elemUrlAttr.
attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',// Get URL value.
url=attr&&that.attr(attr)||'';// Update attribute with new URL.
that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);// Section: History, hashchange event
//
// Method: jQuery.bbq.pushState
//
// Adds a 'state' into the browser history at the current position, setting
// location.hash and triggering any bound <hashchange event> callbacks
// (provided the new state is different than the previous state).
//
// If no arguments are passed, an empty state is created, which is just a
// shortcut for jQuery.bbq.pushState( {}, 2 ).
//
// Usage:
//
// > jQuery.bbq.pushState( [ params [, merge_mode ] ] );
//
// Arguments:
//
//  params - (String) A serialized params string or a hash string beginning
//    with # to merge into location.hash.
//  params - (Object) A params object to merge into location.hash.
//  merge_mode - (Number) Merge behavior defaults to 0 if merge_mode is not
//    specified (unless a hash string beginning with # is specified, in which
//    case merge behavior defaults to 2), and is as-follows:
//
//    * 0: params in the params argument will override any params in the
//         current state.
//    * 1: any params in the current state will override params in the params
//         argument.
//    * 2: params argument will completely replace current state.
//
// Returns:
//
//  Nothing.
//
// Additional Notes:
//
//  * Setting an empty state may cause the browser to scroll.
//  * Unlike the fragment and querystring methods, if a hash string beginning
//    with # is specified as the params agrument, merge_mode defaults to 2.
jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){// Params string begins with # and merge_mode not specified, so completely
// overwrite window.location.hash.
merge_mode=2;}var has_args=params!==undefined,// Merge params into window.location using $.param.fragment.
url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);// Set new window.location.href. Note that Safari 3 & Chrome barf on
// location.hash = '#' so the entire URL is set.
location.href=url;};// Method: jQuery.bbq.getState
//
// Retrieves the current 'state' from the browser history, parsing
// location.hash for a specific key or returning an object containing the
// entire state, optionally coercing numbers, booleans, null and undefined
// values.
//
// Usage:
//
// > jQuery.bbq.getState( [ key ] [, coerce ] );
//
// Arguments:
//
//  key - (String) An optional state key for which to return a value.
//  coerce - (Boolean) If true, coerces any numbers or true, false, null, and
//    undefined to their actual value. Defaults to false.
//
// Returns:
//
//  (Anything) If key is passed, returns the value corresponding with that key
//    in the location.hash 'state', or undefined. If not, an object
//    representing the entire 'state' is returned.
jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key)// 'key' really means 'coerce' here
:jq_deparam_fragment(coerce)[key];};// Method: jQuery.bbq.removeState
//
// Remove one or more keys from the current browser history 'state', creating
// a new state, setting location.hash and triggering any bound
// <hashchange event> callbacks (provided the new state is different than
// the previous state).
//
// If no arguments are passed, an empty state is created, which is just a
// shortcut for jQuery.bbq.pushState( {}, 2 ).
//
// Usage:
//
// > jQuery.bbq.removeState( [ key [, key ... ] ] );
//
// Arguments:
//
//  key - (String) One or more key values to remove from the current state,
//    passed as individual arguments.
//  key - (Array) A single array argument that contains a list of key values
//    to remove from the current state.
//
// Returns:
//
//  Nothing.
//
// Additional Notes:
//
//  * Setting an empty state may cause the browser to scroll.
jq_bbq.removeState=function(arr){var state={};// If one or more arguments is passed..
if(arr!==undefined){// Get the current state.
state=jq_bbq_getState();// For each passed key, delete the corresponding property from the current
// state.
$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}// Set the state, completely overriding any existing state.
jq_bbq_pushState(state,2);};// Event: hashchange event (BBQ)
//
// Usage in jQuery 1.4 and newer:
//
// In jQuery 1.4 and newer, the event object passed into any hashchange event
// callback is augmented with a copy of the location.hash fragment at the time
// the event was triggered as its event.fragment property. In addition, the
// event.getState method operates on this property (instead of location.hash)
// which allows this fragment-as-a-state to be referenced later, even after
// window.location may have changed.
//
// Note that event.fragment and event.getState are not defined according to
// W3C (or any other) specification, but will still be available whether or
// not the hashchange event exists natively in the browser, because of the
// utility they provide.
//
// The event.fragment property contains the output of <jQuery.param.fragment>
// and the event.getState method is equivalent to the <jQuery.bbq.getState>
// method.
//
// > $(window).bind( 'hashchange', function( event ) {
// >   var hash_str = event.fragment,
// >     param_obj = event.getState(),
// >     param_val = event.getState( 'param_name' ),
// >     param_val_coerced = event.getState( 'param_name', true );
// >   ...
// > });
//
// Usage in jQuery 1.3.2:
//
// In jQuery 1.3.2, the event object cannot to be augmented as in jQuery 1.4+,
// so the fragment state isn't bound to the event object and must instead be
// parsed using the <jQuery.param.fragment> and <jQuery.bbq.getState> methods.
//
// > $(window).bind( 'hashchange', function( event ) {
// >   var hash_str = $.param.fragment(),
// >     param_obj = $.bbq.getState(),
// >     param_val = $.bbq.getState( 'param_name' ),
// >     param_val_coerced = $.bbq.getState( 'param_name', true );
// >   ...
// > });
//
// Additional Notes:
//
// * Due to changes in the special events API, jQuery BBQ v1.2 or newer is
//   required to enable the augmented event object in jQuery 1.4.2 and newer.
// * See <jQuery hashchange event> for more detailed information.
special[str_hashchange]=$.extend(special[str_hashchange],{// Augmenting the event object with the .fragment property and .getState
// method requires jQuery 1.4 or newer. Note: with 1.3.2, everything will
// work, but the event won't be augmented)
add:function(handleObj){var old_handler;function new_handler(e){// e.fragment is set to the value of location.hash (with any leading #
// removed) at the time the event is triggered.
var hash=e[str_fragment]=jq_param_fragment();// e.getState() works just like $.bbq.getState(), but uses the
// e.fragment property stored on the event object.
e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key)// 'key' really means 'coerce' here
:jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};// This may seem a little complicated, but it normalizes the special event
// .add method between jQuery 1.4/1.4.1 and 1.4.2+
if($.isFunction(handleObj)){// 1.4, 1.4.1
old_handler=handleObj;return new_handler;}else{// 1.4.2+
old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);/*!
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */ // Script: jQuery hashchange event
//
// *Version: 1.3, Last updated: 7/21/2010*
// 
// Project Home - http://benalman.com/projects/jquery-hashchange-plugin/
// GitHub       - http://github.com/cowboy/jquery-hashchange/
// Source       - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.js
// (Minified)   - http://github.com/cowboy/jquery-hashchange/raw/master/jquery.ba-hashchange.min.js (0.8kb gzipped)
// 
// About: License
// 
// Copyright (c) 2010 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Examples
// 
// These working examples, complete with fully commented code, illustrate a few
// ways in which this plugin can be used.
// 
// hashchange event - http://benalman.com/code/projects/jquery-hashchange/examples/hashchange/
// document.domain - http://benalman.com/code/projects/jquery-hashchange/examples/document_domain/
// 
// About: Support and Testing
// 
// Information about what version or versions of jQuery this plugin has been
// tested with, what browsers it has been tested in, and where the unit tests
// reside (so you can test it yourself).
// 
// jQuery Versions - 1.2.6, 1.3.2, 1.4.1, 1.4.2
// Browsers Tested - Internet Explorer 6-8, Firefox 2-4, Chrome 5-6, Safari 3.2-5,
//                   Opera 9.6-10.60, iPhone 3.1, Android 1.6-2.2, BlackBerry 4.6-5.
// Unit Tests      - http://benalman.com/code/projects/jquery-hashchange/unit/
// 
// About: Known issues
// 
// While this jQuery hashchange event implementation is quite stable and
// robust, there are a few unfortunate browser bugs surrounding expected
// hashchange event-based behaviors, independent of any JavaScript
// window.onhashchange abstraction. See the following examples for more
// information:
// 
// Chrome: Back Button - http://benalman.com/code/projects/jquery-hashchange/examples/bug-chrome-back-button/
// Firefox: Remote XMLHttpRequest - http://benalman.com/code/projects/jquery-hashchange/examples/bug-firefox-remote-xhr/
// WebKit: Back Button in an Iframe - http://benalman.com/code/projects/jquery-hashchange/examples/bug-webkit-hash-iframe/
// Safari: Back Button from a different domain - http://benalman.com/code/projects/jquery-hashchange/examples/bug-safari-back-from-diff-domain/
// 
// Also note that should a browser natively support the window.onhashchange 
// event, but not report that it does, the fallback polling loop will be used.
// 
// About: Release History
// 
// 1.3   - (7/21/2010) Reorganized IE6/7 Iframe code to make it more
//         "removable" for mobile-only development. Added IE6/7 document.title
//         support. Attempted to make Iframe as hidden as possible by using
//         techniques from http://www.paciellogroup.com/blog/?p=604. Added 
//         support for the "shortcut" format $(window).hashchange( fn ) and
//         $(window).hashchange() like jQuery provides for built-in events.
//         Renamed jQuery.hashchangeDelay to <jQuery.fn.hashchange.delay> and
//         lowered its default value to 50. Added <jQuery.fn.hashchange.domain>
//         and <jQuery.fn.hashchange.src> properties plus document-domain.html
//         file to address access denied issues when setting document.domain in
//         IE6/7.
// 1.2   - (2/11/2010) Fixed a bug where coming back to a page using this plugin
//         from a page on another domain would cause an error in Safari 4. Also,
//         IE6/7 Iframe is now inserted after the body (this actually works),
//         which prevents the page from scrolling when the event is first bound.
//         Event can also now be bound before DOM ready, but it won't be usable
//         before then in IE6/7.
// 1.1   - (1/21/2010) Incorporated document.documentMode test to fix IE8 bug
//         where browser version is incorrectly reported as 8.0, despite
//         inclusion of the X-UA-Compatible IE=EmulateIE7 meta tag.
// 1.0   - (1/9/2010) Initial Release. Broke out the jQuery BBQ event.special
//         window.onhashchange functionality into a separate plugin for users
//         who want just the basic event & back button support, without all the
//         extra awesomeness that BBQ provides. This plugin will be included as
//         part of jQuery BBQ, but also be available separately.
(function($,window,undefined){'$:nomunge';// Used by YUI compressor.
// Reused string.
var str_hashchange='hashchange',// Method / object references.
doc=document,fake_onhashchange,special=$.event.special,// Does the browser support window.onhashchange? Note that IE8 running in
// IE7 compatibility mode reports true for 'onhashchange' in window, even
// though the event isn't supported, so also test document.documentMode.
doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);// Get location.hash (or what you'd expect location.hash to be) sans any
// leading #. Thanks for making this necessary, Firefox!
function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};// Method: jQuery.fn.hashchange
//
// Bind a handler to the window.onhashchange event or trigger all bound
// window.onhashchange event handlers. This behavior is consistent with
// jQuery's built-in event handlers.
//
// Usage:
//
// > jQuery(window).hashchange( [ handler ] );
//
// Arguments:
//
//  handler - (Function) Optional handler to be bound to the hashchange
//    event. This is a "shortcut" for the more verbose form:
//    jQuery(window).bind( 'hashchange', handler ). If handler is omitted,
//    all bound window.onhashchange event handlers will be triggered. This
//    is a shortcut for the more verbose
//    jQuery(window).trigger( 'hashchange' ). These forms are described in
//    the <hashchange event> section.
//
// Returns:
//
//  (jQuery) The initial jQuery collection of elements.
// Allow the "shortcut" format $(elem).hashchange( fn ) for binding and
// $(elem).hashchange() for triggering, like jQuery does for built-in events.
$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};// Property: jQuery.fn.hashchange.delay
//
// The numeric interval (in milliseconds) at which the <hashchange event>
// polling loop executes. Defaults to 50.
// Property: jQuery.fn.hashchange.domain
//
// If you're setting document.domain in your JavaScript, and you want hash
// history to work in IE6/7, not only must this property be set, but you must
// also set document.domain BEFORE jQuery is loaded into the page. This
// property is only applicable if you are supporting IE6/7 (or IE8 operating
// in "IE7 compatibility" mode).
//
// In addition, the <jQuery.fn.hashchange.src> property must be set to the
// path of the included "document-domain.html" file, which can be renamed or
// modified if necessary (note that the document.domain specified must be the
// same in both your main JavaScript as well as in this file).
//
// Usage:
//
// jQuery.fn.hashchange.domain = document.domain;
// Property: jQuery.fn.hashchange.src
//
// If, for some reason, you need to specify an Iframe src file (for example,
// when setting document.domain as in <jQuery.fn.hashchange.domain>), you can
// do so using this property. Note that when using this property, history
// won't be recorded in IE6/7 until the Iframe src file loads. This property
// is only applicable if you are supporting IE6/7 (or IE8 operating in "IE7
// compatibility" mode).
//
// Usage:
//
// jQuery.fn.hashchange.src = 'path/to/file.html';
$.fn[str_hashchange].delay=50;/*
     $.fn[ str_hashchange ].domain = null;
     $.fn[ str_hashchange ].src = null;
     */ // Event: hashchange event
//
// Fired when location.hash changes. In browsers that support it, the native
// HTML5 window.onhashchange event is used, otherwise a polling loop is
// initialized, running every <jQuery.fn.hashchange.delay> milliseconds to
// see if the hash has changed. In IE6/7 (and IE8 operating in "IE7
// compatibility" mode), a hidden Iframe is created to allow the back button
// and hash-based history to work.
//
// Usage as described in <jQuery.fn.hashchange>:
//
// > // Bind an event handler.
// > jQuery(window).hashchange( function(e) {
// >   var hash = location.hash;
// >   ...
// > });
// >
// > // Manually trigger the event handler.
// > jQuery(window).hashchange();
//
// A more verbose usage that allows for event namespacing:
//
// > // Bind an event handler.
// > jQuery(window).bind( 'hashchange', function(e) {
// >   var hash = location.hash;
// >   ...
// > });
// >
// > // Manually trigger the event handler.
// > jQuery(window).trigger( 'hashchange' );
//
// Additional Notes:
//
// * The polling loop and Iframe are not created until at least one handler
//   is actually bound to the 'hashchange' event.
// * If you need the bound handler(s) to execute immediately, in cases where
//   a location.hash exists on page load, via bookmark or page refresh for
//   example, use jQuery(window).hashchange() or the more verbose
//   jQuery(window).trigger( 'hashchange' ).
// * The event can be bound before DOM ready, but since it won't be usable
//   before then in IE6/7 (due to the necessary Iframe), recommended usage is
//   to bind it inside a DOM ready handler.
// Override existing $.event.special.hashchange methods (allowing this plugin
// to be defined after jQuery BBQ in BBQ's source code).
special[str_hashchange]=$.extend(special[str_hashchange],{// Called only when the first 'hashchange' event is bound to window.
setup:function(){// If window.onhashchange is supported natively, there's nothing to do..
if(supports_onhashchange){return false;}// Otherwise, we need to create our own. And we don't want to call this
// until the user binds to the event, just in case they never do, since it
// will create a polling loop and possibly even a hidden Iframe.
$(fake_onhashchange.start);},// Called only when the last 'hashchange' event is unbound from window.
teardown:function(){// If window.onhashchange is supported natively, there's nothing to do..
if(supports_onhashchange){return false;}// Otherwise, we need to stop ours (if possible).
$(fake_onhashchange.stop);}});// fake_onhashchange does all the work of triggering the window.onhashchange
// event for browsers that don't natively support it, including creating a
// polling loop to watch for hash changes and in IE 6/7 creating a hidden
// Iframe to enable back and forward.
fake_onhashchange=function(){var self={},timeout_id,// Remember the initial hash so it doesn't get triggered immediately.
last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;// Start the polling loop.
self.start=function(){timeout_id||poll();};// Stop the polling loop.
self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};// This polling loop checks every $.fn.hashchange.delay milliseconds to see
// if location.hash has changed, and triggers the 'hashchange' event on
// window when necessary.
function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};// vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
// vvvvvvvvvvvvvvvvvvv REMOVE IF NOT SUPPORTING IE6/7/8 vvvvvvvvvvvvvvvvvvv
// vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
navigator.userAgent.match(/MSIE/i)!==null&&!supports_onhashchange&&function(){// Not only do IE6/7 need the "magical" Iframe treatment, but so does IE8
// when running in "IE7 compatibility" mode.
var iframe,iframe_src;// When the event is bound and polling starts in IE 6/7, create a hidden
// Iframe for history handling.
self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();// Create hidden Iframe. Attempt to make Iframe as hidden as possible
// by using techniques from http://www.paciellogroup.com/blog/?p=604.
iframe=$('<iframe tabindex="-1" title="empty"/>').hide()// When Iframe has completely loaded, initialize the history and
// start polling.
.one('load',function(){iframe_src||history_set(get_fragment());poll();})// Load Iframe src if specified, otherwise nothing.
.attr('src',iframe_src||'javascript:0')// Append Iframe after the end of the body to prevent unnecessary
// initial page scrolling (yes, this works).
.insertAfter('body')[0].contentWindow;// Whenever `document.title` changes, update the Iframe's title to
// prettify the back/next history menu entries. Since IE sometimes
// errors with "Unspecified error" the very first time this is set
// (yes, very useful) wrap this with a try/catch block.
doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};// Override the "stop" method since an IE6/7 Iframe was created. Even
// if there are no longer any bound event handlers, the polling loop
// is still necessary for back/next to work at all!
self.stop=fn_retval;// Get history by looking at the hidden Iframe's location.hash.
history_get=function(){return get_fragment(iframe.location.href);};// Set a new history item by opening and then closing the Iframe
// document, *then* setting its location.hash. If document.domain has
// been set, update that as well.
history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){// Update Iframe with any initial `document.title` that might be set.
iframe_doc.title=doc.title;// Opening the Iframe's document after it has been closed is what
// actually adds a history entry.
iframe_doc.open();// Set document.domain for the Iframe document as well, if necessary.
domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();// Update the Iframe's hash, for great justice.
iframe.location.hash=hash;}};}();// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
// ^^^^^^^^^^^^^^^^^^^ REMOVE IF NOT SUPPORTING IE6/7/8 ^^^^^^^^^^^^^^^^^^^
// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
return self;}();})(jQuery,this);/* http://keith-wood.name/backgroundPos.html
 Background position animation for jQuery v1.1.1.
 Written by Keith Wood (kbwood{at}iinet.com.au) November 2010.
 Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license.
 Please attribute the author if you use it. */(function($){var g=!!$.Tween;if(g){$.Tween.propHooks['backgroundPosition']={get:function(a){return parseBackgroundPosition($(a.elem).css(a.prop));},set:setBackgroundPosition};}else{$.fx.step['backgroundPosition']=setBackgroundPosition;};function parseBackgroundPosition(c){var d=(c||'').split(/ /);var e={center:'50%',left:'0%',right:'100%',top:'0%',bottom:'100%'};var f=function(a){var b=(e[d[a]]||d[a]||'50%').match(/^([+-]=)?([+-]?\d+(\.\d*)?)(.*)$/);d[a]=[b[1],parseFloat(b[2]),b[4]||'px'];};if(d.length==1&&$.inArray(d[0],['top','bottom'])>-1){d[1]=d[0];d[0]='50%';}f(0);f(1);return d;}function setBackgroundPosition(a){if(!a.set){initBackgroundPosition(a);}$(a.elem).css('background-position',a.pos*(a.end[0][1]-a.start[0][1])+a.start[0][1]+a.end[0][2]+' '+(a.pos*(a.end[1][1]-a.start[1][1])+a.start[1][1]+a.end[1][2]));}function initBackgroundPosition(a){a.start=parseBackgroundPosition($(a.elem).css('backgroundPosition'));a.end=parseBackgroundPosition(a.end);for(var i=0;i<a.end.length;i++){if(a.end[i][0]){a.end[i][1]=a.start[i][1]+(a.end[i][0]=='-='?-1:+1)*a.end[i][1];}}a.set=true;}})(jQuery);/*jslint devel: true, bitwise: true, regexp: true, browser: true, confusion: true, unparam: true, eqeq: true, white: true, nomen: true, plusplus: true, maxerr: 50, indent: 4 */ /*globals jQuery,Color */ /*
 * ColorPicker
 *
 * Copyright (c) 2011-2013 Martijn W. van der Lee
 * Licensed under the MIT.
 *
 * Full-featured colorpicker for jQueryUI with full theming support.
 * Most images from jPicker by Christopher T. Tillman.
 * Sourcecode created from scratch by Martijn W. van der Lee.
 *
 * https://raw.github.com/vanderlee/colorpicker
 */(function($){"use strict";$.colorpicker=new function(){this.regional=[];this.regional['']={ok:'OK',cancel:'Cancel',none:'None',button:'Color',title:'Pick a color',transparent:'Transparent',hsvH:'H',hsvS:'S',hsvV:'V',rgbR:'R',rgbG:'G',rgbB:'B',labL:'L',labA:'a',labB:'b',hslH:'H',hslS:'S',hslL:'L',cmykC:'C',cmykM:'M',cmykY:'Y',cmykK:'K',alphaA:'A'};this.swatches=[];this.swatches['html']={'black':{r:0,g:0,b:0},'dimgray':{r:0.4117647058823529,g:0.4117647058823529,b:0.4117647058823529},'gray':{r:0.5019607843137255,g:0.5019607843137255,b:0.5019607843137255},'darkgray':{r:0.6627450980392157,g:0.6627450980392157,b:0.6627450980392157},'silver':{r:0.7529411764705882,g:0.7529411764705882,b:0.7529411764705882},'lightgrey':{r:0.8274509803921568,g:0.8274509803921568,b:0.8274509803921568},'gainsboro':{r:0.8627450980392157,g:0.8627450980392157,b:0.8627450980392157},'whitesmoke':{r:0.9607843137254902,g:0.9607843137254902,b:0.9607843137254902},'white':{r:1,g:1,b:1},'rosybrown':{r:0.7372549019607844,g:0.5607843137254902,b:0.5607843137254902},'indianred':{r:0.803921568627451,g:0.3607843137254902,b:0.3607843137254902},'brown':{r:0.6470588235294118,g:0.16470588235294117,b:0.16470588235294117},'firebrick':{r:0.6980392156862745,g:0.13333333333333333,b:0.13333333333333333},'lightcoral':{r:0.9411764705882353,g:0.5019607843137255,b:0.5019607843137255},'maroon':{r:0.5019607843137255,g:0,b:0},'darkred':{r:0.5450980392156862,g:0,b:0},'red':{r:1,g:0,b:0},'snow':{r:1,g:0.9803921568627451,b:0.9803921568627451},'salmon':{r:0.9803921568627451,g:0.5019607843137255,b:0.4470588235294118},'mistyrose':{r:1,g:0.8941176470588236,b:0.8823529411764706},'tomato':{r:1,g:0.38823529411764707,b:0.2784313725490196},'darksalmon':{r:0.9137254901960784,g:0.5882352941176471,b:0.47843137254901963},'orangered':{r:1,g:0.27058823529411763,b:0},'coral':{r:1,g:0.4980392156862745,b:0.3137254901960784},'lightsalmon':{r:1,g:0.6274509803921569,b:0.47843137254901963},'sienna':{r:0.6274509803921569,g:0.3215686274509804,b:0.17647058823529413},'seashell':{r:1,g:0.9607843137254902,b:0.9333333333333333},'chocolate':{r:0.8235294117647058,g:0.4117647058823529,b:0.11764705882352941},'saddlebrown':{r:0.5450980392156862,g:0.27058823529411763,b:0.07450980392156863},'sandybrown':{r:0.9568627450980393,g:0.6431372549019608,b:0.3764705882352941},'peachpuff':{r:1,g:0.8549019607843137,b:0.7254901960784313},'peru':{r:0.803921568627451,g:0.5215686274509804,b:0.24705882352941178},'linen':{r:0.9803921568627451,g:0.9411764705882353,b:0.9019607843137255},'darkorange':{r:1,g:0.5490196078431373,b:0},'bisque':{r:1,g:0.8941176470588236,b:0.7686274509803922},'burlywood':{r:0.8705882352941177,g:0.7215686274509804,b:0.5294117647058824},'tan':{r:0.8235294117647058,g:0.7058823529411765,b:0.5490196078431373},'antiquewhite':{r:0.9803921568627451,g:0.9215686274509803,b:0.8431372549019608},'navajowhite':{r:1,g:0.8705882352941177,b:0.6784313725490196},'blanchedalmond':{r:1,g:0.9215686274509803,b:0.803921568627451},'papayawhip':{r:1,g:0.9372549019607843,b:0.8352941176470589},'orange':{r:1,g:0.6470588235294118,b:0},'moccasin':{r:1,g:0.8941176470588236,b:0.7098039215686275},'wheat':{r:0.9607843137254902,g:0.8705882352941177,b:0.7019607843137254},'oldlace':{r:0.9921568627450981,g:0.9607843137254902,b:0.9019607843137255},'floralwhite':{r:1,g:0.9803921568627451,b:0.9411764705882353},'goldenrod':{r:0.8549019607843137,g:0.6470588235294118,b:0.12549019607843137},'darkgoldenrod':{r:0.7215686274509804,g:0.5254901960784314,b:0.043137254901960784},'cornsilk':{r:1,g:0.9725490196078431,b:0.8627450980392157},'gold':{r:1,g:0.8431372549019608,b:0},'palegoldenrod':{r:0.9333333333333333,g:0.9098039215686274,b:0.6666666666666666},'khaki':{r:0.9411764705882353,g:0.9019607843137255,b:0.5490196078431373},'lemonchiffon':{r:1,g:0.9803921568627451,b:0.803921568627451},'darkkhaki':{r:0.7411764705882353,g:0.7176470588235294,b:0.4196078431372549},'beige':{r:0.9607843137254902,g:0.9607843137254902,b:0.8627450980392157},'lightgoldenrodyellow':{r:0.9803921568627451,g:0.9803921568627451,b:0.8235294117647058},'olive':{r:0.5019607843137255,g:0.5019607843137255,b:0},'yellow':{r:1,g:1,b:0},'lightyellow':{r:1,g:1,b:0.8784313725490196},'ivory':{r:1,g:1,b:0.9411764705882353},'olivedrab':{r:0.4196078431372549,g:0.5568627450980392,b:0.13725490196078433},'yellowgreen':{r:0.6039215686274509,g:0.803921568627451,b:0.19607843137254902},'darkolivegreen':{r:0.3333333333333333,g:0.4196078431372549,b:0.1843137254901961},'greenyellow':{r:0.6784313725490196,g:1,b:0.1843137254901961},'lawngreen':{r:0.48627450980392156,g:0.9882352941176471,b:0},'chartreuse':{r:0.4980392156862745,g:1,b:0},'darkseagreen':{r:0.5607843137254902,g:0.7372549019607844,b:0.5607843137254902},'forestgreen':{r:0.13333333333333333,g:0.5450980392156862,b:0.13333333333333333},'limegreen':{r:0.19607843137254902,g:0.803921568627451,b:0.19607843137254902},'lightgreen':{r:0.5647058823529412,g:0.9333333333333333,b:0.5647058823529412},'palegreen':{r:0.596078431372549,g:0.984313725490196,b:0.596078431372549},'darkgreen':{r:0,g:0.39215686274509803,b:0},'green':{r:0,g:0.5019607843137255,b:0},'lime':{r:0,g:1,b:0},'honeydew':{r:0.9411764705882353,g:1,b:0.9411764705882353},'mediumseagreen':{r:0.23529411764705882,g:0.7019607843137254,b:0.44313725490196076},'seagreen':{r:0.1803921568627451,g:0.5450980392156862,b:0.3411764705882353},'springgreen':{r:0,g:1,b:0.4980392156862745},'mintcream':{r:0.9607843137254902,g:1,b:0.9803921568627451},'mediumspringgreen':{r:0,g:0.9803921568627451,b:0.6039215686274509},'mediumaquamarine':{r:0.4,g:0.803921568627451,b:0.6666666666666666},'aquamarine':{r:0.4980392156862745,g:1,b:0.8313725490196079},'turquoise':{r:0.25098039215686274,g:0.8784313725490196,b:0.8156862745098039},'lightseagreen':{r:0.12549019607843137,g:0.6980392156862745,b:0.6666666666666666},'mediumturquoise':{r:0.2823529411764706,g:0.8196078431372549,b:0.8},'darkslategray':{r:0.1843137254901961,g:0.30980392156862746,b:0.30980392156862746},'paleturquoise':{r:0.6862745098039216,g:0.9333333333333333,b:0.9333333333333333},'teal':{r:0,g:0.5019607843137255,b:0.5019607843137255},'darkcyan':{r:0,g:0.5450980392156862,b:0.5450980392156862},'darkturquoise':{r:0,g:0.807843137254902,b:0.8196078431372549},'aqua':{r:0,g:1,b:1},'cyan':{r:0,g:1,b:1},'lightcyan':{r:0.8784313725490196,g:1,b:1},'azure':{r:0.9411764705882353,g:1,b:1},'cadetblue':{r:0.37254901960784315,g:0.6196078431372549,b:0.6274509803921569},'powderblue':{r:0.6901960784313725,g:0.8784313725490196,b:0.9019607843137255},'lightblue':{r:0.6784313725490196,g:0.8470588235294118,b:0.9019607843137255},'deepskyblue':{r:0,g:0.7490196078431373,b:1},'skyblue':{r:0.5294117647058824,g:0.807843137254902,b:0.9215686274509803},'lightskyblue':{r:0.5294117647058824,g:0.807843137254902,b:0.9803921568627451},'steelblue':{r:0.27450980392156865,g:0.5098039215686274,b:0.7058823529411765},'aliceblue':{r:0.9411764705882353,g:0.9725490196078431,b:1},'dodgerblue':{r:0.11764705882352941,g:0.5647058823529412,b:1},'slategray':{r:0.4392156862745098,g:0.5019607843137255,b:0.5647058823529412},'lightslategray':{r:0.4666666666666667,g:0.5333333333333333,b:0.6},'lightsteelblue':{r:0.6901960784313725,g:0.7686274509803922,b:0.8705882352941177},'cornflowerblue':{r:0.39215686274509803,g:0.5843137254901961,b:0.9294117647058824},'royalblue':{r:0.2549019607843137,g:0.4117647058823529,b:0.8823529411764706},'midnightblue':{r:0.09803921568627451,g:0.09803921568627451,b:0.4392156862745098},'lavender':{r:0.9019607843137255,g:0.9019607843137255,b:0.9803921568627451},'navy':{r:0,g:0,b:0.5019607843137255},'darkblue':{r:0,g:0,b:0.5450980392156862},'mediumblue':{r:0,g:0,b:0.803921568627451},'blue':{r:0,g:0,b:1},'ghostwhite':{r:0.9725490196078431,g:0.9725490196078431,b:1},'darkslateblue':{r:0.2823529411764706,g:0.23921568627450981,b:0.5450980392156862},'slateblue':{r:0.41568627450980394,g:0.35294117647058826,b:0.803921568627451},'mediumslateblue':{r:0.4823529411764706,g:0.40784313725490196,b:0.9333333333333333},'mediumpurple':{r:0.5764705882352941,g:0.4392156862745098,b:0.8588235294117647},'blueviolet':{r:0.5411764705882353,g:0.16862745098039217,b:0.8862745098039215},'indigo':{r:0.29411764705882354,g:0,b:0.5098039215686274},'darkorchid':{r:0.6,g:0.19607843137254902,b:0.8},'darkviolet':{r:0.5803921568627451,g:0,b:0.8274509803921568},'mediumorchid':{r:0.7294117647058823,g:0.3333333333333333,b:0.8274509803921568},'thistle':{r:0.8470588235294118,g:0.7490196078431373,b:0.8470588235294118},'plum':{r:0.8666666666666667,g:0.6274509803921569,b:0.8666666666666667},'violet':{r:0.9333333333333333,g:0.5098039215686274,b:0.9333333333333333},'purple':{r:0.5019607843137255,g:0,b:0.5019607843137255},'darkmagenta':{r:0.5450980392156862,g:0,b:0.5450980392156862},'magenta':{r:1,g:0,b:1},'fuchsia':{r:1,g:0,b:1},'orchid':{r:0.8549019607843137,g:0.4392156862745098,b:0.8392156862745098},'mediumvioletred':{r:0.7803921568627451,g:0.08235294117647059,b:0.5215686274509804},'deeppink':{r:1,g:0.0784313725490196,b:0.5764705882352941},'hotpink':{r:1,g:0.4117647058823529,b:0.7058823529411765},'palevioletred':{r:0.8588235294117647,g:0.4392156862745098,b:0.5764705882352941},'lavenderblush':{r:1,g:0.9411764705882353,b:0.9607843137254902},'crimson':{r:0.8627450980392157,g:0.0784313725490196,b:0.23529411764705882},'pink':{r:1,g:0.7529411764705882,b:0.796078431372549},'lightpink':{r:1,g:0.7137254901960784,b:0.7568627450980392}};}();var _colorpicker_index=0,_container_popup='<div class="ui-colorpicker ui-colorpicker-dialog ui-dialog ui-widget ui-widget-content ui-corner-all" style="display: none;"></div>',_container_inline='<div class="ui-colorpicker ui-colorpicker-inline ui-dialog ui-widget ui-widget-content ui-corner-all"></div>',_parts_lists={'full':['header','map','bar','hex','hsv','rgb','alpha','lab','cmyk','preview','swatches','footer'],'popup':['map','bar','hex','hsv','rgb','alpha','preview','footer'],'draggable':['header','map','bar','hex','hsv','rgb','alpha','preview','footer'],'inline':['map','bar','hex','hsv','rgb','alpha','preview']},_intToHex=function(dec){var result=Math.round(dec).toString(16);if(result.length===1){result='0'+result;}return result.toLowerCase();},_parseHex=function(color){var c,m;// {#}rrggbb
m=/^#?([a-fA-F0-9]{1,6})$/.exec(color);if(m){c=parseInt(m[1],16);return new Color((c>>16&0xFF)/255,(c>>8&0xFF)/255,(c&0xFF)/255);}return new Color();},_layoutTable=function(layout,callback){var bitmap,x,y,width,height,columns,rows,index,cell,html,w,h,colspan,walked;layout.sort(function(a,b){if(a.pos[1]==b.pos[1]){return a.pos[0]-b.pos[0];}return a.pos[1]-b.pos[1];});// Determine dimensions of the table
width=0;height=0;$.each(layout,function(index,part){width=Math.max(width,part.pos[0]+part.pos[2]);height=Math.max(height,part.pos[1]+part.pos[3]);});// Initialize bitmap
bitmap=[];for(x=0;x<width;++x){bitmap.push([]);}// Mark rows and columns which have layout assigned
rows=[];columns=[];$.each(layout,function(index,part){// mark columns
for(x=0;x<part.pos[2];x+=1){columns[part.pos[0]+x]=true;}for(y=0;y<part.pos[3];y+=1){rows[part.pos[1]+y]=true;}});// Generate the table
html='';cell=layout[index=0];for(y=0;y<height;++y){html+='<tr>';for(x=0;x<width;x){if(typeof cell!=='undefined'&&x==cell.pos[0]&&y==cell.pos[1]){// Create a "real" cell
html+=callback(cell,x,y);for(h=0;h<cell.pos[3];h+=1){for(w=0;w<cell.pos[2];w+=1){bitmap[x+w][y+h]=true;}}x+=cell.pos[2];cell=layout[++index];}else{// Fill in the gaps
colspan=0;walked=false;while(x<width&&bitmap[x][y]===undefined&&(cell===undefined||y<cell.pos[1]||y==cell.pos[1]&&x<cell.pos[0])){if(columns[x]===true){colspan+=1;}walked=true;x+=1;}if(colspan>0){html+='<td colspan="'+colspan+'"></td>';}else if(!walked){x+=1;}}}html+='</tr>';}return'<table cellspacing="0" cellpadding="0" border="0"><tbody>'+html+'</tbody></table>';},_parts={header:function(inst){var that=this,e=null,_html=function(){var title=inst.options.title||inst._getRegional('title'),html='<span class="ui-dialog-title">'+title+'</span>';if(!inst.inline&&inst.options.showCloseButton){html+='<a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button">'+'<span class="ui-icon ui-icon-closethick">close</span></a>';}return'<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+html+'</div>';};this.init=function(){e=$(_html()).prependTo(inst.dialog);var close=$('.ui-dialog-titlebar-close',e);inst._hoverable(close);inst._focusable(close);close.click(function(event){event.preventDefault();inst.close();});if(!inst.inline&&inst.options.draggable){inst.dialog.draggable({handle:e});}};},map:function(inst){var that=this,e=null,mousemove_timeout=null,_mousedown,_mouseup,_mousemove,_html;_mousedown=function(event){if(!inst.opened){return;}var div=$('.ui-colorpicker-map-layer-pointer',e),offset=div.offset(),width=div.width(),height=div.height(),x=event.pageX-offset.left,y=event.pageY-offset.top;if(x>=0&&x<width&&y>=0&&y<height){event.stopImmediatePropagation();event.preventDefault();e.unbind('mousedown',_mousedown);$(document).bind('mouseup',_mouseup);$(document).bind('mousemove',_mousemove);_mousemove(event);}};_mouseup=function(event){event.stopImmediatePropagation();event.preventDefault();$(document).unbind('mouseup',_mouseup);$(document).unbind('mousemove',_mousemove);e.bind('mousedown',_mousedown);};_mousemove=function(event){event.stopImmediatePropagation();event.preventDefault();if(event.pageX===that.x&&event.pageY===that.y){return;}that.x=event.pageX;that.y=event.pageY;var div=$('.ui-colorpicker-map-layer-pointer',e),offset=div.offset(),width=div.width(),height=div.height(),x=event.pageX-offset.left,y=event.pageY-offset.top;x=Math.max(0,Math.min(x/width,1));y=Math.max(0,Math.min(y/height,1));// interpret values
switch(inst.mode){case'h':inst.color.setHSV(null,x,1-y);break;case's':case'a':inst.color.setHSV(x,null,1-y);break;case'v':inst.color.setHSV(x,1-y,null);break;case'r':inst.color.setRGB(null,1-y,x);break;case'g':inst.color.setRGB(1-y,null,x);break;case'b':inst.color.setRGB(x,1-y,null);break;}inst._change();};_html=function(){var html='<div class="ui-colorpicker-map ui-colorpicker-border">'+'<span class="ui-colorpicker-map-layer-1">&nbsp;</span>'+'<span class="ui-colorpicker-map-layer-2">&nbsp;</span>'+(inst.options.alpha?'<span class="ui-colorpicker-map-layer-alpha">&nbsp;</span>':'')+'<span class="ui-colorpicker-map-layer-pointer"><span class="ui-colorpicker-map-pointer"></span></span></div>';return html;};this.update=function(){switch(inst.mode){case'h':$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 0','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).hide();break;case's':case'a':$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 -260px','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).css({'background-position':'0 -520px','opacity':''}).show();break;case'v':$(e).css('background-color','black');$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 -780px','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).hide();break;case'r':$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 -1040px','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).css({'background-position':'0 -1300px','opacity':''}).show();break;case'g':$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 -1560px','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).css({'background-position':'0 -1820px','opacity':''}).show();break;case'b':$('.ui-colorpicker-map-layer-1',e).css({'background-position':'0 -2080px','opacity':''}).show();$('.ui-colorpicker-map-layer-2',e).css({'background-position':'0 -2340px','opacity':''}).show();break;}that.repaint();};this.repaint=function(){var div=$('.ui-colorpicker-map-layer-pointer',e),x=0,y=0;switch(inst.mode){case'h':x=inst.color.getHSV().s*div.width();y=(1-inst.color.getHSV().v)*div.width();$(e).css('background-color',inst.color.copy().normalize().toCSS());break;case's':case'a':x=inst.color.getHSV().h*div.width();y=(1-inst.color.getHSV().v)*div.width();$('.ui-colorpicker-map-layer-2',e).css('opacity',1-inst.color.getHSV().s);break;case'v':x=inst.color.getHSV().h*div.width();y=(1-inst.color.getHSV().s)*div.width();$('.ui-colorpicker-map-layer-1',e).css('opacity',inst.color.getHSV().v);break;case'r':x=inst.color.getRGB().b*div.width();y=(1-inst.color.getRGB().g)*div.width();$('.ui-colorpicker-map-layer-2',e).css('opacity',inst.color.getRGB().r);break;case'g':x=inst.color.getRGB().b*div.width();y=(1-inst.color.getRGB().r)*div.width();$('.ui-colorpicker-map-layer-2',e).css('opacity',inst.color.getRGB().g);break;case'b':x=inst.color.getRGB().r*div.width();y=(1-inst.color.getRGB().g)*div.width();$('.ui-colorpicker-map-layer-2',e).css('opacity',inst.color.getRGB().b);break;}if(inst.options.alpha){$('.ui-colorpicker-map-layer-alpha',e).css('opacity',1-inst.color.getAlpha());}$('.ui-colorpicker-map-pointer',e).css({'left':x-7,'top':y-7});};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-map-container',inst.dialog));e.bind('mousedown',_mousedown);};},bar:function(inst){var that=this,e=null,_mousedown,_mouseup,_mousemove,_html;_mousedown=function(event){if(!inst.opened){return;}var div=$('.ui-colorpicker-bar-layer-pointer',e),offset=div.offset(),width=div.width(),height=div.height(),x=event.pageX-offset.left,y=event.pageY-offset.top;if(x>=0&&x<width&&y>=0&&y<height){event.stopImmediatePropagation();event.preventDefault();e.unbind('mousedown',_mousedown);$(document).bind('mouseup',_mouseup);$(document).bind('mousemove',_mousemove);_mousemove(event);}};_mouseup=function(event){event.stopImmediatePropagation();event.preventDefault();$(document).unbind('mouseup',_mouseup);$(document).unbind('mousemove',_mousemove);e.bind('mousedown',_mousedown);};_mousemove=function(event){event.stopImmediatePropagation();event.preventDefault();if(event.pageY===that.y){return;}that.y=event.pageY;var div=$('.ui-colorpicker-bar-layer-pointer',e),offset=div.offset(),height=div.height(),y=event.pageY-offset.top;y=Math.max(0,Math.min(y/height,1));// interpret values
switch(inst.mode){case'h':inst.color.setHSV(1-y,null,null);break;case's':inst.color.setHSV(null,1-y,null);break;case'v':inst.color.setHSV(null,null,1-y);break;case'r':inst.color.setRGB(1-y,null,null);break;case'g':inst.color.setRGB(null,1-y,null);break;case'b':inst.color.setRGB(null,null,1-y);break;case'a':inst.color.setAlpha(1-y);break;}inst._change();};_html=function(){var html='<div class="ui-colorpicker-bar ui-colorpicker-border">'+'<span class="ui-colorpicker-bar-layer-1">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-2">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-3">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-4">&nbsp;</span>';if(inst.options.alpha){html+='<span class="ui-colorpicker-bar-layer-alpha">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-alphabar">&nbsp;</span>';}html+='<span class="ui-colorpicker-bar-layer-pointer"><span class="ui-colorpicker-bar-pointer"></span></span></div>';return html;};this.update=function(){switch(inst.mode){case'h':case's':case'v':case'r':case'g':case'b':$('.ui-colorpicker-bar-layer-alpha',e).show();$('.ui-colorpicker-bar-layer-alphabar',e).hide();break;case'a':$('.ui-colorpicker-bar-layer-alpha',e).hide();$('.ui-colorpicker-bar-layer-alphabar',e).show();break;}switch(inst.mode){case'h':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 0','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).hide();$('.ui-colorpicker-bar-layer-3',e).hide();$('.ui-colorpicker-bar-layer-4',e).hide();break;case's':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 -260px','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).css({'background-position':'0 -520px','opacity':''}).show();$('.ui-colorpicker-bar-layer-3',e).hide();$('.ui-colorpicker-bar-layer-4',e).hide();break;case'v':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 -520px','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).hide();$('.ui-colorpicker-bar-layer-3',e).hide();$('.ui-colorpicker-bar-layer-4',e).hide();break;case'r':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 -1560px','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).css({'background-position':'0 -1300px','opacity':''}).show();$('.ui-colorpicker-bar-layer-3',e).css({'background-position':'0 -780px','opacity':''}).show();$('.ui-colorpicker-bar-layer-4',e).css({'background-position':'0 -1040px','opacity':''}).show();break;case'g':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 -2600px','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).css({'background-position':'0 -2340px','opacity':''}).show();$('.ui-colorpicker-bar-layer-3',e).css({'background-position':'0 -1820px','opacity':''}).show();$('.ui-colorpicker-bar-layer-4',e).css({'background-position':'0 -2080px','opacity':''}).show();break;case'b':$('.ui-colorpicker-bar-layer-1',e).css({'background-position':'0 -3640px','opacity':''}).show();$('.ui-colorpicker-bar-layer-2',e).css({'background-position':'0 -3380px','opacity':''}).show();$('.ui-colorpicker-bar-layer-3',e).css({'background-position':'0 -2860px','opacity':''}).show();$('.ui-colorpicker-bar-layer-4',e).css({'background-position':'0 -3120px','opacity':''}).show();break;case'a':$('.ui-colorpicker-bar-layer-1',e).hide();$('.ui-colorpicker-bar-layer-2',e).hide();$('.ui-colorpicker-bar-layer-3',e).hide();$('.ui-colorpicker-bar-layer-4',e).hide();break;}that.repaint();};this.repaint=function(){var div=$('.ui-colorpicker-bar-layer-pointer',e),y=0;switch(inst.mode){case'h':y=(1-inst.color.getHSV().h)*div.height();break;case's':y=(1-inst.color.getHSV().s)*div.height();$('.ui-colorpicker-bar-layer-2',e).css('opacity',1-inst.color.getHSV().v);$(e).css('background-color',inst.color.copy().normalize().toCSS());break;case'v':y=(1-inst.color.getHSV().v)*div.height();$(e).css('background-color',inst.color.copy().normalize().toCSS());break;case'r':y=(1-inst.color.getRGB().r)*div.height();$('.ui-colorpicker-bar-layer-2',e).css('opacity',Math.max(0,inst.color.getRGB().b-inst.color.getRGB().g));$('.ui-colorpicker-bar-layer-3',e).css('opacity',Math.max(0,inst.color.getRGB().g-inst.color.getRGB().b));$('.ui-colorpicker-bar-layer-4',e).css('opacity',Math.min(inst.color.getRGB().b,inst.color.getRGB().g));break;case'g':y=(1-inst.color.getRGB().g)*div.height();$('.ui-colorpicker-bar-layer-2',e).css('opacity',Math.max(0,inst.color.getRGB().b-inst.color.getRGB().r));$('.ui-colorpicker-bar-layer-3',e).css('opacity',Math.max(0,inst.color.getRGB().r-inst.color.getRGB().b));$('.ui-colorpicker-bar-layer-4',e).css('opacity',Math.min(inst.color.getRGB().r,inst.color.getRGB().b));break;case'b':y=(1-inst.color.getRGB().b)*div.height();$('.ui-colorpicker-bar-layer-2',e).css('opacity',Math.max(0,inst.color.getRGB().r-inst.color.getRGB().g));$('.ui-colorpicker-bar-layer-3',e).css('opacity',Math.max(0,inst.color.getRGB().g-inst.color.getRGB().r));$('.ui-colorpicker-bar-layer-4',e).css('opacity',Math.min(inst.color.getRGB().r,inst.color.getRGB().g));break;case'a':y=(1-inst.color.getAlpha())*div.height();$(e).css('background-color',inst.color.copy().normalize().toCSS());break;}if(inst.mode!=='a'){$('.ui-colorpicker-bar-layer-alpha',e).css('opacity',1-inst.color.getAlpha());}$('.ui-colorpicker-bar-pointer',e).css('top',y-3);};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-bar-container',inst.dialog));e.bind('mousedown',_mousedown);};},preview:function(inst){var that=this,e=null,_html;_html=function(){return'<div class="ui-colorpicker-preview ui-colorpicker-border">'+'<div class="ui-colorpicker-preview-initial"><div class="ui-colorpicker-preview-initial-alpha"></div></div>'+'<div class="ui-colorpicker-preview-current"><div class="ui-colorpicker-preview-current-alpha"></div></div>'+'</div>';};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-preview-container',inst.dialog));$('.ui-colorpicker-preview-initial',e).click(function(){inst.color=inst.currentColor.copy();inst._change();});};this.update=function(){if(inst.options.alpha){$('.ui-colorpicker-preview-initial-alpha, .ui-colorpicker-preview-current-alpha',e).show();}else{$('.ui-colorpicker-preview-initial-alpha, .ui-colorpicker-preview-current-alpha',e).hide();}this.repaint();};this.repaint=function(){$('.ui-colorpicker-preview-initial',e).css('background-color',inst.currentColor.toCSS()).attr('title',inst.currentColor.toHex());$('.ui-colorpicker-preview-initial-alpha',e).css('opacity',1-inst.currentColor.getAlpha());$('.ui-colorpicker-preview-current',e).css('background-color',inst.color.toCSS()).attr('title',inst.color.toHex());$('.ui-colorpicker-preview-current-alpha',e).css('opacity',1-inst.color.getAlpha());};},hsv:function(inst){var that=this,e=null,_html;_html=function(){var html='';if(inst.options.hsv){html+='<div class="ui-colorpicker-hsv-h"><input class="ui-colorpicker-mode" type="radio" value="h"/><label>'+inst._getRegional('hsvH')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="360" size="10"/><span class="ui-colorpicker-unit">&deg;</span></div>'+'<div class="ui-colorpicker-hsv-s"><input class="ui-colorpicker-mode" type="radio" value="s"/><label>'+inst._getRegional('hsvS')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-hsv-v"><input class="ui-colorpicker-mode" type="radio" value="v"/><label>'+inst._getRegional('hsvV')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>';}return'<div class="ui-colorpicker-hsv">'+html+'</div>';};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-hsv-container',inst.dialog));$('.ui-colorpicker-mode',e).click(function(){inst.mode=$(this).val();inst._updateAllParts();});$('.ui-colorpicker-number',e).bind('change keyup',function(){inst.color.setHSV($('.ui-colorpicker-hsv-h .ui-colorpicker-number',e).val()/360,$('.ui-colorpicker-hsv-s .ui-colorpicker-number',e).val()/100,$('.ui-colorpicker-hsv-v .ui-colorpicker-number',e).val()/100);inst._change();});};this.repaint=function(){var hsv=inst.color.getHSV();hsv.h*=360;hsv.s*=100;hsv.v*=100;$.each(hsv,function(index,value){var input=$('.ui-colorpicker-hsv-'+index+' .ui-colorpicker-number',e);value=Math.round(value);if(input.val()!==value){input.val(value);}});};this.update=function(){$('.ui-colorpicker-mode',e).each(function(){$(this).attr('checked',$(this).val()===inst.mode);});this.repaint();};},rgb:function(inst){var that=this,e=null,_html;_html=function(){var html='';if(inst.options.rgb){html+='<div class="ui-colorpicker-rgb-r"><input class="ui-colorpicker-mode" type="radio" value="r"/><label>'+inst._getRegional('rgbR')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'+'<div class="ui-colorpicker-rgb-g"><input class="ui-colorpicker-mode" type="radio" value="g"/><label>'+inst._getRegional('rgbG')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'+'<div class="ui-colorpicker-rgb-b"><input class="ui-colorpicker-mode" type="radio" value="b"/><label>'+inst._getRegional('rgbB')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>';}return'<div class="ui-colorpicker-rgb">'+html+'</div>';};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-rgb-container',inst.dialog));$('.ui-colorpicker-mode',e).click(function(){inst.mode=$(this).val();inst._updateAllParts();});$('.ui-colorpicker-number',e).bind('change keyup',function(){inst.color.setRGB($('.ui-colorpicker-rgb-r .ui-colorpicker-number',e).val()/255,$('.ui-colorpicker-rgb-g .ui-colorpicker-number',e).val()/255,$('.ui-colorpicker-rgb-b .ui-colorpicker-number',e).val()/255);inst._change();});};this.repaint=function(){$.each(inst.color.getRGB(),function(index,value){var input=$('.ui-colorpicker-rgb-'+index+' .ui-colorpicker-number',e);value=Math.round(value*255);if(input.val()!==value){input.val(value);}});};this.update=function(){$('.ui-colorpicker-mode',e).each(function(){$(this).attr('checked',$(this).val()===inst.mode);});this.repaint();};},lab:function(inst){var that=this,part=null,html=function(){var html='';if(inst.options.hsv){html+='<div class="ui-colorpicker-lab-l"><label>'+inst._getRegional('labL')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/></div>'+'<div class="ui-colorpicker-lab-a"><label>'+inst._getRegional('labA')+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>'+'<div class="ui-colorpicker-lab-b"><label>'+inst._getRegional('labB')+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>';}return'<div class="ui-colorpicker-lab">'+html+'</div>';};this.init=function(){var data=0;part=$(html()).appendTo($('.ui-colorpicker-lab-container',inst.dialog));$('.ui-colorpicker-number',part).on('change keyup',function(event){inst.color.setLAB(parseInt($('.ui-colorpicker-lab-l .ui-colorpicker-number',part).val(),10)/100,(parseInt($('.ui-colorpicker-lab-a .ui-colorpicker-number',part).val(),10)+128)/255,(parseInt($('.ui-colorpicker-lab-b .ui-colorpicker-number',part).val(),10)+128)/255);inst._change();});};this.repaint=function(){var lab=inst.color.getLAB();lab.l*=100;lab.a=lab.a*255-128;lab.b=lab.b*255-128;$.each(lab,function(index,value){var input=$('.ui-colorpicker-lab-'+index+' .ui-colorpicker-number',part);value=Math.round(value);if(input.val()!==value){input.val(value);}});};this.update=function(){this.repaint();};},cmyk:function(inst){var that=this,part=null,html=function(){var html='';if(inst.options.hsv){html+='<div class="ui-colorpicker-cmyk-c"><label>'+inst._getRegional('cmykC')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-m"><label>'+inst._getRegional('cmykM')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-y"><label>'+inst._getRegional('cmykY')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-k"><label>'+inst._getRegional('cmykK')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>';}return'<div class="ui-colorpicker-cmyk">'+html+'</div>';};this.init=function(){part=$(html()).appendTo($('.ui-colorpicker-cmyk-container',inst.dialog));$('.ui-colorpicker-number',part).on('change keyup',function(event){inst.color.setCMYK(parseInt($('.ui-colorpicker-cmyk-c .ui-colorpicker-number',part).val(),10)/100,parseInt($('.ui-colorpicker-cmyk-m .ui-colorpicker-number',part).val(),10)/100,parseInt($('.ui-colorpicker-cmyk-y .ui-colorpicker-number',part).val(),10)/100,parseInt($('.ui-colorpicker-cmyk-k .ui-colorpicker-number',part).val(),10)/100);inst._change();});};this.repaint=function(){$.each(inst.color.getCMYK(),function(index,value){var input=$('.ui-colorpicker-cmyk-'+index+' .ui-colorpicker-number',part);value=Math.round(value*100);if(input.val()!==value){input.val(value);}});};this.update=function(){this.repaint();};},alpha:function(inst){var that=this,e=null,_html;_html=function(){var html='';if(inst.options.alpha){html+='<div class="ui-colorpicker-a"><input class="ui-colorpicker-mode" name="mode" type="radio" value="a"/><label>'+inst._getRegional('alphaA')+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>';}return'<div class="ui-colorpicker-alpha">'+html+'</div>';};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-alpha-container',inst.dialog));$('.ui-colorpicker-mode',e).click(function(){inst.mode=$(this).val();inst._updateAllParts();});$('.ui-colorpicker-number',e).bind('change keyup',function(){inst.color.setAlpha($('.ui-colorpicker-a .ui-colorpicker-number',e).val()/100);inst._change();});};this.update=function(){$('.ui-colorpicker-mode',e).each(function(){$(this).attr('checked',$(this).val()===inst.mode);});this.repaint();};this.repaint=function(){var input=$('.ui-colorpicker-a .ui-colorpicker-number',e),value=Math.round(inst.color.getAlpha()*100);if(!input.is(':focus')&&input.val()!==value){input.val(value);}};},hex:function(inst){var that=this,e=null,_html;_html=function(){var html='';if(inst.options.alpha){html+='<input class="ui-colorpicker-hex-alpha" type="text" maxlength="2" size="2"/>';}html+='<input class="ui-colorpicker-hex-input" type="text" maxlength="6" size="6"/>';return'<div class="ui-colorpicker-hex"><label>#</label>'+html+'</div>';};this.init=function(){e=$(_html()).appendTo($('.ui-colorpicker-hex-container',inst.dialog));// repeat here makes the invalid input disappear faster
$('.ui-colorpicker-hex-input',e).bind('change keydown keyup',function(a,b,c){if(/[^a-fA-F0-9]/.test($(this).val())){$(this).val($(this).val().replace(/[^a-fA-F0-9]/,''));}});$('.ui-colorpicker-hex-input',e).bind('change keyup',function(){// repeat here makes sure that the invalid input doesn't get parsed
inst.color=_parseHex($(this).val()).setAlpha(inst.color.getAlpha());inst._change();});$('.ui-colorpicker-hex-alpha',e).bind('change keydown keyup',function(){if(/[^a-fA-F0-9]/.test($(this).val())){$(this).val($(this).val().replace(/[^a-fA-F0-9]/,''));}});$('.ui-colorpicker-hex-alpha',e).bind('change keyup',function(){inst.color.setAlpha(parseInt($('.ui-colorpicker-hex-alpha',e).val(),16)/255);inst._change();});};this.update=function(){this.repaint();};this.repaint=function(){if(!$('.ui-colorpicker-hex-input',e).is(':focus')){$('.ui-colorpicker-hex-input',e).val(inst.color.toHex(true));}if(!$('.ui-colorpicker-hex-alpha',e).is(':focus')){$('.ui-colorpicker-hex-alpha',e).val(_intToHex(inst.color.getAlpha()*255));}};},swatches:function(inst){var that=this,part=null,html=function(){var html='';$.each(inst._getSwatches(),function(name,color){var c=new Color(color.r,color.g,color.b),css=c.toCSS();html+='<div class="ui-colorpicker-swatch" style="background-color:'+css+'" title="'+name+'"></div>';});return'<div class="ui-colorpicker-swatches ui-colorpicker-border" style="width:'+inst.options.swatchesWidth+'px">'+html+'</div>';};this.init=function(){part=$(html()).appendTo($('.ui-colorpicker-swatches-container',inst.dialog));$('.ui-colorpicker-swatch',part).click(function(){inst.color=inst._parseColor($(this).css('background-color'));inst._change();});};},footer:function(inst){var that=this,part=null,id_transparent='ui-colorpicker-special-transparent-'+_colorpicker_index,id_none='ui-colorpicker-special-none-'+_colorpicker_index,html=function(){var html='';if(inst.options.alpha||!inst.inline&&inst.options.showNoneButton){html+='<div class="ui-colorpicker-buttonset">';if(inst.options.alpha){html+='<input type="radio" name="ui-colorpicker-special" id="'+id_transparent+'" class="ui-colorpicker-special-transparent"/><label for="'+id_transparent+'">'+inst._getRegional('transparent')+'</label>';}if(!inst.inline&&inst.options.showNoneButton){html+='<input type="radio" name="ui-colorpicker-special" id="'+id_none+'" class="ui-colorpicker-special-none"><label for="'+id_none+'">'+inst._getRegional('none')+'</label>';}html+='</div>';}if(!inst.inline){html+='<div class="ui-dialog-buttonset">';if(inst.options.showCancelButton){html+='<button class="ui-colorpicker-cancel">'+inst._getRegional('cancel')+'</button>';}html+='<button class="ui-colorpicker-ok">'+inst._getRegional('ok')+'</button>';html+='</div>';}return'<div class="ui-dialog-buttonpane ui-widget-content">'+html+'</div>';};this.init=function(){part=$(html()).appendTo(inst.dialog);$('.ui-colorpicker-ok',part).button().click(function(){inst.close();});$('.ui-colorpicker-cancel',part).button().click(function(){inst.color=inst.currentColor.copy();inst._change(inst.color.set);inst.close();});//inst._getRegional('transparent')
$('.ui-colorpicker-buttonset',part).buttonset();$('.ui-colorpicker-special-color',part).click(function(){inst._change();});$('#'+id_none,part).click(function(){inst._change(false);});$('#'+id_transparent,part).click(function(){inst.color.setAlpha(0);inst._change();});};this.repaint=function(){if(!inst.color.set){$('.ui-colorpicker-special-none',part).attr('checked',true).button("refresh");}else if(inst.color.getAlpha()==0){$('.ui-colorpicker-special-transparent',part).attr('checked',true).button("refresh");}else{$('input',part).attr('checked',false).button("refresh");}$('.ui-colorpicker-cancel',part).button(inst.changed?'enable':'disable');};this.update=function(){};}},Color=function(){var spaces={rgb:{r:0,g:0,b:0},hsv:{h:0,s:0,v:0},hsl:{h:0,s:0,l:0},lab:{l:0,a:0,b:0},cmyk:{c:0,m:0,y:0,k:1}},a=1,args=arguments,_clip=function(v){if(isNaN(v)||v===null){return 0;}if(typeof v=='string'){v=parseInt(v,10);}return Math.max(0,Math.min(v,1));},_hexify=function(number){var digits='0123456789abcdef',lsd=number%16,msd=(number-lsd)/16,hexified=digits.charAt(msd)+digits.charAt(lsd);return hexified;},_rgb_to_xyz=function(rgb){var r=rgb.r>0.04045?Math.pow((rgb.r+0.055)/1.055,2.4):rgb.r/12.92,g=rgb.g>0.04045?Math.pow((rgb.g+0.055)/1.055,2.4):rgb.g/12.92,b=rgb.b>0.04045?Math.pow((rgb.b+0.055)/1.055,2.4):rgb.b/12.92;return{x:r*0.4124+g*0.3576+b*0.1805,y:r*0.2126+g*0.7152+b*0.0722,z:r*0.0193+g*0.1192+b*0.9505};},_xyz_to_rgb=function(xyz){var rgb={r:xyz.x*3.2406+xyz.y*-1.5372+xyz.z*-0.4986,g:xyz.x*-0.9689+xyz.y*1.8758+xyz.z*0.0415,b:xyz.x*0.0557+xyz.y*-0.2040+xyz.z*1.0570};rgb.r=rgb.r>0.0031308?1.055*Math.pow(rgb.r,1/2.4)-0.055:12.92*rgb.r;rgb.g=rgb.g>0.0031308?1.055*Math.pow(rgb.g,1/2.4)-0.055:12.92*rgb.g;rgb.b=rgb.b>0.0031308?1.055*Math.pow(rgb.b,1/2.4)-0.055:12.92*rgb.b;return rgb;},_rgb_to_hsv=function(rgb){var minVal=Math.min(rgb.r,rgb.g,rgb.b),maxVal=Math.max(rgb.r,rgb.g,rgb.b),delta=maxVal-minVal,del_R,del_G,del_B,hsv={h:0,s:0,v:maxVal};if(delta===0){hsv.h=0;hsv.s=0;}else{hsv.s=delta/maxVal;del_R=((maxVal-rgb.r)/6+delta/2)/delta;del_G=((maxVal-rgb.g)/6+delta/2)/delta;del_B=((maxVal-rgb.b)/6+delta/2)/delta;if(rgb.r===maxVal){hsv.h=del_B-del_G;}else if(rgb.g===maxVal){hsv.h=1/3+del_R-del_B;}else if(rgb.b===maxVal){hsv.h=2/3+del_G-del_R;}if(hsv.h<0){hsv.h+=1;}else if(hsv.h>1){hsv.h-=1;}}return hsv;},_hsv_to_rgb=function(hsv){var rgb={r:0,g:0,b:0},var_h,var_i,var_1,var_2,var_3;if(hsv.s===0){rgb.r=rgb.g=rgb.b=hsv.v;}else{var_h=hsv.h===1?0:hsv.h*6;var_i=Math.floor(var_h);var_1=hsv.v*(1-hsv.s);var_2=hsv.v*(1-hsv.s*(var_h-var_i));var_3=hsv.v*(1-hsv.s*(1-(var_h-var_i)));if(var_i===0){rgb.r=hsv.v;rgb.g=var_3;rgb.b=var_1;}else if(var_i===1){rgb.r=var_2;rgb.g=hsv.v;rgb.b=var_1;}else if(var_i===2){rgb.r=var_1;rgb.g=hsv.v;rgb.b=var_3;}else if(var_i===3){rgb.r=var_1;rgb.g=var_2;rgb.b=hsv.v;}else if(var_i===4){rgb.r=var_3;rgb.g=var_1;rgb.b=hsv.v;}else{rgb.r=hsv.v;rgb.g=var_1;rgb.b=var_2;}}return rgb;},_rgb_to_hsl=function(rgb){var minVal=Math.min(rgb.r,rgb.g,rgb.b),maxVal=Math.max(rgb.r,rgb.g,rgb.b),delta=maxVal-minVal,del_R,del_G,del_B,hsl={h:0,s:0,l:(maxVal+minVal)/2};if(delta===0){hsl.h=0;hsl.s=0;}else{hsl.s=hsl.l<0.5?delta/(maxVal+minVal):delta/(2-maxVal-minVal);del_R=((maxVal-rgb.r)/6+delta/2)/delta;del_G=((maxVal-rgb.g)/6+delta/2)/delta;del_B=((maxVal-rgb.b)/6+delta/2)/delta;if(rgb.r===maxVal){hsl.h=del_B-del_G;}else if(rgb.g===maxVal){hsl.h=1/3+del_R-del_B;}else if(rgb.b===maxVal){hsl.h=2/3+del_G-del_R;}if(hsl.h<0){hsl.h+=1;}else if(hsl.h>1){hsl.h-=1;}}return hsl;},_hsl_to_rgb=function(hsl){var var_1,var_2,hue_to_rgb=function(v1,v2,vH){if(vH<0){vH+=1;}if(vH>1){vH-=1;}if(6*vH<1){return v1+(v2-v1)*6*vH;}if(2*vH<1){return v2;}if(3*vH<2){return v1+(v2-v1)*(2/3-vH)*6;}return v1;};if(hsl.s===0){return{r:hsl.l,g:hsl.l,b:hsl.l};}var_2=hsl.l<0.5?hsl.l*(1+hsl.s):hsl.l+hsl.s-hsl.s*hsl.l;var_1=2*hsl.l-var_2;return{r:hue_to_rgb(var_1,var_2,hsl.h+1/3),g:hue_to_rgb(var_1,var_2,hsl.h),b:hue_to_rgb(var_1,var_2,hsl.h-1/3)};},_xyz_to_lab=function(xyz){// CIE-L*ab D65 1931
var x=xyz.x/0.95047,y=xyz.y,z=xyz.z/1.08883;x=x>0.008856?Math.pow(x,1/3):7.787*x+16/116;y=y>0.008856?Math.pow(y,1/3):7.787*y+16/116;z=z>0.008856?Math.pow(z,1/3):7.787*z+16/116;return{l:(116*y-16)/100,// [0,100]
a:(500*(x-y)+128)/255,// [-128,127]
b:(200*(y-z)+128)/255// [-128,127]
};},_lab_to_xyz=function(lab){var lab2={l:lab.l*100,a:lab.a*255-128,b:lab.b*255-128},xyz={x:0,y:(lab2.l+16)/116,z:0};xyz.x=lab2.a/500+xyz.y;xyz.z=xyz.y-lab2.b/200;xyz.x=Math.pow(xyz.x,3)>0.008856?Math.pow(xyz.x,3):(xyz.x-16/116)/7.787;xyz.y=Math.pow(xyz.y,3)>0.008856?Math.pow(xyz.y,3):(xyz.y-16/116)/7.787;xyz.z=Math.pow(xyz.z,3)>0.008856?Math.pow(xyz.z,3):(xyz.z-16/116)/7.787;xyz.x*=0.95047;xyz.y*=1;xyz.z*=1.08883;return xyz;},_rgb_to_cmy=function(rgb){return{c:1-rgb.r,m:1-rgb.g,y:1-rgb.b};},_cmy_to_rgb=function(cmy){return{r:1-cmy.c,g:1-cmy.m,b:1-cmy.y};},_cmy_to_cmyk=function(cmy){var K=1;if(cmy.c<K){K=cmy.c;}if(cmy.m<K){K=cmy.m;}if(cmy.y<K){K=cmy.y;}if(K==1){return{c:0,m:0,y:0,k:1};}return{c:(cmy.c-K)/(1-K),m:(cmy.m-K)/(1-K),y:(cmy.y-K)/(1-K),k:K};},_cmyk_to_cmy=function(cmyk){return{c:cmyk.c*(1-cmyk.k)+cmyk.k,m:cmyk.m*(1-cmyk.k)+cmyk.k,y:cmyk.y*(1-cmyk.k)+cmyk.k};};this.set=true;this.setAlpha=function(_a){if(_a!==null){a=_clip(_a);}return this;};this.getAlpha=function(){return a;};this.setRGB=function(r,g,b){spaces={rgb:this.getRGB()};if(r!==null){spaces.rgb.r=_clip(r);}if(g!==null){spaces.rgb.g=_clip(g);}if(b!==null){spaces.rgb.b=_clip(b);}return this;};this.setHSV=function(h,s,v){spaces={hsv:this.getHSV()};if(h!==null){spaces.hsv.h=_clip(h);}if(s!==null){spaces.hsv.s=_clip(s);}if(v!==null){spaces.hsv.v=_clip(v);}return this;};this.setHSL=function(h,s,l){spaces={hsl:this.getHSL()};if(h!==null){spaces.hsl.h=_clip(h);}if(s!==null){spaces.hsl.s=_clip(s);}if(l!==null){spaces.hsl.l=_clip(l);}return this;};this.setLAB=function(l,a,b){spaces={lab:this.getLAB()};if(l!==null){spaces.lab.l=_clip(l);}if(a!==null){spaces.lab.a=_clip(a);}if(b!==null){spaces.lab.b=_clip(b);}return this;};this.setCMYK=function(c,m,y,k){spaces={cmyk:this.getCMYK()};if(c!==null){spaces.cmyk.c=_clip(c);}if(m!==null){spaces.cmyk.m=_clip(m);}if(y!==null){spaces.cmyk.y=_clip(y);}if(k!==null){spaces.cmyk.k=_clip(k);}return this;};this.getRGB=function(){if(!spaces.rgb){spaces.rgb=spaces.lab?_xyz_to_rgb(_lab_to_xyz(spaces.lab)):spaces.hsv?_hsv_to_rgb(spaces.hsv):spaces.hsl?_hsl_to_rgb(spaces.hsl):spaces.cmyk?_cmy_to_rgb(_cmyk_to_cmy(spaces.cmyk)):{r:0,g:0,b:0};spaces.rgb.r=_clip(spaces.rgb.r);spaces.rgb.g=_clip(spaces.rgb.g);spaces.rgb.b=_clip(spaces.rgb.b);}return $.extend({},spaces.rgb);};this.getHSV=function(){if(!spaces.hsv){spaces.hsv=spaces.lab?_rgb_to_hsv(this.getRGB()):spaces.rgb?_rgb_to_hsv(spaces.rgb):spaces.hsl?_rgb_to_hsv(this.getRGB()):spaces.cmyk?_rgb_to_hsv(this.getRGB()):{h:0,s:0,v:0};spaces.hsv.h=_clip(spaces.hsv.h);spaces.hsv.s=_clip(spaces.hsv.s);spaces.hsv.v=_clip(spaces.hsv.v);}return $.extend({},spaces.hsv);};this.getHSL=function(){if(!spaces.hsl){spaces.hsl=spaces.rgb?_rgb_to_hsl(spaces.rgb):spaces.hsv?_rgb_to_hsl(this.getRGB()):spaces.cmyk?_rgb_to_hsl(this.getRGB()):spaces.hsv?_rgb_to_hsl(this.getRGB()):{h:0,s:0,l:0};spaces.hsl.h=_clip(spaces.hsl.h);spaces.hsl.s=_clip(spaces.hsl.s);spaces.hsl.l=_clip(spaces.hsl.l);}return $.extend({},spaces.hsl);};this.getCMYK=function(){if(!spaces.cmyk){spaces.cmyk=spaces.rgb?_cmy_to_cmyk(_rgb_to_cmy(spaces.rgb)):spaces.hsv?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):spaces.hsl?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):spaces.lab?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):{c:0,m:0,y:0,k:1};spaces.cmyk.c=_clip(spaces.cmyk.c);spaces.cmyk.m=_clip(spaces.cmyk.m);spaces.cmyk.y=_clip(spaces.cmyk.y);spaces.cmyk.k=_clip(spaces.cmyk.k);}return $.extend({},spaces.cmyk);};this.getLAB=function(){if(!spaces.lab){spaces.lab=spaces.rgb?_xyz_to_lab(_rgb_to_xyz(spaces.rgb)):spaces.hsv?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):spaces.hsl?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):spaces.cmyk?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):{l:0,a:0,b:0};spaces.lab.l=_clip(spaces.lab.l);spaces.lab.a=_clip(spaces.lab.a);spaces.lab.b=_clip(spaces.lab.b);}return $.extend({},spaces.lab);};this.getChannels=function(){return{r:this.getRGB().r,g:this.getRGB().g,b:this.getRGB().b,a:this.getAlpha(),h:this.getHSV().h,s:this.getHSV().s,v:this.getHSV().v,c:this.getCMYK().c,m:this.getCMYK().m,y:this.getCMYK().y,k:this.getCMYK().k,L:this.getLAB().l,A:this.getLAB().a,B:this.getLAB().b};};this.getSpaces=function(){return $.extend(true,{},spaces);};this.setSpaces=function(new_spaces){spaces=new_spaces;return this;};this.distance=function(color){var space='lab',getter='get'+space.toUpperCase(),a=this[getter](),b=color[getter](),distance=0,channel;for(channel in a){distance+=Math.pow(a[channel]-b[channel],2);}return distance;};this.equals=function(color){var a=this.getRGB(),b=color.getRGB();return this.getAlpha()==color.getAlpha()&&a.r==b.r&&a.g==b.g&&a.b==b.b;};this.limit=function(steps){steps-=1;var rgb=this.getRGB();this.setRGB(Math.round(rgb.r*steps)/steps,Math.round(rgb.g*steps)/steps,Math.round(rgb.b*steps)/steps);};this.toHex=function(){var rgb=this.getRGB();return _hexify(rgb.r*255)+_hexify(rgb.g*255)+_hexify(rgb.b*255);};this.toCSS=function(){return'#'+this.toHex();};this.normalize=function(){this.setHSV(null,1,1);return this;};this.copy=function(){var spaces=this.getSpaces(),a=this.getAlpha();return new Color(spaces,a);};// Construct
if(args.length==2){this.setSpaces(args[0]);this.setAlpha(args[1]===0?0:args[1]||1);}if(args.length>2){this.setRGB(args[0],args[1],args[2]);this.setAlpha(args[3]===0?0:args[3]||1);}};$.widget("vanderlee.colorpicker",{options:{alpha:false,// Show alpha controls and mode
altAlpha:true,// change opacity of altField as well?
altField:'',// selector for DOM elements which change background color on change.
altOnChange:true,// true to update on each change, false to update only on close.
altProperties:'background-color',// comma separated list of any of 'background-color', 'color', 'border-color', 'outline-color'
autoOpen:false,// Open dialog automatically upon creation
buttonColorize:false,buttonImage:'images/ui-colorpicker.png',buttonImageOnly:false,buttonText:null,// Text on the button and/or title of button image.
closeOnEscape:true,// Close the dialog when the escape key is pressed.
closeOnOutside:true,// Close the dialog when clicking outside the dialog (not for inline)
color:'#00FF00',// Initial color (for inline only)
colorFormat:'HEX',// Format string for output color format
draggable:true,// Make popup dialog draggable if header is visible.
duration:'fast',hsv:true,// Show HSV controls and modes
inline:true,// Show any divs as inline by default
layout:{map:[0,0,1,5],// Left, Top, Width, Height (in table cells).
bar:[1,0,1,5],preview:[2,0,1,1],hsv:[2,1,1,1],rgb:[2,2,1,1],alpha:[2,3,1,1],hex:[2,4,1,1],lab:[3,1,1,1],cmyk:[3,2,1,2],swatches:[4,0,1,5]},limit:'',// Limit color "resolution": '', 'websafe', 'nibble', 'binary', 'name'
modal:false,// Modal dialog?
mode:'h',// Initial editing mode, h, s, v, r, g, b or a
parts:'',// leave empty for automatic selection
regional:'',rgb:true,// Show RGB controls and modes
showAnim:'fadeIn',showCancelButton:true,showNoneButton:false,showCloseButton:true,showOn:'focus',// 'focus', 'button', 'both'
showOptions:{},swatches:null,// null for default or kv-object or names swatches set
swatchesWidth:84,// width (in number of pixels) of swatches box.
title:null,close:null,init:null,select:null,open:null},_create:function(){var that=this,text;++_colorpicker_index;that.widgetEventPrefix='color';that.opened=false;that.generated=false;that.inline=false;that.changed=false;that.dialog=null;that.button=null;that.image=null;that.overlay=null;that.mode=that.options.mode;if(this.element[0].nodeName.toLowerCase()==='input'||!that.options.inline){that._setColor(that.element.val());this._callback('init');$('body').append(_container_popup);that.dialog=$('.ui-colorpicker:last');// Click outside/inside
$(document).delegate('html','touchstart click',function(event){if(!that.opened||event.target===that.element[0]||that.overlay){return;}// Check if clicked on any part of dialog
if(that.dialog.is(event.target)||that.dialog.has(event.target).length>0){that.element.blur();// inside window!
return;}// Check if clicked on button
var p,parents=$(event.target).parents();for(p=0;p<=parents.length;++p){if(that.button!==null&&parents[p]===that.button[0]){return;}}// no closeOnOutside
if(!that.options.closeOnOutside){return;}that.close();});$(document).keydown(function(event){if(event.keyCode==27&&that.opened&&that.options.closeOnEscape){that.close();}});if(that.options.showOn==='focus'||that.options.showOn==='both'){that.element.on('focus click',function(){that.open();});}if(that.options.showOn==='button'||that.options.showOn==='both'){if(that.options.buttonImage!==''){text=that.options.buttonText||that._getRegional('button');that.image=$('<img/>').attr({'src':that.options.buttonImage,'alt':text,'title':text});that._setImageBackground();}if(that.options.buttonImageOnly&&that.image){that.button=that.image;}else{that.button=$('<button type="button"></button>').html(that.image||that.options.buttonText).button();that.image=that.image?$('img',that.button).first():null;}that.button.insertAfter(that.element).click(function(){that[that.opened?'close':'open']();});}if(that.options.autoOpen){that.open();}that.element.keydown(function(event){if(event.keyCode===9){that.close();}}).keyup(function(event){var color=that._parseColor(that.element.val());if(!that.color.equals(color)){that.color=color;that._change();}});}else{that.inline=true;$(this.element).html(_container_inline);that.dialog=$('.ui-colorpicker',this.element);that._generate();that.opened=true;}return this;},_setOption:function(key,value){var that=this;switch(key){case"disabled":if(value){that.dialog.addClass('ui-colorpicker-disabled');}else{that.dialog.removeClass('ui-colorpicker-disabled');}break;}$.Widget.prototype._setOption.apply(that,arguments);},/* setBackground */_setImageBackground:function(){if(this.image&&this.options.buttonColorize){this.image.css('background-color',this.color.set?this._formatColor('RGBA',this.color):'');}},/**
         * If an alternate field is specified, set it according to the current color.
         */_setAltField:function(){if(this.options.altOnChange&&this.options.altField&&this.options.altProperties){var index,property,properties=this.options.altProperties.split(',');for(index=0;index<=properties.length;++index){property=$.trim(properties[index]);switch(property){case'color':case'background-color':case'outline-color':case'border-color':$(this.options.altField).css(property,this.color.set?this.color.toCSS():'');break;}}if(this.options.altAlpha){$(this.options.altField).css('opacity',this.color.set?this.color.getAlpha():'');}}},_setColor:function(text){this.color=this._parseColor(text);this.currentColor=this.color.copy();this._setImageBackground();this._setAltField();},setColor:function(text){this._setColor(text);this._change(this.color.set);},_generate:function(){var that=this,index,part,parts_list,layout_parts;// Set color based on element?
that._setColor(that.inline?that.options.color:that.element.val());// Determine the parts to include in this colorpicker
if(typeof that.options.parts==='string'){if(_parts_lists[that.options.parts]){parts_list=_parts_lists[that.options.parts];}else{// automatic
parts_list=_parts_lists[that.inline?'inline':'popup'];}}else{parts_list=that.options.parts;}// Add any parts to the internal parts list
that.parts={};$.each(parts_list,function(index,part){if(_parts[part]){that.parts[part]=new _parts[part](that);}});if(!that.generated){layout_parts=[];$.each(that.options.layout,function(part,pos){if(that.parts[part]){layout_parts.push({'part':part,'pos':pos});}});$(_layoutTable(layout_parts,function(cell,x,y){var classes=['ui-colorpicker-'+cell.part+'-container'];if(x>0){classes.push('ui-colorpicker-padding-left');}if(y>0){classes.push('ui-colorpicker-padding-top');}return'<td  class="'+classes.join(' ')+'"'+(cell.pos[2]>1?' colspan="'+cell.pos[2]+'"':'')+(cell.pos[3]>1?' rowspan="'+cell.pos[3]+'"':'')+' valign="top"></td>';})).appendTo(that.dialog).addClass('ui-dialog-content ui-widget-content');that._initAllParts();that._updateAllParts();that.generated=true;}},_effectGeneric:function(element,show,slide,fade,callback){var that=this;if($.effects&&$.effects[that.options.showAnim]){element[show](that.options.showAnim,that.options.showOptions,that.options.duration,callback);}else{element[that.options.showAnim==='slideDown'?slide:that.options.showAnim==='fadeIn'?fade:show](that.options.showAnim?that.options.duration:null,callback);if(!that.options.showAnim||!that.options.duration){callback();}}},_effectShow:function(element,callback){this._effectGeneric(element,'show','slideDown','fadeIn',callback);},_effectHide:function(element,callback){this._effectGeneric(element,'hide','slideUp','fadeOut',callback);},open:function(){var that=this,offset,bottom,right,height,width,x,y,zIndex;if(!that.opened){that._generate();offset=that.element.offset();bottom=$(window).height()+$(window).scrollTop();right=$(window).width()+$(window).scrollLeft();height=that.dialog.outerHeight();width=that.dialog.outerWidth();x=offset.left;y=offset.top+that.element.outerHeight();if(x+width>right){x=Math.max(0,right-width);}if(y+height>bottom){if(offset.top-height>=$(window).scrollTop()){y=offset.top-height;}else{y=Math.max(0,bottom-height);}}that.dialog.css({'left':x,'top':y});// Automatically find highest z-index.
zIndex=0;$(that.element[0]).parents().each(function(){var z=$(this).css('z-index');if((typeof z==='number'||typeof z==='string')&&z!==''&&!isNaN(z)){zIndex=parseInt(z);return false;}});//@todo zIndexOffset option, to raise above other elements?
that.dialog.css('z-index',zIndex+=2);that.overlay=that.options.modal?new $.ui.dialog.overlay(that):null;that._effectShow(this.dialog);that.opened=true;that._callback('open',true);// Without waiting for domready the width of the map is 0 and we
// wind up with the cursor stuck in the upper left corner
$(function(){that._repaintAllParts();});}},close:function(){var that=this;that.currentColor=that.color.copy();that.changed=false;// tear down the interface
that._effectHide(that.dialog,function(){that.dialog.empty();that.generated=false;that.opened=false;that._callback('close',true);});if(that.overlay){that.overlay.destroy();}},destroy:function(){this.element.unbind();if(this.image!==null){this.image.remove();}if(this.button!==null){this.button.remove();}if(this.dialog!==null){this.dialog.remove();}if(this.overlay){this.overlay.destroy();}},_callback:function(callback,spaces){var that=this,data,lab;if(that.color.set){data={formatted:that._formatColor(that.options.colorFormat,that.color)};lab=that.color.getLAB();lab.a=lab.a*2-1;lab.b=lab.b*2-1;if(spaces===true){data.a=that.color.getAlpha();data.rgb=that.color.getRGB();data.hsv=that.color.getHSV();data.cmyk=that.color.getCMYK();data.hsl=that.color.getHSL();data.lab=lab;}return that._trigger(callback,null,data);}else{return that._trigger(callback,null,{formatted:''});}},_initAllParts:function(){$.each(this.parts,function(index,part){if(part.init){part.init();}});},_updateAllParts:function(){$.each(this.parts,function(index,part){if(part.update){part.update();}});},_repaintAllParts:function(){$.each(this.parts,function(index,part){if(part.repaint){part.repaint();}});},_change:function(set/* = true */){this.color.set=set!==false;this.changed=true;// Limit color palette
switch(this.options.limit){case'websafe':this.color.limit(6);break;case'nibble':this.color.limit(16);break;case'binary':this.color.limit(2);break;case'name':var swatch=this._getSwatch(this._closestName(this.color));this.color.setRGB(swatch.r,swatch.g,swatch.b);break;}// update input element content
if(!this.inline){if(!this.color.set){this.element.val('');}else if(!this.color.equals(this._parseColor(this.element.val()))){this.element.val(this._formatColor(this.options.colorFormat,this.color));}this._setImageBackground();this._setAltField();}if(this.opened){this._repaintAllParts();}// callback
this._callback('select');},// This will be deprecated by jQueryUI 1.9 widget
_hoverable:function(e){e.hover(function(){e.addClass("ui-state-hover");},function(){e.removeClass("ui-state-hover");});},// This will be deprecated by jQueryUI 1.9 widget
_focusable:function(e){e.focus(function(){e.addClass("ui-state-focus");}).blur(function(){e.removeClass("ui-state-focus");});},_getRegional:function(name){return $.colorpicker.regional[this.options.regional][name]!==undefined?$.colorpicker.regional[this.options.regional][name]:$.colorpicker.regional[''][name];},_getSwatches:function(){if(typeof this.options.swatches==='string'){return $.colorpicker.swatches[this.options.swatches];}if($.isPlainObject(this.options.swatches)){return $.colorpicker.swatches;}return $.colorpicker.swatches.html;},_getSwatch:function(name){var swatches=this._getSwatches(),swatch=false;if(swatches[name]!==undefined){return swatches[name];}$.each(swatches,function(swatchName,current){if(swatchName.toLowerCase()==name.toLowerCase()){swatch=current;return false;}return true;});return swatch;},_parseColor:function(color){var c,m;// no color
if(color==''){return new Color();}// named swatch
c=this._getSwatch($.trim(color));if(c){return new Color(c.r,c.g,c.b);}// rgba(r,g,b,a)
m=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);if(m){return new Color(m[1]/255,m[2]/255,m[3]/255,parseFloat(m[4]));}// hsla(r,g,b,a)
m=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);if(m){return new Color().setHSL(m[1]/255,m[2]/255,m[3]/255).setAlpha(parseFloat(m[4]));}// rgba(r%,g%,b%,a%)
m=/^rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);if(m){return new Color(m[1]/100,m[2]/100,m[3]/100,m[4]/100);}// hsla(r%,g%,b%,a%)
m=/^hsla?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);if(m){return new Color().setHSL(m[1]/100,m[2]/100,m[3]/100).setAlpha(m[4]/100);}// #rrggbb
m=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(color);if(m){return new Color(parseInt(m[1],16)/255,parseInt(m[2],16)/255,parseInt(m[3],16)/255);}// #rgb
m=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(color);if(m){return new Color(parseInt(m[1]+m[1],16)/255,parseInt(m[2]+m[2],16)/255,parseInt(m[3]+m[3],16)/255);}return _parseHex(color);},_exactName:function(color){var name=false;$.each(this._getSwatches(),function(n,swatch){if(color.equals(new Color(swatch.r,swatch.g,swatch.b))){name=n;return false;}return true;});return name;},_closestName:function(color){var rgb=color.getRGB(),distance=null,name=false,d;$.each(this._getSwatches(),function(n,swatch){d=color.distance(new Color(swatch.r,swatch.g,swatch.b));if(d<distance||distance===null){name=n;if(d==0){return false;// can't get much closer than 0
}distance=d;}return true;});return name;},_formatColor:function(formats,color){var that=this,text=null,types={'x':function(v){return _intToHex(v*255);},'d':function(v){return Math.round(v*255);},'f':function(v){return v;},'p':function(v){return v*100;}},channels=color.getChannels();if(!$.isArray(formats)){formats=[formats];}$.each(formats,function(index,format){if(that._formats[format]){text=that._formats[format](color,that);return text===false;}else{text=format.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(m){if(m.match(/^\\/)){return m.slice(1);}return types[m.charAt(1)](channels[m.charAt(0)]);});return false;}});return text;},_formats:{'#HEX':function(color,that){return that._formatColor('#rxgxbx',color);},'#HEX3':function(color,that){var hex3=that._formats.HEX3(color);return hex3===false?false:'#'+hex3;},'HEX':function(color,that){return that._formatColor('rxgxbx',color);},'HEX3':function(color,that){var rgb=color.getRGB(),r=Math.round(rgb.r*255),g=Math.round(rgb.g*255),b=Math.round(rgb.b*255);if(r>>>4==(r&=0xf)&&g>>>4==(g&=0xf)&&b>>>4==(b&=0xf)){return r.toString(16)+g.toString(16)+b.toString(16);}return false;},'RGB':function(color,that){return color.getAlpha()>=1?that._formatColor('rgb(rd,gd,bd)',color):false;},'RGBA':function(color,that){return that._formatColor('rgba(rd,gd,bd,af)',color);},'RGB%':function(color,that){return color.getAlpha()>=1?that._formatColor('rgb(rp%,gp%,bp%)',color):false;},'RGBA%':function(color,that){return that._formatColor('rgba(rp%,gp%,bp%,af)',color);},'HSL':function(color,that){return color.getAlpha()>=1?that._formatColor('hsl(hd,sd,vd)',color):false;},'HSLA':function(color,that){return that._formatColor('hsla(hd,sd,vd,af)',color);},'HSL%':function(color,that){return color.getAlpha()>=1?that._formatColor('hsl(hp%,sp%,vp%)',color):false;},'HSLA%':function(color,that){return that._formatColor('hsla(hp%,sp%,vp%,af)',color);},'NAME':function(color,that){return that._closestName(color);},'EXACT':function(color,that){//@todo experimental. Implement a good fallback list
return that._exactName(color);}}});})(jQuery);/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */(function(factory){if(typeof define==='function'&&define.amd){// AMD. Register as anonymous module.
define(['jquery'],factory);}else{// Browser globals.
factory(jQuery);}})(function($){var pluses=/\+/g;function raw(s){return s;}function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}function converted(s){if(s.indexOf('"')===0){// This is a quoted cookie as according to RFC2068, unescape
s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}try{return config.json?JSON.parse(s):s;}catch(er){}}var config=$.cookie=function(key,value,options){// write
if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}value=config.json?JSON.stringify(value):String(value);return document.cookie=[config.raw?key:encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',// use expires attribute, max-age is not supported by IE
options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join('');}// read
var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=decode(parts.join('='));if(key&&key===name){result=converted(cookie);break;}if(!key){result[name]=converted(cookie);}}return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){// Must not alter options, thus extending a fresh object...
$.cookie(key,'',$.extend({},options,{expires:-1}));return true;}return false;};});/**
 * jquery.dump.js
 * @author Torkild Dyvik Olsen
 * @version 1.0
 * 
 * A simple debug function to gather information about an object.
 * Returns a nested tree with information.
 * 
 */(function($){$.fn.dump=function(){return $.dump(this);};$.dump=function(object){var recursion=function(obj,level){if(!level)level=0;var dump='',p='';for(i=0;i<level;i++)p+="\t";t=type(obj);switch(t){case"string":return'"'+obj+'"';break;case"number":return obj.toString();break;case"boolean":return obj?'true':'false';case"date":return"Date: "+obj.toLocaleString();case"array":dump+='Array ( \n';$.each(obj,function(k,v){dump+=p+'\t'+k+' => '+recursion(v,level+1)+'\n';});dump+=p+')';break;case"object":dump+='Object { \n';$.each(obj,function(k,v){dump+=p+'\t'+k+': '+recursion(v,level+1)+'\n';});dump+=p+'}';break;case"jquery":dump+='jQuery Object { \n';$.each(obj,function(k,v){dump+=p+'\t'+k+' = '+recursion(v,level+1)+'\n';});dump+=p+'}';break;case"regexp":return"RegExp: "+obj.toString();case"error":return obj.toString();case"document":case"domelement":dump+='DOMElement [ \n'+p+'\tnodeName: '+obj.nodeName+'\n'+p+'\tnodeValue: '+obj.nodeValue+'\n'+p+'\tinnerHTML: [ \n';$.each(obj.childNodes,function(k,v){if(k<1)var r=0;if(type(v)=="string"){if(v.textContent.match(/[^\s]/)){dump+=p+'\t\t'+(k-(r||0))+' = String: '+trim(v.textContent)+'\n';}else{r--;}}else{dump+=p+'\t\t'+(k-(r||0))+' = '+recursion(v,level+2)+'\n';}});dump+=p+'\t]\n'+p+']';break;case"function":var match=obj.toString().match(/^(.*)\(([^\)]*)\)/im);match[1]=trim(match[1].replace(new RegExp("[\\s]+","g")," "));match[2]=trim(match[2].replace(new RegExp("[\\s]+","g")," "));return match[1]+"("+match[2]+")";case"window":default:dump+='N/A: '+t;break;}return dump;};var type=function(obj){var type=typeof obj;if(type!="object"){return type;}switch(obj){case null:return'null';case window:return'window';case document:return'document';case window.event:return'event';default:break;}if(obj.jquery){return'jquery';}switch(obj.constructor){case Array:return'array';case Boolean:return'boolean';case Date:return'date';case Object:return'object';case RegExp:return'regexp';case ReferenceError:case Error:return'error';case null:default:break;}switch(obj.nodeType){case 1:return'domelement';case 3:return'string';case null:default:break;}return'Unknown';};return recursion(object);};function trim(str){return ltrim(rtrim(str));}function ltrim(str){return str.replace(new RegExp("^[\\s]+","g"),"");}function rtrim(str){return str.replace(new RegExp("[\\s]+$","g"),"");}})(jQuery);/*
 * jQuery plugin: fieldSelection - v0.1.1 - last change: 2006-12-16
 * (c) 2006 Alex Brem <alex@0xab.cd> - http://blog.0xab.cd
 */(function(){var fieldSelection={getSelection:function(){var e=this.jquery?this[0]:this;return(/* mozilla / dom 3.0 */'selectionStart'in e&&function(){var l=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:l,text:e.value.substr(e.selectionStart,l)};}||/* exploder */document.selection&&function(){e.focus();var r=document.selection.createRange();if(r===null){return{start:0,end:e.value.length,length:0};}var re=e.createTextRange();var rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint('EndToStart',re);return{start:rc.text.length,end:rc.text.length+r.text.length,length:r.text.length,text:r.text};}||/* browser not supported */function(){return null;})();},setSelection:function(){var e=this.jquery?this[0]:this;var args=arguments[0]||{};return(/* mozilla / dom 3.0 */'selectionStart'in e&&function(){var start=typeof args=='object'?args.start:args;if(start!=undefined){e.selectionStart=start;}if(args.end!=undefined){e.selectionEnd=args.end;}e.focus();return this;}||/* exploder */document.selection&&function(){e.focus();var r=document.selection.createRange();if(r===null){return this;}var start=typeof args=='object'?args.start:args;if(start!=undefined){r.moveStart('character',-e.value.length);r.moveStart('character',start);r.collapse();}if(args.end!=undefined){r.moveEnd('character',args.end-start);}r.select();return this;}||/* browser not supported */function(){e.focus();return jQuery(e);})();},replaceSelection:function(){var e=this.jquery?this[0]:this;var text=arguments[0]||'';return(/* mozilla / dom 3.0 */'selectionStart'in e&&function(){e.value=e.value.substr(0,e.selectionStart)+text+e.value.substr(e.selectionEnd,e.value.length);return this;}||/* exploder */document.selection&&function(){e.focus();document.selection.createRange().text=text;return this;}||/* browser not supported */function(){e.value+=text;return jQuery(e);})();}};jQuery.each(fieldSelection,function(i){jQuery.fn[i]=this;});})();/**
* hoverIntent is similar to jQuery's built-in "hover" function except that
* instead of firing the onMouseOver event immediately, hoverIntent checks
* to see if the user's mouse has slowed down (beneath the sensitivity
* threshold) before firing the onMouseOver event.
* 
* hoverIntent r6 // 2011.02.26 // jQuery 1.5.1+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* hoverIntent is currently available for use in all personal or commercial 
* projects under both MIT and GPL licenses. This means that you can choose 
* the license that best suits your project, and use it accordingly.
* 
* // basic usage (just like .hover) receives onMouseOver and onMouseOut functions
* $("ul li").hoverIntent( showNav , hideNav );
* 
* // advanced usage receives configuration object only
* $("ul li").hoverIntent({
*	sensitivity: 7, // number = sensitivity threshold (must be 1 or higher)
*	interval: 100,   // number = milliseconds of polling interval
*	over: showNav,  // function = onMouseOver callback (required)
*	timeout: 0,   // number = milliseconds delay before onMouseOut function call
*	out: hideNav    // function = onMouseOut callback (required)
* });
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne brian(at)cherne(dot)net
*/(function($){$.fn.hoverIntent=function(f,g){// default configuration options
var cfg={sensitivity:7,interval:100,timeout:0};// override configuration options with user supplied object
cfg=$.extend(cfg,g?{over:f,out:g}:f);// instantiate variables
// cX, cY = current X and Y position of mouse, updated by mousemove event
// pX, pY = previous X and Y position of mouse, set by mouseover and polling interval
var cX,cY,pX,pY;// A private function for getting mouse position
var track=function(ev){cX=ev.pageX;cY=ev.pageY;};// A private function for comparing current and previous mouse position
var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);// compare mouse positions to see if they've crossed the threshold
if(Math.abs(pX-cX)+Math.abs(pY-cY)<cfg.sensitivity){$(ob).unbind("mousemove",track);// set hoverIntent state to true (so mouseOut can be called)
ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{// set previous coordinates for next time
pX=cX;pY=cY;// use self-calling timeout, guarantees intervals are spaced out properly (avoids JavaScript timer bugs)
ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};// A private function for delaying the mouseOut function
var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};// A private function for handling mouse 'hovering'
var handleHover=function(e){// copy objects to be passed into t (required for event object to be passed in IE)
var ev=jQuery.extend({},e);var ob=this;// cancel hoverIntent timer if it exists
if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}// if e.type == "mouseenter"
if(e.type=="mouseenter"){// set "previous" X and Y position based on initial entry point
pX=ev.pageX;pY=ev.pageY;// update "current" X and Y position based on mousemove
$(ob).bind("mousemove",track);// start polling interval (self-calling timeout) to compare mouse coordinates over time
if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}// else e.type == "mouseleave"
}else{// unbind expensive mousemove event
$(ob).unbind("mousemove",track);// if hoverIntent state is true, then call the mouseOut function after the specified delay
if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};// bind the function to the two event listeners
return this.bind('mouseenter',handleHover).bind('mouseleave',handleHover);};})(jQuery);/*
 * jQuery JSONP Core Plugin 2.4.0 (2012-08-21)
 *
 * https://github.com/jaubourg/jquery-jsonp
 *
 * Copyright (c) 2012 Julian Aubourg
 *
 * This document is licensed as free software under the terms of the
 * MIT License: http://www.opensource.org/licenses/mit-license.php
 */(function($){// ###################### UTILITIES ##
// Noop
function noop(){}// Generic callback
function genericCallback(data){lastValue=[data];}// Call if defined
function callIfDefined(method,object,parameters){return method&&method.apply(object.context||object,parameters);}// Give joining character given url
function qMarkOrAmp(url){return /\?/.test(url)?"&":"?";}var// String constants (for better minification)
STR_ASYNC="async",STR_CHARSET="charset",STR_EMPTY="",STR_ERROR="error",STR_INSERT_BEFORE="insertBefore",STR_JQUERY_JSONP="_jqjsp",STR_ON="on",STR_ON_CLICK=STR_ON+"click",STR_ON_ERROR=STR_ON+STR_ERROR,STR_ON_LOAD=STR_ON+"load",STR_ON_READY_STATE_CHANGE=STR_ON+"readystatechange",STR_READY_STATE="readyState",STR_REMOVE_CHILD="removeChild",STR_SCRIPT_TAG="<script>",STR_SUCCESS="success",STR_TIMEOUT="timeout",// Window
win=window,// Deferred
Deferred=$.Deferred,// Head element
head=$("head")[0]||document.documentElement,// Page cache
pageCache={},// Counter
count=0,// Last returned value
lastValue,// ###################### DEFAULT OPTIONS ##
xOptionsDefaults={//beforeSend: undefined,
//cache: false,
callback:STR_JQUERY_JSONP,//callbackParameter: undefined,
//charset: undefined,
//complete: undefined,
//context: undefined,
//data: "",
//dataFilter: undefined,
//error: undefined,
//pageCache: false,
//success: undefined,
//timeout: 0,
//traditional: false,
url:location.href},// opera demands sniffing :/
opera=win.opera,// IE < 10
oldIE=!!$("<div>").html("<!--[if IE]><i><![endif]-->").find("i").length;// ###################### MAIN FUNCTION ##
function jsonp(xOptions){// Build data with default
xOptions=$.extend({},xOptionsDefaults,xOptions);// References to xOptions members (for better minification)
var successCallback=xOptions.success,errorCallback=xOptions.error,completeCallback=xOptions.complete,dataFilter=xOptions.dataFilter,callbackParameter=xOptions.callbackParameter,successCallbackName=xOptions.callback,cacheFlag=xOptions.cache,pageCacheFlag=xOptions.pageCache,charset=xOptions.charset,url=xOptions.url,data=xOptions.data,timeout=xOptions.timeout,pageCached,// Abort/done flag
done=0,// Life-cycle functions
cleanUp=noop,// Support vars
supportOnload,supportOnreadystatechange,// Request execution vars
firstChild,script,scriptAfter,timeoutTimer;// If we have Deferreds:
// - substitute callbacks
// - promote xOptions to a promise
Deferred&&Deferred(function(defer){defer.done(successCallback).fail(errorCallback);successCallback=defer.resolve;errorCallback=defer.reject;}).promise(xOptions);// Create the abort method
xOptions.abort=function(){!done++&&cleanUp();};// Call beforeSend if provided (early abort if false returned)
if(callIfDefined(xOptions.beforeSend,xOptions,[xOptions])===!1||done){return xOptions;}// Control entries
url=url||STR_EMPTY;data=data?typeof data=="string"?data:$.param(data,xOptions.traditional):STR_EMPTY;// Build final url
url+=data?qMarkOrAmp(url)+data:STR_EMPTY;// Add callback parameter if provided as option
callbackParameter&&(url+=qMarkOrAmp(url)+encodeURIComponent(callbackParameter)+"=?");// Add anticache parameter if needed
!cacheFlag&&!pageCacheFlag&&(url+=qMarkOrAmp(url)+"_"+new Date().getTime()+"=");// Replace last ? by callback parameter
url=url.replace(/=\?(&|$)/,"="+successCallbackName+"$1");// Success notifier
function notifySuccess(json){if(!done++){cleanUp();// Pagecache if needed
pageCacheFlag&&(pageCache[url]={s:[json]});// Apply the data filter if provided
dataFilter&&(json=dataFilter.apply(xOptions,[json]));// Call success then complete
callIfDefined(successCallback,xOptions,[json,STR_SUCCESS,xOptions]);callIfDefined(completeCallback,xOptions,[xOptions,STR_SUCCESS]);}}// Error notifier
function notifyError(type){if(!done++){// Clean up
cleanUp();// If pure error (not timeout), cache if needed
pageCacheFlag&&type!=STR_TIMEOUT&&(pageCache[url]=type);// Call error then complete
callIfDefined(errorCallback,xOptions,[xOptions,type]);callIfDefined(completeCallback,xOptions,[xOptions,type]);}}// Check page cache
if(pageCacheFlag&&(pageCached=pageCache[url])){pageCached.s?notifySuccess(pageCached.s[0]):notifyError(pageCached);}else{// Install the generic callback
// (BEWARE: global namespace pollution ahoy)
win[successCallbackName]=genericCallback;// Create the script tag
script=$(STR_SCRIPT_TAG)[0];script.id=STR_JQUERY_JSONP+count++;// Set charset if provided
if(charset){script[STR_CHARSET]=charset;}opera&&opera.version()<11.60?// onerror is not supported: do not set as async and assume in-order execution.
// Add a trailing script to emulate the event
(scriptAfter=$(STR_SCRIPT_TAG)[0]).text="document.getElementById('"+script.id+"')."+STR_ON_ERROR+"()":// onerror is supported: set the script as async to avoid requests blocking each others
script[STR_ASYNC]=STR_ASYNC;// Internet Explorer: event/htmlFor trick
if(oldIE){script.htmlFor=script.id;script.event=STR_ON_CLICK;}// Attached event handlers
script[STR_ON_LOAD]=script[STR_ON_ERROR]=script[STR_ON_READY_STATE_CHANGE]=function(result){// Test readyState if it exists
if(!script[STR_READY_STATE]||!/i/.test(script[STR_READY_STATE])){try{script[STR_ON_CLICK]&&script[STR_ON_CLICK]();}catch(_){}result=lastValue;lastValue=0;result?notifySuccess(result[0]):notifyError(STR_ERROR);}};// Set source
script.src=url;// Re-declare cleanUp function
cleanUp=function(i){timeoutTimer&&clearTimeout(timeoutTimer);script[STR_ON_READY_STATE_CHANGE]=script[STR_ON_LOAD]=script[STR_ON_ERROR]=null;head[STR_REMOVE_CHILD](script);scriptAfter&&head[STR_REMOVE_CHILD](scriptAfter);};// Append main script
head[STR_INSERT_BEFORE](script,firstChild=head.firstChild);// Append trailing script if needed
scriptAfter&&head[STR_INSERT_BEFORE](scriptAfter,firstChild);// If a timeout is needed, install it
timeoutTimer=timeout>0&&setTimeout(function(){notifyError(STR_TIMEOUT);},timeout);}return xOptions;}// ###################### SETUP FUNCTION ##
jsonp.setup=function(xOptions){$.extend(xOptionsDefaults,xOptions);};// ###################### INSTALL in jQuery ##
$.jsonp=jsonp;})(jQuery);// ----------------------------------------------------------------------------
// markItUp! Universal MarkUp Engine, JQuery plugin
// v 1.1.x
// Dual licensed under the MIT and GPL licenses.
// ----------------------------------------------------------------------------
// Copyright (C) 2007-2012 Jay Salvat
// http://markitup.jaysalvat.com/
// ----------------------------------------------------------------------------
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
// ----------------------------------------------------------------------------
(function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=='string'){method=settings;params=extraSettings;}options={id:'',nameSpace:'',root:'',previewHandler:false,previewInWindow:'',// 'width=800, height=600, resizable=yes, scrollbars=yes'
previewInElement:'',previewAutoRefresh:true,previewPosition:'after',previewTemplatePath:'~/templates/preview.html',previewParser:false,previewParserPath:'',previewParserVar:'data',resizeHandle:true,beforeInsert:'',afterInsert:'',onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{/* set */}]// changed to Obj Array to allow for distinction between basic and advanced set
};$.extend(options,settings,extraSettings);// compute markItUp! path
if(!options.root){$('script').each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1];}});}// Quick patch to keep compatibility with jQuery 1.9
var uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};var matched=uaMatch(navigator.userAgent);var browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version;}if(browser.chrome){browser.webkit=true;}else if(browser.webkit){browser.safari=true;}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case'remove':remove();break;case'insert':markup(params);break;default:$.error('Method '+method+' does not exist on jQuery.markItUp');}return;}// apply the computed path to ~/
function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root);}return data.replace(/^~\//,options.root);}// init and build editor
function init(){id='';nameSpace='';if(options.id){id='id="'+options.id+'"';}else if($$.attr("id")){id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"';}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"';}$$.wrap('<div '+nameSpace+'></div>');$$.wrap('<div '+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");// add the header before the textarea
header=$('<div class="markItUpHeader"></div>').insertBefore($$);// $(dropMenus(options.markupSet)).appendTo(header);
// basic
var $basicSet=$(dropMenus(options.markupSet[0],'miu_basic'));$basicSet.append('<li class="txt_link fright li_miu_advanced"><span class="toggle_miu_advanced show_miu_advanced awesome-button" role="button">'+locaKeys.moreopts+'</span></li>');$basicSet.appendTo(header);// advanced
var $advancedSet=$(dropMenus(options.markupSet[1],'miu_advanced'));$advancedSet.appendTo(header).hide();footer=$('<div class="markItUpFooter"></div>').insertAfter($$);// add the resize handle after textarea
if(options.resizeHandle===true&&browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false;};mouseUp=function(e){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false;};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp);});footer.append(resizeHandle);}// listen key events
$$.bind('keydown.markItUp',keyPressed).bind('keyup',keyPressed);// bind an event to catch external calls
$$.bind("insertion.markItUp",function(e,settings){if(settings.target!==false){get();}if(textarea===$.markItUp.focused){markup(settings);}});// remember the last focus
$$.bind('focus.markItUp',function(){$.markItUp.focused=this;});if(options.previewInElement){refreshPreview();}}// recursively build header with dropMenus from markupset
function dropMenus(markupSet,mSetClass){if(!mSetClass)mSetClass='';var ul=$('<ul class="'+mSetClass+'"></ul>'),i=0;//$('li:hover > ul', ul).css('display', 'block');
$.each(markupSet,function(){var button=this,t='',title,li,j;title=button.key?(button.name||'')+' [Ctrl+'+button.key+']':button.name||'';key=button.key?'accesskey="'+button.key+'"':'';if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||'')+'</li>').appendTo(ul);}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-";}li=$('<li class="markItUpButton markItUpButton'+t+i+' '+(button.className||'')+'"><a href="" '+key+' title="'+title+'">'+(button.name||'')+'</a></li>').bind("contextmenu.markItUp",function(){// prevent contextmenu on mac and allow ctrl+click
return false;}).appendTo(ul);if(!isMobile){li.unbind('click.markItUp').bind('click.markItUp',function(){if(button.call){eval(button.call)();}else{// beim 1. Aufruf verschieben... an body haengen
var $innerUL=$('>ul',li);if($innerUL.length>0){// ausblenden wenn parent ausgeblendet wird
$innerUL.parents('.ui-dialog').find('.ui-dialog-titlebar-close').on('click',function(){$innerUL.hide();});$innerUL.addClass('markItUpOutpost');$('body').append($innerUL);var randomId=Math.ceil(Math.random()*10000);li.attr('id','markitUpDropdown'+randomId);$innerUL.attr('rel','markitUpDropdown'+randomId);// eine Auswahl darin soll das UL auch wieder schliessen
$innerUL.find('>li').bind('click.markItUp',function(){$innerUL.hide();li.attr('data-opened',0);});$(window).on('resize',function(e){// nicht huebsch, aber benoetigt fuer allyrundmails + zoom<1
repositionDropdowns($innerUL,li);});}else{// nicht erster aufruf - unterelement von body holen
$innerUL=$('body>ul[rel="'+li.attr('id')+'"]');}$('html').one('click.markItUp2',function(){$innerUL.hide();li.attr('data-opened',0);});// bei jedem klick neu positionieren
repositionDropdowns($innerUL,li);// Sichtbarkeit toggeln
if($innerUL.filter(':visible').length){$innerUL.hide();li.attr('data-opened',0);}else{$innerUL.show();li.attr('data-opened',1);}}setTimeout(function(){markup(button);},1);return false;}).bind("focusin.markItUp",function(){$$.focus();});}else{li.bind('click.markItUp',function(){$(header).find('ul ul').hide();if($(this).find('> ul').length){$(this).find('> ul').show();}else{if(button.call){eval(button.call)();}setTimeout(function(){markup(button);},1);}return false;});}if(button.dropMenu){levels.push(i);$(li).addClass('markItUpDropMenu').append(dropMenus(button.dropMenu));var dropDownArr=$('<span class="dropdown_arr"></span>');$(li).append(dropDownArr);}}});levels.pop();return ul;}function repositionDropdowns($innerUL,li){// bei jedem klick neu positionieren
var ulHeight=$innerUL.outerHeight();var top;var dropDownTop=Math.ceil(li.offset().top);if(dropDownTop+li.height()+ulHeight+$('#siteFooter').outerHeight()>=$(window).innerHeight()+$(window).scrollTop()){top=dropDownTop-ulHeight-2;}else{top=dropDownTop+29;}$innerUL.css({'top':top,'left':Math.floor(li.offset()['left'])});}// markItUp! markups
function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split('|!|');if(altKey===true){return b[1]!==undefined?b[1]:b[0];}else{return b[1]===undefined?"":b[0];}});// [![prompt]!], [![prompt:!:value]!]
string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(':!:');if(abort===true){return false;}value=prompt(b[0],b[1]?b[1]:'');if(value===null){abort=true;}return value;});return string;}return"";}// prepare action
function prepare(action){if($.isFunction(action)){action=action(hash);}return magicMarkups(action);}// build block to insert
function build(string){var openWith=prepare(clicked.openWith);var placeHolder=prepare(clicked.placeHolder);var replaceWith=prepare(clicked.replaceWith);var closeWith=prepare(clicked.closeWith);var openBlockWith=prepare(clicked.openBlockWith);var closeBlockWith=prepare(clicked.closeBlockWith);var multiline=clicked.multiline;if(replaceWith!==""){block=openWith+replaceWith+closeWith;}else if(selection===''&&placeHolder!==''){block=openWith+placeHolder+closeWith;}else{string=string||selection;var lines=[string],blocks=[];if(multiline===true){lines=string.split(/\r?\n/);}for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/)){blocks.push(openWith+line.replace(/ *$/g,'')+closeWith+trailingSpaces);}else{blocks.push(openWith+line+closeWith);}}block=blocks.join("\n");}block=openBlockWith+block+closeBlockWith;return{block:block,openBlockWith:openBlockWith,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith,closeBlockWith:closeBlockWith};}// define markup to insert
function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||'',caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});// callbacks before insertion
prepare(options.beforeInsert);prepare(clicked.beforeInsert);if(ctrlKey===true&&shiftKey===true||button.multiline===true){prepare(clicked.beforeMultiInsert);}$.extend(hash,{line:1});if(ctrlKey===true&&shiftKey===true){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==''){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block;}else{lines[i]="";}}string={block:lines.join('\n')};start=caretPosition;len=string.block.length+(browser.opera?n-1:0);}else if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block);}else if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block);}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block);}if(selection===''&&string.replaceWith===''){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openBlockWith.length+string.openWith.length;len=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition));}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len);}else{caretOffset=-1;}get();$.extend(hash,{line:'',selection:selection});// callbacks after insertion
if(ctrlKey===true&&shiftKey===true||button.multiline===true){prepare(clicked.afterMultiInsert);}prepare(clicked.afterInsert);prepare(options.afterInsert);// refresh preview if opened
if(previewWindow&&options.previewAutoRefresh){refreshPreview();}// reinit keyevent
shiftKey=altKey=ctrlKey=abort=false;}// Substract linefeed in Opera
function fixOperaBug(string){if(browser.opera){return string.length-string.replace(/\n*/g,'').length;}return 0;}// Substract linefeed in IE
function fixIeBug(string){if(browser.msie){return string.length-string.replace(/\r*/g,'').length;}return 0;}// add markup
function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block;}else{textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length);}}// set a selection
function set(start,len){if(textarea.createTextRange){// quick fix to make it work on Opera 9.5
if(browser.opera&&browser.version>=9.5&&len==0){return false;}range=textarea.createTextRange();range.collapse(true);range.moveStart('character',start);range.moveEnd('character',len);range.select();}else if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len);}textarea.scrollTop=scrollPosition;textarea.focus();}// get the selection
function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if(browser.msie){// ie
var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart('character');caretPosition++;}}else{// opera
caretPosition=textarea.selectionStart;}}else{// gecko & webkit
caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd);}return selection;}// open preview window
function preview(){if(typeof options.previewHandler==='function'){previewWindow=true;}else if(options.previewInElement){previewWindow=$(options.previewInElement);}else if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open('','preview',options.previewInWindow);$(window).unload(function(){previewWindow.close();});}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=='after'){iFrame.insertAfter(footer);}else{iFrame.insertBefore(header);}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1];}}else if(altKey===true){if(iFrame){iFrame.remove();}else{previewWindow.close();}previewWindow=iFrame=false;}if(!options.previewAutoRefresh){refreshPreview();}if(options.previewInWindow){previewWindow.focus();}}// refresh Preview window
function refreshPreview(){renderPreview();}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==='function'){options.previewHandler($$.val());}else if(options.previewParser&&typeof options.previewParser==='function'){var data=options.previewParser($$.val());writeInPreview(localize(data,1));}else if(options.previewParserPath!==''){$.ajax({type:'POST',dataType:'text',global:false,url:options.previewParserPath,data:options.previewParserVar+'='+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1));}});}else{if(!template){$.ajax({url:options.previewTemplatePath,dataType:'text',global:false,success:function(data){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()));}});}}return false;}function writeInPreview(data){if(options.previewInElement){$(options.previewInElement).html(data);}else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop;}catch(e){sp=0;}previewWindow.document.open();previewWindow.document.write(data);previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp;}}// set keys pressed
function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=!(e.altKey&&e.ctrlKey)?e.ctrlKey||e.metaKey:false;if(e.type==='keydown'){if(ctrlKey===true){li=$('a[accesskey="'+(e.keyCode==13?'\\n':String.fromCharCode(e.keyCode))+'"]',header).parent('li');if(li.length!==0){ctrlKey=false;setTimeout(function(){li.triggerHandler('mouseup');},1);return false;}}if(e.keyCode===13||e.keyCode===10){// Enter key
if(ctrlKey===true){// Enter + Ctrl
ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault;}else if(shiftKey===true){// Enter + Shift
shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault;}else{// only Enter
markup(options.onEnter);return options.onEnter.keepDefault;}}if(e.keyCode===9){// Tab key
if(shiftKey==true||ctrlKey==true||altKey==true){return false;}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false;}else{markup(options.onTab);return options.onTab.keepDefault;}}}}function remove(){$$.unbind(".markItUp").removeClass('markItUpEditor');$$.parent('div').parent('div.markItUp').parent('div').replaceWith($$);$$.data('markItUp',null);}init();});};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp('remove');});};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger('insertion',[options]);});}else{$('textarea').trigger('insertion',[options]);}};})(jQuery);/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery);}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q;}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r;}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top;}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h);}}function c(){f=null;}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0;}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this));},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height");},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16;},getPageHeight:function(b){return a(b).height();},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel");},unmousewheel:function(a){return this.unbind("mousewheel",a);}});});(function($){$.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",cssChildRow:"expand-child",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,sortLocaleCompare:true,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'/\.|\,/g',onRenderHeader:null,selectorHeaders:'thead th',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}if(table.tBodies.length==0)return;var rows=table.tBodies[0].rows;if(rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($.metadata&&$($headers[i]).metadata()&&$($headers[i]).metadata().sorter){p=getParserById($($headers[i]).metadata().sorter);}else if(table.config.headers[i]&&table.config.headers[i].sorter){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,rows,-1,i);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,rows,rowIndex,cellIndex){var l=parsers.length,node=false,nodeValue=false,keepLooking=true;while(nodeValue==''&&keepLooking){rowIndex++;if(rows[rowIndex]){node=getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex);nodeValue=trimAndGetNodeText(table.config,node);if(table.config.debug){log('Checking if value was empty on row:'+rowIndex);}}else{keepLooking=false;}}for(var i=1;i<l;i++){if(parsers[i].is(nodeValue,table,node)){return parsers[i];}}return parsers[0];}function getNodeFromRowAndCellIndex(rows,rowIndex,cellIndex){return rows[rowIndex].cells[cellIndex];}function trimAndGetNodeText(config,node){return $.trim(getElementText(config,node));}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=table.tBodies[0]&&table.tBodies[0].rows.length||0,totalCells=table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=$(table.tBodies[0].rows[i]),cols=[];if(c.hasClass(table.config.cssChildRow)){cache.row[cache.row.length-1]=cache.row[cache.row.length-1].add(c);continue;}cache.row.push(c);for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c[0].cells[j]),table,c[0].cells[j]));}cols.push(cache.normalized.length);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){var text="";if(!node)return"";if(!config.supportsTextContent)config.supportsTextContent=node.textContent||false;if(config.textExtraction=="simple"){if(config.supportsTextContent){text=node.textContent;}else{if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){text=node.childNodes[0].innerHTML;}else{text=node.innerHTML;}}}else{if(typeof config.textExtraction=="function"){text=config.textExtraction(node);}else{text=$(node).text();}}return text;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date();}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=n[0].length-1,tableBody=$(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){var pos=n[i][checkCell];rows.push(r[pos]);if(!table.config.appender){var l=r[pos].length;for(var j=0;j<l;j++){tableBody[0].appendChild(r[pos][j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=$.metadata?true:false;var header_index=computeTableHeaderCellIndexes(table);$tableHeaders=$(table.config.selectorHeaders,table).each(function(index){this.column=header_index[this.parentNode.rowIndex+"-"+this.cellIndex];this.order=formatSortingOrder(table.config.sortInitialOrder);this.count=this.order;if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(checkHeaderOptionsSortingLocked(table,index))this.order=this.lockedOrder=checkHeaderOptionsSortingLocked(table,index);if(!this.sortDisabled){var $th=$(this).addClass(table.config.cssHeader);if(table.config.onRenderHeader)table.config.onRenderHeader.apply($th);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function computeTableHeaderCellIndexes(t){var matrix=[];var lookup={};var thead=t.getElementsByTagName('THEAD')[0];var trs=thead.getElementsByTagName('TR');for(var i=0;i<trs.length;i++){var cells=trs[i].cells;for(var j=0;j<cells.length;j++){var c=cells[j];var rowIndex=c.parentNode.rowIndex;var cellId=rowIndex+"-"+c.cellIndex;var rowSpan=c.rowSpan||1;var colSpan=c.colSpan||1;var firstAvailCol;if(typeof matrix[rowIndex]=="undefined"){matrix[rowIndex]=[];}for(var k=0;k<matrix[rowIndex].length+1;k++){if(typeof matrix[rowIndex][k]=="undefined"){firstAvailCol=k;break;}}lookup[cellId]=firstAvailCol;for(var k=rowIndex;k<rowIndex+rowSpan;k++){if(typeof matrix[k]=="undefined"){matrix[k]=[];}var matrixrow=matrix[k];for(var l=firstAvailCol;l<firstAvailCol+colSpan;l++){matrixrow[l]="x";}}}}return lookup;}function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||cell.rowSpan>1||!r[row+1]){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if($.metadata&&$(cell).metadata().sorter===false){return true;};return false;}function checkHeaderOptions(table,i){if(table.config.headers[i]&&table.config.headers[i].sorter===false){return true;};return false;}function checkHeaderOptionsSortingLocked(table,i){if(table.config.headers[i]&&table.config.headers[i].lockedOrder)return table.config.headers[i].lockedOrder;return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof v!="Number"){return v.toLowerCase()=="desc"?1:0;}else{return v==1?1:0;}}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$('<colgroup>');$("tr:first td",table.tBodies[0]).each(function(){colgroup.append($('<col>').css('width',$(this).width()));});$(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=table.config.parsers[c].type=="text"?order==0?makeSortFunction("text","asc",c):makeSortFunction("text","desc",c):order==0?makeSortFunction("numeric","asc",c):makeSortFunction("numeric","desc",c);var e="e"+i;dynamicExp+="var "+e+" = "+s;dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";if(table.config.debug){benchmark("Evaling expression:"+dynamicExp,new Date());}eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function makeSortFunction(type,direction,index){var a="a["+index+"]",b="b["+index+"]";if(type=='text'&&direction=='asc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+a+" < "+b+") ? -1 : 1 )));";}else if(type=='text'&&direction=='desc'){return"("+a+" == "+b+" ? 0 : ("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : ("+b+" < "+a+") ? -1 : 1 )));";}else if(type=='numeric'&&direction=='asc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+a+" - "+b+"));";}else if(type=='numeric'&&direction=='desc'){return"("+a+" === null && "+b+" === null) ? 0 :("+a+" === null ? Number.POSITIVE_INFINITY : ("+b+" === null ? Number.NEGATIVE_INFINITY : "+b+" - "+a+"));";}};function makeSortText(i){return"((a["+i+"] < b["+i+"]) ? -1 : ((a["+i+"] > b["+i+"]) ? 1 : 0));";};function makeSortTextDesc(i){return"((b["+i+"] < a["+i+"]) ? -1 : ((b["+i+"] > a["+i+"]) ? 1 : 0));";};function makeSortNumeric(i){return"a["+i+"]-b["+i+"];";};function makeSortNumericDesc(i){return"b["+i+"]-a["+i+"];";};function sortText(a,b){if(table.config.sortLocaleCompare)return a.localeCompare(b);return a<b?-1:a>b?1:0;};function sortTextDesc(a,b){if(table.config.sortLocaleCompare)return b.localeCompare(a);return b<a?-1:b>a?1:0;};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$.extend(this.config,$.tablesorter.defaults,settings);$this=$(this);$.data(this,"tablesorter",config);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){var totalRows=$this[0].tBodies[0]&&$this[0].tBodies[0].rows.length||0;if(!this.sortDisabled&&totalRows>0){$this.trigger("sortStart");var $cell=$(this);var i=this.column;this.order=this.count++%2;if(this.lockedOrder)this.order=this.lockedOrder;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false;};return false;}});$this.bind("update",function(){var me=this;setTimeout(function(){me.config.parsers=buildParserCache(me,$headers);cache=buildCache(me);},1);}).bind("updateCell",function(e,cell){var config=this.config;var pos=[cell.parentNode.rowIndex-1,cell.cellIndex];cache.normalized[pos[0]][pos[1]]=config.parsers[pos[1]].format(getElementText(config,cell),cell);}).bind("sorton",function(e,list){$(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($.metadata&&$(this).metadata()&&$(this).metadata().sortlist){config.sortList=$(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return isNaN(i)?0:i;};this.formatInt=function(s){var i=parseInt(s);return isNaN(i)?0:i;};this.isDigit=function(s,config){return /^[-+]?\d*$/.test($.trim(s.replace(/[,.']/g,'')));};this.clearTableBody=function(table){if($.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}()});$.fn.extend({tablesorter:$.tablesorter.construct});var ts=$.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $.trim(s.toLocaleLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $.tablesorter.isDigit(s,c);},format:function(s){return $.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return /^[$?.]/.test(s);},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/[$]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return /^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return /^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return jQuery.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return /^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $.tablesorter.formatFloat(s!=""?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return /\%$/.test($.trim(s));},format:function(s){return $.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return /\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return /^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=!c.parserMetadataName?'sortValue':c.parserMetadataName;return $(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}var $tr,row=-1,odd;$("tr:visible",table.tBodies[0]).each(function(i){$tr=$(this);if(!$tr.hasClass(table.config.cssChildRow))row++;odd=row%2==0;$tr.removeClass(table.config.widgetZebra.css[odd?0:1]).addClass(table.config.widgetZebra.css[odd?1:0]);});if(table.config.debug){$.tablesorter.benchmark("Applying Zebra widget",time);}}});})(jQuery);/*
 * Inline Form Validation Engine 2.6.2, jQuery plugin
 *
 * Copyright(c) 2010, Cedric Dugas
 * http://www.position-absolute.com
 *
 * 2.0 Rewrite by Olivier Refalo
 * http://www.crionics.com
 *
 * Form validation engine allowing custom regex rules to be added.
 * Licensed under the MIT License
 */(function($){"use strict";var methods={/**
         * Kind of the constructor, called before any action
         * @param {Map} user options
         */init:function(options){var form=this;if(!form.data('jqv')||form.data('jqv')==null){options=methods._saveOptions(form,options);// bind all formError elements to close on click
$(document).on("click",".formError",function(){$(this).fadeOut(150,function(){// remove prompt once invisible
$(this).parent('.formErrorOuter').remove();$(this).remove();});});}return this;},/**
         * Attachs jQuery.validationEngine to form.submit and field.blur events
         * Takes an optional params: a list of options
         * ie. jQuery("#formID1").validationEngine('attach', {promptPosition : "centerRight"});
         */attach:function(userOptions){var form=this;var options;if(userOptions)options=methods._saveOptions(form,userOptions);else options=form.data('jqv');options.validateAttribute=form.find("[data-validation-engine*=validate]").length?"data-validation-engine":"class";if(options.binded){// delegate fields
form.on(options.validationEventTrigger,"["+options.validateAttribute+"*=validate]:not([type=checkbox]):not([type=radio]):not(.datepicker)",methods._onFieldEvent);form.on("click","["+options.validateAttribute+"*=validate][type=checkbox],["+options.validateAttribute+"*=validate][type=radio]",methods._onFieldEvent);form.on(options.validationEventTrigger,"["+options.validateAttribute+"*=validate][class*=datepicker]",{"delay":300},methods._onFieldEvent);}if(options.autoPositionUpdate){$(window).bind("resize",{"noAnimation":true,"formElem":form},methods.updatePromptsPosition);}form.on("click","a[data-validation-engine-skip], a[class*='validate-skip'], button[data-validation-engine-skip], button[class*='validate-skip'], input[data-validation-engine-skip], input[class*='validate-skip']",methods._submitButtonClick);form.removeData('jqv_submitButton');// bind form.submit
form.on("submit",methods._onSubmitEvent);return this;},/**
         * Unregisters any bindings that may point to jQuery.validaitonEngine
         */detach:function(){var form=this;var options=form.data('jqv');// unbind fields
form.find("["+options.validateAttribute+"*=validate]").not("[type=checkbox]").off(options.validationEventTrigger,methods._onFieldEvent);form.find("["+options.validateAttribute+"*=validate][type=checkbox],[class*=validate][type=radio]").off("click",methods._onFieldEvent);// unbind form.submit
form.off("submit",methods._onSubmitEvent);form.removeData('jqv');form.off("click","a[data-validation-engine-skip], a[class*='validate-skip'], button[data-validation-engine-skip], button[class*='validate-skip'], input[data-validation-engine-skip], input[class*='validate-skip']",methods._submitButtonClick);form.removeData('jqv_submitButton');if(options.autoPositionUpdate)$(window).off("resize",methods.updatePromptsPosition);return this;},/**
         * Validates either a form or a list of fields, shows prompts accordingly.
         * Note: There is no ajax form validation with this method, only field ajax validation are evaluated
         *
         * @return true if the form validates, false if it fails
         */validate:function(){var element=$(this);var valid=null;if(element.is("form")||element.hasClass("validationEngineContainer")){if(element.hasClass('validating')){// form is already validating.
// Should abort old validation and start new one. I don't know how to implement it.
return false;}else{element.addClass('validating');var options=element.data('jqv');var valid=methods._validateFields(this);// If the form doesn't validate, clear the 'validating' class before the user has a chance to submit again
setTimeout(function(){element.removeClass('validating');},100);if(valid&&options.onSuccess){options.onSuccess();}else if(!valid&&options.onFailure){options.onFailure();}}}else if(element.is('form')||element.hasClass('validationEngineContainer')){element.removeClass('validating');}else{// field validation
var form=element.closest('form, .validationEngineContainer'),options=form.data('jqv')?form.data('jqv'):$.validationEngine.defaults,valid=methods._validateField(element,options);if(valid&&options.onFieldSuccess)options.onFieldSuccess();else if(options.onFieldFailure&&options.InvalidFields.length>0){options.onFieldFailure();}}if(options.onValidationComplete){// !! ensures that an undefined return is interpreted as return false but allows a onValidationComplete() to possibly return true and have form continue processing
return!!options.onValidationComplete(form,valid);}return valid;},/**
         *  Redraw prompts position, useful when you change the DOM state when validating
         */updatePromptsPosition:function(event){if(event&&this==window){var form=event.data.formElem;var noAnimation=event.data.noAnimation;}else var form=$(this.closest('form, .validationEngineContainer'));var options=form.data('jqv');// No option, take default one
form.find('['+options.validateAttribute+'*=validate]').not(":disabled").each(function(){var field=$(this);if(options.prettySelect&&field.is(":hidden"))field=form.find("#"+options.usePrefix+field.attr('id')+options.useSuffix);var prompt=methods._getPrompt(field);var promptText=$(prompt).find(".formErrorContent").html();if(prompt)methods._updatePrompt(field,$(prompt),promptText,undefined,false,options,noAnimation);});return this;},/**
         * Displays a prompt on a element.
         * Note that the element needs an id!
         *
         * @param {String} promptText html text to display type
         * @param {String} type the type of bubble: 'pass' (green), 'load' (black) anything else (red)
         * @param {String} possible values topLeft, topRight, bottomLeft, centerRight, bottomRight
         */showPrompt:function(promptText,type,promptPosition,showArrow){var form=this.closest('form, .validationEngineContainer');var options=form.data('jqv');// No option, take default one
if(!options)options=methods._saveOptions(this,options);if(promptPosition)options.promptPosition=promptPosition;options.showArrow=showArrow==true;methods._showPrompt(this,promptText,type,false,options);return this;},/**
         * Closes form error prompts, CAN be invidual
         */hide:function(){var form=$(this).closest('form, .validationEngineContainer');var options=form.data('jqv');var fadeDuration=options&&options.fadeDuration?options.fadeDuration:0.3;var closingtag;if($(this).is("form")||$(this).hasClass("validationEngineContainer")){closingtag="parentForm"+methods._getClassName($(this).attr("id"));}else{closingtag=methods._getClassName($(this).attr("id"))+"formError";}$('.'+closingtag).fadeTo(fadeDuration,0.3,function(){$(this).parent('.formErrorOuter').remove();$(this).remove();});return this;},/**
         * Closes all error prompts on the page
         */hideAll:function(){var form=this;var options=form.data('jqv');var duration=options?options.fadeDuration:300;$('.formError').fadeTo(duration,300,function(){$(this).parent('.formErrorOuter').remove();$(this).remove();});return this;},/**
         * Typically called when user exists a field using tab or a mouse click, triggers a field
         * validation
         */_onFieldEvent:function(event){var field=$(this);var form=field.closest('form, .validationEngineContainer');var options=form.data('jqv');options.eventTrigger="field";// validate the current field
window.setTimeout(function(){methods._validateField(field,options);if(options.InvalidFields.length==0&&options.onFieldSuccess){options.onFieldSuccess();}else if(options.InvalidFields.length>0&&options.onFieldFailure){options.onFieldFailure();}},event.data?event.data.delay:0);},/**
         * Called when the form is submited, shows prompts accordingly
         *
         * @param {jqObject}
         *            form
         * @return false if form submission needs to be cancelled
         */_onSubmitEvent:function(){var form=$(this);var options=form.data('jqv');//check if it is trigger from skipped button
if(form.data("jqv_submitButton")){var submitButton=$("#"+form.data("jqv_submitButton"));if(submitButton){if(submitButton.length>0){if(submitButton.hasClass("validate-skip")||submitButton.attr("data-validation-engine-skip")=="true")return true;}}}options.eventTrigger="submit";// validate each field
// (- skip field ajax validation, not necessary IF we will perform an ajax form validation)
var r=methods._validateFields(form);if(r&&options.ajaxFormValidation){methods._validateFormWithAjax(form,options);// cancel form auto-submission - process with async call onAjaxFormComplete
return false;}if(options.onValidationComplete){// !! ensures that an undefined return is interpreted as return false but allows a onValidationComplete() to possibly return true and have form continue processing
return!!options.onValidationComplete(form,r);}return r;},/**
         * Return true if the ajax field validations passed so far
         * @param {Object} options
         * @return true, is all ajax validation passed so far (remember ajax is async)
         */_checkAjaxStatus:function(options){var status=true;$.each(options.ajaxValidCache,function(key,value){if(!value){status=false;// break the each
return false;}});return status;},/**
         * Return true if the ajax field is validated
         * @param {String} fieldid
         * @param {Object} options
         * @return true, if validation passed, false if false or doesn't exist
         */_checkAjaxFieldStatus:function(fieldid,options){return options.ajaxValidCache[fieldid]==true;},/**
         * Validates form fields, shows prompts accordingly
         *
         * @param {jqObject}
         *            form
         * @param {skipAjaxFieldValidation}
         *            boolean - when set to true, ajax field validation is skipped, typically used when the submit button is clicked
         *
         * @return true if form is valid, false if not, undefined if ajax form validation is done
         */_validateFields:function(form){var options=form.data('jqv');// this variable is set to true if an error is found
var errorFound=false;// Trigger hook, start validation
form.trigger("jqv.form.validating");// first, evaluate status of non ajax fields
var first_err=null;form.find('['+options.validateAttribute+'*=validate]').not(":disabled").each(function(){var field=$(this);var names=[];if($.inArray(field.attr('name'),names)<0){errorFound|=methods._validateField(field,options);if(errorFound&&first_err==null)if(field.is(":hidden")&&options.prettySelect)first_err=field=form.find("#"+options.usePrefix+methods._jqSelector(field.attr('id'))+options.useSuffix);else{//Check if we need to adjust what element to show the prompt on
//and and such scroll to instead
if(field.data('jqv-prompt-at')instanceof jQuery){field=field.data('jqv-prompt-at');}else if(field.data('jqv-prompt-at')){field=$(field.data('jqv-prompt-at'));}first_err=field;}if(options.doNotShowAllErrosOnSubmit)return false;names.push(field.attr('name'));//if option set, stop checking validation rules after one error is found
if(options.showOneMessage==true&&errorFound){return false;}}});// second, check to see if all ajax calls completed ok
// errorFound |= !methods._checkAjaxStatus(options);
// third, check status and scroll the container accordingly
form.trigger("jqv.form.result",[errorFound]);if(errorFound){if(options.scroll){var destination=first_err.offset().top;var fixleft=first_err.offset().left;//prompt positioning adjustment support. Usage: positionType:Xshift,Yshift (for ex.: bottomLeft:+20 or bottomLeft:-20,+10)
var positionType=options.promptPosition;if(typeof positionType=='string'&&positionType.indexOf(":")!=-1)positionType=positionType.substring(0,positionType.indexOf(":"));if(positionType!="bottomRight"&&positionType!="bottomLeft"){var prompt_err=methods._getPrompt(first_err);if(prompt_err){destination=prompt_err.offset().top;}}// Offset the amount the page scrolls by an amount in px to accomodate fixed elements at top of page
if(options.scrollOffset){destination-=options.scrollOffset;}// get the position of the first error, there should be at least one, no need to check this
//var destination = form.find(".formError:not('.greenPopup'):first").offset().top;
if(options.isOverflown){var overflowDIV=$(options.overflownDIV);if(!overflowDIV.length)return false;var scrollContainerScroll=overflowDIV.scrollTop();var scrollContainerPos=-parseInt(overflowDIV.offset().top);destination+=scrollContainerScroll+scrollContainerPos-5;var scrollContainer=$(options.overflownDIV+":not(:animated)");scrollContainer.animate({scrollTop:destination},1100,function(){if(options.focusFirstField)first_err.focus();});}else{$("html, body").animate({scrollTop:destination},1100,function(){if(options.focusFirstField)first_err.focus();});$("html, body").animate({scrollLeft:fixleft},1100);}}else if(options.focusFirstField)first_err.focus();return false;}return true;},/**
         * This method is called to perform an ajax form validation.
         * During this process all the (field, value) pairs are sent to the server which returns a list of invalid fields or true
         *
         * @param {jqObject} form
         * @param {Map} options
         */_validateFormWithAjax:function(form,options){var data=form.serialize();var type=options.ajaxFormValidationMethod?options.ajaxFormValidationMethod:"GET";var url=options.ajaxFormValidationURL?options.ajaxFormValidationURL:form.attr("action");var dataType=options.dataType?options.dataType:"json";$.ajax({type:type,url:url,cache:false,dataType:dataType,data:data,form:form,methods:methods,options:options,beforeSend:function(){return options.onBeforeAjaxFormValidation(form,options);},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){if(dataType=="json"&&json!==true){// getting to this case doesn't necessary means that the form is invalid
// the server may return green or closing prompt actions
// this flag helps figuring it out
var errorInForm=false;for(var i=0;i<json.length;i++){var value=json[i];var errorFieldId=value[0];var errorField=$($("#"+errorFieldId)[0]);// make sure we found the element
if(errorField.length==1){// promptText or selector
var msg=value[2];// if the field is valid
if(value[1]==true){if(msg==""||!msg){// if for some reason, status==true and error="", just close the prompt
methods._closePrompt(errorField);}else{// the field is valid, but we are displaying a green prompt
if(options.allrules[msg]){var txt=options.allrules[msg].alertTextOk;if(txt)msg=txt;}if(options.showPrompts)methods._showPrompt(errorField,msg,"pass",false,options,true);}}else{// the field is invalid, show the red error prompt
errorInForm|=true;if(options.allrules[msg]){var txt=options.allrules[msg].alertText;if(txt)msg=txt;}if(options.showPrompts)methods._showPrompt(errorField,msg,"",false,options,true);}}}options.onAjaxFormComplete(!errorInForm,form,json,options);}else options.onAjaxFormComplete(true,form,json,options);}});},/**
         * Validates field, shows prompts accordingly
         *
         * @param {jqObject}
         *            field
         * @param {Array[String]}
         *            field's validation rules
         * @param {Map}
         *            user options
         * @return false if field is valid (It is inversed for *fields*, it return false on validate and true on errors.)
         */_validateField:function(field,options,skipAjaxValidation){if(!field.attr("id")){field.attr("id","form-validation-field-"+$.validationEngine.fieldIdCounter);++$.validationEngine.fieldIdCounter;}if(!options.validateNonVisibleFields&&(field.is(":hidden")&&!options.prettySelect||field.parent().is(":hidden")))return false;var rulesParsing=field.attr(options.validateAttribute);var getRules=/validate\[(.*)\]/.exec(rulesParsing);if(!getRules)return false;var str=getRules[1];var rules=str.split(/\[|,|\]/);// true if we ran the ajax validation, tells the logic to stop messing with prompts
var isAjaxValidator=false;var fieldName=field.attr("name");var promptText="";var promptType="";var required=false;var limitErrors=false;options.isError=false;options.showArrow=true;// If the programmer wants to limit the amount of error messages per field,
if(options.maxErrorsPerField>0){limitErrors=true;}var form=$(field.closest("form, .validationEngineContainer"));// Fix for adding spaces in the rules
for(var i=0;i<rules.length;i++){rules[i]=rules[i].replace(" ","");// Remove any parsing errors
if(rules[i]===''){delete rules[i];}}for(var i=0,field_errors=0;i<rules.length;i++){// If we are limiting errors, and have hit the max, break
if(limitErrors&&field_errors>=options.maxErrorsPerField){// If we haven't hit a required yet, check to see if there is one in the validation rules for this
// field and that it's index is greater or equal to our current index
if(!required){var have_required=$.inArray('required',rules);required=have_required!=-1&&have_required>=i;}break;}var errorMsg=undefined;switch(rules[i]){case"required":required=true;errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._required);break;case"custom":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._custom);break;case"groupRequired":// Check is its the first of group, if not, reload validation with first field
// AND continue normal validation on present field
var classGroup="["+options.validateAttribute+"*="+rules[i+1]+"]";var firstOfGroup=form.find(classGroup).eq(0);if(firstOfGroup[0]!=field[0]){methods._validateField(firstOfGroup,options,skipAjaxValidation);options.showArrow=true;}errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._groupRequired);if(errorMsg)required=true;options.showArrow=false;break;case"ajax":// AJAX defaults to returning it's loading message
errorMsg=methods._ajax(field,rules,i,options);if(errorMsg){promptType="load";}break;case"minSize":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._minSize);break;case"maxSize":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._maxSize);break;case"min":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._min);break;case"max":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._max);break;case"past":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._past);break;case"future":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._future);break;case"dateRange":var classGroup="["+options.validateAttribute+"*="+rules[i+1]+"]";options.firstOfGroup=form.find(classGroup).eq(0);options.secondOfGroup=form.find(classGroup).eq(1);//if one entry out of the pair has value then proceed to run through validation
if(options.firstOfGroup[0].value||options.secondOfGroup[0].value){errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._dateRange);}if(errorMsg)required=true;options.showArrow=false;break;case"dateTimeRange":var classGroup="["+options.validateAttribute+"*="+rules[i+1]+"]";options.firstOfGroup=form.find(classGroup).eq(0);options.secondOfGroup=form.find(classGroup).eq(1);//if one entry out of the pair has value then proceed to run through validation
if(options.firstOfGroup[0].value||options.secondOfGroup[0].value){errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._dateTimeRange);}if(errorMsg)required=true;options.showArrow=false;break;case"maxCheckbox":field=$(form.find("input[name='"+fieldName+"']"));errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._maxCheckbox);break;case"minCheckbox":field=$(form.find("input[name='"+fieldName+"']"));errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._minCheckbox);break;case"equals":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._equals);break;case"funcCall":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._funcCall);break;case"creditCard":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._creditCard);break;case"condRequired":errorMsg=methods._getErrorMessage(form,field,rules[i],rules,i,options,methods._condRequired);if(errorMsg!==undefined){required=true;}break;default:}var end_validation=false;// If we were passed back an message object, check what the status was to determine what to do
if(typeof errorMsg=="object"){switch(errorMsg.status){case"_break":end_validation=true;break;// If we have an error message, set errorMsg to the error message
case"_error":errorMsg=errorMsg.message;break;// If we want to throw an error, but not show a prompt, return early with true
case"_error_no_prompt":return true;break;// Anything else we continue on
default:break;}}// If it has been specified that validation should end now, break
if(end_validation){break;}// If we have a string, that means that we have an error, so add it to the error message.
if(typeof errorMsg=='string'){promptText+=errorMsg+"<br/>";options.isError=true;field_errors++;}}// If the rules required is not added, an empty field is not validated
if(!required&&!field.val()&&field.val().length<1)options.isError=false;// Hack for radio/checkbox group button, the validation go into the
// first radio/checkbox of the group
var fieldType=field.prop("type");var positionType=field.data("promptPosition")||options.promptPosition;if((fieldType=="radio"||fieldType=="checkbox")&&form.find("input[name='"+fieldName+"']").size()>1){if(positionType==='inline'){field=$(form.find("input[name='"+fieldName+"'][type!=hidden]:last"));}else{field=$(form.find("input[name='"+fieldName+"'][type!=hidden]:first"));}options.showArrow=false;}if(field.is(":hidden")&&options.prettySelect){field=form.find("#"+options.usePrefix+methods._jqSelector(field.attr('id'))+options.useSuffix);}if(options.isError&&options.showPrompts){methods._showPrompt(field,promptText,promptType,false,options);}else{if(!isAjaxValidator)methods._closePrompt(field);}if(!isAjaxValidator){field.trigger("jqv.field.result",[field,options.isError,promptText]);}/* Record error */var errindex=$.inArray(field[0],options.InvalidFields);if(errindex==-1){if(options.isError)options.InvalidFields.push(field[0]);}else if(!options.isError){options.InvalidFields.splice(errindex,1);}methods._handleStatusCssClasses(field,options);/* run callback function for each field */if(options.isError&&options.onFieldFailure)options.onFieldFailure(field);if(!options.isError&&options.onFieldSuccess)options.onFieldSuccess(field);return options.isError;},/**
         * Handling css classes of fields indicating result of validation
         *
         * @param {jqObject}
         *            field
         * @param {Array[String]}
         *            field's validation rules
         * @private
         */_handleStatusCssClasses:function(field,options){/* remove all classes */if(options.addSuccessCssClassToField)field.removeClass(options.addSuccessCssClassToField);if(options.addFailureCssClassToField)field.removeClass(options.addFailureCssClassToField);/* Add classes */if(options.addSuccessCssClassToField&&!options.isError)field.addClass(options.addSuccessCssClassToField);if(options.addFailureCssClassToField&&options.isError)field.addClass(options.addFailureCssClassToField);},/********************
         * _getErrorMessage
         *
         * @param form
         * @param field
         * @param rule
         * @param rules
         * @param i
         * @param options
         * @param originalValidationMethod
         * @return {*}
         * @private
         */_getErrorMessage:function(form,field,rule,rules,i,options,originalValidationMethod){// If we are using the custon validation type, build the index for the rule.
// Otherwise if we are doing a function call, make the call and return the object
// that is passed back.
var rule_index=jQuery.inArray(rule,rules);if(rule==="custom"||rule==="funcCall"){var custom_validation_type=rules[rule_index+1];rule=rule+"["+custom_validation_type+"]";// Delete the rule from the rules array so that it doesn't try to call the
// same rule over again
delete rules[rule_index];}// Change the rule to the composite rule, if it was different from the original
var alteredRule=rule;var element_classes=field.attr("data-validation-engine")?field.attr("data-validation-engine"):field.attr("class");var element_classes_array=element_classes.split(" ");// Call the original validation method. If we are dealing with dates or checkboxes, also pass the form
var errorMsg;if(rule=="future"||rule=="past"||rule=="maxCheckbox"||rule=="minCheckbox"){errorMsg=originalValidationMethod(form,field,rules,i,options);}else{errorMsg=originalValidationMethod(field,rules,i,options);}// If the original validation method returned an error and we have a custom error message,
// return the custom message instead. Otherwise return the original error message.
if(errorMsg!=undefined){var custom_message=methods._getCustomErrorMessage($(field),element_classes_array,alteredRule,options);if(custom_message)errorMsg=custom_message;}return errorMsg;},_getCustomErrorMessage:function(field,classes,rule,options){var custom_message=false;var validityProp=/^custom\[.*\]$/.test(rule)?methods._validityProp["custom"]:methods._validityProp[rule];// If there is a validityProp for this rule, check to see if the field has an attribute for it
if(validityProp!=undefined){custom_message=field.attr("data-errormessage-"+validityProp);// If there was an error message for it, return the message
if(custom_message!=undefined)return custom_message;}custom_message=field.attr("data-errormessage");// If there is an inline custom error message, return it
if(custom_message!=undefined)return custom_message;var id='#'+field.attr("id");// If we have custom messages for the element's id, get the message for the rule from the id.
// Otherwise, if we have custom messages for the element's classes, use the first class message we find instead.
if(typeof options.custom_error_messages[id]!="undefined"&&typeof options.custom_error_messages[id][rule]!="undefined"){custom_message=options.custom_error_messages[id][rule]['message'];}else if(classes.length>0){for(var i=0;i<classes.length&&classes.length>0;i++){var element_class="."+classes[i];if(typeof options.custom_error_messages[element_class]!="undefined"&&typeof options.custom_error_messages[element_class][rule]!="undefined"){custom_message=options.custom_error_messages[element_class][rule]['message'];break;}}}if(!custom_message&&typeof options.custom_error_messages[rule]!="undefined"&&typeof options.custom_error_messages[rule]['message']!="undefined"){custom_message=options.custom_error_messages[rule]['message'];}return custom_message;},_validityProp:{"required":"value-missing","custom":"custom-error","groupRequired":"value-missing","ajax":"custom-error","minSize":"range-underflow","maxSize":"range-overflow","min":"range-underflow","max":"range-overflow","past":"type-mismatch","future":"type-mismatch","dateRange":"type-mismatch","dateTimeRange":"type-mismatch","maxCheckbox":"range-overflow","minCheckbox":"range-underflow","equals":"pattern-mismatch","funcCall":"custom-error","creditCard":"pattern-mismatch","condRequired":"value-missing"},/**
         * Required validation
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @param {bool} condRequired flag when method is used for internal purpose in condRequired check
         * @return an error string if validation failed
         */_required:function(field,rules,i,options,condRequired){switch(field.prop("type")){case"text":case"password":case"textarea":case"file":case"select-one":case"select-multiple":default:var field_val=$.trim(field.val());var dv_placeholder=$.trim(field.attr("data-validation-placeholder"));//var placeholder    = $.trim( field.attr("placeholder")                 );
if(!field_val||dv_placeholder&&field_val==dv_placeholder//|| ( placeholder    && field_val == placeholder    )
){return options.allrules[rules[i]].alertText;}break;case"radio":case"checkbox":// new validation style to only check dependent field
if(condRequired){if(!field.attr('checked')){return options.allrules[rules[i]].alertTextCheckboxMultiple;}break;}// old validation style
var form=field.closest("form, .validationEngineContainer");var name=field.attr("name");if(form.find("input[name='"+name+"']:checked").size()==0){if(form.find("input[name='"+name+"']:visible").size()==1)return options.allrules[rules[i]].alertTextCheckboxe;else return options.allrules[rules[i]].alertTextCheckboxMultiple;}break;}},/**
         * Validate that 1 from the group field is required
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_groupRequired:function(field,rules,i,options){var classGroup="["+options.validateAttribute+"*="+rules[i+1]+"]";var isValid=false;// Check all fields from the group
field.closest("form, .validationEngineContainer").find(classGroup).each(function(){if(!methods._required($(this),rules,i,options)){isValid=true;return false;}});if(!isValid){return options.allrules[rules[i]].alertText;}},/**
         * Validate rules
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_custom:function(field,rules,i,options){var customRule=rules[i+1];var rule=options.allrules[customRule];var fn;if(!rule){alert("jqv:custom rule not found - "+customRule);return;}if(rule["regex"]){var ex=rule.regex;if(!ex){alert("jqv:custom regex not found - "+customRule);return;}var pattern=new RegExp(ex);if(!pattern.test(field.val()))return options.allrules[customRule].alertText;}else if(rule["func"]){fn=rule["func"];if(typeof fn!=="function"){alert("jqv:custom parameter 'function' is no function - "+customRule);return;}if(!fn(field,rules,i,options))return options.allrules[customRule].alertText;}else{alert("jqv:custom type not allowed "+customRule);return;}},/**
         * Validate custom function outside of the engine scope
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_funcCall:function(field,rules,i,options){var functionName=rules[i+1];var fn;if(functionName.indexOf('.')>-1){var namespaces=functionName.split('.');var scope=window;while(namespaces.length){scope=scope[namespaces.shift()];}fn=scope;}else fn=window[functionName]||options.customFunctions[functionName];if(typeof fn=='function')return fn(field,rules,i,options);},/**
         * Field match
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_equals:function(field,rules,i,options){var equalsField=rules[i+1];if(field.val()!=$("#"+equalsField).val())return options.allrules.equals.alertText;},/**
         * Check the maximum size (in characters)
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_maxSize:function(field,rules,i,options){var max=rules[i+1];var len=field.val().length;if(len>max){var rule=options.allrules.maxSize;if(typeof rule.alertText2=='string'){return rule.alertText+min+rule.alertText2;}else{return rule.alertText;}}},/**
         * Check the minimum size (in characters)
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_minSize:function(field,rules,i,options){var min=rules[i+1];var len=field.val().length;if(len<min){var rule=options.allrules.minSize;if(typeof rule.alertText2=='string'){return rule.alertText+min+rule.alertText2;}else{return rule.alertText;}}},/**
         * Check number minimum value
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_min:function(field,rules,i,options){var min=parseFloat(rules[i+1]);var len=parseFloat(field.val());if(len<min){var rule=options.allrules.min;if(rule.alertText2)return rule.alertText+min+rule.alertText2;return rule.alertText+min;}},/**
         * Check number maximum value
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_max:function(field,rules,i,options){var max=parseFloat(rules[i+1]);var len=parseFloat(field.val());if(len>max){var rule=options.allrules.max;if(rule.alertText2)return rule.alertText+max+rule.alertText2;//orefalo: to review, also do the translations
return rule.alertText+max;}},/**
         * Checks date is in the past
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_past:function(form,field,rules,i,options){var p=rules[i+1];var fieldAlt=$(form.find("input[name='"+p.replace(/^#+/,'')+"']"));var pdate;if(p.toLowerCase()=="now"){pdate=new Date();}else if(undefined!=fieldAlt.val()){if(fieldAlt.is(":disabled"))return;pdate=methods._parseDate(fieldAlt.val());}else{pdate=methods._parseDate(p);}var vdate=methods._parseDate(field.val());if(vdate>pdate){var rule=options.allrules.past;if(rule.alertText2)return rule.alertText+methods._dateToString(pdate)+rule.alertText2;return rule.alertText+methods._dateToString(pdate);}},/**
         * Checks date is in the future
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_future:function(form,field,rules,i,options){var p=rules[i+1];var fieldAlt=$(form.find("input[name='"+p.replace(/^#+/,'')+"']"));var pdate;if(p.toLowerCase()=="now"){pdate=new Date();}else if(undefined!=fieldAlt.val()){if(fieldAlt.is(":disabled"))return;pdate=methods._parseDate(fieldAlt.val());}else{pdate=methods._parseDate(p);}var vdate=methods._parseDate(field.val());if(vdate<pdate){var rule=options.allrules.future;if(rule.alertText2)return rule.alertText+methods._dateToString(pdate)+rule.alertText2;return rule.alertText+methods._dateToString(pdate);}},/**
         * Checks if valid date
         *
         * @param {string} date string
         * @return a bool based on determination of valid date
         */_isDate:function(value){var dateRegEx=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:0?[1-9]|1[0-2])(\/|-)(?:0?[1-9]|1\d|2[0-8]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(0?2(\/|-)29)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$/);return dateRegEx.test(value);},/**
         * Checks if valid date time
         *
         * @param {string} date string
         * @return a bool based on determination of valid date time
         */_isDateTime:function(value){var dateTimeRegEx=new RegExp(/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1}$|^(?:(?:(?:0?[13578]|1[02])(\/|-)31)|(?:(?:0?[1,3-9]|1[0-2])(\/|-)(?:29|30)))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^((1[012]|0?[1-9]){1}\/(0?[1-9]|[12][0-9]|3[01]){1}\/\d{2,4}\s+(1[012]|0?[1-9]){1}:(0?[1-5]|[0-6][0-9]){1}:(0?[0-6]|[0-6][0-9]){1}\s+(am|pm|AM|PM){1})$/);return dateTimeRegEx.test(value);},//Checks if the start date is before the end date
//returns true if end is later than start
_dateCompare:function(start,end){return new Date(start.toString())<new Date(end.toString());},/**
         * Checks date range
         *
         * @param {jqObject} first field name
         * @param {jqObject} second field name
         * @return an error string if validation failed
         */_dateRange:function(field,rules,i,options){//are not both populated
if(!options.firstOfGroup[0].value&&options.secondOfGroup[0].value||options.firstOfGroup[0].value&&!options.secondOfGroup[0].value){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}//are not both dates
if(!methods._isDate(options.firstOfGroup[0].value)||!methods._isDate(options.secondOfGroup[0].value)){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}//are both dates but range is off
if(!methods._dateCompare(options.firstOfGroup[0].value,options.secondOfGroup[0].value)){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}},/**
         * Checks date time range
         *
         * @param {jqObject} first field name
         * @param {jqObject} second field name
         * @return an error string if validation failed
         */_dateTimeRange:function(field,rules,i,options){//are not both populated
if(!options.firstOfGroup[0].value&&options.secondOfGroup[0].value||options.firstOfGroup[0].value&&!options.secondOfGroup[0].value){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}//are not both dates
if(!methods._isDateTime(options.firstOfGroup[0].value)||!methods._isDateTime(options.secondOfGroup[0].value)){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}//are both dates but range is off
if(!methods._dateCompare(options.firstOfGroup[0].value,options.secondOfGroup[0].value)){return options.allrules[rules[i]].alertText+options.allrules[rules[i]].alertText2;}},/**
         * Max number of checkbox selected
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_maxCheckbox:function(form,field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=form.find("input[name='"+groupname+"']:checked").size();if(groupSize>nbCheck){options.showArrow=false;if(options.allrules.maxCheckbox.alertText2)return options.allrules.maxCheckbox.alertText+" "+nbCheck+" "+options.allrules.maxCheckbox.alertText2;return options.allrules.maxCheckbox.alertText;}},/**
         * Min number of checkbox selected
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_minCheckbox:function(form,field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=form.find("input[name='"+groupname+"']:checked").size();if(groupSize<nbCheck){options.showArrow=false;return options.allrules.minCheckbox.alertText+" "+nbCheck+" "+options.allrules.minCheckbox.alertText2;}},/**
         * Checks that it is a valid credit card number according to the
         * Luhn checksum algorithm.
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return an error string if validation failed
         */_creditCard:function(field,rules,i,options){//spaces and dashes may be valid characters, but must be stripped to calculate the checksum.
var valid=false,cardNumber=field.val().replace(/ +/g,'').replace(/-+/g,'');var numDigits=cardNumber.length;if(numDigits>=14&&numDigits<=16&&parseInt(cardNumber)>0){var sum=0,i=numDigits-1,pos=1,digit,luhn=new String();do{digit=parseInt(cardNumber.charAt(i));luhn+=pos++%2==0?digit*2:digit;}while(--i>=0);for(i=0;i<luhn.length;i++){sum+=parseInt(luhn.charAt(i));}valid=sum%10==0;}if(!valid)return options.allrules.creditCard.alertText;},/**
         * Ajax field validation
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         *            user options
         * @return nothing! the ajax validator handles the prompts itself
         */_ajax:function(field,rules,i,options){var errorSelector=rules[i+1];var rule=options.allrules[errorSelector];var extraData=rule.extraData;var extraDataDynamic=rule.extraDataDynamic;var data={"fieldId":field.attr("id"),"fieldValue":field.val()};if(typeof extraData==="object"){$.extend(data,extraData);}else if(typeof extraData==="string"){var tempData=extraData.split("&");for(var i=0;i<tempData.length;i++){var values=tempData[i].split("=");if(values[0]&&values[0]){data[values[0]]=values[1];}}}if(extraDataDynamic){var tmpData=[];var domIds=String(extraDataDynamic).split(",");for(var i=0;i<domIds.length;i++){var id=domIds[i];if($(id).length){var inputValue=field.closest("form, .validationEngineContainer").find(id).val();var keyValue=id.replace('#','')+'='+escape(inputValue);data[id.replace('#','')]=inputValue;}}}// If a field change event triggered this we want to clear the cache for this ID
if(options.eventTrigger=="field"){delete options.ajaxValidCache[field.attr("id")];}// If there is an error or if the the field is already validated, do not re-execute AJAX
if(!options.isError&&!methods._checkAjaxFieldStatus(field.attr("id"),options)){$.ajax({type:options.ajaxFormValidationMethod,url:rule.url,cache:false,dataType:"json",data:data,field:field,rule:rule,methods:methods,options:options,beforeSend:function(){},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){// asynchronously called on success, data is the json answer from the server
var errorFieldId=json[0];//var errorField = $($("#" + errorFieldId)[0]);
var errorField=$("#"+errorFieldId).eq(0);// make sure we found the element
if(errorField.length==1){var status=json[1];// read the optional msg from the server
var msg=json[2];if(!status){// Houston we got a problem - display an red prompt
options.ajaxValidCache[errorFieldId]=false;options.isError=true;// resolve the msg prompt
if(msg){if(options.allrules[msg]){var txt=options.allrules[msg].alertText;if(txt){msg=txt;}}}else msg=rule.alertText;if(options.showPrompts)methods._showPrompt(errorField,msg,"",true,options);}else{options.ajaxValidCache[errorFieldId]=true;// resolves the msg prompt
if(msg){if(options.allrules[msg]){var txt=options.allrules[msg].alertTextOk;if(txt){msg=txt;}}}else msg=rule.alertTextOk;if(options.showPrompts){// see if we should display a green prompt
if(msg)methods._showPrompt(errorField,msg,"pass",true,options);else methods._closePrompt(errorField);}// If a submit form triggered this, we want to re-submit the form
if(options.eventTrigger=="submit")field.closest("form").submit();}}errorField.trigger("jqv.field.result",[errorField,options.isError,msg]);}});return rule.alertTextLoad;}},/**
         * Common method to handle ajax errors
         *
         * @param {Object} data
         * @param {Object} transport
         */_ajaxError:function(data,transport){if(data.status==0&&transport==null)alert("The page is not served from a server! ajax call failed");else if(typeof console!="undefined")console.log("Ajax error: "+data.status+" "+transport);},/**
         * date -> string
         *
         * @param {Object} date
         */_dateToString:function(date){return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();},/**
         * Parses an ISO date
         * @param {String} d
         */_parseDate:function(d){var dateParts=d.split("-");if(dateParts==d)dateParts=d.split("/");if(dateParts==d){dateParts=d.split(".");return new Date(dateParts[2],dateParts[1]-1,dateParts[0]);}return new Date(dateParts[0],dateParts[1]-1,dateParts[2]);},/**
         * Builds or updates a prompt with the given information
         *
         * @param {jqObject} field
         * @param {String} promptText html text to display type
         * @param {String} type the type of bubble: 'pass' (green), 'load' (black) anything else (red)
         * @param {boolean} ajaxed - use to mark fields than being validated with ajax
         * @param {Map} options user options
         */_showPrompt:function(field,promptText,type,ajaxed,options,ajaxform){//Check if we need to adjust what element to show the prompt on
if(field.data('jqv-prompt-at')instanceof jQuery){field=field.data('jqv-prompt-at');}else if(field.data('jqv-prompt-at')){field=$(field.data('jqv-prompt-at'));}var prompt=methods._getPrompt(field);// The ajax submit errors are not see has an error in the form,
// When the form errors are returned, the engine see 2 bubbles, but those are ebing closed by the engine at the same time
// Because no error was found befor submitting
if(ajaxform)prompt=false;// Check that there is indded text
if($.trim(promptText)){if(prompt)methods._updatePrompt(field,prompt,promptText,type,ajaxed,options);else methods._buildPrompt(field,promptText,type,ajaxed,options);}},/**
         * Builds and shades a prompt for the given field.
         *
         * @param {jqObject} field
         * @param {String} promptText html text to display type
         * @param {String} type the type of bubble: 'pass' (green), 'load' (black) anything else (red)
         * @param {boolean} ajaxed - use to mark fields than being validated with ajax
         * @param {Map} options user options
         */_buildPrompt:function(field,promptText,type,ajaxed,options){// create the prompt
var prompt=$('<div>');prompt.addClass(methods._getClassName(field.attr("id"))+"formError");// add a class name to identify the parent form of the prompt
prompt.addClass("parentForm"+methods._getClassName(field.closest('form, .validationEngineContainer').attr("id")));prompt.addClass("formError");switch(type){case"pass":prompt.addClass("greenPopup");break;case"load":prompt.addClass("blackPopup");break;default:/* it has error  */ //alert("unknown popup type:"+type);
}if(ajaxed)prompt.addClass("ajaxed");// create the prompt content
var promptContent=$('<div>').addClass("formErrorContent").html(promptText).appendTo(prompt);// determine position type
var positionType=field.data("promptPosition")||options.promptPosition;// create the css arrow pointing at the field
// note that there is no triangle on max-checkbox and radio
if(options.showArrow){var arrow=$('<div>').addClass("formErrorArrow");//prompt positioning adjustment support. Usage: positionType:Xshift,Yshift (for ex.: bottomLeft:+20 or bottomLeft:-20,+10)
if(typeof positionType=='string'){var pos=positionType.indexOf(":");if(pos!=-1)positionType=positionType.substring(0,pos);}switch(positionType){case"bottomLeft":case"bottomRight":prompt.find(".formErrorContent").before(arrow);arrow.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":arrow.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');prompt.append(arrow);break;}}// Add custom prompt class
if(options.addPromptClass)prompt.addClass(options.addPromptClass);// Add custom prompt class defined in element
var requiredOverride=field.attr('data-required-class');if(requiredOverride!==undefined){prompt.addClass(requiredOverride);}else{if(options.prettySelect){if($('#'+field.attr('id')).next().is('select')){var prettyOverrideClass=$('#'+field.attr('id').substr(options.usePrefix.length).substring(options.useSuffix.length)).attr('data-required-class');if(prettyOverrideClass!==undefined){prompt.addClass(prettyOverrideClass);}}}}prompt.css({"opacity":0});if(positionType==='inline'){prompt.addClass("inline");if(typeof field.attr('data-prompt-target')!=='undefined'&&$('#'+field.attr('data-prompt-target')).length>0){prompt.appendTo($('#'+field.attr('data-prompt-target')));}else{field.after(prompt);}}else{field.before(prompt);}var pos=methods._calculatePosition(field,prompt,options);prompt.css({'position':positionType==='inline'?'relative':'absolute',"top":pos.callerTopPosition,"left":pos.callerleftPosition,"marginTop":pos.marginTopSize,"opacity":0}).data("callerField",field);if(options.autoHidePrompt){setTimeout(function(){prompt.animate({"opacity":0},function(){prompt.closest('.formErrorOuter').remove();prompt.remove();});},options.autoHideDelay);}return prompt.animate({"opacity":0.87});},/**
         * Updates the prompt text field - the field for which the prompt
         * @param {jqObject} field
         * @param {String} promptText html text to display type
         * @param {String} type the type of bubble: 'pass' (green), 'load' (black) anything else (red)
         * @param {boolean} ajaxed - use to mark fields than being validated with ajax
         * @param {Map} options user options
         */_updatePrompt:function(field,prompt,promptText,type,ajaxed,options,noAnimation){if(prompt){if(typeof type!=="undefined"){if(type=="pass")prompt.addClass("greenPopup");else prompt.removeClass("greenPopup");if(type=="load")prompt.addClass("blackPopup");else prompt.removeClass("blackPopup");}if(ajaxed)prompt.addClass("ajaxed");else prompt.removeClass("ajaxed");prompt.find(".formErrorContent").html(promptText);var pos=methods._calculatePosition(field,prompt,options);var css={"top":pos.callerTopPosition,"left":pos.callerleftPosition,"marginTop":pos.marginTopSize};if(noAnimation)prompt.css(css);else prompt.animate(css);}},/**
         * Closes the prompt associated with the given field
         *
         * @param {jqObject}
         *            field
         */_closePrompt:function(field){var prompt=methods._getPrompt(field);if(prompt)prompt.fadeTo("fast",0,function(){prompt.parent('.formErrorOuter').remove();prompt.remove();});},closePrompt:function(field){return methods._closePrompt(field);},/**
         * Returns the error prompt matching the field if any
         *
         * @param {jqObject}
         *            field
         * @return undefined or the error prompt (jqObject)
         */_getPrompt:function(field){var formId=$(field).closest('form, .validationEngineContainer').attr('id');var className=methods._getClassName(field.attr("id"))+"formError";var match=$("."+methods._escapeExpression(className)+'.parentForm'+methods._getClassName(formId))[0];if(match)return $(match);},/**
         * Returns the escapade classname
         *
         * @param {selector}
         *            className
         */_escapeExpression:function(selector){return selector.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1");},/**
         * returns true if we are in a RTLed document
         *
         * @param {jqObject} field
         */isRTL:function(field){var $document=$(document);var $body=$('body');var rtl=field&&field.hasClass('rtl')||field&&(field.attr('dir')||'').toLowerCase()==='rtl'||$document.hasClass('rtl')||($document.attr('dir')||'').toLowerCase()==='rtl'||$body.hasClass('rtl')||($body.attr('dir')||'').toLowerCase()==='rtl';return Boolean(rtl);},/**
         * Calculates prompt position
         *
         * @param {jqObject}
         *            field
         * @param {jqObject}
         *            the prompt
         * @param {Map}
         *            options
         * @return positions
         */_calculatePosition:function(field,promptElmt,options){var promptTopPosition,promptleftPosition,marginTopSize;var fieldWidth=field.width();var fieldLeft=field.position().left;var fieldTop=field.position().top;var fieldHeight=field.height();var promptHeight=promptElmt.height();// is the form contained in an overflown container?
promptTopPosition=promptleftPosition=0;// compensation for the arrow
marginTopSize=-promptHeight;//prompt positioning adjustment support
//now you can adjust prompt position
//usage: positionType:Xshift,Yshift
//for example:
//   bottomLeft:+20 means bottomLeft position shifted by 20 pixels right horizontally
//   topRight:20, -15 means topRight position shifted by 20 pixels to right and 15 pixels to top
//You can use +pixels, - pixels. If no sign is provided than + is default.
var positionType=field.data("promptPosition")||options.promptPosition;var shift1="";var shift2="";var shiftX=0;var shiftY=0;if(typeof positionType=='string'){//do we have any position adjustments ?
if(positionType.indexOf(":")!=-1){shift1=positionType.substring(positionType.indexOf(":")+1);positionType=positionType.substring(0,positionType.indexOf(":"));//if any advanced positioning will be needed (percents or something else) - parser should be added here
//for now we use simple parseInt()
//do we have second parameter?
if(shift1.indexOf(",")!=-1){shift2=shift1.substring(shift1.indexOf(",")+1);shift1=shift1.substring(0,shift1.indexOf(","));shiftY=parseInt(shift2);if(isNaN(shiftY))shiftY=0;};shiftX=parseInt(shift1);if(isNaN(shift1))shift1=0;};};switch(positionType){default:case"topRight":promptleftPosition+=fieldLeft+fieldWidth-30;promptTopPosition+=fieldTop;break;case"topLeft":promptTopPosition+=fieldTop;promptleftPosition+=fieldLeft;break;case"centerRight":promptTopPosition=fieldTop+4;marginTopSize=0;promptleftPosition=fieldLeft+field.outerWidth(true)+5;break;case"centerLeft":promptleftPosition=fieldLeft-(promptElmt.width()+2);promptTopPosition=fieldTop+4;marginTopSize=0;break;case"bottomLeft":promptTopPosition=fieldTop+field.height()+5;marginTopSize=0;promptleftPosition=fieldLeft;break;case"bottomRight":promptleftPosition=fieldLeft+fieldWidth-30;promptTopPosition=fieldTop+field.height()+5;marginTopSize=0;break;case"inline":promptleftPosition=0;promptTopPosition=0;marginTopSize=0;};//apply adjusments if any
promptleftPosition+=shiftX;promptTopPosition+=shiftY;return{"callerTopPosition":promptTopPosition+"px","callerleftPosition":promptleftPosition+"px","marginTopSize":marginTopSize+"px"};},/**
         * Saves the user options and variables in the form.data
         *
         * @param {jqObject}
         *            form - the form where the user option should be saved
         * @param {Map}
         *            options - the user options
         * @return the user options (extended from the defaults)
         */_saveOptions:function(form,options){// is there a language localisation ?
if($.validationEngineLanguage)var allRules=$.validationEngineLanguage.allRules;else $.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");// --- Internals DO NOT TOUCH or OVERLOAD ---
// validation rules and i18
$.validationEngine.defaults.allrules=allRules;var userOptions=$.extend(true,{},$.validationEngine.defaults,options);form.data('jqv',userOptions);return userOptions;},/**
         * Removes forbidden characters from class name
         * @param {String} className
         */_getClassName:function(className){if(className)return className.replace(/:/g,"_").replace(/\./g,"_");},/**
         * Escape special character for jQuery selector
         * http://totaldev.com/content/escaping-characters-get-valid-jquery-id
         * @param {String} selector
         */_jqSelector:function(str){return str.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,'\\$1');},/**
         * Conditionally required field
         *
         * @param {jqObject} field
         * @param {Array[String]} rules
         * @param {int} i rules index
         * @param {Map}
         * user options
         * @return an error string if validation failed
         */_condRequired:function(field,rules,i,options){var idx,dependingField;for(idx=i+1;idx<rules.length;idx++){dependingField=jQuery("#"+rules[idx]).first();/* Use _required for determining wether dependingField has a value.
                 * There is logic there for handling all field types, and default value; so we won't replicate that here
                 * Indicate this special use by setting the last parameter to true so we only validate the dependingField on chackboxes and radio buttons (#462)
                 */if(dependingField.length&&methods._required(dependingField,["required"],0,options,true)==undefined){/* We now know any of the depending fields has a value,
                     * so we can validate this field as per normal required code
                     */return methods._required(field,["required"],0,options);}}},_submitButtonClick:function(event){var button=$(this);var form=button.closest('form, .validationEngineContainer');form.data("jqv_submitButton",button.attr("id"));}};/**
     * Plugin entry point.
     * You may pass an action as a parameter or a list of options.
     * if none, the init and attach methods are being called.
     * Remember: if you pass options, the attached method is NOT called automatically
     *
     * @param {String}
     *            method (optional) action
     */$.fn.validationEngine=function(method){var form=$(this);if(!form[0])return form;// stop here if the form does not exist
if(typeof method=='string'&&method.charAt(0)!='_'&&methods[method]){// make sure init is called once
if(method!="showPrompt"&&method!="hide"&&method!="hideAll")methods.init.apply(form);return methods[method].apply(form,Array.prototype.slice.call(arguments,1));}else if(typeof method=='object'||!method){// default constructor with or without arguments
methods.init.apply(form,arguments);return methods.attach.apply(form);}else{$.error('Method '+method+' does not exist in jQuery.validationEngine');}};// LEAK GLOBAL OPTIONS
$.validationEngine={fieldIdCounter:0,defaults:{// Name of the event triggering field validation
validationEventTrigger:"blur",// Automatically scroll viewport to the first error
scroll:true,// Focus on the first input
focusFirstField:true,// Show prompts, set to false to disable prompts
showPrompts:true,// Should we attempt to validate non-visible input fields contained in the form? (Useful in cases of tabbed containers, e.g. jQuery-UI tabs)
validateNonVisibleFields:false,// Opening box position, possible locations are: topLeft,
// topRight, bottomLeft, centerRight, bottomRight, inline
// inline gets inserted after the validated field or into an element specified in data-prompt-target
promptPosition:"topRight",bindMethod:"bind",// internal, automatically set to true when it parse a _ajax rule
inlineAjax:false,// if set to true, the form data is sent asynchronously via ajax to the form.action url (get)
ajaxFormValidation:false,// The url to send the submit ajax validation (default to action)
ajaxFormValidationURL:false,// HTTP method used for ajax validation
ajaxFormValidationMethod:'get',// Ajax form validation callback method: boolean onComplete(form, status, errors, options)
// retuns false if the form.submit event needs to be canceled.
onAjaxFormComplete:$.noop,// called right before the ajax call, may return false to cancel
onBeforeAjaxFormValidation:$.noop,// Stops form from submitting and execute function assiciated with it
onValidationComplete:false,// Used when you have a form fields too close and the errors messages are on top of other disturbing viewing messages
doNotShowAllErrosOnSubmit:false,// Object where you store custom messages to override the default error messages
custom_error_messages:{},// true if you want to vind the input fields
binded:true,// set to true, when the prompt arrow needs to be displayed
showArrow:true,// did one of the validation fail ? kept global to stop further ajax validations
isError:false,// Limit how many displayed errors a field can have
maxErrorsPerField:false,// Caches field validation status, typically only bad status are created.
// the array is used during ajax form validation to detect issues early and prevent an expensive submit
ajaxValidCache:{},// Auto update prompt position after window resize
autoPositionUpdate:false,InvalidFields:[],onFieldSuccess:false,onFieldFailure:false,onSuccess:false,onFailure:false,validateAttribute:"class",addSuccessCssClassToField:"",addFailureCssClassToField:"",// Auto-hide prompt
autoHidePrompt:false,// Delay before auto-hide
autoHideDelay:10000,// Fade out duration while hiding the validations
fadeDuration:0.3,// Use Prettify select library
prettySelect:false,// Add css class on prompt
addPromptClass:"",// Custom ID uses prefix
usePrefix:"",// Custom ID uses suffix
useSuffix:"",// Only show one message per error prompt
showOneMessage:false}};/**************************************************************
     * Modifications begin here!
     */var tooltipSettings={hook:'rightmiddle',hideOn:false,skin:'cloud',hideOthers:false};methods._buildPrompt=function(field,promptText,type,ajaxed,options){field.data("promptText",promptText);Tipped.create(field[0],promptText,tooltipSettings);Tipped.show(field[0]);};methods._closePrompt=function(field){field.data("promptText","");Tipped.remove(field[0]);};methods._updatePrompt=function(field,prompt,promptText,type,ajaxed,options,noAnimation){if(field.data("promptText")!=promptText){methods._closePrompt(field);methods._buildPrompt(field,promptText);}};methods._getPrompt=function(field){return Tipped.get(field[0]);};/**************************************************************
     * End of Modifications
     */$(function(){$.validationEngine.defaults.promptPosition=methods.isRTL()?'topLeft':"topRight";});})(jQuery);// jQuery WipeTouch 1.2.0
// ------------------------------------------------------------------------
//
// Developed and maintained by Igor Ramadas
// http://aboutigor.com
// http://devv.com
//
// USAGE
// ------------------------------------------------------------------------
//
// $(selector).wipetouch(config);
//
// The wipe events should expect the result object with the following properties:
// speed - the wipe speed from 1 to 5
// x - how many pixels moved on the horizontal axis
// y - how many pixels moved on the vertical axis
// source - the element which triggered the wipe gesture
//
// EXAMPLE
//		$(document).wipetouch({
//			allowDiagonal: true,
//			wipeLeft: function(result) { alert("Left on speed " + result.speed) },
//			wipeTopLeft: function(result) { alert("Top left on speed " + result.speed) },
//			wipeBottomLeft: function(result) { alert("Bottom left on speed " + result.speed) }
//		});
//
//
// More details at http://wipetouch.codeplex.com/
//
// CHANGE LOG
// ------------------------------------------------------------------------
// 1.2.0
// - New: wipeMove event, triggered while moving the mouse/finger.
// - New: added "source" to the result object.
// - Bug fix: sometimes vertical wipe events would not trigger correctly.
// - Bug fix: improved tapToClick handler.
// - General code refactoring.
// - Windows Phone 7 is not supported, yet! Its behaviour is completely broken and would require some special tricks to make it work. Maybe in the future...
//
// 1.1.0
// - New: tapToClick, if true will identify taps and and trigger a click on the touched element. Default is false.
// - Changed: events wipeBottom*** and wipeTop*** renamed to wipeDown*** and wipeUp***.
// - Changed: better touch speed calculation (was always too fast before).
// - Changed: speed will be an integer now (instead of float).
// - Changed: better wipe detection (if Y movement is more than X, do a vertical wipe instead of horizontal).
// - Bug fix: added preventDefault to touchStart and touchEnd internal events (this was missing).
// - Other general tweaks to the code.
//
// The minified version of WipeTouch can be generated using Jasc: http://jasc.codeplex.com
(function($){$.fn.wipetouch=function(settings){// ------------------------------------------------------------------------
// PLUGIN SETTINGS
// ------------------------------------------------------------------------
var config={// Variables and options
moveX:40,// minimum amount of horizontal pixels to trigger a wipe event
moveY:40,// minimum amount of vertical pixels to trigger a wipe event
tapToClick:false,// if user taps the screen it will fire a click event on the touched element
preventDefault:true,// if true, prevents default events (click for example)
allowDiagonal:false,// if false, will trigger horizontal and vertical movements so wipeUpLeft, wipeDownLeft, wipeUpRight, wipeDownRight are ignored,
preventDefaultWhenTriggering:true,// Wipe events
wipeLeft:false,// called on wipe left gesture
wipeRight:false,// called on wipe right gesture
wipeUp:false,// called on wipe up gesture
wipeDown:false,// called on wipe down gesture
wipeUpLeft:false,// called on wipe top and left gesture
wipeDownLeft:false,// called on wipe bottom and left gesture
wipeUpRight:false,// called on wipe top and right gesture
wipeDownRight:false,// called on wipe bottom and right gesture
wipeMove:false,// triggered whenever touchMove acts
// DEPRECATED EVENTS
wipeTopLeft:false,// USE WIPEUPLEFT
wipeBottomLeft:false,// USE WIPEDOWNLEFT
wipeTopRight:false,// USE WIPEUPRIGHT
wipeBottomRight:false// USE WIPEDOWNRIGHT
};if(settings){$.extend(config,settings);}this.each(function(){// ------------------------------------------------------------------------
// INTERNAL VARIABLES
// ------------------------------------------------------------------------
var startX;// where touch has started, left
var startY;// where touch has started, top
var startDate=false;// used to calculate timing and aprox. acceleration
var curX;// keeps touch X position while moving on the screen
var curY;// keeps touch Y position while moving on the screen
var isMoving=false;// is user touching and moving?
var touchedElement=false;// element which user has touched
// These are for non-touch devices!
var useMouseEvents=false;// force using the mouse events to simulate touch
var clickEvent=false;// holds the click event of the target, when used hasn't clicked
// ------------------------------------------------------------------------
// TOUCH EVENTS
// ------------------------------------------------------------------------
// Called when user touches the screen.
function onTouchStart(e){resetTouch();var start=useMouseEvents||e.originalEvent.touches&&e.originalEvent.touches.length>0;if(!isMoving&&start){if(config.preventDefault){e.preventDefault();}// Temporary fix for deprecated events, these will be removed on next version!
if(config.allowDiagonal){if(!config.wipeDownLeft){config.wipeDownLeft=config.wipeBottomLeft;}if(!config.wipeDownRight){config.wipeDownRight=config.wipeBottomRight;}if(!config.wipeUpLeft){config.wipeUpLeft=config.wipeTopLeft;}if(!config.wipeUpRight){config.wipeUpRight=config.wipeTopRight;}}// When touch events are not present, use mouse events.
if(useMouseEvents){startX=e.pageX;startY=e.pageY;$(this).bind("mousemove",onTouchMove);$(this).one("mouseup",onTouchEnd);}else{startX=e.originalEvent.touches[0].pageX;startY=e.originalEvent.touches[0].pageY;$(this).bind("touchmove",onTouchMove);}// Set the start date and current X/Y.
startDate=new Date().getTime();curX=startX;curY=startY;isMoving=true;touchedElement=$(e.target);}}// Called when user untouches the screen.
function onTouchEnd(e){if(config.preventDefault){e.preventDefault();}// When touch events are not present, use mouse events.
if(useMouseEvents){$(this).unbind("mousemove",onTouchMove);}else{$(this).unbind("touchmove",onTouchMove);}// If is moving then calculate the touch results, otherwise reset it.
if(isMoving){touchCalculate(e);}else{resetTouch();}}// Called when user is touching and moving on the screen.
function onTouchMove(e){if(config.preventDefault){e.preventDefault();}if(useMouseEvents&&!isMoving){onTouchStart(e);}if(isMoving){if(useMouseEvents){curX=e.pageX;curY=e.pageY;}else{curX=e.originalEvent.touches[0].pageX;curY=e.originalEvent.touches[0].pageY;}// If there's a wipeMove event, call it passing
// current X and Y position (curX and curY).
if(config.wipeMove){triggerEvent(config.wipeMove,{curX:curX,curY:curY});}}}// ------------------------------------------------------------------------
// CALCULATE TOUCH AND TRIGGER
// ------------------------------------------------------------------------
function touchCalculate(e){var endDate=new Date().getTime();// current date to calculate timing
var ms=startDate-endDate;// duration of touch in milliseconds
var x=curX;// current left position
var y=curY;// current top position
var dx=x-startX;// diff of current left to starting left
var dy=y-startY;// diff of current top to starting top
var ax=Math.abs(dx);// amount of horizontal movement
var ay=Math.abs(dy);// amount of vertical movement
// If moved less than 15 pixels, touch duration is less than 100ms,
// and tapToClick is true then trigger a click event and stop processing.
if(ax<15&&ay<15&&ms<100){clickEvent=false;if(config.preventDefault){resetTouch();touchedElement.trigger("click");return;}}// When touch events are not present, use mouse events.
else if(useMouseEvents){var evts=touchedElement.data("events");if(evts){// Save click event to the temp clickEvent variable.
var clicks=evts.click;if(clicks&&clicks.length>0){$.each(clicks,function(i,f){clickEvent=f;return;});touchedElement.unbind("click");}}}// Is it moving to the right or left, top or bottom?
var toright=dx>0;var tobottom=dy>0;// Calculate speed from 1 to 5, 1 being slower and 5 faster.
var s=(ax+ay)*60/(ms/6*ms);if(s<1)s=1;if(s>5)s=5;var result={speed:parseInt(s),x:ax,y:ay,source:touchedElement};if(ax>=config.moveX){// Check if it's allowed and trigger diagonal wipe events.
if(config.allowDiagonal&&ay>=config.moveY){if(toright&&tobottom){triggerEvent(config.wipeDownRight,result,e);}else if(toright&&!tobottom){triggerEvent(config.wipeUpRight,result,e);}else if(!toright&&tobottom){triggerEvent(config.wipeDownLeft,result,e);}else{triggerEvent(config.wipeUpLeft,result,e);}}// Otherwise trigger horizontal events if X > Y.
else if(ax>=ay){if(toright){triggerEvent(config.wipeRight,result,e);}else{triggerEvent(config.wipeLeft,result,e);}}}// If Y > X and no diagonal, trigger vertical events.
else if(ay>=config.moveY&&ay>ax){if(tobottom){triggerEvent(config.wipeDown,result,e);}else{triggerEvent(config.wipeUp,result,e);}}resetTouch();}// Resets the cached variables.
function resetTouch(){startX=false;startY=false;startDate=false;isMoving=false;// If there's a click event, bind after a few miliseconds.
if(clickEvent){window.setTimeout(function(){touchedElement.bind("click",clickEvent);clickEvent=false;},50);}}// Trigger a wipe event passing a result object with
// speed from 1 to 5, x / y movement amount in pixels,
// and the source element.
function triggerEvent(wipeEvent,result,e){if(wipeEvent){if(config.preventDefaultWhenTriggering){e.preventDefault();}wipeEvent(result);}}// ------------------------------------------------------------------------
// ADD TOUCHSTART AND TOUCHEND EVENT LISTENERS
// ------------------------------------------------------------------------
if("ontouchstart"in document.documentElement){$(this).bind("touchstart",onTouchStart);$(this).bind("touchend",onTouchEnd);}else{useMouseEvents=true;$(this).bind("mousedown",onTouchStart);$(this).bind("mouseout mouseup",onTouchEnd);}});return this;};})(jQuery);/* == malihu jquery custom scrollbar plugin == Version: 3.1.5, License: MIT License (MIT) */!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e:e(jQuery,window,document);}(function(e){!function(t){var o="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports,n="https:"==document.location.protocol?"https:":"http:",i="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";o||(a?require("jquery-mousewheel")(e):e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//"+i+"%3E%3C/script%3E"))),t();}(function(){var t,o="mCustomScrollbar",a="mCS",n=".mCustomScrollbar",i={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},r=0,l={},s=window.attachEvent&&!window.addEventListener?1:0,c=!1,d=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(t){var t=e.extend(!0,{},i,t),o=f.call(this);if(t.live){var s=t.liveSelector||this.selector||n,c=e(s);if("off"===t.live)return void m(s);l[s]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&m(s);},500);}else m(s);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":p(t.axis),t.scrollInertia=t.scrollInertia>0&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=g(t.scrollButtons.scrollType),h(t),e(o).each(function(){var o=e(this);if(!o.data(a)){o.data(a,{idx:++r,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:o.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var n=o.data(a),i=n.opt,l=o.data("mcs-axis"),s=o.data("mcs-scrollbar-position"),c=o.data("mcs-theme");l&&(i.axis=l),s&&(i.scrollbarPosition=s),c&&(i.theme=c,h(i)),v.call(this),n&&i.callbacks.onCreate&&"function"==typeof i.callbacks.onCreate&&i.callbacks.onCreate.call(this),e("#mCSB_"+n.idx+"_container img:not(."+d[2]+")").addClass(d[2]),u.update.call(null,o);}});},update:function(t,o){var n=t||f.call(this);return e(n).each(function(){var t=e(this);if(t.data(a)){var n=t.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container"),l=e("#mCSB_"+n.idx),s=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];if(!r.length)return;n.tweenRunning&&Q(t),o&&n&&i.callbacks.onBeforeUpdate&&"function"==typeof i.callbacks.onBeforeUpdate&&i.callbacks.onBeforeUpdate.call(this),t.hasClass(d[3])&&t.removeClass(d[3]),t.hasClass(d[4])&&t.removeClass(d[4]),l.css("max-height","none"),l.height()!==t.height()&&l.css("max-height",t.height()),_.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",x(r)),n.overflowed=y.call(this),M.call(this),i.autoDraggerLength&&S.call(this),b.call(this),T.call(this);var c=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(n.overflowed[0]?s[0].height()>s[0].parent().height()?B.call(this):(G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(B.call(this),"y"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[1]&&G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(n.overflowed[1]?s[1].width()>s[1].parent().width()?B.call(this):(G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(B.call(this),"x"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[0]&&G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),o&&n&&(2===o&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===o&&i.callbacks.onSelectorChange&&"function"==typeof i.callbacks.onSelectorChange?i.callbacks.onSelectorChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),N.call(this);}});},scrollTo:function(t,o){if("undefined"!=typeof t&&null!=t){var n=f.call(this);return e(n).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,o),c=Y.call(this,t),d=s.scrollInertia>0&&s.scrollInertia<17?17:s.scrollInertia;c[0]=X.call(this,c[0],"y"),c[1]=X.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=ne()?0:d,setTimeout(function(){null!==c[0]&&"undefined"!=typeof c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",G(n,c[0].toString(),s)),null!==c[1]&&"undefined"!=typeof c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",G(n,c[1].toString(),s));},s.timeout);}});}},stop:function(){var t=f.call(this);return e(t).each(function(){var t=e(this);t.data(a)&&Q(t);});},disable:function(t){var o=f.call(this);return e(o).each(function(){var o=e(this);if(o.data(a)){o.data(a);N.call(this,"remove"),k.call(this),t&&B.call(this),M.call(this,!0),o.addClass(d[3]);}});},destroy:function(){var t=f.call(this);return e(t).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&m(r.liveSelector||e(t).selector),N.call(this,"remove"),k.call(this),B.call(this),n.removeData(a),$(this,"mcs"),c.remove(),s.find("img."+d[2]).removeClass(d[2]),l.replaceWith(s.contents()),n.removeClass(o+" _"+a+"_"+i.idx+" "+d[6]+" "+d[7]+" "+d[5]+" "+d[3]).addClass(d[4]);}});}},f=function(){return"object"!=typeof e(this)||e(this).length<1?n:this;},h=function(t){var o=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],a=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],i=["minimal","minimal-dark"],r=["minimal","minimal-dark"];t.autoDraggerLength=e.inArray(t.theme,o)>-1?!1:t.autoDraggerLength,t.autoExpandScrollbar=e.inArray(t.theme,a)>-1?!1:t.autoExpandScrollbar,t.scrollButtons.enable=e.inArray(t.theme,n)>-1?!1:t.scrollButtons.enable,t.autoHideScrollbar=e.inArray(t.theme,i)>-1?!0:t.autoHideScrollbar,t.scrollbarPosition=e.inArray(t.theme,r)>-1?"outside":t.scrollbarPosition;},m=function(e){l[e]&&(clearTimeout(l[e]),$(l,e));},p=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y";},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless";},v=function(){var t=e(this),n=t.data(a),i=n.opt,r=i.autoExpandScrollbar?" "+d[1]+"_expand":"",l=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],u="yx"===i.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+d[6]:"",h="x"!==i.axis&&"rtl"===n.langDir?" "+d[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===n.langDir?"989999px":i.setLeft,t.addClass(o+" _"+a+"_"+n.idx+f+h).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir='"+n.langDir+"' /></div>");var m=e("#mCSB_"+n.idx),p=e("#mCSB_"+n.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",x(p)),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(u)),w.call(this);var g=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width());},x=function(t){var o=[t[0].scrollWidth,Math.max.apply(Math,t.children().map(function(){return e(this).outerWidth(!0);}).get())],a=t.parent().width();return o[0]>a?o[0]:o[1]>a?o[1]:"100%";},_=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx+"_container");if(n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis){i.css({width:"auto","min-width":0,"overflow-x":"scroll"});var r=Math.ceil(i[0].scrollWidth);3===n.advanced.autoExpandHorizontalScroll||2!==n.advanced.autoExpandHorizontalScroll&&r>i.parent().width()?i.css({width:r,"min-width":"100%","overflow-x":"inherit"}):i.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap();}},w=function(){var t=e(this),o=t.data(a),n=o.opt,i=e(".mCSB_"+o.idx+"_scrollbar:first"),r=oe(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+d[13]+"' "+r+" />","<a href='#' class='"+d[14]+"' "+r+" />","<a href='#' class='"+d[15]+"' "+r+" />","<a href='#' class='"+d[16]+"' "+r+" />"],s=["x"===n.axis?l[2]:l[0],"x"===n.axis?l[3]:l[1],l[2],l[3]];n.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3]);},S=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[n.height()/i.outerHeight(!1),n.width()/i.outerWidth(!1)],c=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=s&&c[1]<c[0]?c[0]:c[1],u=s&&c[3]<c[2]?c[2]:c[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":c[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10});},b=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-n.height(),i.outerWidth(!1)-n.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];o.scrollRatio={y:s[0],x:s[1]};},C=function(e,t,o){var a=o?d[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(d[0]+" "+a),n.toggleClass(d[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(d[0]),n.removeClass(d[1])):(e.addClass(d[0]),n.addClass(d[1])));},y=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=null==o.overflowed?i.height():i.outerHeight(!1),l=null==o.overflowed?i.width():i.outerWidth(!1),s=i[0].scrollHeight,c=i[0].scrollWidth;return s>r&&(r=s),c>l&&(l=c),[r>n.height(),l>n.width()];},B=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx),r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(Q(t),("x"!==n.axis&&!o.overflowed[0]||"y"===n.axis&&o.overflowed[0])&&(l[0].add(r).css("top",0),G(t,"_resetY")),"y"!==n.axis&&!o.overflowed[1]||"x"===n.axis&&o.overflowed[1]){var s=dx=0;"rtl"===o.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/o.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),G(t,"_resetX");}},T=function(){function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(o[0])):t();},100);}var o=e(this),n=o.data(a),i=n.opt;if(!n.bindEvents){if(I.call(this),i.contentTouchScroll&&D.call(this),E.call(this),i.mouseWheel.enable){var r;t();}P.call(this),U.call(this),i.advanced.autoScrollOnFocus&&H.call(this),i.scrollButtons.enable&&F.call(this),i.keyboard.enable&&q.call(this),n.bindEvents=!0;}},k=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=".mCSB_"+o.idx+"_scrollbar",l=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+r+" ."+d[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+r+">a"),s=e("#mCSB_"+o.idx+"_container");n.advanced.releaseDraggableSelectors&&l.add(e(n.advanced.releaseDraggableSelectors)),n.advanced.extraDraggableSelectors&&l.add(e(n.advanced.extraDraggableSelectors)),o.bindEvents&&(e(document).add(e(!A()||top.document)).unbind("."+i),l.each(function(){e(this).unbind("."+i);}),clearTimeout(t[0]._focusTimeout),$(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),$(o.sequential,"step"),clearTimeout(s[0].onCompleteTimeout),$(s[0],"onCompleteTimeout"),o.bindEvents=!1);},M=function(t){var o=e(this),n=o.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+n.idx+"_container"),s=[e("#mCSB_"+n.idx+"_scrollbar_vertical"),e("#mCSB_"+n.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(n.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(d[8]+" "+d[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].css("display","none"),l.removeClass(d[10])):(s[0].css("display","none"),l.addClass(d[10])),l.addClass(d[8]))),"y"!==i.axis&&(n.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(d[9]+" "+d[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].css("display","none"),l.removeClass(d[11])):(s[1].css("display","none"),l.addClass(d[11])),l.addClass(d[9]))),n.overflowed[0]||n.overflowed[1]?o.removeClass(d[5]):o.addClass(d[5]);},O=function(t){var o=t.type,a=t.target.ownerDocument!==document&&null!==frameElement?[e(frameElement).offset().top,e(frameElement).offset().left]:null,n=A()&&t.target.ownerDocument!==top.document&&null!==frameElement?[e(t.view.frameElement).offset().top,e(t.view.frameElement).offset().left]:[0,0];switch(o){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return a?[t.originalEvent.pageY-a[0]+n[0],t.originalEvent.pageX-a[1]+n[1],!1]:[t.originalEvent.pageY,t.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],r=t.originalEvent.touches.length||t.originalEvent.changedTouches.length;return t.target.ownerDocument!==document?[i.screenY,i.screenX,r>1]:[i.pageY,i.pageX,r>1];default:return a?[t.pageY-a[0]+n[0],t.pageX-a[1]+n[1],!1]:[t.pageY,t.pageX,!1];}},I=function(){function t(e,t,a,n){if(h[0].idleTimer=d.scrollInertia<233?250:0,o.attr("id")===f[1])var i="x",s=(o[0].offsetLeft-t+n)*l.scrollRatio.x;else var i="y",s=(o[0].offsetTop-e+a)*l.scrollRatio.y;G(r,s.toString(),{dir:i,drag:!0});}var o,n,i,r=e(this),l=r.data(a),d=l.opt,u=a+"_"+l.idx,f=["mCSB_"+l.idx+"_dragger_vertical","mCSB_"+l.idx+"_dragger_horizontal"],h=e("#mCSB_"+l.idx+"_container"),m=e("#"+f[0]+",#"+f[1]),p=d.advanced.releaseDraggableSelectors?m.add(e(d.advanced.releaseDraggableSelectors)):m,g=d.advanced.extraDraggableSelectors?e(!A()||top.document).add(e(d.advanced.extraDraggableSelectors)):e(!A()||top.document);m.bind("contextmenu."+u,function(e){e.preventDefault();}).bind("mousedown."+u+" touchstart."+u+" pointerdown."+u+" MSPointerDown."+u,function(t){if(t.stopImmediatePropagation(),t.preventDefault(),ee(t)){c=!0,s&&(document.onselectstart=function(){return!1;}),L.call(h,!1),Q(r),o=e(this);var a=o.offset(),l=O(t)[0]-a.top,u=O(t)[1]-a.left,f=o.height()+a.top,m=o.width()+a.left;f>l&&l>0&&m>u&&u>0&&(n=l,i=u),C(o,"active",d.autoExpandScrollbar);}}).bind("touchmove."+u,function(e){e.stopImmediatePropagation(),e.preventDefault();var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;t(n,i,r,l);}),e(document).add(g).bind("mousemove."+u+" pointermove."+u+" MSPointerMove."+u,function(e){if(o){var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;if(n===r&&i===l)return;t(n,i,r,l);}}).add(p).bind("mouseup."+u+" touchend."+u+" pointerup."+u+" MSPointerUp."+u,function(){o&&(C(o,"active",d.autoExpandScrollbar),o=null),c=!1,s&&(document.onselectstart=null),L.call(h,!0);});},D=function(){function o(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,b=0,C=0,d=1,y.removeClass("mCS_touch_action");var o=I.offset();u=O(e)[0]-o.top,f=O(e)[1]-o.left,z=[O(e)[0],O(e)[1]];}function n(e){if(te(e)&&!c&&!O(e)[2]&&(T.documentTouchScroll||e.preventDefault(),e.stopImmediatePropagation(),(!C||b)&&d)){g=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left,n="mcsLinearOut";if(E.push(o),W.push(a),z[2]=Math.abs(O(e)[0]-z[0]),z[3]=Math.abs(O(e)[1]-z[1]),B.overflowed[0])var i=D[0].parent().height()-D[0].height(),r=u-o>0&&o-u>-(i*B.scrollRatio.y)&&(2*z[3]<z[2]||"yx"===T.axis);if(B.overflowed[1])var l=D[1].parent().width()-D[1].width(),h=f-a>0&&a-f>-(l*B.scrollRatio.x)&&(2*z[2]<z[3]||"yx"===T.axis);r||h?(U||e.preventDefault(),b=1):(C=1,y.addClass("mCS_touch_action")),U&&e.preventDefault(),w="yx"===T.axis?[u-o,f-a]:"x"===T.axis?[null,f-a]:[u-o,null],I[0].idleTimer=250,B.overflowed[0]&&s(w[0],R,n,"y","all",!0),B.overflowed[1]&&s(w[1],R,n,"x",L,!0);}}function i(e){if(!te(e)||c||O(e)[2])return void(t=0);t=1,e.stopImmediatePropagation(),Q(y),p=K();var o=M.offset();h=O(e)[0]-o.top,m=O(e)[1]-o.left,E=[],W=[];}function r(e){if(te(e)&&!c&&!O(e)[2]){d=0,e.stopImmediatePropagation(),b=0,C=0,v=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left;if(!(v-g>30)){_=1e3/(v-p);var n="mcsEaseOut",i=2.5>_,r=i?[E[E.length-2],W[W.length-2]]:[0,0];x=i?[o-r[0],a-r[1]]:[o-h,a-m];var u=[Math.abs(x[0]),Math.abs(x[1])];_=i?[Math.abs(x[0]/4),Math.abs(x[1]/4)]:[_,_];var f=[Math.abs(I[0].offsetTop)-x[0]*l(u[0]/_[0],_[0]),Math.abs(I[0].offsetLeft)-x[1]*l(u[1]/_[1],_[1])];w="yx"===T.axis?[f[0],f[1]]:"x"===T.axis?[null,f[1]]:[f[0],null],S=[4*u[0]+T.scrollInertia,4*u[1]+T.scrollInertia];var y=parseInt(T.contentTouchScroll)||0;w[0]=u[0]>y?w[0]:0,w[1]=u[1]>y?w[1]:0,B.overflowed[0]&&s(w[0],S[0],n,"y",L,!1),B.overflowed[1]&&s(w[1],S[1],n,"x",L,!1);}}}function l(e,t){var o=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?o[0]:o[3]:e>60?t>3?o[3]:o[2]:e>30?t>8?o[1]:t>6?o[0]:t>4?t:o[2]:t>8?t:o[3];}function s(e,t,o,a,n,i){e&&G(y,e.toString(),{dur:t,scrollEasing:o,dir:a,overwrite:n,drag:i});}var d,u,f,h,m,p,g,v,x,_,w,S,b,C,y=e(this),B=y.data(a),T=B.opt,k=a+"_"+B.idx,M=e("#mCSB_"+B.idx),I=e("#mCSB_"+B.idx+"_container"),D=[e("#mCSB_"+B.idx+"_dragger_vertical"),e("#mCSB_"+B.idx+"_dragger_horizontal")],E=[],W=[],R=0,L="yx"===T.axis?"none":"all",z=[],P=I.find("iframe"),H=["touchstart."+k+" pointerdown."+k+" MSPointerDown."+k,"touchmove."+k+" pointermove."+k+" MSPointerMove."+k,"touchend."+k+" pointerup."+k+" MSPointerUp."+k],U=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;I.bind(H[0],function(e){o(e);}).bind(H[1],function(e){n(e);}),M.bind(H[0],function(e){i(e);}).bind(H[2],function(e){r(e);}),P.length&&P.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(H[0],function(e){o(e),i(e);}).bind(H[1],function(e){n(e);}).bind(H[2],function(e){r(e);});});});},E=function(){function o(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0;}function n(e,t,o){d.type=o&&i?"stepped":"stepless",d.scrollAmount=10,j(r,e,t,"mcsLinearOut",o?60:null);}var i,r=e(this),l=r.data(a),s=l.opt,d=l.sequential,u=a+"_"+l.idx,f=e("#mCSB_"+l.idx+"_container"),h=f.parent();f.bind("mousedown."+u,function(){t||i||(i=1,c=!0);}).add(document).bind("mousemove."+u,function(e){if(!t&&i&&o()){var a=f.offset(),r=O(e)[0]-a.top+f[0].offsetTop,c=O(e)[1]-a.left+f[0].offsetLeft;r>0&&r<h.height()&&c>0&&c<h.width()?d.step&&n("off",null,"stepped"):("x"!==s.axis&&l.overflowed[0]&&(0>r?n("on",38):r>h.height()&&n("on",40)),"y"!==s.axis&&l.overflowed[1]&&(0>c?n("on",37):c>h.width()&&n("on",39)));}}).bind("mouseup."+u+" dragend."+u,function(){t||(i&&(i=0,n("off",null)),c=!1);});},W=function(){function t(t,a){if(Q(o),!z(o,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):s&&t.deltaFactor<100?100:t.deltaFactor||100,d=i.scrollInertia;if("x"===i.axis||"x"===i.mouseWheel.axis)var u="x",f=[Math.round(r*n.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.width()?.9*l.width():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetLeft),p=c[1][0].offsetLeft,g=c[1].parent().width()-c[1].width(),v="y"===i.mouseWheel.axis?t.deltaY||a:t.deltaX;else var u="y",f=[Math.round(r*n.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.height()?.9*l.height():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetTop),p=c[0][0].offsetTop,g=c[0].parent().height()-c[0].height(),v=t.deltaY||a;"y"===u&&!n.overflowed[0]||"x"===u&&!n.overflowed[1]||((i.mouseWheel.invert||t.webkitDirectionInvertedFromDevice)&&(v=-v),i.mouseWheel.normalizeDelta&&(v=0>v?-1:1),(v>0&&0!==p||0>v&&p!==g||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),t.deltaFactor<5&&!i.mouseWheel.normalizeDelta&&(h=t.deltaFactor,d=17),G(o,(m-v*h).toString(),{dir:u,dur:d}));}}if(e(this).data(a)){var o=e(this),n=o.data(a),i=n.opt,r=a+"_"+n.idx,l=e("#mCSB_"+n.idx),c=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")],d=e("#mCSB_"+n.idx+"_container").find("iframe");d.length&&d.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind("mousewheel."+r,function(e,o){t(e,o);});});}),l.bind("mousewheel."+r,function(e,o){t(e,o);});}},R=new Object(),A=function(t){var o=!1,a=!1,n=null;if(void 0===t?a="#empty":void 0!==e(t).attr("id")&&(a=e(t).attr("id")),a!==!1&&void 0!==R[a])return R[a];if(t){try{var i=t.contentDocument||t.contentWindow.document;n=i.body.innerHTML;}catch(r){}o=null!==n;}else{try{var i=top.document;n=i.body.innerHTML;}catch(r){}o=null!==n;}return a!==!1&&(R[a]=o),o;},L=function(e){var t=this.find("iframe");if(t.length){var o=e?"auto":"none";t.css("pointer-events",o);}},z=function(t,o){var n=o.nodeName.toLowerCase(),i=t.data(a).opt.mouseWheel.disableOver,r=["select","textarea"];return e.inArray(n,i)>-1&&!(e.inArray(n,r)>-1&&!e(o).is(":focus"));},P=function(){var t,o=e(this),n=o.data(a),i=a+"_"+n.idx,r=e("#mCSB_"+n.idx+"_container"),l=r.parent(),s=e(".mCSB_"+n.idx+"_scrollbar ."+d[12]);s.bind("mousedown."+i+" touchstart."+i+" pointerdown."+i+" MSPointerDown."+i,function(o){c=!0,e(o.target).hasClass("mCSB_dragger")||(t=1);}).bind("touchend."+i+" pointerup."+i+" MSPointerUp."+i,function(){c=!1;}).bind("click."+i,function(a){if(t&&(t=0,e(a.target).hasClass(d[12])||e(a.target).hasClass("mCSB_draggerRail"))){Q(o);var i=e(this),s=i.find(".mCSB_dragger");if(i.parent(".mCSB_scrollTools_horizontal").length>0){if(!n.overflowed[1])return;var c="x",u=a.pageX>s.offset().left?-1:1,f=Math.abs(r[0].offsetLeft)-u*(.9*l.width());}else{if(!n.overflowed[0])return;var c="y",u=a.pageY>s.offset().top?-1:1,f=Math.abs(r[0].offsetTop)-u*(.9*l.height());}G(o,f.toString(),{dir:c,scrollEasing:"mcsEaseInOut"});}});},H=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=e("#mCSB_"+o.idx+"_container"),l=r.parent();r.bind("focusin."+i,function(){var o=e(document.activeElement),a=r.find(".mCustomScrollBox").length,i=0;o.is(n.advanced.autoScrollOnFocus)&&(Q(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=a?(i+17)*a:0,t[0]._focusTimeout=setTimeout(function(){var e=[ae(o)[0],ae(o)[1]],a=[r[0].offsetTop,r[0].offsetLeft],s=[a[0]+e[0]>=0&&a[0]+e[0]<l.height()-o.outerHeight(!1),a[1]+e[1]>=0&&a[0]+e[1]<l.width()-o.outerWidth(!1)],c="yx"!==n.axis||s[0]||s[1]?"all":"none";"x"===n.axis||s[0]||G(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i}),"y"===n.axis||s[1]||G(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i});},t[0]._focusTimer));});},U=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container").parent();i.bind("scroll."+n,function(){0===i.scrollTop()&&0===i.scrollLeft()||e(".mCSB_"+o.idx+"_scrollbar").css("visibility","hidden");});},F=function(){var t=e(this),o=t.data(a),n=o.opt,i=o.sequential,r=a+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e(l+">a");s.bind("contextmenu."+r,function(e){e.preventDefault();}).bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(a){function r(e,o){i.scrollAmount=n.scrollButtons.scrollAmount,j(t,e,o);}if(a.preventDefault(),ee(a)){var l=e(this).attr("class");switch(i.type=n.scrollButtons.scrollType,a.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;c=!0,o.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;c=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||o.tweenRunning)return;r("on",l);}}});},q=function(){function t(t){function a(e,t){r.type=i.keyboard.scrollType,r.scrollAmount=i.keyboard.scrollAmount,"stepped"===r.type&&n.tweenRunning||j(o,e,t);}switch(t.type){case"blur":n.tweenRunning&&r.dir&&a("off",null);break;case"keydown":case"keyup":var l=t.keyCode?t.keyCode:t.which,s="on";if("x"!==i.axis&&(38===l||40===l)||"y"!==i.axis&&(37===l||39===l)){if((38===l||40===l)&&!n.overflowed[0]||(37===l||39===l)&&!n.overflowed[1])return;"keyup"===t.type&&(s="off"),e(document.activeElement).is(u)||(t.preventDefault(),t.stopImmediatePropagation(),a(s,l));}else if(33===l||34===l){if((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type){Q(o);var f=34===l?-1:1;if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=Math.abs(c[0].offsetLeft)-f*(.9*d.width());else var h="y",m=Math.abs(c[0].offsetTop)-f*(.9*d.height());G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"});}}else if((35===l||36===l)&&!e(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)){if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=35===l?Math.abs(d.width()-c.outerWidth(!1)):0;else var h="y",m=35===l?Math.abs(d.height()-c.outerHeight(!1)):0;G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"});}}}var o=e(this),n=o.data(a),i=n.opt,r=n.sequential,l=a+"_"+n.idx,s=e("#mCSB_"+n.idx),c=e("#mCSB_"+n.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=c.find("iframe"),h=["blur."+l+" keydown."+l+" keyup."+l];f.length&&f.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(h[0],function(e){t(e);});});}),s.attr("tabindex","0").bind(h[0],function(e){t(e);});},j=function(t,o,n,i,r){function l(e){u.snapAmount&&(f.scrollAmount=u.snapAmount instanceof Array?"x"===f.dir[0]?u.snapAmount[1]:u.snapAmount[0]:u.snapAmount);var o="stepped"!==f.type,a=r?r:e?o?p/1.5:g:1e3/60,n=e?o?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],d=[c.scrollRatio.y>10?10:c.scrollRatio.y,c.scrollRatio.x>10?10:c.scrollRatio.x],m="x"===f.dir[0]?s[1]+f.dir[1]*(d[1]*n):s[0]+f.dir[1]*(d[0]*n),v="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),x="auto"!==f.scrollAmount?v:m,_=i?i:e?o?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",w=!!e;return e&&17>a&&(x="x"===f.dir[0]?s[1]:s[0]),G(t,x.toString(),{dir:f.dir[0],scrollEasing:_,dur:a,onComplete:w}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l();},a)));}function s(){clearTimeout(f.step),$(f,"step"),Q(t);}var c=t.data(a),u=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type,p=u.scrollInertia<26?26:u.scrollInertia,g=u.scrollInertia<1?17:u.scrollInertia;switch(o){case"on":if(f.dir=[n===d[16]||n===d[15]||39===n||37===n?"x":"y",n===d[13]||n===d[15]||38===n||37===n?-1:1],Q(t),oe(n)&&"stepped"===f.type)return;l(m);break;case"off":s(),(m||c.tweenRunning&&f.dir)&&l(!0);}},Y=function(t){var o=e(this).data(a).opt,n=[];return"function"==typeof t&&(t=t()),t instanceof Array?n=t.length>1?[t[0],t[1]]:"x"===o.axis?[null,t[0]]:[t[0],null]:(n[0]=t.y?t.y:t.x||"x"===o.axis?null:t,n[1]=t.x?t.x:t.y||"y"===o.axis?null:t),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n;},X=function(t,o){if(null!=t&&"undefined"!=typeof t){var n=e(this),i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;o||(o="x"===r.axis?"x":"y");var d="x"===o?l.outerWidth(!1)-s.width():l.outerHeight(!1)-s.height(),f="x"===o?l[0].offsetLeft:l[0].offsetTop,h="x"===o?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===o?ae(m)[1]:ae(m)[0];case"string":case"number":if(oe(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(f-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=f+parseInt(t.split("+=")[1]);return p>=0?0:Math.abs(p);}if(-1!==t.indexOf("px")&&oe(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"===t||"last"===t){var m=l.find(":"+t);return"x"===o?ae(m)[1]:ae(m)[0];}return e(t).length?"x"===o?ae(e(t))[1]:ae(e(t))[0]:(l.css(h,t),void u.update.call(null,n[0]));}}},N=function(t){function o(){return clearTimeout(f[0].autoUpdate),0===l.parents("html").length?void(l=null):void(f[0].autoUpdate=setTimeout(function(){return c.advanced.updateOnSelectorChange&&(s.poll.change.n=i(),s.poll.change.n!==s.poll.change.o)?(s.poll.change.o=s.poll.change.n,void r(3)):c.advanced.updateOnContentResize&&(s.poll.size.n=l[0].scrollHeight+l[0].scrollWidth+f[0].offsetHeight+l[0].offsetHeight+l[0].offsetWidth,s.poll.size.n!==s.poll.size.o)?(s.poll.size.o=s.poll.size.n,void r(1)):!c.advanced.updateOnImageLoad||"auto"===c.advanced.updateOnImageLoad&&"y"===c.axis||(s.poll.img.n=f.find("img").length,s.poll.img.n===s.poll.img.o)?void((c.advanced.updateOnSelectorChange||c.advanced.updateOnContentResize||c.advanced.updateOnImageLoad)&&o()):(s.poll.img.o=s.poll.img.n,void f.find("img").each(function(){n(this);}));},c.advanced.autoUpdateTimeout));}function n(t){function o(e,t){return function(){return t.apply(e,arguments);};}function a(){this.onload=null,e(t).addClass(d[2]),r(2);}if(e(t).hasClass(d[2]))return void r();var n=new Image();n.onload=o(n,a),n.src=t.src;}function i(){c.advanced.updateOnSelectorChange===!0&&(c.advanced.updateOnSelectorChange="*");var e=0,t=f.find(c.advanced.updateOnSelectorChange);return c.advanced.updateOnSelectorChange&&t.length>0&&t.each(function(){e+=this.offsetHeight+this.offsetWidth;}),e;}function r(e){clearTimeout(f[0].autoUpdate),u.update.call(null,l[0],e);}var l=e(this),s=l.data(a),c=s.opt,f=e("#mCSB_"+s.idx+"_container");return t?(clearTimeout(f[0].autoUpdate),void $(f[0],"autoUpdate")):void o();},V=function(e,t,o){return Math.round(e/t)*t-o;},Q=function(t){var o=t.data(a),n=e("#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal");n.each(function(){Z.call(this);});},G=function(t,o,n){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e];}function r(){return[c.callbacks.alwaysTriggerOffsets||w>=S[0]+y,c.callbacks.alwaysTriggerOffsets||-B>=w];}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],o=[x[0].offsetTop,x[0].offsetLeft],a=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:o[0],draggerLeft:o[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(a[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(a[1])-i[1])),direction:n.dir};}var s=t.data(a),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=e.extend(d,n),u=[n.dur,n.drag?0:n.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?Y.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?Y.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=n.trigger,0===m.scrollTop()&&0===m.scrollLeft()||(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==o||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==o||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==o&&"_resetX"!==o){if(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount){var v=c.snapAmount instanceof Array?"x"===n.dir?c.snapAmount[1]:c.snapAmount[0]:c.snapAmount;o=V(o,v,c.snapOffset);}switch(n.dir){case"x":var x=e("#mCSB_"+s.idx+"_dragger_horizontal"),_="left",w=h[0].offsetLeft,S=[f.width()-h.outerWidth(!1),x.parent().width()-x.width()],b=[o,0===o?0:o/s.scrollRatio.x],y=p[1],B=g[1],T=y>0?y/s.scrollRatio.x:0,k=B>0?B/s.scrollRatio.x:0;break;case"y":var x=e("#mCSB_"+s.idx+"_dragger_vertical"),_="top",w=h[0].offsetTop,S=[f.height()-h.outerHeight(!1),x.parent().height()-x.height()],b=[o,0===o?0:o/s.scrollRatio.y],y=p[0],B=g[0],T=y>0?y/s.scrollRatio.y:0,k=B>0?B/s.scrollRatio.y:0;}b[1]<0||0===b[0]&&0===b[1]?b=[0,0]:b[1]>=S[1]?b=[S[0],S[1]]:b[0]=-b[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),J(x[0],_,Math.round(b[1]),u[1],n.scrollEasing),!s.tweenRunning&&(0===w&&b[0]>=0||w===S[0]&&b[0]<=S[0])||J(h[0],_,Math.round(b[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,C(x),s.cbOffsets=r());},onUpdate:function(){n.callbacks&&n.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]));},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&b[1]>=S[1]-T&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&b[1]<=k&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,C(x,"hide");},e);}}});}},J=function(e,t,o,a,n,i,r){function l(){S.stop||(x||m.call(),x=K()-v,s(),x>=S.time&&(S.time=x>S.time?x+f-(x-S.time):x+f-1,S.time<x+1&&(S.time=x+1)),S.time<a?S.id=h(l):g.call());}function s(){a>0?(S.currVal=u(S.time,_,b,a,n),w[t]=Math.round(S.currVal)+"px"):w[t]=o+"px",p.call();}function c(){f=1e3/60,S.time=x+f,h=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return s(),setTimeout(e,.01);},S.id=h(l);}function d(){null!=S.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(S.id):clearTimeout(S.id),S.id=null);}function u(e,t,o,a,n){switch(n){case"linear":case"mcsLinear":return o*e/a+t;case"mcsLinearOut":return e/=a,e--,o*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=a/2,1>e?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=a/2,1>e?o/2*Math.pow(2,10*(e-1))+t:(e--,o/2*(-Math.pow(2,-10*e)+2)+t);case"easeInOut":case"mcsEaseInOut":return e/=a/2,1>e?o/2*e*e*e+t:(e-=2,o/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=a,e--,-o*(e*e*e*e-1)+t;case"easeOutStrong":return o*(-Math.pow(2,-10*e/a)+1)+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=a)*e,r=i*e;return t+o*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e);}}e._mTween||(e._mTween={top:{},left:{}});var f,h,r=r||{},m=r.onStart||function(){},p=r.onUpdate||function(){},g=r.onComplete||function(){},v=K(),x=0,_=e.offsetTop,w=e.style,S=e._mTween[t];"left"===t&&(_=e.offsetLeft);var b=o-_;S.stop=0,"none"!==i&&d(),c();},K=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():new Date().getTime();},Z=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],o=0;o<t.length;o++){var a=t[o];e._mTween[a].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[a].id):clearTimeout(e._mTween[a].id),e._mTween[a].id=null,e._mTween[a].stop=1);}},$=function(e,t){try{delete e[t];}catch(o){e[t]=null;}},ee=function(e){return!(e.which&&1!==e.which);},te=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t);},oe=function(e){return!isNaN(parseFloat(e))&&isFinite(e);},ae=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left];},ne=function(){function e(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null;}var t=e();return t?document[t]:!1;};e.fn[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments);},e[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments);},e[o].defaults=i,window[o]=!0,e(window).bind("load",function(){e(n)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var o,a,n=e(t),i=n.parents(".mCSB_container");if(i.length)return o=i.parent(),a=[i[0].offsetTop,i[0].offsetLeft],a[0]+ae(n)[0]>=0&&a[0]+ae(n)[0]<o.height()-n.outerHeight(!1)&&a[1]+ae(n)[1]>=0&&a[1]+ae(n)[1]<o.width()-n.outerWidth(!1);},mcsInSight:e.expr[":"].mcsInSight||function(t,o,a){var n,i,r,l,s=e(t),c=s.parents(".mCSB_container"),d="exact"===a[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(c.length)return n=[s.outerHeight(!1),s.outerWidth(!1)],r=[c[0].offsetTop+ae(s)[0],c[0].offsetLeft+ae(s)[1]],i=[c.parent()[0].offsetHeight,c.parent()[0].offsetWidth],l=[n[0]<i[0]?d[0]:d[1],n[1]<i[1]?d[0]:d[1]],r[0]-i[0]*l[0][0]<0&&r[0]+n[0]-i[0]*l[0][1]>=0&&r[1]-i[1]*l[1][0]<0&&r[1]+n[1]-i[1]*l[1][1]>=0;},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var o=e(t).data(a);if(o)return o.overflowed[0]||o.overflowed[1];}});});});});/** 
 * This is only currently needed in a separate file in libraries because 
 * the javascript files are loaded alphabetically from files and we need to 
 * ensure that our namespace object is loaded before all other ogame specific 
 * javascript code
 */ /*
 * global javascript namespace for ogame
 */var ogame=ogame||{};/*!
 * Select2 4.0.0
 * https://select2.github.io
 *
 * Released under the MIT license
 * https://github.com/select2/select2/blob/master/LICENSE.md
 */(function(factory){if(typeof define==='function'&&define.amd){// AMD. Register as an anonymous module.
define(['jquery'],factory);}else if(typeof exports==='object'){// Node/CommonJS
factory(require('jquery'));}else{// Browser globals
factory(jQuery);}})(function(jQuery){// This is needed so we can catch the AMD loader configuration and use it
// The inner file should be wrapped (by `banner.start.js`) in a function that
// returns the AMD loader references.
var S2=function(){// Restore the Select2 AMD loader so it can be used
// Needed mostly in the language files, where the loader is not inserted
if(jQuery&&jQuery.fn&&jQuery.fn.select2&&jQuery.fn.select2.amd){var S2=jQuery.fn.select2.amd;}var S2;(function(){if(!S2||!S2.requirejs){if(!S2){S2={};}else{require=S2;}/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */ //Going sloppy to avoid 'use strict' string cost, but strict practices should
//be followed.
/*jslint sloppy: true */ /*global setTimeout: false */var requirejs,require,define;(function(undef){var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice,jsSuffixRegExp=/\.js$/;function hasProp(obj,prop){return hasOwn.call(obj,prop);}/**
     * Given a relative module name, like ./something, normalize it to
     * a real name that can be mapped to a path.
     * @param {String} name the relative name
     * @param {String} baseName a real name that the name arg is relative
     * to.
     * @returns {String} normalized name
     */function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,lastIndex,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map['*']||{};//Adjust any relative paths.
if(name&&name.charAt(0)==="."){//If have a base name, try to normalize against it,
//otherwise, assume it is a top-level require that will
//be relative to baseUrl in the end.
if(baseName){//Convert baseName to array, and lop off the last part,
//so that . matches that "directory" and not name of the baseName's
//module. For instance, baseName of "one/two/three", maps to
//"one/two/three.js", but we want the directory, "one/two" for
//this normalization.
baseParts=baseParts.slice(0,baseParts.length-1);name=name.split('/');lastIndex=name.length-1;// Node .js allowance:
if(config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])){name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,'');}name=baseParts.concat(name);//start trimDots
for(i=0;i<name.length;i+=1){part=name[i];if(part==="."){name.splice(i,1);i-=1;}else if(part===".."){if(i===1&&(name[2]==='..'||name[0]==='..')){//End of the line. Keep at least one non-dot
//path segment at the front so it can be mapped
//correctly to disk. Otherwise, there is likely
//no path mapping for a path starting with '..'.
//This can still fail, but catches the most reasonable
//uses of ..
break;}else if(i>0){name.splice(i-1,2);i-=2;}}}//end trimDots
name=name.join("/");}else if(name.indexOf('./')===0){// No baseName, so this is ID is resolved relative
// to baseUrl, pull off the leading dot.
name=name.substring(2);}}//Apply map config if available.
if((baseParts||starMap)&&map){nameParts=name.split('/');for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){//Find the longest baseName segment match in the config.
//So, do joins on the biggest to smallest lengths of baseParts.
for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join('/')];//baseName segment has  config, find if it has one for
//this name.
if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){//Match, update name to the new value.
foundMap=mapValue;foundI=i;break;}}}}if(foundMap){break;}//Check for a star map match, but just hold on to it,
//if there is a shorter segment match later in a matching
//config, then favor over this star map.
if(!foundStarMap&&starMap&&starMap[nameSegment]){foundStarMap=starMap[nameSegment];starI=i;}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI;}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join('/');}}return name;}function makeRequire(relName,forceSync){return function(){//A version of a require function that passes a moduleName
//value for items that may need to
//look up paths relative to the moduleName
return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]));};}function makeNormalize(relName){return function(name){return normalize(name,relName);};}function makeLoad(depName){return function(value){defined[depName]=value;};}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name];defining[name]=true;main.apply(undef,args);}if(!hasProp(defined,name)&&!hasProp(defining,name)){throw new Error('No '+name);}return defined[name];}//Turns a plugin!resource to [plugin, resource]
//with the plugin being undefined if the name
//did not have a plugin prefix.
function splitPrefix(name){var prefix,index=name?name.indexOf('!'):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length);}return[prefix,name];}/**
     * Makes a name map, normalizing the name, and using a plugin
     * for normalization if necessary. Grabs a ref to plugin
     * too, as an optimization.
     */makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];name=parts[1];if(prefix){prefix=normalize(prefix,relName);plugin=callDep(prefix);}//Normalize according
if(prefix){if(plugin&&plugin.normalize){name=plugin.normalize(name,makeNormalize(relName));}else{name=normalize(name,relName);}}else{name=normalize(name,relName);parts=splitPrefix(name);prefix=parts[0];name=parts[1];if(prefix){plugin=callDep(prefix);}}//Using ridiculous property names for space reasons
return{f:prefix?prefix+'!'+name:name,//fullName
n:name,pr:prefix,p:plugin};};function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{};};}handlers={require:function(name){return makeRequire(name);},exports:function(name){var e=defined[name];if(typeof e!=='undefined'){return e;}else{return defined[name]={};}},module:function(name){return{id:name,uri:'',exports:defined[name],config:makeConfig(name)};}};main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,args=[],callbackType=typeof callback,usingExports;//Use name if no relName
relName=relName||name;//Call the callback to define the module, if necessary.
if(callbackType==='undefined'||callbackType==='function'){//Pull out the defined dependencies and pass the ordered
//values to the callback.
//Default to [require, exports, module] if no deps
deps=!deps.length&&callback.length?['require','exports','module']:deps;for(i=0;i<deps.length;i+=1){map=makeMap(deps[i],relName);depName=map.f;//Fast path CommonJS standard dependencies.
if(depName==="require"){args[i]=handlers.require(name);}else if(depName==="exports"){//CommonJS module spec 1.1
args[i]=handlers.exports(name);usingExports=true;}else if(depName==="module"){//CommonJS module spec 1.1
cjsModule=args[i]=handlers.module(name);}else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName)){args[i]=callDep(depName);}else if(map.p){map.p.load(map.n,makeRequire(relName,true),makeLoad(depName),{});args[i]=defined[depName];}else{throw new Error(name+' missing '+depName);}}ret=callback?callback.apply(defined[name],args):undefined;if(name){//If setting exports via "module" is in play,
//favor that over return value and exports. After that,
//favor a non-undefined return value over exports use.
if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]){defined[name]=cjsModule.exports;}else if(ret!==undef||!usingExports){//Use the return value from the function.
defined[name]=ret;}}}else if(name){//May just be an object definition for the module. Only
//worry about defining if have a module name.
defined[name]=callback;}};requirejs=require=req=function(deps,callback,relName,forceSync,alt){if(typeof deps==="string"){if(handlers[deps]){//callback in this case is really relName
return handlers[deps](callback);}//Just return the module wanted. In this scenario, the
//deps arg is the module name, and second arg (if passed)
//is just the relName.
//Normalize module name, if it contains . or ..
return callDep(makeMap(deps,callback).f);}else if(!deps.splice){//deps is a config object, not an array.
config=deps;if(config.deps){req(config.deps,config.callback);}if(!callback){return;}if(callback.splice){//callback is an array, which means it is a dependency list.
//Adjust args if there are dependencies
deps=callback;callback=relName;relName=null;}else{deps=undef;}}//Support require(['a'])
callback=callback||function(){};//If relName is a function, it is an errback handler,
//so remove it.
if(typeof relName==='function'){relName=forceSync;forceSync=alt;}//Simulate async callback;
if(forceSync){main(undef,deps,callback,relName);}else{//Using a non-zero value because of concern for what old browsers
//do, and latest browsers "upgrade" to 4 if lower value is used:
//http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
//If want a value immediately, use require('id') instead -- something
//that works in almond on the global level, but not guaranteed and
//unlikely to work in other AMD implementations.
setTimeout(function(){main(undef,deps,callback,relName);},4);}return req;};/**
     * Just drops the config on the floor, but returns req in case
     * the config return value is used.
     */req.config=function(cfg){return req(cfg);};/**
     * Expose module registry for debugging and tooling
     */requirejs._defined=defined;define=function(name,deps,callback){//This module may not have dependencies
if(!deps.splice){//deps is not an array, so probably means
//an object literal or factory function for
//the value. Adjust args.
callback=deps;deps=[];}if(!hasProp(defined,name)&&!hasProp(waiting,name)){waiting[name]=[name,deps,callback];}};define.amd={jQuery:true};})();S2.requirejs=requirejs;S2.require=require;S2.define=define;}})();S2.define("almond",function(){});/* global jQuery:false, $:false */S2.define('jquery',[],function(){var _$=jQuery||$;if(_$==null&&console&&console.error){console.error('Select2: An instance of jQuery or a jQuery-compatible library was not '+'found. Make sure that you are including jQuery before Select2 on your '+'web page.');}return _$;});S2.define('select2/utils',['jquery'],function($){var Utils={};Utils.Extend=function(ChildClass,SuperClass){var __hasProp={}.hasOwnProperty;function BaseConstructor(){this.constructor=ChildClass;}for(var key in SuperClass){if(__hasProp.call(SuperClass,key)){ChildClass[key]=SuperClass[key];}}BaseConstructor.prototype=SuperClass.prototype;ChildClass.prototype=new BaseConstructor();ChildClass.__super__=SuperClass.prototype;return ChildClass;};function getMethods(theClass){var proto=theClass.prototype;var methods=[];for(var methodName in proto){var m=proto[methodName];if(typeof m!=='function'){continue;}if(methodName==='constructor'){continue;}methods.push(methodName);}return methods;}Utils.Decorate=function(SuperClass,DecoratorClass){var decoratedMethods=getMethods(DecoratorClass);var superMethods=getMethods(SuperClass);function DecoratedClass(){var unshift=Array.prototype.unshift;var argCount=DecoratorClass.prototype.constructor.length;var calledConstructor=SuperClass.prototype.constructor;if(argCount>0){unshift.call(arguments,SuperClass.prototype.constructor);calledConstructor=DecoratorClass.prototype.constructor;}calledConstructor.apply(this,arguments);}DecoratorClass.displayName=SuperClass.displayName;function ctr(){this.constructor=DecoratedClass;}DecoratedClass.prototype=new ctr();for(var m=0;m<superMethods.length;m++){var superMethod=superMethods[m];DecoratedClass.prototype[superMethod]=SuperClass.prototype[superMethod];}var calledMethod=function(methodName){// Stub out the original method if it's not decorating an actual method
var originalMethod=function(){};if(methodName in DecoratedClass.prototype){originalMethod=DecoratedClass.prototype[methodName];}var decoratedMethod=DecoratorClass.prototype[methodName];return function(){var unshift=Array.prototype.unshift;unshift.call(arguments,originalMethod);return decoratedMethod.apply(this,arguments);};};for(var d=0;d<decoratedMethods.length;d++){var decoratedMethod=decoratedMethods[d];DecoratedClass.prototype[decoratedMethod]=calledMethod(decoratedMethod);}return DecoratedClass;};var Observable=function(){this.listeners={};};Observable.prototype.on=function(event,callback){this.listeners=this.listeners||{};if(event in this.listeners){this.listeners[event].push(callback);}else{this.listeners[event]=[callback];}};Observable.prototype.trigger=function(event){var slice=Array.prototype.slice;this.listeners=this.listeners||{};if(event in this.listeners){this.invoke(this.listeners[event],slice.call(arguments,1));}if('*'in this.listeners){this.invoke(this.listeners['*'],arguments);}};Observable.prototype.invoke=function(listeners,params){for(var i=0,len=listeners.length;i<len;i++){listeners[i].apply(this,params);}};Utils.Observable=Observable;Utils.generateChars=function(length){var chars='';for(var i=0;i<length;i++){var randomChar=Math.floor(Math.random()*36);chars+=randomChar.toString(36);}return chars;};Utils.bind=function(func,context){return function(){func.apply(context,arguments);};};Utils._convertData=function(data){for(var originalKey in data){var keys=originalKey.split('-');var dataLevel=data;if(keys.length===1){continue;}for(var k=0;k<keys.length;k++){var key=keys[k];// Lowercase the first letter
// By default, dash-separated becomes camelCase
key=key.substring(0,1).toLowerCase()+key.substring(1);if(!(key in dataLevel)){dataLevel[key]={};}if(k==keys.length-1){dataLevel[key]=data[originalKey];}dataLevel=dataLevel[key];}delete data[originalKey];}return data;};Utils.hasScroll=function(index,el){// Adapted from the function created by @ShadowScripter
// and adapted by @BillBarry on the Stack Exchange Code Review website.
// The original code can be found at
// http://codereview.stackexchange.com/q/13338
// and was designed to be used with the Sizzle selector engine.
var $el=$(el);var overflowX=el.style.overflowX;var overflowY=el.style.overflowY;//Check both x and y declarations
if(overflowX===overflowY&&(overflowY==='hidden'||overflowY==='visible')){return false;}if(overflowX==='scroll'||overflowY==='scroll'){return true;}return $el.innerHeight()<el.scrollHeight||$el.innerWidth()<el.scrollWidth;};Utils.escapeMarkup=function(markup){var replaceMap={'\\':'&#92;','&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;','/':'&#47;'};// Do not try to escape the markup if it's not a string
if(typeof markup!=='string'){return markup;}return String(markup).replace(/[&<>"'\/\\]/g,function(match){return replaceMap[match];});};// Append an array of jQuery nodes to a given element.
Utils.appendMany=function($element,$nodes){// jQuery 1.7.x does not support $.fn.append() with an array
// Fall back to a jQuery object collection using $.fn.add()
if($.fn.jquery.substr(0,3)==='1.7'){var $jqNodes=$();$.map($nodes,function(node){$jqNodes=$jqNodes.add(node);});$nodes=$jqNodes;}$element.append($nodes);};return Utils;});S2.define('select2/results',['jquery','./utils'],function($,Utils){function Results($element,options,dataAdapter){this.$element=$element;this.data=dataAdapter;this.options=options;Results.__super__.constructor.call(this);}Utils.Extend(Results,Utils.Observable);Results.prototype.render=function(){var $results=$('<ul class="select2-results__options" role="tree"></ul>');if(this.options.get('multiple')){$results.attr('aria-multiselectable','true');}this.$results=$results;return $results;};Results.prototype.clear=function(){this.$results.empty();};Results.prototype.displayMessage=function(params){var escapeMarkup=this.options.get('escapeMarkup');this.clear();this.hideLoading();var $message=$('<li role="treeitem" class="select2-results__option"></li>');var message=this.options.get('translations').get(params.message);$message.append(escapeMarkup(message(params.args)));this.$results.append($message);};Results.prototype.append=function(data){this.hideLoading();var $options=[];if(data.results==null||data.results.length===0){if(this.$results.children().length===0){this.trigger('results:message',{message:'noResults'});}return;}data.results=this.sort(data.results);for(var d=0;d<data.results.length;d++){var item=data.results[d];var $option=this.option(item);$options.push($option);}this.$results.append($options);};Results.prototype.position=function($results,$dropdown){var $resultsContainer=$dropdown.find('.select2-results');$resultsContainer.append($results);};Results.prototype.sort=function(data){var sorter=this.options.get('sorter');return sorter(data);};Results.prototype.setClasses=function(){var self=this;this.data.current(function(selected){var selectedIds=$.map(selected,function(s){return s.id.toString();});var $options=self.$results.find('.select2-results__option[aria-selected]');$options.each(function(){var $option=$(this);var item=$.data(this,'data');// id needs to be converted to a string when comparing
var id=''+item.id;if(item.element!=null&&item.element.selected||item.element==null&&$.inArray(id,selectedIds)>-1){$option.attr('aria-selected','true');}else{$option.attr('aria-selected','false');}});var $selected=$options.filter('[aria-selected=true]');// Check if there are any selected options
if($selected.length>0){// If there are selected options, highlight the first
$selected.first().trigger('mouseenter');}else{// If there are no selected options, highlight the first option
// in the dropdown
$options.first().trigger('mouseenter');}});};Results.prototype.showLoading=function(params){this.hideLoading();var loadingMore=this.options.get('translations').get('searching');var loading={disabled:true,loading:true,text:loadingMore(params)};var $loading=this.option(loading);$loading.className+=' loading-results';this.$results.prepend($loading);};Results.prototype.hideLoading=function(){this.$results.find('.loading-results').remove();};Results.prototype.option=function(data){var option=document.createElement('li');option.className='select2-results__option';var attrs={'role':'treeitem','aria-selected':'false'};if(data.disabled){delete attrs['aria-selected'];attrs['aria-disabled']='true';}if(data.id==null){delete attrs['aria-selected'];}if(data._resultId!=null){option.id=data._resultId;}if(data.title){option.title=data.title;}if(data.children){attrs.role='group';attrs['aria-label']=data.text;delete attrs['aria-selected'];}for(var attr in attrs){var val=attrs[attr];option.setAttribute(attr,val);}if(data.children){var $option=$(option);var label=document.createElement('strong');label.className='select2-results__group';var $label=$(label);this.template(data,label);var $children=[];for(var c=0;c<data.children.length;c++){var child=data.children[c];var $child=this.option(child);$children.push($child);}var $childrenContainer=$('<ul></ul>',{'class':'select2-results__options select2-results__options--nested'});$childrenContainer.append($children);$option.append(label);$option.append($childrenContainer);}else{this.template(data,option);}$.data(option,'data',data);return option;};Results.prototype.bind=function(container,$container){var self=this;var id=container.id+'-results';this.$results.attr('id',id);container.on('results:all',function(params){self.clear();self.append(params.data);if(container.isOpen()){self.setClasses();}});container.on('results:append',function(params){self.append(params.data);if(container.isOpen()){self.setClasses();}});container.on('query',function(params){self.showLoading(params);});container.on('select',function(){if(!container.isOpen()){return;}self.setClasses();});container.on('unselect',function(){if(!container.isOpen()){return;}self.setClasses();});container.on('open',function(){// When the dropdown is open, aria-expended="true"
self.$results.attr('aria-expanded','true');self.$results.attr('aria-hidden','false');self.setClasses();self.ensureHighlightVisible();});container.on('close',function(){// When the dropdown is closed, aria-expended="false"
self.$results.attr('aria-expanded','false');self.$results.attr('aria-hidden','true');self.$results.removeAttr('aria-activedescendant');});container.on('results:toggle',function(){var $highlighted=self.getHighlightedResults();if($highlighted.length===0){return;}$highlighted.trigger('mouseup');});container.on('results:select',function(){var $highlighted=self.getHighlightedResults();if($highlighted.length===0){return;}var data=$highlighted.data('data');if($highlighted.attr('aria-selected')=='true'){self.trigger('close');}else{self.trigger('select',{data:data});}});container.on('results:previous',function(){var $highlighted=self.getHighlightedResults();var $options=self.$results.find('[aria-selected]');var currentIndex=$options.index($highlighted);// If we are already at te top, don't move further
if(currentIndex===0){return;}var nextIndex=currentIndex-1;// If none are highlighted, highlight the first
if($highlighted.length===0){nextIndex=0;}var $next=$options.eq(nextIndex);$next.trigger('mouseenter');var currentOffset=self.$results.offset().top;var nextTop=$next.offset().top;var nextOffset=self.$results.scrollTop()+(nextTop-currentOffset);if(nextIndex===0){self.$results.scrollTop(0);}else if(nextTop-currentOffset<0){self.$results.scrollTop(nextOffset);}});container.on('results:next',function(){var $highlighted=self.getHighlightedResults();var $options=self.$results.find('[aria-selected]');var currentIndex=$options.index($highlighted);var nextIndex=currentIndex+1;// If we are at the last option, stay there
if(nextIndex>=$options.length){return;}var $next=$options.eq(nextIndex);$next.trigger('mouseenter');var currentOffset=self.$results.offset().top+self.$results.outerHeight(false);var nextBottom=$next.offset().top+$next.outerHeight(false);var nextOffset=self.$results.scrollTop()+nextBottom-currentOffset;if(nextIndex===0){self.$results.scrollTop(0);}else if(nextBottom>currentOffset){self.$results.scrollTop(nextOffset);}});container.on('results:focus',function(params){params.element.addClass('select2-results__option--highlighted');});container.on('results:message',function(params){self.displayMessage(params);});if($.fn.mousewheel){this.$results.on('mousewheel',function(e){var top=self.$results.scrollTop();var bottom=self.$results.get(0).scrollHeight-self.$results.scrollTop()+e.deltaY;var isAtTop=e.deltaY>0&&top-e.deltaY<=0;var isAtBottom=e.deltaY<0&&bottom<=self.$results.height();if(isAtTop){self.$results.scrollTop(0);e.preventDefault();e.stopPropagation();}else if(isAtBottom){self.$results.scrollTop(self.$results.get(0).scrollHeight-self.$results.height());e.preventDefault();e.stopPropagation();}});}this.$results.on('mouseup','.select2-results__option[aria-selected]',function(evt){var $this=$(this);var data=$this.data('data');if($this.attr('aria-selected')==='true'){if(self.options.get('multiple')){self.trigger('unselect',{originalEvent:evt,data:data});}else{self.trigger('close');}return;}self.trigger('select',{originalEvent:evt,data:data});});this.$results.on('mouseenter','.select2-results__option[aria-selected]',function(evt){var data=$(this).data('data');self.getHighlightedResults().removeClass('select2-results__option--highlighted');self.trigger('results:focus',{data:data,element:$(this)});});};Results.prototype.getHighlightedResults=function(){var $highlighted=this.$results.find('.select2-results__option--highlighted');return $highlighted;};Results.prototype.destroy=function(){this.$results.remove();};Results.prototype.ensureHighlightVisible=function(){var $highlighted=this.getHighlightedResults();if($highlighted.length===0){return;}var $options=this.$results.find('[aria-selected]');var currentIndex=$options.index($highlighted);var currentOffset=this.$results.offset().top;var nextTop=$highlighted.offset().top;var nextOffset=this.$results.scrollTop()+(nextTop-currentOffset);var offsetDelta=nextTop-currentOffset;nextOffset-=$highlighted.outerHeight(false)*2;if(currentIndex<=2){this.$results.scrollTop(0);}else if(offsetDelta>this.$results.outerHeight()||offsetDelta<0){this.$results.scrollTop(nextOffset);}};Results.prototype.template=function(result,container){var template=this.options.get('templateResult');var escapeMarkup=this.options.get('escapeMarkup');var content=template(result);if(content==null){container.style.display='none';}else if(typeof content==='string'){container.innerHTML=escapeMarkup(content);}else{$(container).append(content);}};return Results;});S2.define('select2/keys',[],function(){var KEYS={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return KEYS;});S2.define('select2/selection/base',['jquery','../utils','../keys'],function($,Utils,KEYS){function BaseSelection($element,options){this.$element=$element;this.options=options;BaseSelection.__super__.constructor.call(this);}Utils.Extend(BaseSelection,Utils.Observable);BaseSelection.prototype.render=function(){var $selection=$('<span class="select2-selection" role="combobox" '+'aria-autocomplete="list" aria-haspopup="true" aria-expanded="false">'+'</span>');this._tabindex=0;if(this.$element.data('old-tabindex')!=null){this._tabindex=this.$element.data('old-tabindex');}else if(this.$element.attr('tabindex')!=null){this._tabindex=this.$element.attr('tabindex');}$selection.attr('title',this.$element.attr('title'));$selection.attr('tabindex',this._tabindex);this.$selection=$selection;return $selection;};BaseSelection.prototype.bind=function(container,$container){var self=this;var id=container.id+'-container';var resultsId=container.id+'-results';this.container=container;this.$selection.on('focus',function(evt){self.trigger('focus',evt);});this.$selection.on('blur',function(evt){self.trigger('blur',evt);});this.$selection.on('keydown',function(evt){self.trigger('keypress',evt);if(evt.which===KEYS.SPACE){evt.preventDefault();}});container.on('results:focus',function(params){self.$selection.attr('aria-activedescendant',params.data._resultId);});container.on('selection:update',function(params){self.update(params.data);});container.on('open',function(){// When the dropdown is open, aria-expanded="true"
self.$selection.attr('aria-expanded','true');self.$selection.attr('aria-owns',resultsId);self._attachCloseHandler(container);});container.on('close',function(){// When the dropdown is closed, aria-expanded="false"
self.$selection.attr('aria-expanded','false');self.$selection.removeAttr('aria-activedescendant');self.$selection.removeAttr('aria-owns');self.$selection.focus();self._detachCloseHandler(container);});container.on('enable',function(){self.$selection.attr('tabindex',self._tabindex);});container.on('disable',function(){self.$selection.attr('tabindex','-1');});};BaseSelection.prototype._attachCloseHandler=function(container){var self=this;$(document.body).on('mousedown.select2.'+container.id,function(e){var $target=$(e.target);var $select=$target.closest('.select2');var $all=$('.select2.select2-container--open');$all.each(function(){var $this=$(this);if(this==$select[0]){return;}var $element=$this.data('element');$element.select2('close');});});};BaseSelection.prototype._detachCloseHandler=function(container){$(document.body).off('mousedown.select2.'+container.id);};BaseSelection.prototype.position=function($selection,$container){var $selectionContainer=$container.find('.selection');$selectionContainer.append($selection);};BaseSelection.prototype.destroy=function(){this._detachCloseHandler(this.container);};BaseSelection.prototype.update=function(data){throw new Error('The `update` method must be defined in child classes.');};return BaseSelection;});S2.define('select2/selection/single',['jquery','./base','../utils','../keys'],function($,BaseSelection,Utils,KEYS){function SingleSelection(){SingleSelection.__super__.constructor.apply(this,arguments);}Utils.Extend(SingleSelection,BaseSelection);SingleSelection.prototype.render=function(){var $selection=SingleSelection.__super__.render.call(this);$selection.addClass('select2-selection--single');$selection.html('<span class="select2-selection__rendered"></span>'+'<span class="select2-selection__arrow" role="presentation">'+'<b role="presentation"></b>'+'</span>');return $selection;};SingleSelection.prototype.bind=function(container,$container){var self=this;SingleSelection.__super__.bind.apply(this,arguments);var id=container.id+'-container';this.$selection.find('.select2-selection__rendered').attr('id',id);this.$selection.attr('aria-labelledby',id);this.$selection.on('mousedown',function(evt){// Only respond to left clicks
if(evt.which!==1){return;}self.trigger('toggle',{originalEvent:evt});});this.$selection.on('focus',function(evt){// User focuses on the container
});this.$selection.on('blur',function(evt){// User exits the container
});container.on('selection:update',function(params){self.update(params.data);});};SingleSelection.prototype.clear=function(){this.$selection.find('.select2-selection__rendered').empty();};SingleSelection.prototype.display=function(data){var template=this.options.get('templateSelection');var escapeMarkup=this.options.get('escapeMarkup');return escapeMarkup(template(data));};SingleSelection.prototype.selectionContainer=function(){return $('<span></span>');};SingleSelection.prototype.update=function(data){if(data.length===0){this.clear();return;}var selection=data[0];var formatted=this.display(selection);var $rendered=this.$selection.find('.select2-selection__rendered');$rendered.empty().append(formatted);$rendered.prop('title',selection.title||selection.text);};return SingleSelection;});S2.define('select2/selection/multiple',['jquery','./base','../utils'],function($,BaseSelection,Utils){function MultipleSelection($element,options){MultipleSelection.__super__.constructor.apply(this,arguments);}Utils.Extend(MultipleSelection,BaseSelection);MultipleSelection.prototype.render=function(){var $selection=MultipleSelection.__super__.render.call(this);$selection.addClass('select2-selection--multiple');$selection.html('<ul class="select2-selection__rendered"></ul>');return $selection;};MultipleSelection.prototype.bind=function(container,$container){var self=this;MultipleSelection.__super__.bind.apply(this,arguments);this.$selection.on('click',function(evt){self.trigger('toggle',{originalEvent:evt});});this.$selection.on('click','.select2-selection__choice__remove',function(evt){var $remove=$(this);var $selection=$remove.parent();var data=$selection.data('data');self.trigger('unselect',{originalEvent:evt,data:data});});};MultipleSelection.prototype.clear=function(){this.$selection.find('.select2-selection__rendered').empty();};MultipleSelection.prototype.display=function(data){var template=this.options.get('templateSelection');var escapeMarkup=this.options.get('escapeMarkup');return escapeMarkup(template(data));};MultipleSelection.prototype.selectionContainer=function(){var $container=$('<li class="select2-selection__choice">'+'<span class="select2-selection__choice__remove" role="presentation">'+'&times;'+'</span>'+'</li>');return $container;};MultipleSelection.prototype.update=function(data){this.clear();if(data.length===0){return;}var $selections=[];for(var d=0;d<data.length;d++){var selection=data[d];var formatted=this.display(selection);var $selection=this.selectionContainer();$selection.append(formatted);$selection.prop('title',selection.title||selection.text);$selection.data('data',selection);$selections.push($selection);}var $rendered=this.$selection.find('.select2-selection__rendered');Utils.appendMany($rendered,$selections);};return MultipleSelection;});S2.define('select2/selection/placeholder',['../utils'],function(Utils){function Placeholder(decorated,$element,options){this.placeholder=this.normalizePlaceholder(options.get('placeholder'));decorated.call(this,$element,options);}Placeholder.prototype.normalizePlaceholder=function(_,placeholder){if(typeof placeholder==='string'){placeholder={id:'',text:placeholder};}return placeholder;};Placeholder.prototype.createPlaceholder=function(decorated,placeholder){var $placeholder=this.selectionContainer();$placeholder.html(this.display(placeholder));$placeholder.addClass('select2-selection__placeholder').removeClass('select2-selection__choice');return $placeholder;};Placeholder.prototype.update=function(decorated,data){var singlePlaceholder=data.length==1&&data[0].id!=this.placeholder.id;var multipleSelections=data.length>1;if(multipleSelections||singlePlaceholder){return decorated.call(this,data);}this.clear();var $placeholder=this.createPlaceholder(this.placeholder);this.$selection.find('.select2-selection__rendered').append($placeholder);};return Placeholder;});S2.define('select2/selection/allowClear',['jquery','../keys'],function($,KEYS){function AllowClear(){}AllowClear.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);if(this.placeholder==null){if(this.options.get('debug')&&window.console&&console.error){console.error('Select2: The `allowClear` option should be used in combination '+'with the `placeholder` option.');}}this.$selection.on('mousedown','.select2-selection__clear',function(evt){self._handleClear(evt);});container.on('keypress',function(evt){self._handleKeyboardClear(evt,container);});};AllowClear.prototype._handleClear=function(_,evt){// Ignore the event if it is disabled
if(this.options.get('disabled')){return;}var $clear=this.$selection.find('.select2-selection__clear');// Ignore the event if nothing has been selected
if($clear.length===0){return;}evt.stopPropagation();var data=$clear.data('data');for(var d=0;d<data.length;d++){var unselectData={data:data[d]};// Trigger the `unselect` event, so people can prevent it from being
// cleared.
this.trigger('unselect',unselectData);// If the event was prevented, don't clear it out.
if(unselectData.prevented){return;}}this.$element.val(this.placeholder.id).trigger('change');this.trigger('toggle');};AllowClear.prototype._handleKeyboardClear=function(_,evt,container){if(container.isOpen()){return;}if(evt.which==KEYS.DELETE||evt.which==KEYS.BACKSPACE){this._handleClear(evt);}};AllowClear.prototype.update=function(decorated,data){decorated.call(this,data);if(this.$selection.find('.select2-selection__placeholder').length>0||data.length===0){return;}var $remove=$('<span class="select2-selection__clear">'+'&times;'+'</span>');$remove.data('data',data);this.$selection.find('.select2-selection__rendered').prepend($remove);};return AllowClear;});S2.define('select2/selection/search',['jquery','../utils','../keys'],function($,Utils,KEYS){function Search(decorated,$element,options){decorated.call(this,$element,options);}Search.prototype.render=function(decorated){var $search=$('<li class="select2-search select2-search--inline">'+'<input class="select2-search__field" type="search" tabindex="-1"'+' autocomplete="off" autocorrect="off" autocapitalize="off"'+' spellcheck="false" role="textbox" />'+'</li>');this.$searchContainer=$search;this.$search=$search.find('input');var $rendered=decorated.call(this);return $rendered;};Search.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on('open',function(){self.$search.attr('tabindex',0);self.$search.focus();});container.on('close',function(){self.$search.attr('tabindex',-1);self.$search.val('');self.$search.focus();});container.on('enable',function(){self.$search.prop('disabled',false);});container.on('disable',function(){self.$search.prop('disabled',true);});this.$selection.on('focusin','.select2-search--inline',function(evt){self.trigger('focus',evt);});this.$selection.on('focusout','.select2-search--inline',function(evt){self.trigger('blur',evt);});this.$selection.on('keydown','.select2-search--inline',function(evt){evt.stopPropagation();self.trigger('keypress',evt);self._keyUpPrevented=evt.isDefaultPrevented();var key=evt.which;if(key===KEYS.BACKSPACE&&self.$search.val()===''){var $previousChoice=self.$searchContainer.prev('.select2-selection__choice');if($previousChoice.length>0){var item=$previousChoice.data('data');self.searchRemoveChoice(item);evt.preventDefault();}}});// Workaround for browsers which do not support the `input` event
// This will prevent double-triggering of events for browsers which support
// both the `keyup` and `input` events.
this.$selection.on('input','.select2-search--inline',function(evt){// Unbind the duplicated `keyup` event
self.$selection.off('keyup.search');});this.$selection.on('keyup.search input','.select2-search--inline',function(evt){self.handleSearch(evt);});};Search.prototype.createPlaceholder=function(decorated,placeholder){this.$search.attr('placeholder',placeholder.text);};Search.prototype.update=function(decorated,data){this.$search.attr('placeholder','');decorated.call(this,data);this.$selection.find('.select2-selection__rendered').append(this.$searchContainer);this.resizeSearch();};Search.prototype.handleSearch=function(){this.resizeSearch();if(!this._keyUpPrevented){var input=this.$search.val();this.trigger('query',{term:input});}this._keyUpPrevented=false;};Search.prototype.searchRemoveChoice=function(decorated,item){this.trigger('unselect',{data:item});this.trigger('open');this.$search.val(item.text+' ');};Search.prototype.resizeSearch=function(){this.$search.css('width','25px');var width='';if(this.$search.attr('placeholder')!==''){width=this.$selection.find('.select2-selection__rendered').innerWidth();}else{var minimumWidth=this.$search.val().length+1;width=minimumWidth*0.75+'em';}this.$search.css('width',width);};return Search;});S2.define('select2/selection/eventRelay',['jquery'],function($){function EventRelay(){}EventRelay.prototype.bind=function(decorated,container,$container){var self=this;var relayEvents=['open','opening','close','closing','select','selecting','unselect','unselecting'];var preventableEvents=['opening','closing','selecting','unselecting'];decorated.call(this,container,$container);container.on('*',function(name,params){// Ignore events that should not be relayed
if($.inArray(name,relayEvents)===-1){return;}// The parameters should always be an object
params=params||{};// Generate the jQuery event for the Select2 event
var evt=$.Event('select2:'+name,{params:params});self.$element.trigger(evt);// Only handle preventable events if it was one
if($.inArray(name,preventableEvents)===-1){return;}params.prevented=evt.isDefaultPrevented();});};return EventRelay;});S2.define('select2/translation',['jquery','require'],function($,require){function Translation(dict){this.dict=dict||{};}Translation.prototype.all=function(){return this.dict;};Translation.prototype.get=function(key){return this.dict[key];};Translation.prototype.extend=function(translation){this.dict=$.extend({},translation.all(),this.dict);};// Static functions
Translation._cache={};Translation.loadPath=function(path){if(!(path in Translation._cache)){var translations=require(path);Translation._cache[path]=translations;}return new Translation(Translation._cache[path]);};return Translation;});S2.define('select2/diacritics',[],function(){var diacritics={'\u24B6':'A','\uFF21':'A','\u00C0':'A','\u00C1':'A','\u00C2':'A','\u1EA6':'A','\u1EA4':'A','\u1EAA':'A','\u1EA8':'A','\u00C3':'A','\u0100':'A','\u0102':'A','\u1EB0':'A','\u1EAE':'A','\u1EB4':'A','\u1EB2':'A','\u0226':'A','\u01E0':'A','\u00C4':'A','\u01DE':'A','\u1EA2':'A','\u00C5':'A','\u01FA':'A','\u01CD':'A','\u0200':'A','\u0202':'A','\u1EA0':'A','\u1EAC':'A','\u1EB6':'A','\u1E00':'A','\u0104':'A','\u023A':'A','\u2C6F':'A','\uA732':'AA','\u00C6':'AE','\u01FC':'AE','\u01E2':'AE','\uA734':'AO','\uA736':'AU','\uA738':'AV','\uA73A':'AV','\uA73C':'AY','\u24B7':'B','\uFF22':'B','\u1E02':'B','\u1E04':'B','\u1E06':'B','\u0243':'B','\u0182':'B','\u0181':'B','\u24B8':'C','\uFF23':'C','\u0106':'C','\u0108':'C','\u010A':'C','\u010C':'C','\u00C7':'C','\u1E08':'C','\u0187':'C','\u023B':'C','\uA73E':'C','\u24B9':'D','\uFF24':'D','\u1E0A':'D','\u010E':'D','\u1E0C':'D','\u1E10':'D','\u1E12':'D','\u1E0E':'D','\u0110':'D','\u018B':'D','\u018A':'D','\u0189':'D','\uA779':'D','\u01F1':'DZ','\u01C4':'DZ','\u01F2':'Dz','\u01C5':'Dz','\u24BA':'E','\uFF25':'E','\u00C8':'E','\u00C9':'E','\u00CA':'E','\u1EC0':'E','\u1EBE':'E','\u1EC4':'E','\u1EC2':'E','\u1EBC':'E','\u0112':'E','\u1E14':'E','\u1E16':'E','\u0114':'E','\u0116':'E','\u00CB':'E','\u1EBA':'E','\u011A':'E','\u0204':'E','\u0206':'E','\u1EB8':'E','\u1EC6':'E','\u0228':'E','\u1E1C':'E','\u0118':'E','\u1E18':'E','\u1E1A':'E','\u0190':'E','\u018E':'E','\u24BB':'F','\uFF26':'F','\u1E1E':'F','\u0191':'F','\uA77B':'F','\u24BC':'G','\uFF27':'G','\u01F4':'G','\u011C':'G','\u1E20':'G','\u011E':'G','\u0120':'G','\u01E6':'G','\u0122':'G','\u01E4':'G','\u0193':'G','\uA7A0':'G','\uA77D':'G','\uA77E':'G','\u24BD':'H','\uFF28':'H','\u0124':'H','\u1E22':'H','\u1E26':'H','\u021E':'H','\u1E24':'H','\u1E28':'H','\u1E2A':'H','\u0126':'H','\u2C67':'H','\u2C75':'H','\uA78D':'H','\u24BE':'I','\uFF29':'I','\u00CC':'I','\u00CD':'I','\u00CE':'I','\u0128':'I','\u012A':'I','\u012C':'I','\u0130':'I','\u00CF':'I','\u1E2E':'I','\u1EC8':'I','\u01CF':'I','\u0208':'I','\u020A':'I','\u1ECA':'I','\u012E':'I','\u1E2C':'I','\u0197':'I','\u24BF':'J','\uFF2A':'J','\u0134':'J','\u0248':'J','\u24C0':'K','\uFF2B':'K','\u1E30':'K','\u01E8':'K','\u1E32':'K','\u0136':'K','\u1E34':'K','\u0198':'K','\u2C69':'K','\uA740':'K','\uA742':'K','\uA744':'K','\uA7A2':'K','\u24C1':'L','\uFF2C':'L','\u013F':'L','\u0139':'L','\u013D':'L','\u1E36':'L','\u1E38':'L','\u013B':'L','\u1E3C':'L','\u1E3A':'L','\u0141':'L','\u023D':'L','\u2C62':'L','\u2C60':'L','\uA748':'L','\uA746':'L','\uA780':'L','\u01C7':'LJ','\u01C8':'Lj','\u24C2':'M','\uFF2D':'M','\u1E3E':'M','\u1E40':'M','\u1E42':'M','\u2C6E':'M','\u019C':'M','\u24C3':'N','\uFF2E':'N','\u01F8':'N','\u0143':'N','\u00D1':'N','\u1E44':'N','\u0147':'N','\u1E46':'N','\u0145':'N','\u1E4A':'N','\u1E48':'N','\u0220':'N','\u019D':'N','\uA790':'N','\uA7A4':'N','\u01CA':'NJ','\u01CB':'Nj','\u24C4':'O','\uFF2F':'O','\u00D2':'O','\u00D3':'O','\u00D4':'O','\u1ED2':'O','\u1ED0':'O','\u1ED6':'O','\u1ED4':'O','\u00D5':'O','\u1E4C':'O','\u022C':'O','\u1E4E':'O','\u014C':'O','\u1E50':'O','\u1E52':'O','\u014E':'O','\u022E':'O','\u0230':'O','\u00D6':'O','\u022A':'O','\u1ECE':'O','\u0150':'O','\u01D1':'O','\u020C':'O','\u020E':'O','\u01A0':'O','\u1EDC':'O','\u1EDA':'O','\u1EE0':'O','\u1EDE':'O','\u1EE2':'O','\u1ECC':'O','\u1ED8':'O','\u01EA':'O','\u01EC':'O','\u00D8':'O','\u01FE':'O','\u0186':'O','\u019F':'O','\uA74A':'O','\uA74C':'O','\u01A2':'OI','\uA74E':'OO','\u0222':'OU','\u24C5':'P','\uFF30':'P','\u1E54':'P','\u1E56':'P','\u01A4':'P','\u2C63':'P','\uA750':'P','\uA752':'P','\uA754':'P','\u24C6':'Q','\uFF31':'Q','\uA756':'Q','\uA758':'Q','\u024A':'Q','\u24C7':'R','\uFF32':'R','\u0154':'R','\u1E58':'R','\u0158':'R','\u0210':'R','\u0212':'R','\u1E5A':'R','\u1E5C':'R','\u0156':'R','\u1E5E':'R','\u024C':'R','\u2C64':'R','\uA75A':'R','\uA7A6':'R','\uA782':'R','\u24C8':'S','\uFF33':'S','\u1E9E':'S','\u015A':'S','\u1E64':'S','\u015C':'S','\u1E60':'S','\u0160':'S','\u1E66':'S','\u1E62':'S','\u1E68':'S','\u0218':'S','\u015E':'S','\u2C7E':'S','\uA7A8':'S','\uA784':'S','\u24C9':'T','\uFF34':'T','\u1E6A':'T','\u0164':'T','\u1E6C':'T','\u021A':'T','\u0162':'T','\u1E70':'T','\u1E6E':'T','\u0166':'T','\u01AC':'T','\u01AE':'T','\u023E':'T','\uA786':'T','\uA728':'TZ','\u24CA':'U','\uFF35':'U','\u00D9':'U','\u00DA':'U','\u00DB':'U','\u0168':'U','\u1E78':'U','\u016A':'U','\u1E7A':'U','\u016C':'U','\u00DC':'U','\u01DB':'U','\u01D7':'U','\u01D5':'U','\u01D9':'U','\u1EE6':'U','\u016E':'U','\u0170':'U','\u01D3':'U','\u0214':'U','\u0216':'U','\u01AF':'U','\u1EEA':'U','\u1EE8':'U','\u1EEE':'U','\u1EEC':'U','\u1EF0':'U','\u1EE4':'U','\u1E72':'U','\u0172':'U','\u1E76':'U','\u1E74':'U','\u0244':'U','\u24CB':'V','\uFF36':'V','\u1E7C':'V','\u1E7E':'V','\u01B2':'V','\uA75E':'V','\u0245':'V','\uA760':'VY','\u24CC':'W','\uFF37':'W','\u1E80':'W','\u1E82':'W','\u0174':'W','\u1E86':'W','\u1E84':'W','\u1E88':'W','\u2C72':'W','\u24CD':'X','\uFF38':'X','\u1E8A':'X','\u1E8C':'X','\u24CE':'Y','\uFF39':'Y','\u1EF2':'Y','\u00DD':'Y','\u0176':'Y','\u1EF8':'Y','\u0232':'Y','\u1E8E':'Y','\u0178':'Y','\u1EF6':'Y','\u1EF4':'Y','\u01B3':'Y','\u024E':'Y','\u1EFE':'Y','\u24CF':'Z','\uFF3A':'Z','\u0179':'Z','\u1E90':'Z','\u017B':'Z','\u017D':'Z','\u1E92':'Z','\u1E94':'Z','\u01B5':'Z','\u0224':'Z','\u2C7F':'Z','\u2C6B':'Z','\uA762':'Z','\u24D0':'a','\uFF41':'a','\u1E9A':'a','\u00E0':'a','\u00E1':'a','\u00E2':'a','\u1EA7':'a','\u1EA5':'a','\u1EAB':'a','\u1EA9':'a','\u00E3':'a','\u0101':'a','\u0103':'a','\u1EB1':'a','\u1EAF':'a','\u1EB5':'a','\u1EB3':'a','\u0227':'a','\u01E1':'a','\u00E4':'a','\u01DF':'a','\u1EA3':'a','\u00E5':'a','\u01FB':'a','\u01CE':'a','\u0201':'a','\u0203':'a','\u1EA1':'a','\u1EAD':'a','\u1EB7':'a','\u1E01':'a','\u0105':'a','\u2C65':'a','\u0250':'a','\uA733':'aa','\u00E6':'ae','\u01FD':'ae','\u01E3':'ae','\uA735':'ao','\uA737':'au','\uA739':'av','\uA73B':'av','\uA73D':'ay','\u24D1':'b','\uFF42':'b','\u1E03':'b','\u1E05':'b','\u1E07':'b','\u0180':'b','\u0183':'b','\u0253':'b','\u24D2':'c','\uFF43':'c','\u0107':'c','\u0109':'c','\u010B':'c','\u010D':'c','\u00E7':'c','\u1E09':'c','\u0188':'c','\u023C':'c','\uA73F':'c','\u2184':'c','\u24D3':'d','\uFF44':'d','\u1E0B':'d','\u010F':'d','\u1E0D':'d','\u1E11':'d','\u1E13':'d','\u1E0F':'d','\u0111':'d','\u018C':'d','\u0256':'d','\u0257':'d','\uA77A':'d','\u01F3':'dz','\u01C6':'dz','\u24D4':'e','\uFF45':'e','\u00E8':'e','\u00E9':'e','\u00EA':'e','\u1EC1':'e','\u1EBF':'e','\u1EC5':'e','\u1EC3':'e','\u1EBD':'e','\u0113':'e','\u1E15':'e','\u1E17':'e','\u0115':'e','\u0117':'e','\u00EB':'e','\u1EBB':'e','\u011B':'e','\u0205':'e','\u0207':'e','\u1EB9':'e','\u1EC7':'e','\u0229':'e','\u1E1D':'e','\u0119':'e','\u1E19':'e','\u1E1B':'e','\u0247':'e','\u025B':'e','\u01DD':'e','\u24D5':'f','\uFF46':'f','\u1E1F':'f','\u0192':'f','\uA77C':'f','\u24D6':'g','\uFF47':'g','\u01F5':'g','\u011D':'g','\u1E21':'g','\u011F':'g','\u0121':'g','\u01E7':'g','\u0123':'g','\u01E5':'g','\u0260':'g','\uA7A1':'g','\u1D79':'g','\uA77F':'g','\u24D7':'h','\uFF48':'h','\u0125':'h','\u1E23':'h','\u1E27':'h','\u021F':'h','\u1E25':'h','\u1E29':'h','\u1E2B':'h','\u1E96':'h','\u0127':'h','\u2C68':'h','\u2C76':'h','\u0265':'h','\u0195':'hv','\u24D8':'i','\uFF49':'i','\u00EC':'i','\u00ED':'i','\u00EE':'i','\u0129':'i','\u012B':'i','\u012D':'i','\u00EF':'i','\u1E2F':'i','\u1EC9':'i','\u01D0':'i','\u0209':'i','\u020B':'i','\u1ECB':'i','\u012F':'i','\u1E2D':'i','\u0268':'i','\u0131':'i','\u24D9':'j','\uFF4A':'j','\u0135':'j','\u01F0':'j','\u0249':'j','\u24DA':'k','\uFF4B':'k','\u1E31':'k','\u01E9':'k','\u1E33':'k','\u0137':'k','\u1E35':'k','\u0199':'k','\u2C6A':'k','\uA741':'k','\uA743':'k','\uA745':'k','\uA7A3':'k','\u24DB':'l','\uFF4C':'l','\u0140':'l','\u013A':'l','\u013E':'l','\u1E37':'l','\u1E39':'l','\u013C':'l','\u1E3D':'l','\u1E3B':'l','\u017F':'l','\u0142':'l','\u019A':'l','\u026B':'l','\u2C61':'l','\uA749':'l','\uA781':'l','\uA747':'l','\u01C9':'lj','\u24DC':'m','\uFF4D':'m','\u1E3F':'m','\u1E41':'m','\u1E43':'m','\u0271':'m','\u026F':'m','\u24DD':'n','\uFF4E':'n','\u01F9':'n','\u0144':'n','\u00F1':'n','\u1E45':'n','\u0148':'n','\u1E47':'n','\u0146':'n','\u1E4B':'n','\u1E49':'n','\u019E':'n','\u0272':'n','\u0149':'n','\uA791':'n','\uA7A5':'n','\u01CC':'nj','\u24DE':'o','\uFF4F':'o','\u00F2':'o','\u00F3':'o','\u00F4':'o','\u1ED3':'o','\u1ED1':'o','\u1ED7':'o','\u1ED5':'o','\u00F5':'o','\u1E4D':'o','\u022D':'o','\u1E4F':'o','\u014D':'o','\u1E51':'o','\u1E53':'o','\u014F':'o','\u022F':'o','\u0231':'o','\u00F6':'o','\u022B':'o','\u1ECF':'o','\u0151':'o','\u01D2':'o','\u020D':'o','\u020F':'o','\u01A1':'o','\u1EDD':'o','\u1EDB':'o','\u1EE1':'o','\u1EDF':'o','\u1EE3':'o','\u1ECD':'o','\u1ED9':'o','\u01EB':'o','\u01ED':'o','\u00F8':'o','\u01FF':'o','\u0254':'o','\uA74B':'o','\uA74D':'o','\u0275':'o','\u01A3':'oi','\u0223':'ou','\uA74F':'oo','\u24DF':'p','\uFF50':'p','\u1E55':'p','\u1E57':'p','\u01A5':'p','\u1D7D':'p','\uA751':'p','\uA753':'p','\uA755':'p','\u24E0':'q','\uFF51':'q','\u024B':'q','\uA757':'q','\uA759':'q','\u24E1':'r','\uFF52':'r','\u0155':'r','\u1E59':'r','\u0159':'r','\u0211':'r','\u0213':'r','\u1E5B':'r','\u1E5D':'r','\u0157':'r','\u1E5F':'r','\u024D':'r','\u027D':'r','\uA75B':'r','\uA7A7':'r','\uA783':'r','\u24E2':'s','\uFF53':'s','\u00DF':'s','\u015B':'s','\u1E65':'s','\u015D':'s','\u1E61':'s','\u0161':'s','\u1E67':'s','\u1E63':'s','\u1E69':'s','\u0219':'s','\u015F':'s','\u023F':'s','\uA7A9':'s','\uA785':'s','\u1E9B':'s','\u24E3':'t','\uFF54':'t','\u1E6B':'t','\u1E97':'t','\u0165':'t','\u1E6D':'t','\u021B':'t','\u0163':'t','\u1E71':'t','\u1E6F':'t','\u0167':'t','\u01AD':'t','\u0288':'t','\u2C66':'t','\uA787':'t','\uA729':'tz','\u24E4':'u','\uFF55':'u','\u00F9':'u','\u00FA':'u','\u00FB':'u','\u0169':'u','\u1E79':'u','\u016B':'u','\u1E7B':'u','\u016D':'u','\u00FC':'u','\u01DC':'u','\u01D8':'u','\u01D6':'u','\u01DA':'u','\u1EE7':'u','\u016F':'u','\u0171':'u','\u01D4':'u','\u0215':'u','\u0217':'u','\u01B0':'u','\u1EEB':'u','\u1EE9':'u','\u1EEF':'u','\u1EED':'u','\u1EF1':'u','\u1EE5':'u','\u1E73':'u','\u0173':'u','\u1E77':'u','\u1E75':'u','\u0289':'u','\u24E5':'v','\uFF56':'v','\u1E7D':'v','\u1E7F':'v','\u028B':'v','\uA75F':'v','\u028C':'v','\uA761':'vy','\u24E6':'w','\uFF57':'w','\u1E81':'w','\u1E83':'w','\u0175':'w','\u1E87':'w','\u1E85':'w','\u1E98':'w','\u1E89':'w','\u2C73':'w','\u24E7':'x','\uFF58':'x','\u1E8B':'x','\u1E8D':'x','\u24E8':'y','\uFF59':'y','\u1EF3':'y','\u00FD':'y','\u0177':'y','\u1EF9':'y','\u0233':'y','\u1E8F':'y','\u00FF':'y','\u1EF7':'y','\u1E99':'y','\u1EF5':'y','\u01B4':'y','\u024F':'y','\u1EFF':'y','\u24E9':'z','\uFF5A':'z','\u017A':'z','\u1E91':'z','\u017C':'z','\u017E':'z','\u1E93':'z','\u1E95':'z','\u01B6':'z','\u0225':'z','\u0240':'z','\u2C6C':'z','\uA763':'z','\u0386':'\u0391','\u0388':'\u0395','\u0389':'\u0397','\u038A':'\u0399','\u03AA':'\u0399','\u038C':'\u039F','\u038E':'\u03A5','\u03AB':'\u03A5','\u038F':'\u03A9','\u03AC':'\u03B1','\u03AD':'\u03B5','\u03AE':'\u03B7','\u03AF':'\u03B9','\u03CA':'\u03B9','\u0390':'\u03B9','\u03CC':'\u03BF','\u03CD':'\u03C5','\u03CB':'\u03C5','\u03B0':'\u03C5','\u03C9':'\u03C9','\u03C2':'\u03C3'};return diacritics;});S2.define('select2/data/base',['../utils'],function(Utils){function BaseAdapter($element,options){BaseAdapter.__super__.constructor.call(this);}Utils.Extend(BaseAdapter,Utils.Observable);BaseAdapter.prototype.current=function(callback){throw new Error('The `current` method must be defined in child classes.');};BaseAdapter.prototype.query=function(params,callback){throw new Error('The `query` method must be defined in child classes.');};BaseAdapter.prototype.bind=function(container,$container){// Can be implemented in subclasses
};BaseAdapter.prototype.destroy=function(){// Can be implemented in subclasses
};BaseAdapter.prototype.generateResultId=function(container,data){var id=container.id+'-result-';id+=Utils.generateChars(4);if(data.id!=null){id+='-'+data.id.toString();}else{id+='-'+Utils.generateChars(4);}return id;};return BaseAdapter;});S2.define('select2/data/select',['./base','../utils','jquery'],function(BaseAdapter,Utils,$){function SelectAdapter($element,options){this.$element=$element;this.options=options;SelectAdapter.__super__.constructor.call(this);}Utils.Extend(SelectAdapter,BaseAdapter);SelectAdapter.prototype.current=function(callback){var data=[];var self=this;this.$element.find(':selected').each(function(){var $option=$(this);var option=self.item($option);data.push(option);});callback(data);};SelectAdapter.prototype.select=function(data){var self=this;data.selected=true;// If data.element is a DOM node, use it instead
if($(data.element).is('option')){data.element.selected=true;this.$element.trigger('change');return;}if(this.$element.prop('multiple')){this.current(function(currentData){var val=[];data=[data];data.push.apply(data,currentData);for(var d=0;d<data.length;d++){var id=data[d].id;if($.inArray(id,val)===-1){val.push(id);}}self.$element.val(val);self.$element.trigger('change');});}else{var val=data.id;this.$element.val(val);this.$element.trigger('change');}};SelectAdapter.prototype.unselect=function(data){var self=this;if(!this.$element.prop('multiple')){return;}data.selected=false;if($(data.element).is('option')){data.element.selected=false;this.$element.trigger('change');return;}this.current(function(currentData){var val=[];for(var d=0;d<currentData.length;d++){var id=currentData[d].id;if(id!==data.id&&$.inArray(id,val)===-1){val.push(id);}}self.$element.val(val);self.$element.trigger('change');});};SelectAdapter.prototype.bind=function(container,$container){var self=this;this.container=container;container.on('select',function(params){self.select(params.data);});container.on('unselect',function(params){self.unselect(params.data);});};SelectAdapter.prototype.destroy=function(){// Remove anything added to child elements
this.$element.find('*').each(function(){// Remove any custom data set by Select2
$.removeData(this,'data');});};SelectAdapter.prototype.query=function(params,callback){var data=[];var self=this;var $options=this.$element.children();$options.each(function(){var $option=$(this);if(!$option.is('option')&&!$option.is('optgroup')){return;}var option=self.item($option);var matches=self.matches(params,option);if(matches!==null){data.push(matches);}});callback({results:data});};SelectAdapter.prototype.addOptions=function($options){Utils.appendMany(this.$element,$options);};SelectAdapter.prototype.option=function(data){var option;if(data.children){option=document.createElement('optgroup');option.label=data.text;}else{option=document.createElement('option');if(option.textContent!==undefined){option.textContent=data.text;}else{option.innerText=data.text;}}if(data.id){option.value=data.id;}if(data.disabled){option.disabled=true;}if(data.selected){option.selected=true;}if(data.title){option.title=data.title;}var $option=$(option);var normalizedData=this._normalizeItem(data);normalizedData.element=option;// Override the option's data with the combined data
$.data(option,'data',normalizedData);return $option;};SelectAdapter.prototype.item=function($option){var data={};data=$.data($option[0],'data');if(data!=null){return data;}if($option.is('option')){data={id:$option.val(),text:$option.text(),disabled:$option.prop('disabled'),selected:$option.prop('selected'),title:$option.prop('title')};}else if($option.is('optgroup')){data={text:$option.prop('label'),children:[],title:$option.prop('title')};var $children=$option.children('option');var children=[];for(var c=0;c<$children.length;c++){var $child=$($children[c]);var child=this.item($child);children.push(child);}data.children=children;}data=this._normalizeItem(data);data.element=$option[0];$.data($option[0],'data',data);return data;};SelectAdapter.prototype._normalizeItem=function(item){if(!$.isPlainObject(item)){item={id:item,text:item};}item=$.extend({},{text:''},item);var defaults={selected:false,disabled:false};if(item.id!=null){item.id=item.id.toString();}if(item.text!=null){item.text=item.text.toString();}if(item._resultId==null&&item.id&&this.container!=null){item._resultId=this.generateResultId(this.container,item);}return $.extend({},defaults,item);};SelectAdapter.prototype.matches=function(params,data){var matcher=this.options.get('matcher');return matcher(params,data);};return SelectAdapter;});S2.define('select2/data/array',['./select','../utils','jquery'],function(SelectAdapter,Utils,$){function ArrayAdapter($element,options){var data=options.get('data')||[];ArrayAdapter.__super__.constructor.call(this,$element,options);this.addOptions(this.convertToOptions(data));}Utils.Extend(ArrayAdapter,SelectAdapter);ArrayAdapter.prototype.select=function(data){var $option=this.$element.find('option').filter(function(i,elm){return elm.value==data.id.toString();});if($option.length===0){$option=this.option(data);this.addOptions($option);}ArrayAdapter.__super__.select.call(this,data);};ArrayAdapter.prototype.convertToOptions=function(data){var self=this;var $existing=this.$element.find('option');var existingIds=$existing.map(function(){return self.item($(this)).id;}).get();var $options=[];// Filter out all items except for the one passed in the argument
function onlyItem(item){return function(){return $(this).val()==item.id;};}for(var d=0;d<data.length;d++){var item=this._normalizeItem(data[d]);// Skip items which were pre-loaded, only merge the data
if($.inArray(item.id,existingIds)>=0){var $existingOption=$existing.filter(onlyItem(item));var existingData=this.item($existingOption);var newData=$.extend(true,{},existingData,item);var $newOption=this.option(existingData);$existingOption.replaceWith($newOption);continue;}var $option=this.option(item);if(item.children){var $children=this.convertToOptions(item.children);Utils.appendMany($option,$children);}$options.push($option);}return $options;};return ArrayAdapter;});S2.define('select2/data/ajax',['./array','../utils','jquery'],function(ArrayAdapter,Utils,$){function AjaxAdapter($element,options){this.ajaxOptions=this._applyDefaults(options.get('ajax'));if(this.ajaxOptions.processResults!=null){this.processResults=this.ajaxOptions.processResults;}ArrayAdapter.__super__.constructor.call(this,$element,options);}Utils.Extend(AjaxAdapter,ArrayAdapter);AjaxAdapter.prototype._applyDefaults=function(options){var defaults={data:function(params){return{q:params.term};},transport:function(params,success,failure){var $request=$.ajax(params);$request.then(success);$request.fail(failure);return $request;}};return $.extend({},defaults,options,true);};AjaxAdapter.prototype.processResults=function(results){return results;};AjaxAdapter.prototype.query=function(params,callback){var matches=[];var self=this;if(this._request!=null){// JSONP requests cannot always be aborted
if($.isFunction(this._request.abort)){this._request.abort();}this._request=null;}var options=$.extend({type:'GET'},this.ajaxOptions);if(typeof options.url==='function'){options.url=options.url(params);}if(typeof options.data==='function'){options.data=options.data(params);}function request(){var $request=options.transport(options,function(data){var results=self.processResults(data,params);if(self.options.get('debug')&&window.console&&console.error){// Check to make sure that the response included a `results` key.
if(!results||!results.results||!$.isArray(results.results)){console.error('Select2: The AJAX results did not return an array in the '+'`results` key of the response.');}}callback(results);},function(){// TODO: Handle AJAX errors
});self._request=$request;}if(this.ajaxOptions.delay&&params.term!==''){if(this._queryTimeout){window.clearTimeout(this._queryTimeout);}this._queryTimeout=window.setTimeout(request,this.ajaxOptions.delay);}else{request();}};return AjaxAdapter;});S2.define('select2/data/tags',['jquery'],function($){function Tags(decorated,$element,options){var tags=options.get('tags');var createTag=options.get('createTag');if(createTag!==undefined){this.createTag=createTag;}decorated.call(this,$element,options);if($.isArray(tags)){for(var t=0;t<tags.length;t++){var tag=tags[t];var item=this._normalizeItem(tag);var $option=this.option(item);this.$element.append($option);}}}Tags.prototype.query=function(decorated,params,callback){var self=this;this._removeOldTags();if(params.term==null||params.page!=null){decorated.call(this,params,callback);return;}function wrapper(obj,child){var data=obj.results;for(var i=0;i<data.length;i++){var option=data[i];var checkChildren=option.children!=null&&!wrapper({results:option.children},true);var checkText=option.text===params.term;if(checkText||checkChildren){if(child){return false;}obj.data=data;callback(obj);return;}}if(child){return true;}var tag=self.createTag(params);if(tag!=null){var $option=self.option(tag);$option.attr('data-select2-tag',true);self.addOptions([$option]);self.insertTag(data,tag);}obj.results=data;callback(obj);}decorated.call(this,params,wrapper);};Tags.prototype.createTag=function(decorated,params){var term=$.trim(params.term);if(term===''){return null;}return{id:term,text:term};};Tags.prototype.insertTag=function(_,data,tag){data.unshift(tag);};Tags.prototype._removeOldTags=function(_){var tag=this._lastTag;var $options=this.$element.find('option[data-select2-tag]');$options.each(function(){if(this.selected){return;}$(this).remove();});};return Tags;});S2.define('select2/data/tokenizer',['jquery'],function($){function Tokenizer(decorated,$element,options){var tokenizer=options.get('tokenizer');if(tokenizer!==undefined){this.tokenizer=tokenizer;}decorated.call(this,$element,options);}Tokenizer.prototype.bind=function(decorated,container,$container){decorated.call(this,container,$container);this.$search=container.dropdown.$search||container.selection.$search||$container.find('.select2-search__field');};Tokenizer.prototype.query=function(decorated,params,callback){var self=this;function select(data){self.select(data);}params.term=params.term||'';var tokenData=this.tokenizer(params,this.options,select);if(tokenData.term!==params.term){// Replace the search term if we have the search box
if(this.$search.length){this.$search.val(tokenData.term);this.$search.focus();}params.term=tokenData.term;}decorated.call(this,params,callback);};Tokenizer.prototype.tokenizer=function(_,params,options,callback){var separators=options.get('tokenSeparators')||[];var term=params.term;var i=0;var createTag=this.createTag||function(params){return{id:params.term,text:params.term};};while(i<term.length){var termChar=term[i];if($.inArray(termChar,separators)===-1){i++;continue;}var part=term.substr(0,i);var partParams=$.extend({},params,{term:part});var data=createTag(partParams);callback(data);// Reset the term to not include the tokenized portion
term=term.substr(i+1)||'';i=0;}return{term:term};};return Tokenizer;});S2.define('select2/data/minimumInputLength',[],function(){function MinimumInputLength(decorated,$e,options){this.minimumInputLength=options.get('minimumInputLength');decorated.call(this,$e,options);}MinimumInputLength.prototype.query=function(decorated,params,callback){params.term=params.term||'';if(params.term.length<this.minimumInputLength){this.trigger('results:message',{message:'inputTooShort',args:{minimum:this.minimumInputLength,input:params.term,params:params}});return;}decorated.call(this,params,callback);};return MinimumInputLength;});S2.define('select2/data/maximumInputLength',[],function(){function MaximumInputLength(decorated,$e,options){this.maximumInputLength=options.get('maximumInputLength');decorated.call(this,$e,options);}MaximumInputLength.prototype.query=function(decorated,params,callback){params.term=params.term||'';if(this.maximumInputLength>0&&params.term.length>this.maximumInputLength){this.trigger('results:message',{message:'inputTooLong',args:{maximum:this.maximumInputLength,input:params.term,params:params}});return;}decorated.call(this,params,callback);};return MaximumInputLength;});S2.define('select2/data/maximumSelectionLength',[],function(){function MaximumSelectionLength(decorated,$e,options){this.maximumSelectionLength=options.get('maximumSelectionLength');decorated.call(this,$e,options);}MaximumSelectionLength.prototype.query=function(decorated,params,callback){var self=this;this.current(function(currentData){var count=currentData!=null?currentData.length:0;if(self.maximumSelectionLength>0&&count>=self.maximumSelectionLength){self.trigger('results:message',{message:'maximumSelected',args:{maximum:self.maximumSelectionLength}});return;}decorated.call(self,params,callback);});};return MaximumSelectionLength;});S2.define('select2/dropdown',['jquery','./utils'],function($,Utils){function Dropdown($element,options){this.$element=$element;this.options=options;Dropdown.__super__.constructor.call(this);}Utils.Extend(Dropdown,Utils.Observable);Dropdown.prototype.render=function(){var $dropdown=$('<span class="select2-dropdown">'+'<span class="select2-results"></span>'+'</span>');$dropdown.attr('dir',this.options.get('dir'));this.$dropdown=$dropdown;return $dropdown;};Dropdown.prototype.position=function($dropdown,$container){// Should be implmented in subclasses
};Dropdown.prototype.destroy=function(){// Remove the dropdown from the DOM
this.$dropdown.remove();};return Dropdown;});S2.define('select2/dropdown/search',['jquery','../utils'],function($,Utils){function Search(){}Search.prototype.render=function(decorated){var $rendered=decorated.call(this);var $search=$('<span class="select2-search select2-search--dropdown">'+'<input class="select2-search__field" type="search" tabindex="-1"'+' autocomplete="off" autocorrect="off" autocapitalize="off"'+' spellcheck="false" role="textbox" />'+'</span>');this.$searchContainer=$search;this.$search=$search.find('input');$rendered.prepend($search);return $rendered;};Search.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);this.$search.on('keydown',function(evt){self.trigger('keypress',evt);self._keyUpPrevented=evt.isDefaultPrevented();});// Workaround for browsers which do not support the `input` event
// This will prevent double-triggering of events for browsers which support
// both the `keyup` and `input` events.
this.$search.on('input',function(evt){// Unbind the duplicated `keyup` event
$(this).off('keyup');});this.$search.on('keyup input',function(evt){self.handleSearch(evt);});container.on('open',function(){self.$search.attr('tabindex',0);self.$search.focus();window.setTimeout(function(){self.$search.focus();},0);});container.on('close',function(){self.$search.attr('tabindex',-1);self.$search.val('');});container.on('results:all',function(params){if(params.query.term==null||params.query.term===''){var showSearch=self.showSearch(params);if(showSearch){self.$searchContainer.removeClass('select2-search--hide');}else{self.$searchContainer.addClass('select2-search--hide');}}});};Search.prototype.handleSearch=function(evt){if(!this._keyUpPrevented){var input=this.$search.val();this.trigger('query',{term:input});}this._keyUpPrevented=false;};Search.prototype.showSearch=function(_,params){return true;};return Search;});S2.define('select2/dropdown/hidePlaceholder',[],function(){function HidePlaceholder(decorated,$element,options,dataAdapter){this.placeholder=this.normalizePlaceholder(options.get('placeholder'));decorated.call(this,$element,options,dataAdapter);}HidePlaceholder.prototype.append=function(decorated,data){data.results=this.removePlaceholder(data.results);decorated.call(this,data);};HidePlaceholder.prototype.normalizePlaceholder=function(_,placeholder){if(typeof placeholder==='string'){placeholder={id:'',text:placeholder};}return placeholder;};HidePlaceholder.prototype.removePlaceholder=function(_,data){var modifiedData=data.slice(0);for(var d=data.length-1;d>=0;d--){var item=data[d];if(this.placeholder.id===item.id){modifiedData.splice(d,1);}}return modifiedData;};return HidePlaceholder;});S2.define('select2/dropdown/infiniteScroll',['jquery'],function($){function InfiniteScroll(decorated,$element,options,dataAdapter){this.lastParams={};decorated.call(this,$element,options,dataAdapter);this.$loadingMore=this.createLoadingMore();this.loading=false;}InfiniteScroll.prototype.append=function(decorated,data){this.$loadingMore.remove();this.loading=false;decorated.call(this,data);if(this.showLoadingMore(data)){this.$results.append(this.$loadingMore);}};InfiniteScroll.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on('query',function(params){self.lastParams=params;self.loading=true;});container.on('query:append',function(params){self.lastParams=params;self.loading=true;});this.$results.on('scroll',function(){var isLoadMoreVisible=$.contains(document.documentElement,self.$loadingMore[0]);if(self.loading||!isLoadMoreVisible){return;}var currentOffset=self.$results.offset().top+self.$results.outerHeight(false);var loadingMoreOffset=self.$loadingMore.offset().top+self.$loadingMore.outerHeight(false);if(currentOffset+50>=loadingMoreOffset){self.loadMore();}});};InfiniteScroll.prototype.loadMore=function(){this.loading=true;var params=$.extend({},{page:1},this.lastParams);params.page++;this.trigger('query:append',params);};InfiniteScroll.prototype.showLoadingMore=function(_,data){return data.pagination&&data.pagination.more;};InfiniteScroll.prototype.createLoadingMore=function(){var $option=$('<li class="option load-more" role="treeitem"></li>');var message=this.options.get('translations').get('loadingMore');$option.html(message(this.lastParams));return $option;};return InfiniteScroll;});S2.define('select2/dropdown/attachBody',['jquery','../utils'],function($,Utils){function AttachBody(decorated,$element,options){this.$dropdownParent=options.get('dropdownParent')||document.body;decorated.call(this,$element,options);}AttachBody.prototype.bind=function(decorated,container,$container){var self=this;var setupResultsEvents=false;decorated.call(this,container,$container);container.on('open',function(){self._showDropdown();self._attachPositioningHandler(container);if(!setupResultsEvents){setupResultsEvents=true;container.on('results:all',function(){self._positionDropdown();self._resizeDropdown();});container.on('results:append',function(){self._positionDropdown();self._resizeDropdown();});}});container.on('close',function(){self._hideDropdown();self._detachPositioningHandler(container);});this.$dropdownContainer.on('mousedown',function(evt){evt.stopPropagation();});};AttachBody.prototype.position=function(decorated,$dropdown,$container){// Clone all of the container classes
$dropdown.attr('class',$container.attr('class'));$dropdown.removeClass('select2');$dropdown.addClass('select2-container--open');$dropdown.css({position:'absolute',top:-999999});this.$container=$container;};AttachBody.prototype.render=function(decorated){var $container=$('<span></span>');var $dropdown=decorated.call(this);$container.append($dropdown);this.$dropdownContainer=$container;return $container;};AttachBody.prototype._hideDropdown=function(decorated){this.$dropdownContainer.detach();};AttachBody.prototype._attachPositioningHandler=function(container){var self=this;var scrollEvent='scroll.select2.'+container.id;var resizeEvent='resize.select2.'+container.id;var orientationEvent='orientationchange.select2.'+container.id;var $watchers=this.$container.parents().filter(Utils.hasScroll);$watchers.each(function(){$(this).data('select2-scroll-position',{x:$(this).scrollLeft(),y:$(this).scrollTop()});});$watchers.on(scrollEvent,function(ev){var position=$(this).data('select2-scroll-position');$(this).scrollTop(position.y);});$(window).on(scrollEvent+' '+resizeEvent+' '+orientationEvent,function(e){self._positionDropdown();self._resizeDropdown();});};AttachBody.prototype._detachPositioningHandler=function(container){var scrollEvent='scroll.select2.'+container.id;var resizeEvent='resize.select2.'+container.id;var orientationEvent='orientationchange.select2.'+container.id;var $watchers=this.$container.parents().filter(Utils.hasScroll);$watchers.off(scrollEvent);$(window).off(scrollEvent+' '+resizeEvent+' '+orientationEvent);};AttachBody.prototype._positionDropdown=function(){var $window=$(window);var isCurrentlyAbove=this.$dropdown.hasClass('select2-dropdown--above');var isCurrentlyBelow=this.$dropdown.hasClass('select2-dropdown--below');var newDirection=null;var position=this.$container.position();var offset=this.$container.offset();offset.bottom=offset.top+this.$container.outerHeight(false);var container={height:this.$container.outerHeight(false)};container.top=offset.top;container.bottom=offset.top+container.height;var dropdown={height:this.$dropdown.outerHeight(false)};var viewport={top:$window.scrollTop(),bottom:$window.scrollTop()+$window.height()};var enoughRoomAbove=viewport.top<offset.top-dropdown.height;var enoughRoomBelow=viewport.bottom>offset.bottom+dropdown.height;var css={left:offset.left,top:container.bottom};if(!isCurrentlyAbove&&!isCurrentlyBelow){newDirection='below';}if(!enoughRoomBelow&&enoughRoomAbove&&!isCurrentlyAbove){newDirection='above';}else if(!enoughRoomAbove&&enoughRoomBelow&&isCurrentlyAbove){newDirection='below';}if(newDirection=='above'||isCurrentlyAbove&&newDirection!=='below'){css.top=container.top-dropdown.height;}if(newDirection!=null){this.$dropdown.removeClass('select2-dropdown--below select2-dropdown--above').addClass('select2-dropdown--'+newDirection);this.$container.removeClass('select2-container--below select2-container--above').addClass('select2-container--'+newDirection);}this.$dropdownContainer.css(css);};AttachBody.prototype._resizeDropdown=function(){this.$dropdownContainer.width();var css={width:this.$container.outerWidth(false)+'px'};if(this.options.get('dropdownAutoWidth')){css.minWidth=css.width;css.width='auto';}this.$dropdown.css(css);};AttachBody.prototype._showDropdown=function(decorated){this.$dropdownContainer.appendTo(this.$dropdownParent);this._positionDropdown();this._resizeDropdown();};return AttachBody;});S2.define('select2/dropdown/minimumResultsForSearch',[],function(){function countResults(data){var count=0;for(var d=0;d<data.length;d++){var item=data[d];if(item.children){count+=countResults(item.children);}else{count++;}}return count;}function MinimumResultsForSearch(decorated,$element,options,dataAdapter){this.minimumResultsForSearch=options.get('minimumResultsForSearch');if(this.minimumResultsForSearch<0){this.minimumResultsForSearch=Infinity;}decorated.call(this,$element,options,dataAdapter);}MinimumResultsForSearch.prototype.showSearch=function(decorated,params){if(countResults(params.data.results)<this.minimumResultsForSearch){return false;}return decorated.call(this,params);};return MinimumResultsForSearch;});S2.define('select2/dropdown/selectOnClose',[],function(){function SelectOnClose(){}SelectOnClose.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on('close',function(){self._handleSelectOnClose();});};SelectOnClose.prototype._handleSelectOnClose=function(){var $highlightedResults=this.getHighlightedResults();if($highlightedResults.length<1){return;}this.trigger('select',{data:$highlightedResults.data('data')});};return SelectOnClose;});S2.define('select2/dropdown/closeOnSelect',[],function(){function CloseOnSelect(){}CloseOnSelect.prototype.bind=function(decorated,container,$container){var self=this;decorated.call(this,container,$container);container.on('select',function(evt){self._selectTriggered(evt);});container.on('unselect',function(evt){self._selectTriggered(evt);});};CloseOnSelect.prototype._selectTriggered=function(_,evt){var originalEvent=evt.originalEvent;// Don't close if the control key is being held
if(originalEvent&&originalEvent.ctrlKey){return;}this.trigger('close');};return CloseOnSelect;});S2.define('select2/i18n/en',[],function(){// English
return{errorLoading:function(){return'The results could not be loaded.';},inputTooLong:function(args){var overChars=args.input.length-args.maximum;var message='Please delete '+overChars+' character';if(overChars!=1){message+='s';}return message;},inputTooShort:function(args){var remainingChars=args.minimum-args.input.length;var message='Please enter '+remainingChars+' or more characters';return message;},loadingMore:function(){return'Loading more results';},maximumSelected:function(args){var message='You can only select '+args.maximum+' item';if(args.maximum!=1){message+='s';}return message;},noResults:function(){return'No results found';},searching:function(){return'Searching';}};});S2.define('select2/defaults',['jquery','require','./results','./selection/single','./selection/multiple','./selection/placeholder','./selection/allowClear','./selection/search','./selection/eventRelay','./utils','./translation','./diacritics','./data/select','./data/array','./data/ajax','./data/tags','./data/tokenizer','./data/minimumInputLength','./data/maximumInputLength','./data/maximumSelectionLength','./dropdown','./dropdown/search','./dropdown/hidePlaceholder','./dropdown/infiniteScroll','./dropdown/attachBody','./dropdown/minimumResultsForSearch','./dropdown/selectOnClose','./dropdown/closeOnSelect','./i18n/en'],function($,require,ResultsList,SingleSelection,MultipleSelection,Placeholder,AllowClear,SelectionSearch,EventRelay,Utils,Translation,DIACRITICS,SelectData,ArrayData,AjaxData,Tags,Tokenizer,MinimumInputLength,MaximumInputLength,MaximumSelectionLength,Dropdown,DropdownSearch,HidePlaceholder,InfiniteScroll,AttachBody,MinimumResultsForSearch,SelectOnClose,CloseOnSelect,EnglishTranslation){function Defaults(){this.reset();}Defaults.prototype.apply=function(options){options=$.extend({},this.defaults,options);if(options.dataAdapter==null){if(options.ajax!=null){options.dataAdapter=AjaxData;}else if(options.data!=null){options.dataAdapter=ArrayData;}else{options.dataAdapter=SelectData;}if(options.minimumInputLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MinimumInputLength);}if(options.maximumInputLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MaximumInputLength);}if(options.maximumSelectionLength>0){options.dataAdapter=Utils.Decorate(options.dataAdapter,MaximumSelectionLength);}if(options.tags){options.dataAdapter=Utils.Decorate(options.dataAdapter,Tags);}if(options.tokenSeparators!=null||options.tokenizer!=null){options.dataAdapter=Utils.Decorate(options.dataAdapter,Tokenizer);}if(options.query!=null){var Query=require(options.amdBase+'compat/query');options.dataAdapter=Utils.Decorate(options.dataAdapter,Query);}if(options.initSelection!=null){var InitSelection=require(options.amdBase+'compat/initSelection');options.dataAdapter=Utils.Decorate(options.dataAdapter,InitSelection);}}if(options.resultsAdapter==null){options.resultsAdapter=ResultsList;if(options.ajax!=null){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,InfiniteScroll);}if(options.placeholder!=null){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,HidePlaceholder);}if(options.selectOnClose){options.resultsAdapter=Utils.Decorate(options.resultsAdapter,SelectOnClose);}}if(options.dropdownAdapter==null){if(options.multiple){options.dropdownAdapter=Dropdown;}else{var SearchableDropdown=Utils.Decorate(Dropdown,DropdownSearch);options.dropdownAdapter=SearchableDropdown;}if(options.minimumResultsForSearch!==0){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,MinimumResultsForSearch);}if(options.closeOnSelect){options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,CloseOnSelect);}if(options.dropdownCssClass!=null||options.dropdownCss!=null||options.adaptDropdownCssClass!=null){var DropdownCSS=require(options.amdBase+'compat/dropdownCss');options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,DropdownCSS);}options.dropdownAdapter=Utils.Decorate(options.dropdownAdapter,AttachBody);}if(options.selectionAdapter==null){if(options.multiple){options.selectionAdapter=MultipleSelection;}else{options.selectionAdapter=SingleSelection;}// Add the placeholder mixin if a placeholder was specified
if(options.placeholder!=null){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,Placeholder);}if(options.allowClear){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,AllowClear);}if(options.multiple){options.selectionAdapter=Utils.Decorate(options.selectionAdapter,SelectionSearch);}if(options.containerCssClass!=null||options.containerCss!=null||options.adaptContainerCssClass!=null){var ContainerCSS=require(options.amdBase+'compat/containerCss');options.selectionAdapter=Utils.Decorate(options.selectionAdapter,ContainerCSS);}options.selectionAdapter=Utils.Decorate(options.selectionAdapter,EventRelay);}if(typeof options.language==='string'){// Check if the language is specified with a region
if(options.language.indexOf('-')>0){// Extract the region information if it is included
var languageParts=options.language.split('-');var baseLanguage=languageParts[0];options.language=[options.language,baseLanguage];}else{options.language=[options.language];}}if($.isArray(options.language)){var languages=new Translation();options.language.push('en');var languageNames=options.language;for(var l=0;l<languageNames.length;l++){var name=languageNames[l];var language={};try{// Try to load it with the original name
language=Translation.loadPath(name);}catch(e){try{// If we couldn't load it, check if it wasn't the full path
name=this.defaults.amdLanguageBase+name;language=Translation.loadPath(name);}catch(ex){// The translation could not be loaded at all. Sometimes this is
// because of a configuration problem, other times this can be
// because of how Select2 helps load all possible translation files.
if(options.debug&&window.console&&console.warn){console.warn('Select2: The language file for "'+name+'" could not be '+'automatically loaded. A fallback will be used instead.');}continue;}}languages.extend(language);}options.translations=languages;}else{var baseTranslation=Translation.loadPath(this.defaults.amdLanguageBase+'en');var customTranslation=new Translation(options.language);customTranslation.extend(baseTranslation);options.translations=customTranslation;}return options;};Defaults.prototype.reset=function(){function stripDiacritics(text){// Used 'uni range + named function' from http://jsperf.com/diacritics/18
function match(a){return DIACRITICS[a]||a;}return text.replace(/[^\u0000-\u007E]/g,match);}function matcher(params,data){// Always return the object if there is nothing to compare
if($.trim(params.term)===''){return data;}// Do a recursive check for options with children
if(data.children&&data.children.length>0){// Clone the data object if there are children
// This is required as we modify the object to remove any non-matches
var match=$.extend(true,{},data);// Check each child of the option
for(var c=data.children.length-1;c>=0;c--){var child=data.children[c];var matches=matcher(params,child);// If there wasn't a match, remove the object in the array
if(matches==null){match.children.splice(c,1);}}// If any children matched, return the new object
if(match.children.length>0){return match;}// If there were no matching children, check just the plain object
return matcher(params,match);}var original=stripDiacritics(data.text).toUpperCase();var term=stripDiacritics(params.term).toUpperCase();// Check if the text contains the term
if(original.indexOf(term)>-1){return data;}// If it doesn't contain the term, don't return anything
return null;}this.defaults={amdBase:'./',amdLanguageBase:'./i18n/',closeOnSelect:true,debug:false,dropdownAutoWidth:false,escapeMarkup:Utils.escapeMarkup,language:EnglishTranslation,matcher:matcher,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:false,sorter:function(data){return data;},templateResult:function(result){return result.text;},templateSelection:function(selection){return selection.text;},theme:'default',width:'resolve'};};Defaults.prototype.set=function(key,value){var camelKey=$.camelCase(key);var data={};data[camelKey]=value;var convertedData=Utils._convertData(data);$.extend(this.defaults,convertedData);};var defaults=new Defaults();return defaults;});S2.define('select2/options',['require','jquery','./defaults','./utils'],function(require,$,Defaults,Utils){function Options(options,$element){this.options=options;if($element!=null){this.fromElement($element);}this.options=Defaults.apply(this.options);if($element&&$element.is('input')){var InputCompat=require(this.get('amdBase')+'compat/inputData');this.options.dataAdapter=Utils.Decorate(this.options.dataAdapter,InputCompat);}}Options.prototype.fromElement=function($e){var excludedData=['select2'];if(this.options.multiple==null){this.options.multiple=$e.prop('multiple');}if(this.options.disabled==null){this.options.disabled=$e.prop('disabled');}if(this.options.language==null){if($e.prop('lang')){this.options.language=$e.prop('lang').toLowerCase();}else if($e.closest('[lang]').prop('lang')){this.options.language=$e.closest('[lang]').prop('lang');}}if(this.options.dir==null){if($e.prop('dir')){this.options.dir=$e.prop('dir');}else if($e.closest('[dir]').prop('dir')){this.options.dir=$e.closest('[dir]').prop('dir');}else{this.options.dir='ltr';}}$e.prop('disabled',this.options.disabled);$e.prop('multiple',this.options.multiple);if($e.data('select2Tags')){if(this.options.debug&&window.console&&console.warn){console.warn('Select2: The `data-select2-tags` attribute has been changed to '+'use the `data-data` and `data-tags="true"` attributes and will be '+'removed in future versions of Select2.');}$e.data('data',$e.data('select2Tags'));$e.data('tags',true);}if($e.data('ajaxUrl')){if(this.options.debug&&window.console&&console.warn){console.warn('Select2: The `data-ajax-url` attribute has been changed to '+'`data-ajax--url` and support for the old attribute will be removed'+' in future versions of Select2.');}$e.attr('ajax--url',$e.data('ajaxUrl'));$e.data('ajax--url',$e.data('ajaxUrl'));}var dataset={};// Prefer the element's `dataset` attribute if it exists
// jQuery 1.x does not correctly handle data attributes with multiple dashes
if($.fn.jquery&&$.fn.jquery.substr(0,2)=='1.'&&$e[0].dataset){dataset=$.extend(true,{},$e[0].dataset,$e.data());}else{dataset=$e.data();}var data=$.extend(true,{},dataset);data=Utils._convertData(data);for(var key in data){if($.inArray(key,excludedData)>-1){continue;}if($.isPlainObject(this.options[key])){$.extend(this.options[key],data[key]);}else{this.options[key]=data[key];}}return this;};Options.prototype.get=function(key){return this.options[key];};Options.prototype.set=function(key,val){this.options[key]=val;};return Options;});S2.define('select2/core',['jquery','./options','./utils','./keys'],function($,Options,Utils,KEYS){var Select2=function($element,options){if($element.data('select2')!=null){$element.data('select2').destroy();}this.$element=$element;this.id=this._generateId($element);options=options||{};this.options=new Options(options,$element);Select2.__super__.constructor.call(this);// Set up the tabindex
var tabindex=$element.attr('tabindex')||0;$element.data('old-tabindex',tabindex);$element.attr('tabindex','-1');// Set up containers and adapters
var DataAdapter=this.options.get('dataAdapter');this.dataAdapter=new DataAdapter($element,this.options);var $container=this.render();this._placeContainer($container);var SelectionAdapter=this.options.get('selectionAdapter');this.selection=new SelectionAdapter($element,this.options);this.$selection=this.selection.render();this.selection.position(this.$selection,$container);var DropdownAdapter=this.options.get('dropdownAdapter');this.dropdown=new DropdownAdapter($element,this.options);this.$dropdown=this.dropdown.render();this.dropdown.position(this.$dropdown,$container);var ResultsAdapter=this.options.get('resultsAdapter');this.results=new ResultsAdapter($element,this.options,this.dataAdapter);this.$results=this.results.render();this.results.position(this.$results,this.$dropdown);// Bind events
var self=this;// Bind the container to all of the adapters
this._bindAdapters();// Register any DOM event handlers
this._registerDomEvents();// Register any internal event handlers
this._registerDataEvents();this._registerSelectionEvents();this._registerDropdownEvents();this._registerResultsEvents();this._registerEvents();// Set the initial state
this.dataAdapter.current(function(initialData){self.trigger('selection:update',{data:initialData});});// Hide the original select
$element.addClass('select2-hidden-accessible');$element.attr('aria-hidden','true');// Synchronize any monitored attributes
this._syncAttributes();$element.data('select2',this);};Utils.Extend(Select2,Utils.Observable);Select2.prototype._generateId=function($element){var id='';if($element.attr('id')!=null){id=$element.attr('id');}else if($element.attr('name')!=null){id=$element.attr('name')+'-'+Utils.generateChars(2);}else{id=Utils.generateChars(4);}id='select2-'+id;return id;};Select2.prototype._placeContainer=function($container){$container.insertAfter(this.$element);var width=this._resolveWidth(this.$element,this.options.get('width'));if(width!=null){$container.css('width',width);}};Select2.prototype._resolveWidth=function($element,method){var WIDTH=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if(method=='resolve'){var styleWidth=this._resolveWidth($element,'style');if(styleWidth!=null){return styleWidth;}return this._resolveWidth($element,'element');}if(method=='element'){var elementWidth=$element.outerWidth(false);if(elementWidth<=0){return'auto';}return elementWidth+'px';}if(method=='style'){var style=$element.attr('style');if(typeof style!=='string'){return null;}var attrs=style.split(';');for(var i=0,l=attrs.length;i<l;i=i+1){var attr=attrs[i].replace(/\s/g,'');var matches=attr.match(WIDTH);if(matches!==null&&matches.length>=1){return matches[1];}}return null;}return method;};Select2.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container);this.selection.bind(this,this.$container);this.dropdown.bind(this,this.$container);this.results.bind(this,this.$container);};Select2.prototype._registerDomEvents=function(){var self=this;this.$element.on('change.select2',function(){self.dataAdapter.current(function(data){self.trigger('selection:update',{data:data});});});this._sync=Utils.bind(this._syncAttributes,this);if(this.$element[0].attachEvent){this.$element[0].attachEvent('onpropertychange',this._sync);}var observer=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(observer!=null){this._observer=new observer(function(mutations){$.each(mutations,self._sync);});this._observer.observe(this.$element[0],{attributes:true,subtree:false});}else if(this.$element[0].addEventListener){this.$element[0].addEventListener('DOMAttrModified',self._sync,false);}};Select2.prototype._registerDataEvents=function(){var self=this;this.dataAdapter.on('*',function(name,params){self.trigger(name,params);});};Select2.prototype._registerSelectionEvents=function(){var self=this;var nonRelayEvents=['toggle'];this.selection.on('toggle',function(){self.toggleDropdown();});this.selection.on('*',function(name,params){if($.inArray(name,nonRelayEvents)!==-1){return;}self.trigger(name,params);});};Select2.prototype._registerDropdownEvents=function(){var self=this;this.dropdown.on('*',function(name,params){self.trigger(name,params);});};Select2.prototype._registerResultsEvents=function(){var self=this;this.results.on('*',function(name,params){self.trigger(name,params);});};Select2.prototype._registerEvents=function(){var self=this;this.on('open',function(){self.$container.addClass('select2-container--open');});this.on('close',function(){self.$container.removeClass('select2-container--open');});this.on('enable',function(){self.$container.removeClass('select2-container--disabled');});this.on('disable',function(){self.$container.addClass('select2-container--disabled');});this.on('focus',function(){self.$container.addClass('select2-container--focus');});this.on('blur',function(){self.$container.removeClass('select2-container--focus');});this.on('query',function(params){if(!self.isOpen()){self.trigger('open');}this.dataAdapter.query(params,function(data){self.trigger('results:all',{data:data,query:params});});});this.on('query:append',function(params){this.dataAdapter.query(params,function(data){self.trigger('results:append',{data:data,query:params});});});this.on('keypress',function(evt){var key=evt.which;if(self.isOpen()){if(key===KEYS.ENTER){self.trigger('results:select');evt.preventDefault();}else if(key===KEYS.SPACE&&evt.ctrlKey){self.trigger('results:toggle');evt.preventDefault();}else if(key===KEYS.UP){self.trigger('results:previous');evt.preventDefault();}else if(key===KEYS.DOWN){self.trigger('results:next');evt.preventDefault();}else if(key===KEYS.ESC||key===KEYS.TAB){self.close();evt.preventDefault();}}else{if(key===KEYS.ENTER||key===KEYS.SPACE||(key===KEYS.DOWN||key===KEYS.UP)&&evt.altKey){self.open();evt.preventDefault();}}});};Select2.prototype._syncAttributes=function(){this.options.set('disabled',this.$element.prop('disabled'));if(this.options.get('disabled')){if(this.isOpen()){this.close();}this.trigger('disable');}else{this.trigger('enable');}};/**
   * Override the trigger method to automatically trigger pre-events when
   * there are events that can be prevented.
   */Select2.prototype.trigger=function(name,args){var actualTrigger=Select2.__super__.trigger;var preTriggerMap={'open':'opening','close':'closing','select':'selecting','unselect':'unselecting'};if(name in preTriggerMap){var preTriggerName=preTriggerMap[name];var preTriggerArgs={prevented:false,name:name,args:args};actualTrigger.call(this,preTriggerName,preTriggerArgs);if(preTriggerArgs.prevented){args.prevented=true;return;}}actualTrigger.call(this,name,args);};Select2.prototype.toggleDropdown=function(){if(this.options.get('disabled')){return;}if(this.isOpen()){this.close();}else{this.open();}};Select2.prototype.open=function(){if(this.isOpen()){return;}this.trigger('query',{});this.trigger('open');};Select2.prototype.close=function(){if(!this.isOpen()){return;}this.trigger('close');};Select2.prototype.isOpen=function(){return this.$container.hasClass('select2-container--open');};Select2.prototype.enable=function(args){if(this.options.get('debug')&&window.console&&console.warn){console.warn('Select2: The `select2("enable")` method has been deprecated and will'+' be removed in later Select2 versions. Use $element.prop("disabled")'+' instead.');}if(args==null||args.length===0){args=[true];}var disabled=!args[0];this.$element.prop('disabled',disabled);};Select2.prototype.data=function(){if(this.options.get('debug')&&arguments.length>0&&window.console&&console.warn){console.warn('Select2: Data can no longer be set using `select2("data")`. You '+'should consider setting the value instead using `$element.val()`.');}var data=[];this.dataAdapter.current(function(currentData){data=currentData;});return data;};Select2.prototype.val=function(args){if(this.options.get('debug')&&window.console&&console.warn){console.warn('Select2: The `select2("val")` method has been deprecated and will be'+' removed in later Select2 versions. Use $element.val() instead.');}if(args==null||args.length===0){return this.$element.val();}var newVal=args[0];if($.isArray(newVal)){newVal=$.map(newVal,function(obj){return obj.toString();});}this.$element.val(newVal).trigger('change');};Select2.prototype.destroy=function(){this.$container.remove();if(this.$element[0].detachEvent){this.$element[0].detachEvent('onpropertychange',this._sync);}if(this._observer!=null){this._observer.disconnect();this._observer=null;}else if(this.$element[0].removeEventListener){this.$element[0].removeEventListener('DOMAttrModified',this._sync,false);}this._sync=null;this.$element.off('.select2');this.$element.attr('tabindex',this.$element.data('old-tabindex'));this.$element.removeClass('select2-hidden-accessible');this.$element.attr('aria-hidden','false');this.$element.removeData('select2');this.dataAdapter.destroy();this.selection.destroy();this.dropdown.destroy();this.results.destroy();this.dataAdapter=null;this.selection=null;this.dropdown=null;this.results=null;};Select2.prototype.render=function(){var $container=$('<span class="select2 select2-container">'+'<span class="selection"></span>'+'<span class="dropdown-wrapper" aria-hidden="true"></span>'+'</span>');$container.attr('dir',this.options.get('dir'));this.$container=$container;this.$container.addClass('select2-container--'+this.options.get('theme'));$container.data('element',this.$element);return $container;};return Select2;});S2.define('jquery.select2',['jquery','require','./select2/core','./select2/defaults'],function($,require,Select2,Defaults){// Force jQuery.mousewheel to be loaded if it hasn't already
require('jquery.mousewheel');if($.fn.select2==null){// All methods that should return the element
var thisMethods=['open','close','destroy'];$.fn.select2=function(options){options=options||{};if(typeof options==='object'){this.each(function(){var instanceOptions=$.extend({},options,true);var instance=new Select2($(this),instanceOptions);});return this;}else if(typeof options==='string'){var instance=this.data('select2');if(instance==null&&window.console&&console.error){console.error('The select2(\''+options+'\') method was called on an '+'element that is not using Select2.');}var args=Array.prototype.slice.call(arguments,1);var ret=instance[options](args);// Check if we should be returning `this`
if($.inArray(options,thisMethods)>-1){return this;}return ret;}else{throw new Error('Invalid arguments for Select2: '+options);}};}if($.fn.select2.defaults==null){$.fn.select2.defaults=Defaults;}return Select2;});S2.define('jquery.mousewheel',['jquery'],function($){// Used to shim jQuery.mousewheel for non-full builds.
return $;});// Return the AMD loader configuration so it can be used outside of this file
return{define:S2.define,require:S2.require};}();// Autoload the jQuery bindings
// We know that all of the modules exist above this, so we're safe
var select2=S2.require('jquery.select2');// Hold the AMD module references on the jQuery function that was just loaded
// This allows Select2 to use the internal loader outside of this file, such
// as in the language files.
jQuery.fn.select2.amd=S2;// Return the Select2 instance for anyone who is importing it.
return select2;});/*!
 * Spinners 3.0.0
 * (c) 2010-2012 Nick Stakenburg - http://www.nickstakenburg.com
 *
 * Spinners is freely distributable under the terms of an MIT-style license.
 *
 * GitHub: http://github.com/staaky/spinners
 */;var Spinners={version:"3.0.0"};(function(a){function b(a){return a*Math.PI/180;}function c(a){this.element=a;}function d(b,c){b&&(this.element=b,h.remove(b),h.removeDetached(),this._position=0,this._state="stopped",this.setOptions(a.extend({color:"#000",dashes:12,radius:5,height:5,width:1.8,opacity:1,padding:3,rotation:700},c||{})),this.drawPosition(0),h.add(this));}var e={scroll:function(a,b){if(!b)return a;var c=a.slice(0,b);return a.slice(b,a.length).concat(c);},isElement:function(a){return a&&1==a.nodeType;},element:{isAttached:function(){return function(a){for(;a&&a.parentNode;)a=a.parentNode;return!!a&&!!a.body;};}()}},f={drawRoundedRectangle:function(c,d){var e=a.extend({top:0,left:0,width:0,height:0,radius:0},d||{}),f=e.left,g=e.top,h=e.width,i=e.height,e=e.radius;c.beginPath(),c.moveTo(f+e,g),c.arc(f+h-e,g+e,e,b(-90),b(0),!1),c.arc(f+h-e,g+i-e,e,b(0),b(90),!1),c.arc(f+e,g+i-e,e,b(90),b(180),!1),c.arc(f+e,g+e,e,b(-180),b(-90),!1),c.closePath(),c.fill();}},g=function(){function a(a){var c=[];0==a.indexOf("#")&&(a=a.substring(1)),a=a.toLowerCase();if(""!=a.replace(b,""))return null;3==a.length?(c[0]=a.charAt(0)+a.charAt(0),c[1]=a.charAt(1)+a.charAt(1),c[2]=a.charAt(2)+a.charAt(2)):(c[0]=a.substring(0,2),c[1]=a.substring(2,4),c[2]=a.substring(4));for(a=0;a<c.length;a++)c[a]=parseInt(c[a],16);return c.red=c[0],c.green=c[1],c.blue=c[2],c;}var b=RegExp("[0123456789abcdef]","g"),c=function(){function a(a,b,c){return a=a.toString(c||10),Array(b-a.length).join("0")+a;}return function(b,c,d){return"#"+a(b,2,16)+a(c,2,16)+a(d,2,16);};}();return{hex2rgb:a,hex2fill:function(b,c){"undefined"==typeof c&&(c=1);var d=c,e=a(b);return e[3]=d,e.opacity=d,"rgba("+e.join()+")";},rgb2hex:c};}();a.extend(Spinners,{enabled:!1,support:{canvas:function(){var b=a("<canvas>")[0];return!!b.getContext&&!!b.getContext("2d");}()},init:function(){if(this.support.canvas||window.G_vmlCanvasManager&&window.attachEvent&&-1===navigator.userAgent.indexOf("Opera"))window.G_vmlCanvasManager&&window.G_vmlCanvasManager.init_(document),this.enabled=!0;},create:function(a,b){return c.create(a,b),this.get(a);},get:function(a){return new c(a);},play:function(a){return this.get(a).play(),this;},pause:function(a){return this.get(a).pause(),this;},toggle:function(a){return this.get(a).toggle(),this;},stop:function(a){return this.get(a).stop(),this;},remove:function(a){return this.get(a).remove(),this;},removeDetached:function(){return h.removeDetached(),this;},center:function(a){return this.get(a).center(),this;},setOptions:function(a,b){return this.get(a).setOptions(b),this;},getDimensions:function(a){return a=2*h.get(a)[0].getLayout().workspace.radius,{width:a,height:a};}});var h={spinners:[],get:function(b){if(b){var c=[];return a.each(this.spinners,function(d,f){f&&(e.isElement(b)?f.element==b:a(f.element).is(b))&&c.push(f);}),c;}},add:function(a){this.spinners.push(a);},remove:function(b){a(a.map(this.spinners,function(c){if(e.isElement(b)?c.element==b:a(c.element).is(b))return c.element;})).each(a.proxy(function(a,b){this.removeByElement(b);},this));},removeByElement:function(b){var c=this.get(b)[0];c&&(c.remove(),this.spinners=a.grep(this.spinners,function(a){return a.element!=b;}));},removeDetached:function(){a.each(this.spinners,a.proxy(function(a,b){b&&b.element&&!e.element.isAttached(b.element)&&this.remove(b.element);},this));}};a.extend(c,{create:function(b,c){if(b){var f=c||{},g=[];return e.isElement(b)?g.push(new d(b,f)):a(b).each(function(a,b){g.push(new d(b,f));}),g;}}}),a.extend(c.prototype,{items:function(){return h.get(this.element);},play:function(){return a.each(this.items(),function(a,b){b.play();}),this;},stop:function(){return a.each(this.items(),function(a,b){b.stop();}),this;},pause:function(){return a.each(this.items(),function(a,b){b.pause();}),this;},toggle:function(){return a.each(this.items(),function(a,b){b.toggle();}),this;},center:function(){return a.each(this.items(),function(a,b){b.center();}),this;},setOptions:function(b){return a.each(this.items(),function(a,c){c.setOptions(b);}),this;},remove:function(){return h.remove(this.element),this;}}),a.extend(d.prototype,{setOptions:function(b){this.options=a.extend({},this.options,b||{}),this.options.radii&&(b=this.options.radii,this.options.radius=Math.min(b[0],b[1]),this.options.height=Math.max(b[0],b[1])-this.options.radius),this.options.dashWidth&&(this.options.width=this.options.dashWidth),this.options.speed&&(this.options.duration=1e3*this.options.speed);var b=this._state,c=this._position;this._layout=null,this.build(),c&&c>=this.options.dashes-1&&(this._position=this.options.dashes-1);switch(b){case"playing":this.play();break;case"paused":case"stopped":this.drawPosition(this._position);}this._centered&&this.center();},remove:function(){this.canvas&&(this.pause(),a(this.canvas).remove(),this.ctx=this.canvas=null);},build:function(){this.remove();var b=this.getLayout().workspace.radius;return a(document.body).append(this.canvas=a("<canvas>").attr({width:2*b,height:2*b}).css({zoom:1})),window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.canvas[0]),this.ctx=this.canvas[0].getContext("2d"),this.ctx.globalAlpha=this.options.opacity,a(this.element).append(this.canvas),this.ctx.translate(b,b),this;},drawPosition:function(a){var c=this.getLayout().workspace,a=e.scroll(c.opacities,-1*a),d=c.radius,c=this.options.dashes,f=b(360/c);this.ctx.clearRect(-1*d,-1*d,2*d,2*d);for(d=0;d<c;d++)this.drawDash(a[d],this.options.color),this.ctx.rotate(f);},drawDash:function(a,b){this.ctx.fillStyle=g.hex2fill(b,a);var c=this.getLayout(),d=c.workspace.radius,e=c.dash.position,c=c.dash.dimensions;f.drawRoundedRectangle(this.ctx,{top:e.top-d,left:e.left-d,width:c.width,height:c.height,radius:Math.min(c.height,c.width)/2});},_nextPosition:function(){var b=this.options.rotation/this.options.dashes;this.nextPosition(),this._playTimer=window.setTimeout(a.proxy(this._nextPosition,this),b);},nextPosition:function(){this._position==this.options.dashes-1&&(this._position=-1),this._position++,this.drawPosition(this._position);},play:function(){if("playing"!=this._state){this._state="playing";var b=this.options.rotation/this.options.dashes;return this._playTimer=window.setTimeout(a.proxy(this._nextPosition,this),b),this;}},pause:function(){if("paused"!=this._state)return this._pause(),this._state="paused",this;},_pause:function(){this._playTimer&&(window.clearTimeout(this._playTimer),this._playTimer=null);},stop:function(){if("stopped"!=this._state)return this._pause(),this._position=0,this.drawPosition(0),this._state="stopped",this;},toggle:function(){return this["playing"==this._state?"pause":"play"](),this;},getLayout:function(){if(this._layout)return this._layout;for(var a=this.options,b=a.dashes,c=a.width,d=a.radius,e=a.radius+a.height,f=Math.max(c,e),f=Math.ceil(Math.max(f,Math.sqrt(e*e+c/2*(c/2)))),a=f+=a.padding,g=1/b,h=[],i=0;i<b;i++)h.push((i+1)*g);return this._layout=b={workspace:{radius:a,opacities:h},dash:{position:{top:f-e,left:f-c/2},dimensions:{width:c,height:e-d}}};},center:function(){var b=2*this.getLayout().workspace.radius;a(this.element.parentNode).css({position:"relative"}),a(this.element).css({position:"absolute",height:b+"px",width:b+"px",top:"50%",left:"50%",marginLeft:-0.5*b+"px",marginTop:-0.5*b+"px"}),this._centered=!0;}}),Spinners.init(),Spinners.enabled||(c.create=function(){return[];});})(jQuery);/**
 * Timer handler
 * 
 * @param integer interval  Default is 1000
 * @param boolean autostart Default is true
 */var TimerHandler=function(interval,autostart){if(typeof interval=='undefined'){interval=1000;}this._interval=interval;this._callbacks=new Array();this._intervalId=null;this._lastId=0;this.pageReloadAlreadyTriggered=false;this.checkEventsAlreadyQueued=false;if(autostart!=false){this.startTimer();}};/**
 * Append a callback to the timer
 * 
 * Returns the index required to remove the callback again
 * 
 * @param  object method
 * @return integer
 */TimerHandler.prototype.appendCallback=function(method){var index=this._lastId++;this._callbacks[index]=method;return index;};TimerHandler.prototype.removeCallback=function(index){this._callbacks[index]=null;};/**
 * Start the timer
 * 
 * @return void
 */TimerHandler.prototype.startTimer=function(){var instance=this;this._intervalId=window.setInterval(function(){instance._timer();},this._interval);};/**
 * Stop the timer
 * 
 * @return void
 */TimerHandler.prototype.stopTimer=function(){window.clearInterval(this._intervalId);};/**
 * Timer which is called every N seconds
 * 
 * Executes every assigned callback
 * 
 * @return void
 */TimerHandler.prototype._timer=function(){for(var i in this._callbacks){if(this._callbacks[i]!=null){this._callbacks[i]();}}}/*!
 * Tipped - A Complete Javascript Tooltip Solution - v4.6.1
 * (c) 2012-2017 Nick Stakenburg
 *
 * http://www.tippedjs.com
 *
 * License: http://www.tippedjs.com/license
 */;!function(d,c){"function"==typeof define&&define.amd?define(["jquery"],c):"object"==typeof module&&module.exports?module.exports=c(require("jquery")):d.Tipped=c(jQuery);}(this,function($){function degrees(a){return 180*a/Math.PI;}function radian(a){return a*Math.PI/180;}function sec(a){return 1/Math.cos(a);}function sfcc(a){return String.fromCharCode.apply(String,a.replace(" ","").split(","));}function deepExtend(a,b){for(var c in b){b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=$.extend({},a[c])||{},deepExtend(a[c],b[c])):a[c]=b[c];}return a;}function Spin(){return this.initialize.apply(this,_slice.call(arguments));}function Visible(){return this.initialize.apply(this,_slice.call(arguments));}function Skin(){this.initialize.apply(this,_slice.call(arguments));}function Stem(){this.initialize.apply(this,_slice.call(arguments));}function Tooltip(){this.initialize.apply(this,_slice.call(arguments));}function Collection(){this.initialize.apply(this,_slice.call(arguments));}var Tipped={};$.extend(Tipped,{version:"4.6.1"}),Tipped.Skins={base:{afterUpdate:!1,ajax:{},cache:!0,container:!1,containment:{selector:"viewport",padding:5},close:!1,detach:!0,fadeIn:200,fadeOut:200,showDelay:75,hideDelay:25,hideAfter:!1,hideOn:{element:"mouseleave"},hideOthers:!1,position:"top",inline:!1,offset:{x:0,y:0},onHide:!1,onShow:!1,padding:!0,radius:!0,shadow:!0,showOn:{element:"mousemove"},size:"medium",spinner:!0,stem:!0,target:"element",voila:!0},reset:{ajax:!1,hideOn:{element:"mouseleave",tooltip:"mouseleave"},showOn:{element:"mouseenter",tooltip:"mouseenter"}}},$.each("dark light gray red green blue lightyellow lightblue lightpink".split(" "),function(a,b){Tipped.Skins[b]={};});var Browser=function(a){function b(b){var c=new RegExp(b+"([\\d.]+)").exec(a);return c?parseFloat(c[1]):!0;}return{IE:!(!window.attachEvent||-1!==a.indexOf("Opera"))&&b("MSIE "),Opera:a.indexOf("Opera")>-1&&(!!window.opera&&opera.version&&parseFloat(opera.version())||7.55),WebKit:a.indexOf("AppleWebKit/")>-1&&b("AppleWebKit/"),Gecko:a.indexOf("Gecko")>-1&&-1===a.indexOf("KHTML")&&b("rv:"),MobileSafari:!!a.match(/Apple.*Mobile.*Safari/),Chrome:a.indexOf("Chrome")>-1&&b("Chrome/"),ChromeMobile:a.indexOf("CrMo")>-1&&b("CrMo/"),Android:a.indexOf("Android")>-1&&b("Android "),IEMobile:a.indexOf("IEMobile")>-1&&b("IEMobile/")};}(navigator.userAgent),Support=function(){function a(a){return c(a,"prefix");}function b(a,b){for(var c in a){if(void 0!==d.style[a[c]]){return"prefix"==b?a[c]:!0;}}return!1;}function c(a,c){var d=a.charAt(0).toUpperCase()+a.substr(1),f=(a+" "+e.join(d+" ")+d).split(" ");return b(f,c);}var d=document.createElement("div"),e="Webkit Moz O ms Khtml".split(" ");return{css:{animation:c("animation"),transform:c("transform"),prefixed:a},shadow:c("boxShadow")&&c("pointerEvents"),touch:function(){try{return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch);}catch(a){return!1;}}()};}(),_slice=Array.prototype.slice,_={wrap:function(a,b){var c=a;return function(){var a=[$.proxy(c,this)].concat(_slice.call(arguments));return b.apply(this,a);};},isElement:function(a){return a&&1==a.nodeType;},isText:function(a){return a&&3==a.nodeType;},isDocumentFragment:function(a){return a&&11==a.nodeType;},delay:function(a,b){var c=_slice.call(arguments,2);return setTimeout(function(){return a.apply(a,c);},b);},defer:function(a){return _.delay.apply(this,[a,1].concat(_slice.call(arguments,1)));},pointer:function(a){return{x:a.pageX,y:a.pageY};},element:{isAttached:function(){function a(a){for(var b=a;b&&b.parentNode;){b=b.parentNode;}return b;}return function(b){var c=a(b);return!(!c||!c.body);};}()}},getUID=function(){var a=0,b="_tipped-uid-";return function(c){for(c=c||b,a++;document.getElementById(c+a);){a++;}return c+a;};}(),Position={positions:["topleft","topmiddle","topright","righttop","rightmiddle","rightbottom","bottomright","bottommiddle","bottomleft","leftbottom","leftmiddle","lefttop"],regex:{toOrientation:/^(top|left|bottom|right)(top|left|bottom|right|middle|center)$/,horizontal:/^(top|bottom)/,isCenter:/(middle|center)/,side:/^(top|bottom|left|right)/},toDimension:function(){var a={top:"height",left:"width",bottom:"height",right:"width"};return function(b){return a[b];};}(),isCenter:function(a){return!!a.toLowerCase().match(this.regex.isCenter);},isCorner:function(a){return!this.isCenter(a);},getOrientation:function(a){return a.toLowerCase().match(this.regex.horizontal)?"horizontal":"vertical";},getSide:function(a){var b=null,c=a.toLowerCase().match(this.regex.side);return c&&c[1]&&(b=c[1]),b;},split:function(a){return a.toLowerCase().match(this.regex.toOrientation);},_flip:{top:"bottom",bottom:"top",left:"right",right:"left"},flip:function(a,b){var c=this.split(a);return b?this.inverseCornerPlane(this.flip(this.inverseCornerPlane(a))):this._flip[c[1]]+c[2];},inverseCornerPlane:function(a){if(Position.isCorner(a)){var b=this.split(a);return b[2]+b[1];}return a;},adjustOffsetBasedOnPosition:function(a,b,c){var d=$.extend({},a),e={horizontal:"x",vertical:"y"},f={x:"y",y:"x"},g={top:{right:"x"},bottom:{left:"x"},left:{bottom:"y"},right:{top:"y"}},h=Position.getOrientation(b);if(h==Position.getOrientation(c)){if(Position.getSide(b)!=Position.getSide(c)){var i=f[e[h]];d[i]*=-1;}}else{var j=d.x;d.x=d.y,d.y=j;var k=g[Position.getSide(b)][Position.getSide(c)];k&&(d[k]*=-1),d[e[Position.getOrientation(c)]]=0;}return d;},getBoxFromPoints:function(a,b,c,d){var e=Math.min(a,c),f=Math.max(a,c),g=Math.min(b,d),h=Math.max(b,d);return{left:e,top:g,width:Math.max(f-e,0),height:Math.max(h-g,0)};},isPointWithinBox:function(a,b,c,d,e,f){var g=this.getBoxFromPoints(c,d,e,f);return a>=g.left&&a<=g.left+g.width&&b>=g.top&&b<=g.top+g.height;},isPointWithinBoxLayout:function(a,b,c){return this.isPointWithinBox(a,b,c.position.left,c.position.top,c.position.left+c.dimensions.width,c.position.top+c.dimensions.height);},getDistance:function(a,b,c,d){return Math.sqrt(Math.pow(Math.abs(c-a),2)+Math.pow(Math.abs(d-b),2));},intersectsLine:function(){var a=function(a,b,c,d,e,f){var g=(f-b)*(c-a)-(d-b)*(e-a);return g>0?!0:0>g?!1:!0;};return function(b,c,d,e,f,g,h,i,j){if(!j){return a(b,c,f,g,h,i)!=a(d,e,f,g,h,i)&&a(b,c,d,e,f,g)!=a(b,c,d,e,h,i);}var k,l,m,n;k=d-b,l=e-c,m=h-f,n=i-g;var o,p;if(o=(-l*(b-f)+k*(c-g))/(-m*l+k*n),p=(m*(c-g)-n*(b-f))/(-m*l+k*n),o>=0&&1>=o&&p>=0&&1>=p){var q=b+p*k,r=c+p*l;return{x:q,y:r};}return!1;};}()},Bounds={viewport:function(){var a;return a=Browser.MobileSafari||Browser.Android&&Browser.Gecko?{width:window.innerWidth,height:window.innerHeight}:{height:$(window).height(),width:$(window).width()};}},Mouse={_buffer:{pageX:0,pageY:0},_dimensions:{width:30,height:30},_shift:{x:2,y:10},getPosition:function(a){var b=this.getActualPosition(a);return{left:b.left-Math.round(0.5*this._dimensions.width)+this._shift.x,top:b.top-Math.round(0.5*this._dimensions.height)+this._shift.y};},getActualPosition:function(a){var b=a&&"number"==$.type(a.pageX)?a:this._buffer;return{left:b.pageX,top:b.pageY};},getDimensions:function(){return this._dimensions;}},Color=function(){function a(a){return("0"+parseInt(a).toString(16)).slice(-2);}function b(b){return b=b.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+a(b[1])+a(b[2])+a(b[3]);}var c={_default:"#000000",aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};return{toRGB:function(a){if(/^rgba?\(/.test(a)){return b(a);}c[a]&&(a=c[a]);var d=a.replace("#","");return /^(?:[0-9a-fA-F]{3}){1,2}$/.test(d)?(3==d.length&&(d=d.charAt(0)+d.charAt(0)+d.charAt(1)+d.charAt(1)+d.charAt(2)+d.charAt(2)),"#"+d):c._default;}};}();Spin.supported=Support.css.transform&&Support.css.animation,$.extend(Spin.prototype,{initialize:function(){this.options=$.extend({},arguments[0]||{}),this.build(),this.start();},build:function(){var a=2*(this.options.length+this.options.radius),b={height:a,width:a};this.element=$("<div>").addClass("tpd-spin").css(b),this.element.append(this._rotate=$("<div>").addClass("tpd-spin-rotate")),this.element.css({"margin-left":-0.5*b.width,"margin-top":-0.5*b.height});for(var c=this.options.lines,d=0;c>d;d++){var e,f;this._rotate.append(e=$("<div>").addClass("tpd-spin-frame").append(f=$("<div>").addClass("tpd-spin-line"))),f.css({"background-color":this.options.color,width:this.options.width,height:this.options.length,"margin-left":-0.5*this.options.width,"border-radius":Math.round(0.5*this.options.width)}),e.css({opacity:(1/c*(d+1)).toFixed(2)});var g={};g[Support.css.prefixed("transform")]="rotate("+360/c*(d+1)+"deg)",e.css(g);}},start:function(){var a={};a[Support.css.prefixed("animation")]="tpd-spin 1s infinite steps("+this.options.lines+")",this._rotate.css(a);},stop:function(){var a={};a[Support.css.prefixed("animation")]="none",this._rotate.css(a),this.element.detach();}}),$.extend(Visible.prototype,{initialize:function(a){return a="array"==$.type(a)?a:[a],this.elements=a,this._restore=[],$.each(a,$.proxy(function(a,b){var c=$(b).is(":visible");c||$(b).show(),this._restore.push({element:b,visible:c});},this)),this;},restore:function(){$.each(this._restore,function(a,b){b.visible||$(b.element).show();}),this._restore=null;}});var AjaxCache=function(){var a=[];return{get:function(b){for(var c=null,d=0;d<a.length;d++){a[d]&&a[d].url==b.url&&(a[d].type||"GET").toUpperCase()==(b.type||"GET").toUpperCase()&&$.param(a[d].data||{})==$.param(b.data||{})&&(c=a[d]);}return c;},set:function(b,c,d){var e=this.get(b);e||(e=$.extend({callbacks:{}},b),a.push(e)),e.callbacks[c]=d;},remove:function(b){for(var c=0;c<a.length;c++){a[c]&&a[c].url==b&&delete a[c];}},clear:function(){a=[];}};}(),Voila=function(a){function b(c,d,e){if(!(this instanceof b)){return new b(c,d,e);}var f=a.type(arguments[1]),g="object"===f?arguments[1]:{},h="function"===f?arguments[1]:"function"===a.type(arguments[2])?arguments[2]:!1;return this.options=a.extend({method:"onload"},g),this.deferred=new jQuery.Deferred(),h&&this.always(h),this._processed=0,this.images=[],this._add(c),this;}a.extend(b.prototype,{_add:function(b){var d="string"==a.type(b)?a(b):b instanceof jQuery||b.length>0?b:[b];a.each(d,a.proxy(function(b,d){var e=a(),f=a(d);e=f.is("img")?e.add(f):e.add(f.find("img")),e.each(a.proxy(function(b,d){this.images.push(new c(d,a.proxy(function(a){this._progress(a);},this),a.proxy(function(a){this._progress(a);},this),this.options));},this));},this)),this.images.length<1&&setTimeout(a.proxy(function(){this._resolve();},this));},abort:function(){this._progress=this._notify=this._reject=this._resolve=function(){},a.each(this.images,function(a,b){b.abort();}),this.images=[];},_progress:function(a){this._processed++,a.isLoaded||(this._broken=!0),this._notify(a),this._processed==this.images.length&&this[this._broken?"_reject":"_resolve"]();},_notify:function(a){this.deferred.notify(this,a);},_reject:function(){this.deferred.reject(this);},_resolve:function(){this.deferred.resolve(this);},always:function(a){return this.deferred.always(a),this;},done:function(a){return this.deferred.done(a),this;},fail:function(a){return this.deferred.fail(a),this;},progress:function(a){return this.deferred.progress(a),this;}});var c=function(a){var b=function(){return this.initialize.apply(this,Array.prototype.slice.call(arguments));};a.extend(b.prototype,{initialize:function(){this.options=a.extend({test:function(){},success:function(){},timeout:function(){},callAt:!1,intervals:[[0,0],[1000,10],[2000,50],[4000,100],[20000,500]]},arguments[0]||{}),this._test=this.options.test,this._success=this.options.success,this._timeout=this.options.timeout,this._ipos=0,this._time=0,this._delay=this.options.intervals[this._ipos][1],this._callTimeouts=[],this.poll(),this._createCallsAt();},poll:function(){this._polling=setTimeout(a.proxy(function(){if(this._test()){return this.success(),void 0;}if(this._time+=this._delay,this._time>=this.options.intervals[this._ipos][0]){if(!this.options.intervals[this._ipos+1]){return"function"==a.type(this._timeout)&&this._timeout(),void 0;}this._ipos++,this._delay=this.options.intervals[this._ipos][1];}this.poll();},this),this._delay);},success:function(){this.abort(),this._success();},_createCallsAt:function(){this.options.callAt&&a.each(this.options.callAt,a.proxy(function(b,c){var d=c[0],e=c[1],f=setTimeout(a.proxy(function(){e();},this),d);this._callTimeouts.push(f);},this));},_stopCallTimeouts:function(){a.each(this._callTimeouts,function(a,b){clearTimeout(b);}),this._callTimeouts=[];},abort:function(){this._stopCallTimeouts(),this._polling&&(clearTimeout(this._polling),this._polling=null);}});var c=function(){return this.initialize.apply(this,Array.prototype.slice.call(arguments));};return a.extend(c.prototype,{supports:{naturalWidth:function(){return"naturalWidth"in new Image();}()},initialize:function(b,c,d){return this.img=a(b)[0],this.successCallback=c,this.errorCallback=d,this.isLoaded=!1,this.options=a.extend({method:"onload",pollFallbackAfter:1000},arguments[3]||{}),"onload"!=this.options.method&&this.supports.naturalWidth?(this.poll(),void 0):(this.load(),void 0);},poll:function(){this._poll=new b({test:a.proxy(function(){return this.img.naturalWidth>0;},this),success:a.proxy(function(){this.success();},this),timeout:a.proxy(function(){this.error();},this),callAt:[[this.options.pollFallbackAfter,a.proxy(function(){this.load();},this)]]});},load:function(){this._loading=setTimeout(a.proxy(function(){var b=new Image();this._onloadImage=b,b.onload=a.proxy(function(){b.onload=function(){},this.supports.naturalWidth||(this.img.naturalWidth=b.width,this.img.naturalHeight=b.height,b.naturalWidth=b.width,b.naturalHeight=b.height),this.success();},this),b.onerror=a.proxy(this.error,this),b.src=this.img.src;},this));},success:function(){this._calledSuccess||(this._calledSuccess=!0,this.abort(),this.waitForRender(a.proxy(function(){this.isLoaded=!0,this.successCallback(this);},this)));},error:function(){this._calledError||(this._calledError=!0,this.abort(),this._errorRenderTimeout=setTimeout(a.proxy(function(){this.errorCallback&&this.errorCallback(this);},this)));},abort:function(){this.stopLoading(),this.stopPolling(),this.stopWaitingForRender();},stopPolling:function(){this._poll&&(this._poll.abort(),this._poll=null);},stopLoading:function(){this._loading&&(clearTimeout(this._loading),this._loading=null),this._onloadImage&&(this._onloadImage.onload=function(){},this._onloadImage.onerror=function(){});},waitForRender:function(a){this._renderTimeout=setTimeout(a);},stopWaitingForRender:function(){this._renderTimeout&&(clearTimeout(this._renderTimeout),this._renderTimeout=null),this._errorRenderTimeout&&(clearTimeout(this._errorRenderTimeout),this._errorRenderTimeout=null);}}),c;}(jQuery);return b;}(jQuery);Tipped.Behaviors={hide:{showOn:{element:"mouseenter",tooltip:!1},hideOn:{element:"mouseleave",tooltip:"mouseenter"}},mouse:{showOn:{element:"mouseenter",tooltip:!1},hideOn:{element:"mouseleave",tooltip:"mouseenter"},target:"mouse",showDelay:100,fadeIn:0,hideDelay:0,fadeOut:0},sticky:{showOn:{element:"mouseenter",tooltip:"mouseenter"},hideOn:{element:"mouseleave",tooltip:"mouseleave"},showDelay:150,target:"mouse",fixed:!0}};var Options={create:function(){function a(b){return e=Tipped.Skins.base,f=deepExtend($.extend({},e),Tipped.Skins.reset),a=d,d(b);}function b(a){return a.match(/^(top|left|bottom|right)$/)&&(a+="middle"),a.replace("center","middle").replace(" ",""),a;}function c(a){var b,c;return b=a.behavior&&(c=Tipped.Behaviors[a.behavior])?deepExtend($.extend({},c),a):a;}function d(a){var d=a.skin?a.skin:Tooltips.options.defaultSkin,g=$.extend({},Tipped.Skins[d]||{});g.skin||(g.skin=Tooltips.options.defaultSkin||"dark");var h=deepExtend($.extend({},f),c(g)),i=deepExtend($.extend({},h),c(a));if(i.ajax){var j=(f.ajax||{},e.ajax);"boolean"==$.type(i.ajax)&&(i.ajax={}),i.ajax=deepExtend($.extend({},j),i.ajax);}var k,l=l=i.position&&i.position.target||"string"==$.type(i.position)&&i.position||f.position&&f.position.target||"string"==$.type(f.position)&&f.position||e.position&&e.position.target||e.position;l=b(l);var m=i.position&&i.position.tooltip||f.position&&f.position.tooltip||e.position&&e.position.tooltip||Tooltips.Position.getInversedPosition(l);if(m=b(m),i.position?"string"==$.type(i.position)?(i.position=b(i.position),k={target:i.position,tooltip:Tooltips.Position.getTooltipPositionFromTarget(i.position)}):(k={tooltip:m,target:l},i.position.tooltip&&(k.tooltip=b(i.position.tooltip)),i.position.target&&(k.target=b(i.position.target))):k={tooltip:m,target:l},Position.isCorner(k.target)&&Position.getOrientation(k.target)!=Position.getOrientation(k.tooltip)&&(k.target=Position.inverseCornerPlane(k.target)),"mouse"==i.target){var n=Position.getOrientation(k.target);k.target="horizontal"==n?k.target.replace(/(left|right)/,"middle"):k.target.replace(/(top|bottom)/,"middle");}i.position=k;var o;if("mouse"==i.target?(o=$.extend({},e.offset),$.extend(o,Tipped.Skins.reset.offset||{}),a.skin&&$.extend(o,(Tipped.Skins[a.skin]||Tipped.Skins[Tooltips.options.defaultSkin]||{}).offset||{}),o=Position.adjustOffsetBasedOnPosition(e.offset,e.position,k.target,!0),a.offset&&(o=$.extend(o,a.offset||{}))):o={x:i.offset.x,y:i.offset.y},i.offset=o,i.hideOn&&"click-outside"==i.hideOn&&(i.hideOnClickOutside=!0,i.hideOn=!1,i.fadeOut=0),i.showOn){var p=i.showOn;"string"==$.type(p)&&(p={element:p}),i.showOn=p;}if(i.hideOn){var q=i.hideOn;"string"==$.type(q)&&(q={element:q}),i.hideOn=q;}return i.inline&&"string"!=$.type(i.inline)&&(i.inline=!1),Browser.IE&&Browser.IE<9&&$.extend(i,{fadeIn:0,fadeOut:0,hideDelay:0}),i.spinner&&(Spin.supported?"boolean"==$.type(i.spinner)&&(i.spinner=f.spinner||e.spinner||{}):i.spinner=!1),i.container||(i.container=document.body),i.containment&&"string"==$.type(i.containment)&&(i.containment={selector:i.containment,padding:f.containment&&f.containment.padding||e.padding&&e.containment.padding}),i.shadow&&(i.shadow=Support.shadow),i;}var e,f;return a;}()};$.extend(Skin.prototype,{initialize:function(a){this.tooltip=a,this.element=a._skin;var b=this.tooltip.options;this.tooltip._tooltip[(b.shadow?"remove":"add")+"Class"]("tpd-no-shadow")[(b.radius?"remove":"add")+"Class"]("tpd-no-radius")[(b.stem?"remove":"add")+"Class"]("tpd-no-stem");var c,d,e,f,g=Support.css.prefixed("borderTopLeftRadius");this.element.append(c=$("<div>").addClass("tpd-frames").append($("<div>").addClass("tpd-frame").append($("<div>").addClass("tpd-backgrounds").append(d=$("<div>").addClass("tpd-background").append(e=$("<div>").addClass("tpd-background-content")))))).append(f=$("<div>").addClass("tpd-spinner")),d.css({width:999,height:999,zoom:1}),this._css={border:parseFloat(d.css("border-top-width")),radius:parseFloat(g?d.css(g):0),padding:parseFloat(a._content.css("padding-top")),borderColor:d.css("border-top-color"),backgroundColor:e.css("background-color"),backgroundOpacity:e.css("opacity"),spinner:{dimensions:{width:f.innerWidth(),height:f.innerHeight()}}},f.remove(),c.remove(),this._side=Position.getSide(a.options.position.tooltip)||"top",this._vars={};},destroy:function(){this.frames&&($.each("top right bottom left".split(" "),$.proxy(function(a,b){this["stem_"+b]&&this["stem_"+b].destroy();},this)),this.frames.remove(),this.frames=null);},build:function(){this.frames||(this.element.append(this.frames=$("<div>").addClass("tpd-frames")),$.each("top right bottom left".split(" "),$.proxy(function(a,b){this.insertFrame(b);},this)),this._spinner||this.tooltip._tooltip.append(this._spinner=$("<div>").addClass("tpd-spinner").hide().append($("<div>").addClass("tpd-spinner-spin"))));},_frame:function(){var a,b=$("<div>").addClass("tpd-frame").append(a=$("<div>").addClass("tpd-backgrounds").append($("<div>").addClass("tpd-background-shadow"))).append($("<div>").addClass("tpd-shift-stem").append($("<div>").addClass("tpd-shift-stem-side tpd-shift-stem-side-before")).append($("<div>").addClass("tpd-stem")).append($("<div>").addClass("tpd-shift-stem-side tpd-shift-stem-side-after")));return $.each("top right bottom left".split(" "),$.proxy(function(b,c){a.append($("<div>").addClass("tpd-background-box tpd-background-box-"+c).append($("<div>").addClass("tpd-background-box-shift").append($("<div>").addClass("tpd-background-box-shift-further").append($("<div>").addClass("tpd-background").append($("<div>").addClass("tpd-background-title")).append($("<div>").addClass("tpd-background-content"))).append($("<div>").addClass("tpd-background tpd-background-loading")).append($("<div>").addClass("tpd-background-border-hack").hide()))));},this)),b;}(),_getFrame:function(a){var b=this._frame.clone();b.addClass("tpd-frame-"+a),b.find(".tpd-background-shadow").css({"border-radius":this._css.radius}),this.tooltip.options.stem&&b.find(".tpd-stem").attr("data-stem-position",a);var c=Math.max(this._css.radius-this._css.border,0);b.find(".tpd-background-title").css({"border-top-left-radius":c,"border-top-right-radius":c}),b.find(".tpd-background-content").css({"border-bottom-left-radius":c,"border-bottom-right-radius":c}),b.find(".tpd-background-loading").css({"border-radius":c});var d={backgroundColor:this._css.borderColor},e=Position.getOrientation(a),f="horizontal"==e;d[f?"height":"width"]=this._css.border+"px";var g={top:"bottom",bottom:"top",left:"right",right:"left"};return d[g[a]]=0,b.find(".tpd-shift-stem-side").css(d),b;},insertFrame:function(a){var b=this["frame_"+a]=this._getFrame(a);if(this.frames.append(b),this.tooltip.options.stem){var c=b.find(".tpd-stem");this["stem_"+a]=new Stem(c,this,{});}},startLoading:function(){this.tooltip.supportsLoading&&(this.build(),this._spinner||this.tooltip.is("resize-to-content")||this.setDimensions(this._css.spinner.dimensions),this._spinner&&this._spinner.show());},stopLoading:function(){this.tooltip.supportsLoading&&this._spinner&&(this.build(),this._spinner.hide());},updateBackground:function(){var a=this._vars.frames[this._side],b=$.extend({},a.background.dimensions);if(this.tooltip.title&&!this.tooltip.is("loading")){this.element.find(".tpd-background-title, .tpd-background-content").show(),this.element.find(".tpd-background").css({"background-color":"transparent"});var c=$.extend({},b),d=Math.max(this._css.radius-this._css.border,0),e={"border-top-left-radius":d,"border-top-right-radius":d,"border-bottom-left-radius":d,"border-bottom-right-radius":d},f=new Visible(this.tooltip._tooltip),g=this.tooltip._titleWrapper.innerHeight();c.height-=g,this.element.find(".tpd-background-title").css({height:g,width:b.width}),e["border-top-left-radius"]=0,e["border-top-right-radius"]=0,f.restore(),this.element.find(".tpd-background-content").css(c).css(e),this.element.find(".tpd-background-loading").css({"background-color":this._css.backgroundColor});}else{this.element.find(".tpd-background-title, .tpd-background-content").hide(),this.element.find(".tpd-background").css({"background-color":this._css.backgroundColor});}this._css.border&&(this.element.find(".tpd-background").css({"border-color":"transparent"}),this.element.find(".tpd-background-border-hack").css({width:b.width,height:b.height,"border-radius":this._css.radius,"border-width":this._css.border,"border-color":this._css.borderColor}).show());},paint:function(){if(!this._paintedDimensions||this._paintedDimensions.width!=this._dimensions.width||this._paintedDimensions.height!=this._dimensions.height||this._paintedStemPosition!=this._stemPosition){this._paintedDimensions=this._dimensions,this._paintedStemPosition=this._stemPosition,this.element.removeClass("tpd-visible-frame-top tpd-visible-frame-bottom tpd-visible-frame-left tpd-visible-frame-right").addClass("tpd-visible-frame-"+this._side);var a=this._vars.frames[this._side],b=$.extend({},a.background.dimensions);this.element.find(".tpd-background").css(b),this.element.find(".tpd-background-shadow").css({width:b.width+2*this._css.border,height:b.height+2*this._css.border}),this.updateBackground(),this.element.find(".tpd-background-box-shift, .tpd-background-box-shift-further").removeAttr("style"),this.element.add(this.frames).add(this.tooltip._tooltip).css(a.dimensions);var c=this._side,d=this._vars.frames[c],e=this.element.find(".tpd-frame-"+this._side),f=this._vars.frames[c].dimensions;e.css(f),e.find(".tpd-backgrounds").css($.extend({},d.background.position,{width:f.width-d.background.position.left,height:f.height-d.background.position.top}));var g=Position.getOrientation(c);if(this.tooltip.options.stem){if(e.find(".tpd-shift-stem").css($.extend({},d.shift.dimensions,d.shift.position)),"vertical"==g){var h=e.find(".tpd-background-box-top, .tpd-background-box-bottom");h.css({height:this._vars.cut,width:this._css.border}),e.find(".tpd-background-box-bottom").css({top:d.dimensions.height-this._vars.cut}).find(".tpd-background-box-shift").css({"margin-top":-1*d.dimensions.height+this._vars.cut});var i="right"==c?d.dimensions.width-d.stemPx-this._css.border:0;h.css({left:i}).find(".tpd-background-box-shift").css({"margin-left":-1*i}),e.find(".tpd-background-box-"+("left"==c?"left":"right")).hide(),"right"==c?e.find(".tpd-background-box-left").css({width:d.dimensions.width-d.stemPx-this._css.border}):e.find(".tpd-background-box-right").css({"margin-left":this._css.border}).find(".tpd-background-box-shift").css({"margin-left":-1*this._css.border});var j=e.find(".tpd-background-box-"+this._side);j.css({height:d.dimensions.height-2*this._vars.cut,"margin-top":this._vars.cut}),j.find(".tpd-background-box-shift").css({"margin-top":-1*this._vars.cut});}else{var h=e.find(".tpd-background-box-left, .tpd-background-box-right");h.css({width:this._vars.cut,height:this._css.border}),e.find(".tpd-background-box-right").css({left:d.dimensions.width-this._vars.cut}).find(".tpd-background-box-shift").css({"margin-left":-1*d.dimensions.width+this._vars.cut});var i="bottom"==c?d.dimensions.height-d.stemPx-this._css.border:0;h.css({top:i}).find(".tpd-background-box-shift").css({"margin-top":-1*i}),e.find(".tpd-background-box-"+("top"==c?"top":"bottom")).hide(),"bottom"==c?e.find(".tpd-background-box-top").css({height:d.dimensions.height-d.stemPx-this._css.border}):e.find(".tpd-background-box-bottom").css({"margin-top":this._css.border}).find(".tpd-background-box-shift").css({"margin-top":-1*this._css.border});var j=e.find(".tpd-background-box-"+this._side);j.css({width:d.dimensions.width-2*this._vars.cut,"margin-left":this._vars.cut}),j.find(".tpd-background-box-shift").css({"margin-left":-1*this._vars.cut});}}var k=a.background,l=k.position,m=k.dimensions;this._spinner.css({top:l.top+this._css.border+(0.5*m.height-0.5*this._css.spinner.dimensions.height),left:l.left+this._css.border+(0.5*m.width-0.5*this._css.spinner.dimensions.width)});}},getVars:function(){var a=(this._css.padding,this._css.radius,this._css.border),b=this._vars.maxStemHeight||0,c=$.extend({},this._dimensions||{}),d={frames:{},dimensions:c,maxStemHeight:b};d.cut=Math.max(this._css.border,this._css.radius)||0;var e={width:0,height:0},f=0,g=0;return this.tooltip.options.stem&&(e=this.stem_top.getMath().dimensions.outside,f=this.stem_top._css.offset,g=Math.max(e.height-this._css.border,0)),d.stemDimensions=e,d.stemOffset=f,Position.getOrientation(this._side),$.each("top right bottom left".split(" "),$.proxy(function(b,f){var h=Position.getOrientation(f),i="vertical"==h,j={width:c.width+2*a,height:c.height+2*a},k=j[i?"height":"width"]-2*d.cut,l={dimensions:j,stemPx:g,position:{top:0,left:0},background:{dimensions:$.extend({},c),position:{top:0,left:0}}};switch(d.frames[f]=l,l.dimensions[i?"width":"height"]+=g,("top"==f||"left"==f)&&(l.background.position[f]+=g),$.extend(l,{shift:{position:{top:0,left:0},dimensions:{width:i?e.height:k,height:i?k:e.height}}}),f){case"top":case"bottom":l.shift.position.left+=d.cut,"bottom"==f&&(l.shift.position.top+=j.height-a-g);break;case"left":case"right":l.shift.position.top+=d.cut,"right"==f&&(l.shift.position.left+=j.width-a-g);}},this)),d.connections={},$.each(Position.positions,$.proxy(function(a,b){d.connections[b]=this.getConnectionLayout(b,d);},this)),d;},setDimensions:function(a){this.build();var b=this._dimensions;b&&b.width==a.width&&b.height==a.height||(this._dimensions=a,this._vars=this.getVars());},setSide:function(a){this._side=a,this._vars=this.getVars();},getConnectionLayout:function(a,b){var c=Position.getSide(a),d=Position.getOrientation(a),e=(b.dimensions,b.cut),f=this["stem_"+c],g=b.stemOffset,h=this.tooltip.options.stem?f.getMath().dimensions.outside.width:0,i=e+g+0.5*h,j={stem:{}},k={left:0,right:0,up:0,down:0},l={top:0,left:0},m={top:0,left:0},n=b.frames[c],i=0;if("horizontal"==d){var o=n.dimensions.width;this.tooltip.options.stem&&(o=n.shift.dimensions.width,2*g>o-h&&(g=Math.floor(0.5*(o-h))||0),i=e+g+0.5*h);var p=o-2*g,q=Position.split(a),r=g;switch(q[2]){case"left":k.right=p-h,l.left=i;break;case"middle":r+=Math.round(0.5*p-0.5*h),k.left=r-g,k.right=r-g,l.left=m.left=Math.round(0.5*n.dimensions.width);break;case"right":r+=p-h,k.left=p-h,l.left=n.dimensions.width-i,m.left=n.dimensions.width;}"bottom"==q[1]&&(l.top+=n.dimensions.height,m.top+=n.dimensions.height),$.extend(j.stem,{position:{left:r},before:{width:r},after:{left:r+h,width:o-r-h+1}});}else{var s=n.dimensions.height;this.tooltip.options.stem&&(s=n.shift.dimensions.height,2*g>s-h&&(g=Math.floor(0.5*(s-h))||0),i=e+g+0.5*h);var t=s-2*g,q=Position.split(a),u=g;switch(q[2]){case"top":k.down=t-h,l.top=i;break;case"middle":u+=Math.round(0.5*t-0.5*h),k.up=u-g,k.down=u-g,l.top=m.top=Math.round(0.5*n.dimensions.height);break;case"bottom":u+=t-h,k.up=t-h,l.top=n.dimensions.height-i,m.top=n.dimensions.height;}"right"==q[1]&&(l.left+=n.dimensions.width,m.left+=n.dimensions.width),$.extend(j.stem,{position:{top:u},before:{height:u},after:{top:u+h,height:s-u-h+1}});}return j.move=k,j.stem.connection=l,j.connection=m,j;},setStemPosition:function(a,b){if(this._stemPosition!=a){this._stemPosition=a;var c=Position.getSide(a);this.setSide(c);}this.tooltip.options.stem&&this.setStemShift(a,b);},setStemShift:function(a,b){var c=this._shift,d=this._dimensions;if(!c||c.stemPosition!=a||c.shift.x!=b.x||c.shift.y!=b.y||!d||c.dimensions.width!=d.width||c.dimensions.height!=d.height){this._shift={stemPosition:a,shift:b,dimensions:d};var e=Position.getSide(a),f={horizontal:"x",vertical:"y"}[Position.getOrientation(a)],g={x:{left:"left",width:"width"},y:{left:"top",width:"height"}}[f],h=this["stem_"+e],i=deepExtend({},this._vars.connections[a].stem);b&&0!==b[f]&&(i.before[g.width]+=b[f],i.position[g.left]+=b[f],i.after[g.left]+=b[f],i.after[g.width]-=b[f]),h.element.css(i.position),h.element.siblings(".tpd-shift-stem-side-before").css(i.before),h.element.siblings(".tpd-shift-stem-side-after").css(i.after);}}}),$.extend(Stem.prototype,{initialize:function(a,b){this.element=$(a),this.element[0]&&(this.skin=b,this.element.removeClass("tpd-stem-reset"),this._css=$.extend({},b._css,{width:this.element.innerWidth(),height:this.element.innerHeight(),offset:parseFloat(this.element.css("margin-left")),spacing:parseFloat(this.element.css("margin-top"))}),this.element.addClass("tpd-stem-reset"),this.options=$.extend({},arguments[2]||{}),this._position=this.element.attr("data-stem-position")||"top",this._m=100,this.build());},destroy:function(){this.element.html("");},build:function(){this.destroy();var a=this._css.backgroundColor,b=a.indexOf("rgba")>-1&&parseFloat(a.replace(/^.*,(.+)\)/,"$1")),c=b&&1>b;this._useTransform=c&&Support.css.transform,this._css.border||(this._useTransform=!1),this[(this._useTransform?"build":"buildNo")+"Transform"]();},buildTransform:function(){this.element.append(this.spacer=$("<div>").addClass("tpd-stem-spacer").append(this.downscale=$("<div>").addClass("tpd-stem-downscale").append(this.transform=$("<div>").addClass("tpd-stem-transform").append(this.first=$("<div>").addClass("tpd-stem-side").append(this.border=$("<div>").addClass("tpd-stem-border")).append($("<div>").addClass("tpd-stem-border-corner")).append($("<div>").addClass("tpd-stem-triangle")))))),this.transform.append(this.last=this.first.clone().addClass("tpd-stem-side-inversed")),this.sides=this.first.add(this.last);var a=this.getMath(),b=a.dimensions,c=this._m,d=Position.getSide(this._position);if(this.element.find(".tpd-stem-spacer").css({width:l?b.inside.height:b.inside.width,height:l?b.inside.width:b.inside.height}),"top"==d||"left"==d){var e={};"top"==d?(e.bottom=0,e.top="auto"):"left"==d&&(e.right=0,e.left="auto"),this.element.find(".tpd-stem-spacer").css(e);}this.transform.css({width:b.inside.width*c,height:b.inside.height*c});var f=Support.css.prefixed("transform"),g={"background-color":"transparent","border-bottom-color":this._css.backgroundColor,"border-left-width":0.5*b.inside.width*c,"border-bottom-width":b.inside.height*c};g[f]="translate("+a.border*c+"px, 0)",this.element.find(".tpd-stem-triangle").css(g);var h=this._css.borderColor;alpha=h.indexOf("rgba")>-1&&parseFloat(h.replace(/^.*,(.+)\)/,"$1")),alpha&&1>alpha?h=(h.substring(0,h.lastIndexOf(","))+")").replace("rgba","rgb"):alpha=1;var i={"background-color":"transparent","border-right-width":a.border*c,width:a.border*c,"margin-left":-2*a.border*c,"border-color":h,opacity:alpha};i[f]="skew("+a.skew+"deg) translate("+a.border*c+"px, "+-1*this._css.border*c+"px)",this.element.find(".tpd-stem-border").css(i);var h=this._css.borderColor;alpha=h.indexOf("rgba")>-1&&parseFloat(h.replace(/^.*,(.+)\)/,"$1")),alpha&&1>alpha?h=(h.substring(0,h.lastIndexOf(","))+")").replace("rgba","rgb"):alpha=1;var j={width:a.border*c,"border-right-width":a.border*c,"border-right-color":h,background:h,opacity:alpha,"margin-left":-2*a.border*c};if(j[f]="skew("+a.skew+"deg) translate("+a.border*c+"px, "+(b.inside.height-this._css.border)*c+"px)",this.element.find(".tpd-stem-border-corner").css(j),this.setPosition(this._position),c>1){var k={};k[f]="scale("+1/c+","+1/c+")",this.downscale.css(k);}var l=/^(left|right)$/.test(this._position);this._css.border||this.element.find(".tpd-stem-border, .tpd-stem-border-corner").hide(),this.element.css({width:l?b.outside.height:b.outside.width,height:l?b.outside.width:b.outside.height});},buildNoTransform:function(){this.element.append(this.spacer=$("<div>").addClass("tpd-stem-spacer").append($("<div>").addClass("tpd-stem-notransform").append($("<div>").addClass("tpd-stem-border").append($("<div>").addClass("tpd-stem-border-corner")).append($("<div>").addClass("tpd-stem-border-center-offset").append($("<div>").addClass("tpd-stem-border-center-offset-inverse").append($("<div>").addClass("tpd-stem-border-center"))))).append($("<div>").addClass("tpd-stem-triangle"))));var a=this.getMath(),b=a.dimensions,c=/^(left|right)$/.test(this._position),d=/^(bottom)$/.test(this._position),e=/^(right)$/.test(this._position),f=Position.getSide(this._position);if(this.element.css({width:c?b.outside.height:b.outside.width,height:c?b.outside.width:b.outside.height}),this.element.find(".tpd-stem-notransform").add(this.element.find(".tpd-stem-spacer")).css({width:c?b.inside.height:b.inside.width,height:c?b.inside.width:b.inside.height}),"top"==f||"left"==f){var g={};"top"==f?(g.bottom=0,g.top="auto"):"left"==f&&(g.right=0,g.left="auto"),this.element.find(".tpd-stem-spacer").css(g);}this.element.find(".tpd-stem-border").css({width:"100%",background:"transparent"});var h={opacity:1};h[c?"height":"width"]="100%",h[c?"width":"height"]=this._css.border,h[d?"top":"bottom"]=0,$.extend(h,e?{left:0}:{right:0}),this.element.find(".tpd-stem-border-corner").css(h);var i={width:0,"background-color":"transparent",opacity:1},j=0.5*b.inside.width+"px solid transparent",k={"background-color":"transparent"};if(0.5*b.inside.width-a.border+"px solid transparent",c){var l={left:"auto",top:"50%","margin-top":-0.5*b.inside.width,"border-top":j,"border-bottom":j};$.extend(i,l),i[e?"right":"left"]=0,i[e?"border-left":"border-right"]=b.inside.height+"px solid "+this._css.borderColor,$.extend(k,l),k[e?"border-left":"border-right"]=b.inside.height+"px solid "+this._css.backgroundColor,k[e?"right":"left"]=a.top,k[e?"left":"right"]="auto",this.element.find(".tpd-stem-border-center-offset").css({"margin-left":-1*this._css.border*(e?-1:1)}).find(".tpd-stem-border-center-offset-inverse").css({"margin-left":this._css.border*(e?-1:1)});}else{var l={"margin-left":-0.5*b.inside.width,"border-left":j,"border-right":j};$.extend(i,l),i[d?"border-top":"border-bottom"]=b.inside.height+"px solid "+this._css.borderColor,$.extend(k,l),k[d?"border-top":"border-bottom"]=b.inside.height+"px solid "+this._css.backgroundColor,k[d?"bottom":"top"]=a.top,k[d?"top":"bottom"]="auto",this.element.find(".tpd-stem-border-center-offset").css({"margin-top":-1*this._css.border*(d?-1:1)}).find(".tpd-stem-border-center-offset-inverse").css({"margin-top":this._css.border*(d?-1:1)});}this.element.find(".tpd-stem-border-center").css(i),this.element.find(".tpd-stem-border-corner").css({"background-color":this._css.borderColor}),this.element.find(".tpd-stem-triangle").css(k),this._css.border||this.element.find(".tpd-stem-border").hide();},setPosition:function(a){this._position=a,this.transform.attr("class","tpd-stem-transform tpd-stem-transform-"+a);},getMath:function(){var a=this._css.height,b=this._css.width,c=this._css.border;this._useTransform&&Math.floor(b)%2&&(b=Math.max(Math.floor(b)-1,0));var d=degrees(Math.atan(0.5*b/a)),e=90-d,f=c/Math.cos((90-e)*Math.PI/180),g=c/Math.cos((90-d)*Math.PI/180),h={width:b+2*f,height:a+g};Math.max(c,this._css.radius),a=h.height,b=0.5*h.width;var i=degrees(Math.atan(a/b)),j=90-i,k=c/Math.cos(j*Math.PI/180),l=180*Math.atan(a/b)/Math.PI,m=-1*(90-l),n=90-l,o=c*Math.tan(n*Math.PI/180),g=c/Math.cos((90-n)*Math.PI/180),p=$.extend({},h),q=$.extend({},h);q.height+=this._css.spacing,q.height=Math.ceil(q.height);var r=!0;return 2*c>=h.width&&(r=!1),{enabled:r,outside:q,dimensions:{inside:p,outside:q},top:g,border:k,skew:m,corner:o};}});var Tooltips={tooltips:{},options:{defaultSkin:"dark",startingZIndex:999999},_emptyClickHandler:function(){},init:function(){this.reset(),this._resizeHandler=$.proxy(this.onWindowResize,this),$(window).bind("resize orientationchange",this._resizeHandler),Browser.MobileSafari&&$("body").bind("click",this._emptyClickHandler);},reset:function(){Tooltips.removeAll(),Delegations.removeAll(),this._resizeHandler&&$(window).unbind("resize orientationchange",this._resizeHandler),Browser.MobileSafari&&$("body").unbind("click",this._emptyClickHandler);},onWindowResize:function(){this._resizeTimer&&(window.clearTimeout(this._resizeTimer),this._resizeTimer=null),this._resizeTimer=_.delay($.proxy(function(){var a=this.getVisible();$.each(a,function(a,b){b.clearUpdatedTo(),b.position();});},this),15);},_getTooltips:function(a,b){var c,d=[],e=[];if(_.isElement(a)?(c=$(a).data("tipped-uids"))&&(d=d.concat(c)):$(a).each(function(a,b){(c=$(b).data("tipped-uids"))&&(d=d.concat(c));}),!d[0]&&!b){var f=this.getTooltipByTooltipElement($(a).closest(".tpd-tooltip")[0]);f&&f.element&&(c=$(f.element).data("tipped-uids")||[],c&&(d=d.concat(c)));}return d.length>0&&$.each(d,$.proxy(function(a,b){var c;(c=this.tooltips[b])&&e.push(c);},this)),e;},findElement:function(a){var b=[];return _.isElement(a)&&(b=this._getTooltips(a)),b[0]&&b[0].element;},get:function(a){var b=$.extend({api:!1},arguments[1]||{}),c=[];return _.isElement(a)?c=this._getTooltips(a):a instanceof $?a.each($.proxy(function(a,b){var d=this._getTooltips(b,!0);d.length>0&&(c=c.concat(d));},this)):"string"==$.type(a)&&$.each(this.tooltips,function(b,d){d.element&&$(d.element).is(a)&&c.push(d);}),b.api&&$.each(c,function(a,b){b.is("api",!0);}),c;},getTooltipByTooltipElement:function(a){if(!a){return null;}var b=null;return $.each(this.tooltips,function(c,d){d.is("build")&&d._tooltip[0]===a&&(b=d);}),b;},getBySelector:function(a){var b=[];return $.each(this.tooltips,function(c,d){d.element&&$(d.element).is(a)&&b.push(d);}),b;},getNests:function(){var a=[];return $.each(this.tooltips,function(b,c){c.is("nest")&&a.push(c);}),a;},show:function(a){$(this.get(a)).each(function(a,b){b.show(!1,!0);});},hide:function(a){$(this.get(a)).each(function(a,b){b.hide();});},toggle:function(a){$(this.get(a)).each(function(a,b){b.toggle();});},hideAll:function(a){$.each(this.getVisible(),function(b,c){a&&a==c||c.hide();});},refresh:function(a){var b;b=a?$.grep(this.get(a),function(a){return a.is("visible");}):this.getVisible(),$.each(b,function(a,b){b.refresh();});},getVisible:function(){var a=[];return $.each(this.tooltips,function(b,c){c.visible()&&a.push(c);}),a;},isVisibleByElement:function(a){var b=!1;return _.isElement(a)&&$.each(this.getVisible()||[],function(c,d){return d.element==a?(b=!0,!1):void 0;}),b;},getHighestTooltip:function(){var a,b=0;return $.each(this.tooltips,function(c,d){d.zIndex>b&&(b=d.zIndex,a=d);}),a;},resetZ:function(){this.getVisible().length<=1&&$.each(this.tooltips,function(a,b){b.is("build")&&!b.options.zIndex&&b._tooltip.css({zIndex:b.zIndex=+Tooltips.options.startingZIndex});});},clearAjaxCache:function(){$.each(this.tooltips,$.proxy(function(a,b){b.options.ajax&&(b._cache&&b._cache.xhr&&(b._cache.xhr.abort(),b._cache.xhr=null),b.is("updated",!1),b.is("updating",!1),b.is("sanitized",!1));},this)),AjaxCache.clear();},add:function(a){this.tooltips[a.uid]=a;},remove:function(a){var b=this._getTooltips(a);this.removeTooltips(b);},removeTooltips:function(a){a&&$.each(a,$.proxy(function(a,b){var c=b.uid;delete this.tooltips[c],b.remove();},this));},removeDetached:function(){var a=this.getNests(),b=[];a.length>0&&$.each(a,function(a,c){c.is("detached")&&(b.push(c),c.attach());}),$.each(this.tooltips,$.proxy(function(a,b){b.element&&!_.element.isAttached(b.element)&&this.remove(b.element);},this)),$.each(b,function(a,b){b.detach();});},removeAll:function(){$.each(this.tooltips,$.proxy(function(a,b){b.element&&this.remove(b.element);},this)),this.tooltips={};},setDefaultSkin:function(a){this.options.defaultSkin=a||"dark";},setStartingZIndex:function(a){this.options.startingZIndex=a||0;}};Tooltips.Position={inversedPosition:{left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle",center:"center"},getInversedPosition:function(a){var b=Position.split(a),c=b[1],d=b[2],e=Position.getOrientation(a),f=$.extend({horizontal:!0,vertical:!0},arguments[1]||{});return"horizontal"==e?(f.vertical&&(c=this.inversedPosition[c]),f.horizontal&&(d=this.inversedPosition[d])):(f.vertical&&(d=this.inversedPosition[d]),f.horizontal&&(c=this.inversedPosition[c])),c+d;},getTooltipPositionFromTarget:function(a){var b=Position.split(a);return this.getInversedPosition(b[1]+this.inversedPosition[b[2]]);}},$.extend(Tooltip.prototype,{supportsLoading:Support.css.transform&&Support.css.animation,initialize:function(element,content){if(this.element=element,this.element){var options;"object"!=$.type(content)||_.isElement(content)||_.isText(content)||_.isDocumentFragment(content)||content instanceof $?options=arguments[2]||{}:(options=content,content=null);var dataOptions=$(element).data("tipped-options");dataOptions&&(options=deepExtend($.extend({},options),eval("({"+dataOptions+"})"))),this.options=Options.create(options),this._cache={dimensions:{width:0,height:0},events:[],timers:{},layouts:{},is:{},fnCallFn:"",updatedTo:{}},this.queues={showhide:$({})};var title=$(element).attr("title")||$(element).data("tipped-restore-title");if(!content){var dt=$(element).attr("data-tipped");if(dt?content=dt:title&&(content=title),content){var SCRIPT_REGEX=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;content=content.replace(SCRIPT_REGEX,"");}}if((!content||content instanceof $&&!content[0])&&!(this.options.ajax&&this.options.ajax.url||this.options.inline)){return this._aborted=!0,void 0;}title&&($(element).data("tipped-restore-title",title),$(element)[0].setAttribute("title","")),this.content=content,this.title=$(this.element).data("tipped-title"),"undefined"!=$.type(this.options.title)&&(this.title=this.options.title),this.zIndex=this.options.zIndex||+Tooltips.options.startingZIndex;var uids=$(element).data("tipped-uids");uids||(uids=[]);var uid=getUID();this.uid=uid,uids.push(uid),$(element).data("tipped-uids",uids);var parentTooltipElement=$(this.element).closest(".tpd-tooltip")[0],parentTooltip;parentTooltipElement&&(parentTooltip=Tooltips.getTooltipByTooltipElement(parentTooltipElement))&&parentTooltip.is("nest",!0);var target=this.options.target;this.target="mouse"==target?this.element:"element"!=target&&target?_.isElement(target)?target:target instanceof $&&target[0]?target[0]:this.element:this.element,this.options.inline&&(this.content=$("#"+this.options.inline)[0]),this.options.ajax&&(this.__content=this.content),"function"==$.type(this.content)&&(this._fn=this.content),this.preBuild(),Tooltips.add(this);}},remove:function(){this.unbind(),this.clearTimers(),this.restoreElementToMarker(),this.stopLoading(),this.abort(),this.is("build")&&this._tooltip&&(this._tooltip.remove(),this._tooltip=null);var a=$(this.element).data("tipped-uids")||[],b=$.inArray(this.uid,a);if(b>-1&&(a.splice(b,1),$(this.element).data("tipped-uids",a)),a.length<1){var c,d="tipped-restore-title";(c=$(this.element).data(d))&&(""!=!$(this.element)[0].getAttribute("title")&&$(this.element).attr("title",c),$(this.element).removeData(d)),$(this.element).removeData("tipped-uids");}var e=$(this.element).attr("class")||"",f=e.replace(/(tpd-delegation-uid-)\d+/g,"").replace(/^\s\s*/,"").replace(/\s\s*$/,"");$(this.element).attr("class",f);},detach:function(){this.options.detach&&!this.is("detached")&&(this._tooltip&&this._tooltip.detach(),this.is("detached",!0));},attach:function(){if(this.is("detached")){var a;if("string"==$.type(this.options.container)){var b=this.target;"mouse"==b&&(b=this.element),a=$($(b).closest(this.options.container).first());}else{a=$(this.options.container);}a[0]||(a=$(document.body)),a.append(this._tooltip),this.is("detached",!1);}},preBuild:function(){this.is("detached",!0);var a={left:"-10000px",top:"-10000px",opacity:0,zIndex:this.zIndex};this._tooltip=$("<div>").addClass("tpd-tooltip").addClass("tpd-skin-"+this.options.skin).addClass("tpd-size-"+this.options.size).css(a).hide(),this.createPreBuildObservers();},build:function(){this.is("build")||(this.attach(),this._tooltip.append(this._skin=$("<div>").addClass("tpd-skin")).append(this._contentWrapper=$("<div>").addClass("tpd-content-wrapper").append(this._contentSpacer=$("<div>").addClass("tpd-content-spacer").append(this._titleWrapper=$("<div>").addClass("tpd-title-wrapper").append(this._titleSpacer=$("<div>").addClass("tpd-title-spacer").append(this._titleRelative=$("<div>").addClass("tpd-title-relative").append(this._titleRelativePadder=$("<div>").addClass("tpd-title-relative-padder").append(this._title=$("<div>").addClass("tpd-title"))))).append(this._close=$("<div>").addClass("tpd-close").append($("<div>").addClass("tpd-close-icon").html("&times;")))).append(this._contentRelative=$("<div>").addClass("tpd-content-relative").append(this._contentRelativePadder=$("<div>").addClass("tpd-content-relative-padder").append(this._content=$("<div>").addClass("tpd-content"))).append(this._inner_close=$("<div>").addClass("tpd-close").append($("<div>").addClass("tpd-close-icon").html("&times;")))))),this.skin=new Skin(this),this._contentSpacer.css({"border-radius":Math.max(this.skin._css.radius-this.skin._css.border,0)}),this.createPostBuildObservers(),this.is("build",!0));},createPostBuildObservers:function(){this._tooltip.delegate(".tpd-close, .close-tooltip","click",$.proxy(function(a){a.stopPropagation(),a.preventDefault(),this.is("api",!1),this.hide(!0);},this));},createPreBuildObservers:function(){this.bind(this.element,"mouseenter",this.setActive),this.bind(this._tooltip,Support.touch&&Browser.MobileSafari?"touchstart":"mouseenter",this.setActive),this.bind(this.element,"mouseleave",function(a){this.setIdle(a);}),this.bind(this._tooltip,"mouseleave",function(a){this.setIdle(a);}),this.options.showOn&&($.each(this.options.showOn,$.proxy(function(a,b){var c,d=!1;switch(a){case"element":c=this.element,this.options.hideOn&&this.options.showOn&&"click"==this.options.hideOn.element&&"click"==this.options.showOn.element&&(d=!0,this.is("toggleable",d));break;case"tooltip":c=this._tooltip;break;case"target":c=this.target;}if(c&&b){var e=b;this.bind(c,e,"click"==b&&d?function(){this.is("api",!1),this.toggle();}:function(){this.is("api",!1),this.showDelayed();});}},this)),Support.touch&&Browser.MobileSafari&&this.bind(this._tooltip,"touchend",function(){this._tooltipTouchEndTime=new Date().getTime();})),this.options.hideOn&&$.each(this.options.hideOn,$.proxy(function(a,b){var c;switch(a){case"element":if(this.is("toggleable")&&"click"==b){return;}c=this.element;break;case"tooltip":c=this._tooltip;break;case"target":c=this.target;}if(c&&b){var d=b;Support.touch&&Browser.MobileSafari&&/^(target|element)/.test(a)&&/mouse(leave|out)/.test(d)?this.bind(c,d,function(a){if(this._tooltipTouchEndTime&&/^mouse(leave|out)$/.test(a.type)){var b=new Date().getTime();if(b-this._tooltipTouchEndTime<450){return;}}this.is("api",!1),this.hideDelayed();}):this.bind(c,d,function(){this.is("api",!1),this.hideDelayed();});}},this)),this.options.hideOnClickOutside&&($(this.element).addClass("tpd-hideOnClickOutside"),this.bind(document.documentElement,"click touchend",$.proxy(function(a){if(this.visible()){var b=$(a.target).closest(".tpd-tooltip, .tpd-hideOnClickOutside")[0];(!b||b&&b!=this._tooltip[0]&&b!=this.element)&&this.hide();}},this))),"mouse"==this.options.target&&this.bind(this.element,"mouseenter mousemove",$.proxy(function(a){this._cache.event=a;},this));var a=!1;this.options.showOn&&"mouse"==this.options.target&&!this.options.fixed&&(a=!0),a&&this.bind(this.element,"mousemove",function(){this.is("build")&&(this.is("api",!1),this.position());});}}),$.extend(Tooltip.prototype,{stop:function(){if(this._tooltip){var a=this.queues.showhide;a.queue([]),this._tooltip.stop(1,0);}},showDelayed:function(){this.is("disabled")||(this.clearTimer("hide"),this.is("visible")||this.getTimer("show")||this.setTimer("show",$.proxy(function(){this.clearTimer("show"),this.show();},this),this.options.showDelay||1));},show:function(){if(this.clearTimer("hide"),!this.visible()&&!this.is("disabled")&&$(this.target).is(":visible")){this.is("visible",!0),this.attach(),this.stop();var a=this.queues.showhide;this.is("updated")||this.is("updating")||a.queue($.proxy(function(a){this._onResizeDimensions={width:0,height:0},this.update($.proxy(function(b){return b?(this.is("visible",!1),this.detach(),void 0):(a(),void 0);},this));},this)),a.queue($.proxy(function(a){this.is("sanitized")?(this.stopLoading(),this._contentWrapper.css({visibility:"visible"}),this.is("resize-to-content",!0),a()):(this._contentWrapper.css({visibility:"hidden"}),this.startLoading(),this.sanitize($.proxy(function(){this.stopLoading(),this._contentWrapper.css({visibility:"visible"}),this.is("resize-to-content",!0),a();},this)));},this)),a.queue($.proxy(function(a){this.position(),this.raise(),a();},this)),a.queue($.proxy(function(a){if(this.is("updated")&&"function"==$.type(this.options.onShow)){var b=new Visible(this._tooltip);this.options.onShow(this._content[0],this.element),b.restore(),a();}else{a();}},this)),a.queue($.proxy(function(a){this._show(this.options.fadeIn,function(){a();});},this));}},_show:function(a,b){a=("number"==$.type(a)?a:this.options.fadeIn)||0,b=b||("function"==$.type(arguments[0])?arguments[0]:!1),this.options.hideOthers&&Tooltips.hideAll(this),this._tooltip.fadeTo(a,1,$.proxy(function(){b&&b();},this));},hideDelayed:function(){this.clearTimer("show"),this.getTimer("hide")||!this.visible()||this.is("disabled")||this.setTimer("hide",$.proxy(function(){this.clearTimer("hide"),this.hide();},this),this.options.hideDelay||1);},hide:function(a,b){if(this.clearTimer("show"),this.visible()&&!this.is("disabled")){this.is("visible",!1),this.stop();var c=this.queues.showhide;c.queue($.proxy(function(a){this.abort(),a();},this)),c.queue($.proxy(function(b){this._hide(a,b);},this)),c.queue(function(a){Tooltips.resetZ(),a();}),c.queue($.proxy(function(a){this.clearUpdatedTo(),a();},this)),"function"==$.type(this.options.afterHide)&&this.is("updated")&&c.queue($.proxy(function(a){this.options.afterHide(this._content[0],this.element),a();},this)),this.options.cache||!this.options.ajax&&!this._fn||c.queue($.proxy(function(a){this.is("updated",!1),this.is("updating",!1),this.is("sanitized",!1),a();},this)),"function"==$.type(b)&&c.queue(function(a){b(),a();}),c.queue($.proxy(function(a){this.detach(),a();},this));}},_hide:function(a,b){b=b||("function"==$.type(arguments[0])?arguments[0]:!1),this.attach(),this._tooltip.fadeTo(a?0:this.options.fadeOut,0,$.proxy(function(){this.stopLoading(),this.is("resize-to-content",!1),this._tooltip.hide(),b&&b();},this));},toggle:function(){this.is("disabled")||this[this.visible()?"hide":"show"]();},raise:function(){if(this.is("build")&&!this.options.zIndex){var a=Tooltips.getHighestTooltip();a&&a!=this&&this.zIndex<=a.zIndex&&(this.zIndex=a.zIndex+1,this._tooltip.css({"z-index":this.zIndex}),this._tooltipShadow&&(this._tooltipShadow.css({"z-index":this.zIndex}),this.zIndex=a.zIndex+2,this._tooltip.css({"z-index":this.zIndex})));}}}),$.extend(Tooltip.prototype,{createElementMarker:function(){!this.elementMarker&&this.content&&_.element.isAttached(this.content)&&($(this.content).data("tpd-restore-inline-display",$(this.content).css("display")),this.elementMarker=$("<div>").hide(),$(this.content).before($(this.elementMarker).hide()));},restoreElementToMarker:function(){var a;this.content,this.elementMarker&&this.content&&((a=$(this.content).data("tpd-restore-inline-display"))&&$(this.content).css({display:a}),$(this.elementMarker).before(this.content).remove());},startLoading:function(){this.is("loading")||(this.build(),this.is("loading",!0),this.options.spinner&&(this._tooltip.addClass("tpd-is-loading"),this.skin.startLoading(),this.is("resize-to-content")||(this.position(),this.raise(),this._show())));},stopLoading:function(){this.build(),this.is("loading",!1),this.options.spinner&&(this._tooltip.removeClass("tpd-is-loading"),this.skin.stopLoading());},abort:function(){this.abortAjax(),this.abortSanitize(),this.is("refreshed-before-sanitized",!1);},abortSanitize:function(){this._cache.voila&&(this._cache.voila.abort(),this._cache.voila=null);},abortAjax:function(){this._cache.xhr&&(this._cache.xhr.abort(),this._cache.xhr=null,this.is("updated",!1),this.is("updating",!1));},update:function(a){if(!this.is("updating")){this.is("updating",!0),this.build();var b=this.options.inline?"inline":this.options.ajax?"ajax":_.isElement(this.content)||_.isText(this.content)||_.isDocumentFragment(this.content)?"element":this._fn?"function":"html";switch(this._contentWrapper.css({visibility:"hidden"}),b){case"html":case"element":case"inline":if(this.is("updated")){return a&&a(),void 0;}this._update(this.content,a);break;case"function":if(this.is("updated")){return a&&a(),void 0;}var c=this._fn(this.element);if(!c){return this.is("updating",!1),a&&a(!0),void 0;}this._update(c,a);break;case"ajax":var d=this.options.ajax||{},e=d.url||this.__content,f=d.data||{},b=d.type||"GET",g=d.dataType,h={url:e,data:f};b&&$.extend(h,{type:b}),g&&$.extend(h,{dataType:g});var i=$.extend({},h,d);i.method&&(i=$.extend({},i),delete i.method),$.each("complete error success".split(" "),$.proxy(function(b,c){i[c]||(i[c]="success"==c?function(a,b,c){return c.responseText;}:function(){}),i[c]=_.wrap(i[c],$.proxy(function(b){var d=_slice.call(arguments,1),e=$.type("object"==d[0])?d[0]:d[2];if(!e.statusText||"abort"!=e.statusText){this.options.cache&&AjaxCache.set({url:i.url,type:i.type,data:i.data},c,d),this._cache.xhr=null;var f=b.apply(this,d);f&&this._update(f,a);}},this));},this));var j;if(this.options.cache&&(j=AjaxCache.get(i))&&j.callbacks.success){return $.each(j.callbacks,$.proxy(function(a,b){"function"==$.type(i[a])&&i[a].apply(this,b);},this)),void 0;}this.startLoading(),this._cache.xhr=$.ajax(i);}}},_update:function(a,b){var c={title:this.options.title,close:this.options.close};"string"==$.type(a)||_.isElement(a)||_.isText(a)||_.isDocumentFragment(a)||a instanceof $?c.content=a:$.extend(c,a);var a=c.content,d=c.title,e=c.close;this.content=a,this.title=d,this.close=e,this.createElementMarker(),(_.isElement(a)||a instanceof $)&&$(a).show(),this._content.html(this.content),this._title.html(d&&"string"==$.type(d)?d:""),this._titleWrapper[d?"show":"hide"](),this._close[(this.title||this.options.title)&&e?"show":"hide"]();var f=e&&!(this.options.title||this.title),g=e&&!(this.options.title||this.title)&&"overlap"!=e,h=e&&(this.options.title||this.title)&&"overlap"!=e;this._inner_close[f?"show":"hide"](),this._tooltip[(g?"add":"remove")+"Class"]("tpd-has-inner-close"),this._tooltip[(h?"add":"remove")+"Class"]("tpd-has-title-close"),this._content[(this.options.padding?"remove":"add")+"Class"]("tpd-content-no-padding"),this.finishUpdate(b);},sanitize:function(a){return!this.options.voila||this._content.find("img").length<1?(this.is("sanitized",!0),a&&a(),void 0):(this._cache.voila=Voila(this._content,{method:"onload"},$.proxy(function(b){this._markImagesAsSanitized(b.images),this.is("refreshed-before-sanitized")?(this.is("refreshed-before-sanitized",!1),this.sanitize(a)):(this.is("sanitized",!0),a&&a());},this)),void 0);},_markImagesAsSanitized:function(a){$.each(a,function(a,b){var c=b.img;$(c).data("completed-src",b.img.src);});},_hasAllImagesSanitized:function(){var a=!0;return this._content.find("img").each(function(b,c){var d=$(c).data("completed-src");return d&&c.src==d?void 0:(a=!1,!1);}),a;},refresh:function(){if(this.visible()){if(!this.is("sanitized")){return this.is("refreshed-before-sanitized",!0),void 0;}this.is("refreshing",!0),this.clearTimer("refresh-spinner"),!this.options.voila||this._content.find("img").length<1||this._hasAllImagesSanitized()?(this.is("should-update-dimensions",!0),this.position(),this.is("refreshing",!1)):(this.is("sanitized",!1),this._contentWrapper.css({visibility:"hidden"}),this.startLoading(),this.sanitize($.proxy(function(){this._contentWrapper.css({visibility:"visible"}),this.stopLoading(),this.is("should-update-dimensions",!0),this.position(),this.is("refreshing",!1);},this)));}},finishUpdate:function(a){if(this.is("updated",!0),this.is("updating",!1),"function"==$.type(this.options.afterUpdate)){var b=this._contentWrapper.css("visibility");b&&this._contentWrapper.css({visibility:"visible"}),this.options.afterUpdate(this._content[0],this.element),b&&this._contentWrapper.css({visibility:"hidden"});}a&&a();}}),$.extend(Tooltip.prototype,{clearUpdatedTo:function(){this._cache.updatedTo={};},updateDimensionsToContent:function(a,b){this.skin.build();var c=this.is("loading"),d=this._cache.updatedTo;if((this._maxWidthPass||this.is("api")||this.is("should-update-dimensions")||d.stemPosition!=b||d.loading!=c)&&(!c||!this.is("resize-to-content"))){this._cache.updatedTo={type:this.is("resize-to-content")?"content":"spinner",loading:this.is("loading"),stemPosition:b},this.is("should-update-dimensions")&&this.is("should-update-dimensions",!1);var a=a||this.options.position.target,b=b||this.options.position.tooltip,e=Position.getSide(b),f=Position.getOrientation(b),g=this.skin._css.border;this._tooltip.addClass("tpd-tooltip-measuring");var h=this._tooltip.attr("style");this._tooltip.removeAttr("style");var i={top:g,right:g,bottom:g,left:g},j=0;if("vertical"==Position.getOrientation(b)){this.options.stem&&(i[e]=this.skin["stem_"+e].getMath().dimensions.outside.height);var k=this.getMouseRoom();k[Position._flip[e]]&&(i[e]+=k[Position._flip[e]]);var l=this.getContainmentLayout(b),m=this.getPaddingLine(a),n=!1;Position.isPointWithinBoxLayout(m.x1,m.y1,l)||Position.isPointWithinBoxLayout(m.x2,m.y2,l)?n=!0:$.each("top right bottom left".split(" "),$.proxy(function(a,b){var c=this.getSideLine(l,b);return Position.intersectsLine(m.x1,m.y1,m.x2,m.y2,c.x1,c.y1,c.x2,c.y2)?(n=!0,!1):void 0;},this)),n&&(j="left"==e?m.x1-l.position.left:l.position.left+l.dimensions.width-m.x1,i[e]+=j);}if(this.options.offset&&"vertical"==f){var o=Position.adjustOffsetBasedOnPosition(this.options.offset,this.options.position.target,a);0!==o.x&&(i.right+=Math.abs(o.x));}var j;this.options.containment&&(j=this.options.containment.padding)&&($.each(i,function(a){i[a]+=j;}),"vertical"==f?i["left"==e?"left":"right"]-=j:i["top"==e?"top":"bottom"]-=j);var p=Bounds.viewport(),q=this.close&&"overlap"!=this.close&&!this.title,r={width:0,height:0};q&&(r=this._innerCloseDimensions||{width:this._inner_close.outerWidth(!0),height:this._inner_close.outerHeight(!0)},this._innerCloseDimensions=r),this._contentRelativePadder.css({"padding-right":r.width}),this._contentSpacer.css({width:p.width-i.left-i.right});var s={width:this._content.innerWidth()+r.width,height:Math.max(this._content.innerHeight(),r.height||0)},t={width:0,height:0};if(this.title){var u={width:0,height:0};this._titleWrapper.add(this._titleSpacer).css({width:"auto",height:"auto"}),this.close&&"overlap"!=this.close&&(u={width:this._close.outerWidth(!0),height:this._close.outerHeight(!0)},this._close.hide()),this._maxWidthPass&&s.width>this.options.maxWidth&&this._titleRelative.css({width:s.width}),this._titleRelativePadder.css({"padding-right":u.width});var v=parseFloat(this._titleWrapper.css("border-bottom-width"));t={width:this.title?this._titleWrapper.innerWidth():0,height:Math.max(this.title?this._titleWrapper.innerHeight()+v:0,u.height+v)},t.width>p.width-i.left-i.right&&(t.width=p.width-i.left-i.right,this._titleSpacer.css({width:t.width}),t.height=Math.max(this.title?this._titleWrapper.innerHeight()+v:0,u.height+v)),s.width=Math.max(t.width,s.width),s.height+=t.height,this._titleWrapper.css({height:Math.max(this.title?this._titleWrapper.innerHeight():0,u.height)}),this.close&&this._close.show();}if(this.options.stem){var w="vertical"==f?"height":"width",x=this.skin["stem_"+e].getMath(),y=x.outside.width+2*this.skin._css.radius;s[w]<y&&(s[w]=y);}if(this._contentSpacer.css({width:s.width}),s.height!=Math.max(this._content.innerHeight(),r.height)+(this.title?this._titleRelative.outerHeight():0)&&s.width++,this.is("resize-to-content")||(s=this.skin._css.spinner.dimensions),this.setDimensions(s),i={top:g,right:g,bottom:g,left:g},this.options.stem){var z=Position.getSide(b);i[z]=this.skin.stem_top.getMath().dimensions.outside.height;}this._contentSpacer.css({"margin-top":i.top,"margin-left":+i.left,width:s.width}),(this.title||this.close)&&this._titleWrapper.css({height:this._titleWrapper.innerHeight(),width:s.width}),this._tooltip.removeClass("tpd-tooltip-measuring"),this._tooltip.attr("style",h);var A=this._contentRelative.add(this._titleRelative);this.options.maxWidth&&s.width>this.options.maxWidth&&!this._maxWidthPass&&this.is("resize-to-content")&&(A.css({width:this.options.maxWidth}),this._maxWidthPass=!0,this.updateDimensionsToContent(a,b),this._maxWidthPass=!1,A.css({width:"auto"}));}},setDimensions:function(a){this.skin.setDimensions(a);},getContainmentSpace:function(a,b){var c=this.getContainmentLayout(a,b),d=this.getTargetLayout(),e=d.position,f=d.dimensions,g=c.position,h=c.dimensions,i={top:Math.max(e.top-g.top,0),bottom:Math.max(g.top+h.height-(e.top+f.height),0),left:Math.max(e.left-g.left,0),right:Math.max(g.left+h.width-(e.left+f.width),0)};return e.top>g.top+h.height&&(i.top-=e.top-(g.top+h.height)),e.top+f.height<g.top&&(i.bottom-=g.top-(e.top+f.height)),e.left>g.left+h.width&&g.left+h.width>=e.left&&(i.left-=e.left-(g.left+h.width)),e.left+f.width<g.left&&(i.right-=g.left-(e.left+f.width)),this._cache.layouts.containmentSpace=i,i;},position:function(){if(this.visible()){this.is("positioning",!0),this._cache.layouts={},this._cache.dimensions;var a=this.options.position.target,b=this.options.position.tooltip,c=b,d=a;this.updateDimensionsToContent(d,c);var e=this.getPositionBasedOnTarget(d,c),f=deepExtend(e),g=[];if(this.options.containment){var h=!1,i={};if($.each("top right bottom left".split(" "),$.proxy(function(a,b){(i[b]=this.isSideWithinContainment(b,c,!0))&&(h=!0);},this)),h||(f.contained=!0),f.contained){this.setPosition(f);}else{g.unshift({position:f,targetPosition:d,stemPosition:c});var j=Position.flip(a);if(d=j,c=Position.flip(b),i[Position.getSide(d)]?(this.updateDimensionsToContent(d,c),f=this.getPositionBasedOnTarget(d,c)):f.contained=!1,f.contained){this.setPosition(f,c);}else{g.unshift({position:f,targetPosition:d,stemPosition:c});var k,l=a,m=this.getContainmentSpace(c,!0),n="horizontal"==Position.getOrientation(l)?["left","right"]:["top","bottom"];k=m[n[0]]===m[n[1]]?"horizontal"==Position.getOrientation(l)?"left":"top":n[m[n[0]]>m[n[1]]?0:1];var o=Position.split(l)[1],p=k+o,q=Position.flip(p);if(d=p,c=q,i[Position.getSide(d)]?(this.updateDimensionsToContent(d,c),f=this.getPositionBasedOnTarget(d,c)):f.contained=!1,f.contained){this.setPosition(f,c);}else{g.unshift({position:f,targetPosition:d,stemPosition:c});var r,s=[];if($.each(g,function(a,b){if(b.position.top>=0&&b.position.left>=0){r=b;}else{var c=b.position.top>=0?1:Math.abs(b.position.top),d=b.position.left>=0?1:Math.abs(b.position.left);s.push({result:b,negativity:c*d});}}),!r){var t=s[s.length-1];$.each(s,function(a,b){b.negativity<t.negativity&&(t=b);}),r=t.result;}this.updateDimensionsToContent(r.targetPosition,r.stemPosition,!0),this.setPosition(r.position,r.stemPosition);}}}}else{this.setPosition(f);}this._cache.dimensions=this.skin._vars.dimensions,this.skin.paint(),this.is("positioning",!1);}},getPositionBasedOnTarget:function(a,b){var b=b||this.options.position.tooltip,c=this.getTargetDimensions(),d={left:0,top:0},e={left:0,top:0};Position.getSide(a);var f=this.skin._vars,g=f.frames[Position.getSide(b)],h=Position.getOrientation(a),i=Position.split(a);if("horizontal"==h){var j=Math.floor(0.5*c.width);switch(i[2]){case"left":e.left=j;break;case"middle":d.left=c.width-j,e.left=d.left;break;case"right":d.left=c.width,e.left=c.width-j;}"bottom"==i[1]&&(d.top=c.height,e.top=c.height);}else{var j=Math.floor(0.5*c.height);switch(i[2]){case"top":e.top=j;break;case"middle":d.top=c.height-j,e.top=d.top;break;case"bottom":e.top=c.height-j,d.top=c.height;}"right"==i[1]&&(d.left=c.width,e.left=c.width);}var k=this.getTargetPosition(),l=$.extend({},c,{top:k.top,left:k.left,connection:d,max:e}),m={width:g.dimensions.width,height:g.dimensions.height,top:0,left:0,connection:f.connections[b].connection,stem:f.connections[b].stem};if(m.top=l.top+l.connection.top,m.left=l.left+l.connection.left,m.top-=m.connection.top,m.left-=m.connection.left,this.options.stem){var n=f.stemDimensions.width,o={stem:{top:m.top+m.stem.connection.top,left:m.left+m.stem.connection.left},connection:{top:l.top+l.connection.top,left:l.left+l.connection.left},max:{top:l.top+l.max.top,left:l.left+l.max.left}};if(!Position.isPointWithinBox(o.stem.left,o.stem.top,o.connection.left,o.connection.top,o.max.left,o.max.top)){var o={stem:{top:m.top+m.stem.connection.top,left:m.left+m.stem.connection.left},connection:{top:l.top+l.connection.top,left:l.left+l.connection.left},max:{top:l.top+l.max.top,left:l.left+l.max.left}},p={connection:Position.getDistance(o.stem.left,o.stem.top,o.connection.left,o.connection.top),max:Position.getDistance(o.stem.left,o.stem.top,o.max.left,o.max.top)},q=Math.min(p.connection,p.max),r=o[p.connection<=p.max?"connection":"max"],s="horizontal"==Position.getOrientation(b)?"left":"top",t=Position.getDistance(o.connection.left,o.connection.top,o.max.left,o.max.top);if(t>=n){var u={top:0,left:0},v=r[s]<o.stem[s]?-1:1;u[s]=q*v,u[s]+=Math.floor(0.5*n)*v,m.left+=u.left,m.top+=u.top;}else{$.extend(o,{center:{top:Math.round(l.top+0.5*c.height),left:Math.round(l.left+0.5*c.left)}});var w={connection:Position.getDistance(o.center.left,o.center.top,o.connection.left,o.connection.top),max:Position.getDistance(o.center.left,o.center.top,o.max.left,o.max.top)},q=p[w.connection<=w.max?"connection":"max"],x={top:0,left:0},v=r[s]<o.stem[s]?-1:1;x[s]=q*v,m.left+=x.left,m.top+=x.top;}}}if(this.options.offset){var y=$.extend({},this.options.offset);y=Position.adjustOffsetBasedOnPosition(y,this.options.position.target,a),m.top+=y.y,m.left+=y.x;}var z=this.getContainment({top:m.top,left:m.left},b),A=z.horizontal&&z.vertical,B={x:0,y:0},C=Position.getOrientation(b);if(!z[C]){var D="horizontal"==C,E=D?["left","right"]:["up","down"],F=D?"x":"y",G=D?"left":"top",H=z.correction[F],I=this.getContainmentLayout(b),J=I.position[D?"left":"top"];if(0!==H){var K=f.connections[b].move,L=K[E[0>-1*H?0:1]],M=0>H?-1:1;if(L>=H*M&&m[G]+H>=J){m[G]+=H,B[F]=-1*H,A=!0;}else{if(Position.getOrientation(a)==Position.getOrientation(b)){if(m[G]+=L*M,B[F]=-1*L*M,m[G]<J){var N=J-m[G],O=K[E[0]]+K[E[1]],N=Math.min(N,O);m[G]+=N;var P=B[F]-N;P>=f.connections[b].move[E[0]]&&P<=f.connections[b].move[E[1]]&&(B[F]-=N);}z=this.getContainment({top:m.top,left:m.left},b);var Q=z.correction[F],R=deepExtend({},m);this.options.offset&&(R.left-=this.options.offset.x,R.top-=this.options.offset.y);var o={stem:{top:R.top+m.stem.connection.top,left:R.left+m.stem.connection.left}};o.stem[G]+=B[F];var S=this.getTargetLayout(),n=f.stemDimensions.width,T=Math.floor(0.5*n),U=J+I.dimensions[D?"width":"height"];if("x"==F){var V=S.position.left+T;Q>0&&(V+=S.dimensions.width-2*T),(0>Q&&o.stem.left+Q>=V&&R.left+Q>=J||Q>0&&o.stem.left+Q<=V&&R.left+Q<=U)&&(R.left+=Q);}else{var W=S.position.top+T;Q>0&&(W+=S.dimensions.height-2*T),(0>Q&&o.stem.top+Q>=W&&R.top+Q>=J||Q>0&&o.stem.top+Q<=W&&R.top+Q<=U)&&(R.top+=Q);}m=R,this.options.offset&&(m.left+=this.options.offset.x,m.top+=this.options.offset.y);}}}z=this.getContainment({top:m.top,left:m.left},b),A=z.horizontal&&z.vertical;}return{top:m.top,left:m.left,contained:A,shift:B};},setPosition:function(a,b){var c=this._position;if(!c||c.top!=a.top||c.left!=a.left){var d;if(this.options.container!=document.body){if("string"==$.type(this.options.container)){var e=this.target;"mouse"==e&&(e=this.element),d=$($(e).closest(this.options.container).first());}else{d=$(d);}if(d[0]){var f=$(d).offset(),g={top:Math.round(f.top),left:Math.round(f.left)},h={top:Math.round($(d).scrollTop()),left:Math.round($(d).scrollLeft())};a.top-=g.top,a.top+=h.top,a.left-=g.left,a.left+=h.left;}}this._position=a,this._tooltip.css({top:a.top,left:a.left});}this.skin.setStemPosition(b||this.options.position.tooltip,a.shift||{x:0,y:0});},getSideLine:function(a,b){var c=a.position.left,d=a.position.top,e=a.position.left,f=a.position.top;switch(b){case"top":e+=a.dimensions.width;break;case"bottom":d+=a.dimensions.height,e+=a.dimensions.width,f+=a.dimensions.height;break;case"left":f+=a.dimensions.height;break;case"right":c+=a.dimensions.width,e+=a.dimensions.width,f+=a.dimensions.height;}return{x1:c,y1:d,x2:e,y2:f};},isSideWithinContainment:function(a,b,c){var d=this.getContainmentLayout(b,c),e=this.getTargetLayout(),f=this.getSideLine(e,a);if(Position.isPointWithinBoxLayout(f.x1,f.y1,d)||Position.isPointWithinBoxLayout(f.x2,f.y2,d)){return!0;}var g=!1;return $.each("top right bottom left".split(" "),$.proxy(function(a,b){var c=this.getSideLine(d,b);return Position.intersectsLine(f.x1,f.y1,f.x2,f.y2,c.x1,c.y1,c.x2,c.y2)?(g=!0,!1):void 0;},this)),g;},getContainment:function(a,b){var c={horizontal:!0,vertical:!0,correction:{y:0,x:0}};if(this.options.containment){var d=this.getContainmentLayout(b),e=this.skin._vars.frames[Position.getSide(b)].dimensions;this.options.containment&&((a.left<d.position.left||a.left+e.width>d.position.left+d.dimensions.width)&&(c.horizontal=!1,c.correction.x=a.left<d.position.left?d.position.left-a.left:d.position.left+d.dimensions.width-(a.left+e.width)),(a.top<d.position.top||a.top+e.height>d.position.top+d.dimensions.height)&&(c.vertical=!1,c.correction.y=a.top<d.position.top?d.position.top-a.top:d.position.top+d.dimensions.height-(a.top+e.height)));}return c;},getContainmentLayout:function(a,b){var c={top:$(window).scrollTop(),left:$(window).scrollLeft()},d=this.target;"mouse"==d&&(d=this.element);var e,f=$(d).closest(this.options.containment.selector).first()[0];e=f&&"viewport"!=this.options.containment.selector?{dimensions:{width:$(f).innerWidth(),height:$(f).innerHeight()},position:$(f).offset()}:{dimensions:Bounds.viewport(),position:c};var g=this.options.containment.padding;if(g&&!b){var h=Math.max(e.dimensions.height,e.dimensions.width);if(2*g>h&&(g=Math.max(Math.floor(0.5*h),0)),g){e.dimensions.width-=2*g,e.dimensions.height-=2*g,e.position.top+=g,e.position.left+=g;var i=Position.getOrientation(a);"vertical"==i?(e.dimensions.width+=g,"left"==Position.getSide(a)&&(e.position.left-=g)):(e.dimensions.height+=g,"top"==Position.getSide(a)&&(e.position.top-=g));}}return this._cache.layouts.containmentLayout=e,e;},getMouseRoom:function(){var a={top:0,left:0,right:0,bottom:0};if("mouse"==this.options.target&&!this.is("api")){var b=Mouse.getActualPosition(this._cache.event),c=$(this.element).offset(),d={width:$(this.element).innerWidth(),height:$(this.element).innerHeight()};a={top:Math.max(0,b.top-c.top),bottom:Math.max(0,c.top+d.height-b.top),left:Math.max(0,b.left-c.left),right:Math.max(0,c.left+d.width-b.left)};}return a;},getTargetPosition:function(){var a;if("mouse"==this.options.target){if(this.is("api")){var b=$(this.element).offset();a={top:Math.round(b.top),left:Math.round(b.left)};}else{a=Mouse.getPosition(this._cache.event);}}else{var b=$(this.target).offset();a={top:Math.round(b.top),left:Math.round(b.left)};}return this._cache.layouts.targetPosition=a,a;},getTargetDimensions:function(){if(this._cache.layouts.targetDimensions){return this._cache.layouts.targetDimensions;}var a;return a="mouse"==this.options.target?Mouse.getDimensions():{width:$(this.target).innerWidth(),height:$(this.target).innerHeight()},this._cache.layouts.targetDimensions=a,a;},getTargetLayout:function(){if(this._cache.layouts.targetLayout){return this._cache.layouts.targetLayout;}var a={position:this.getTargetPosition(),dimensions:this.getTargetDimensions()};return this._cache.layouts.targetLayout=a,a;},getPaddingLine:function(a){var b=this.getTargetLayout(),c="left";if("vertical"==Position.getOrientation(a)){return this.getSideLine(b,Position.getSide(a));}if(Position.isCorner(a)){var d=Position.inverseCornerPlane(a);return c=Position.getSide(d),this.getSideLine(b,c);}var e=this.getSideLine(b,c),f=Math.round(0.5*b.dimensions.width);return e.x1+=f,e.x2+=f,e;}}),$.extend(Tooltip.prototype,{setActive:function(){this.is("active",!0),this.visible()&&this.raise(),this.options.hideAfter&&this.clearTimer("idle");},setIdle:function(){this.is("active",!1),this.options.hideAfter&&this.setTimer("idle",$.proxy(function(){this.clearTimer("idle"),this.is("active")||this.hide();},this),this.options.hideAfter);}}),$.extend(Tooltip.prototype,{bind:function(a,b,c,d){b=b;var e=$.proxy(c,d||this);this._cache.events.push({element:a,eventName:b,handler:e}),$(a).bind(b,e);},unbind:function(){$.each(this._cache.events,function(a,b){$(b.element).unbind(b.eventName,b.handler);}),this._cache.events=[];}}),$.extend(Tooltip.prototype,{disable:function(){this.is("disabled")||this.is("disabled",!0);},enable:function(){this.is("disabled")&&this.is("disabled",!1);}}),$.extend(Tooltip.prototype,{is:function(a,b){return"boolean"==$.type(b)&&(this._cache.is[a]=b),this._cache.is[a];},visible:function(){return this.is("visible");}}),$.extend(Tooltip.prototype,{setTimer:function(a,b,c){this._cache.timers[a]=_.delay(b,c);},getTimer:function(a){return this._cache.timers[a];},clearTimer:function(a){this._cache.timers[a]&&(clearTimeout(this._cache.timers[a]),delete this._cache.timers[a]);},clearTimers:function(){$.each(this._cache.timers,function(a,b){clearTimeout(b);}),this._cache.timers={};}}),$.extend(Tipped,{init:function(){Tooltips.init();},create:function(a,b){var c=$.extend({},arguments[2]||{}),d=[];return _.isElement(a)?d.push(new Tooltip(a,b,c)):$(a).each(function(a,e){d.push(new Tooltip(e,b,c));}),new Collection(d);},get:function(a){var b=Tooltips.get(a);return new Collection(b);},findElement:function(a){return Tooltips.findElement(a);},hideAll:function(){return Tooltips.hideAll(),this;},setDefaultSkin:function(a){return Tooltips.setDefaultSkin(a),this;},visible:function(a){if(_.isElement(a)){return Tooltips.isVisibleByElement(a);}if("undefined"!=$.type(a)){var b=$(a),c=0;return $.each(b,function(a,b){Tooltips.isVisibleByElement(b)&&c++;}),c;}return Tooltips.getVisible().length;},clearAjaxCache:function(){return Tooltips.clearAjaxCache(),this;},refresh:function(a,b,c){return Tooltips.refresh(a,b,c),this;},setStartingZIndex:function(a){return Tooltips.setStartingZIndex(a),this;},remove:function(a){return Tooltips.remove(a),this;}}),$.each("show hide toggle disable enable".split(" "),function(a,b){Tipped[b]=function(a){return this.get(a)[b](),this;};}),$.extend(Tipped,{delegate:function(){Delegations.add.apply(Delegations,_slice.call(arguments));},undelegate:function(){Delegations.remove.apply(Delegations,_slice.call(arguments));}});var Delegations={_uid:0,_delegations:{},add:function(a,b,c){var c;"object"!=$.type(b)||_.isElement(b)?c=arguments[2]||{}:(c=b,b=null);var d=++this._uid,e=Options.create($.extend({},c));this._delegations[d]={uid:d,selector:a,content:b,options:e};var f=function(a){$(this).addClass("tpd-delegation-uid-"+d);var e=new Tooltip(this,b,c);e._cache.event=a,e.setActive(),e.showDelayed();};this._delegations[d].removeTitleHandler=$.proxy(this.removeTitle,this),$(document).delegate(a+":not(.tpd-delegation-uid-"+d+")","mouseenter",this._delegations[d].removeTitleHandler),this._delegations[d].handler=f,$(document).delegate(a+":not(.tpd-delegation-uid-"+d+")",e.showOn.element,f);},removeTitle:function(a){var b=a.currentTarget,c=$(b).attr("title");c&&($(b).data("tipped-restore-title",c),$(b)[0].setAttribute("title",""));},remove:function(a){$.each(this._delegations,$.proxy(function(b,c){c.selector==a&&($(document).undelegate(a+":not(.tpd-delegation-uid-"+b+")","mouseenter",c.removeTitleHandler).undelegate(a+":not(.tpd-delegation-uid-"+b+")",c.options.showOn.element,c.handler),delete this._delegations[b]);},this));},removeAll:function(){$.each(this._delegations,$.proxy(function(a,b){$(document).undelegate(b.selector+":not(.tpd-delegation-uid-"+a+")","mouseenter",b.removeTitleHandler).undelegate(b.selector+":not(.tpd-delegation-uid-"+a+")",b.options.showOn.element,b.handler),delete this._delegations[a];},this));}};return $.extend(Collection.prototype,{initialize:function(a){return this.tooltips=a,this;},items:function(){return $.each(this.tooltips,function(a,b){b.is("api",!0);}),this.tooltips;},refresh:function(){return $.each(this._tooltips,function(a,b){b.is("visible")&&b.refresh();}),this;},remove:function(){return Tooltips.removeTooltips(this.tooltips),this.tooltips=[],this;}}),$.each("show hide toggle disable enable".split(" "),function(a,b){Collection.prototype[b]=function(){return $.each(this.tooltips,function(a,c){c.is("api",!0),c[b]();}),this;};}),Tipped.init(),Tipped;});function reloadRightmenu(url){$.get(url,{},displayRightmenu);}function displayRightmenu(data){$("#rechts").replaceWith(data);initPlanetSorting();}function ajaxFormSubmit(form,url,okFunction){var params=$("#"+form+"").serialize();var successFunction=null;if(okFunction!=null&&typeof okFunction=="function"){successFunction=okFunction;}$.ajax({type:"POST",url:url,data:params,success:successFunction});}function initConnectionErrorFunction(){if(isMobile){document.addEventListener("deviceready",function(){$(document).ajaxError(function(e,xhr,settings,exception){HostApp.ShowNoConnectionScreen();});},false);}}// page: ainfo.js
function initAllianceInfo(){initConnectionErrorFunction();initTooltips();initOverlays();initHideElements();}function manageTabs(id){var selector='#'+id;var rel=$(selector).attr('rel');if($(selector).hasClass('opened')){$(selector).addClass('closed');$(selector).removeClass('opened');$("#"+rel).hide();}else{$(selector).removeClass('closed');$(selector).addClass('opened');$("#"+rel).show();$('.alliancetexts').keyup();//This will trigger the keyup-Event for the editor. This will set the remaining Chars Counter to the right value.
}}function ajaxLoad(page){$("#eins select").ogameDropDown('destroy');$("#eins").html('<div class="ajaxLoad">'+LocalizationStrings.loading+'</div>');$.post(page,{"ajax":1},function(data){$("#eins").html(data).find('select').ogameDropDown();});}function initAlliance(){initToggleHeader('alliance');$(".navi").click(function(){var targetPage=$(this).attr('rel');$("#tab-ally li").removeClass('aktiv');$(this).parent().addClass('aktiv');hideTipsOnTabChange();ajaxLoad(targetPage);});}function initAllianceBroadcast(){$("#allianceBroadCast").submit(function(){var $thisObj=$(this);if($.trim($thisObj.find("textarea[name=\"text\"]").val()).length==0){errorBoxNotify(LocalizationStrings.error,chatLoca["TEXT_EMPTY"],LocalizationStrings.ok);return false;}$.post($thisObj.attr("action"),$thisObj.serialize()+"&ajax=1",function(data){try{var decodedData=$.parseJSON(data);if(typeof decodedData.message!="undefined"){errorBoxNotify(LocalizationStrings.notice,decodedData.message,LocalizationStrings.ok);}}catch(e){$("#eins").html(data);}});return false;});}function initAllianceManagement(){$(".contentz").tabs({activate:hideTipsOnTabChange});$(".allyTagChange").tabs({activate:hideTipsOnTabChange});$(".quitAlly").tabs({activate:hideTipsOnTabChange});$('.dissolve').bind('click',dissolve);$('.deleteRank').bind('click',deleteRank);$('.transferLeadership').bind('click',transferLeadership);$('.takeoverLeadership').bind('click',takeoverLeadership);}// ----------------------------------------------------------------------------
// markItUp!
// ----------------------------------------------------------------------------
// Copyright (C) 2011 Jay Salvat
// http://markitup.jaysalvat.com/
// ----------------------------------------------------------------------------
// Html tags
// http://en.wikipedia.org/wiki/html
// ----------------------------------------------------------------------------
// Basic set. Feel free to add more tags
// ----------------------------------------------------------------------------
/**
 * Ogame specific initialisation code for the markItUp Editor
 *
 * @param locaKeys { Object }
 * @param itemArray { Object }
 * @param imagesAllowed { Boolean }
 * @param selector { String } - is specified, only init editor for this selector
 * @param maxChars { Number } - maximum length of entered text
 * @param lite { bool } - limits possible functions
 **/function initBBCodeEditor(locaKeys,itemArray,imagesAllowed,selector,maxChars,lite){var $textareas;if(typeof selector=='undefined'||selector==null){$textareas=$('textarea:not(.markItUpEditor)');}else{$textareas=$(selector).filter(':not(.markItUpEditor)');}if($textareas.length==0){return;}var imagesAllowed=imagesAllowed||false;var fontSizeArray=[];for(var fontSizeCounter=6;fontSizeCounter<=30;fontSizeCounter+=2){fontSizeArray.push({name:fontSizeCounter,openWith:'[size='+fontSizeCounter+']',closeWith:'[/size]',placeHolder:'Text',className:'fontSize'+fontSizeCounter});}var itemDropdownArray=[];$.each(itemArray,function(uuid,name){itemDropdownArray.push({name:name,replaceWith:'[item]'+uuid+'[/item]'});});function multiInsertSelectionFix(e){if(e.selection.length==0){return;}var $textarea=$(e.textarea);var range=$textarea.getSelection();var listItemStart=$textarea.val().indexOf(e.openWith,range.start);var rangeValue=listItemStart+e.openWith.length;var placeHolderLength=typeof e.placeHolder=='string'?e.placeHolder.length:0;var newRange={start:rangeValue,end:rangeValue+placeHolderLength};$textarea.setSelection(newRange);}function colorPicker(e){var openWith=e.openWith;var $textarea=$(e.textarea);var selection=$textarea.getSelection();$textarea.siblings('.colorpicker').val('').colorpicker('open').colorpicker('option','close',function(e,color){var replaceBy=openWith.replace(/%colorCode%/,color.formatted);// determine new text selection
var selectionOffset="%colorCode%".length-color.formatted.length;selection.start=selection.start-selectionOffset;selection.end=selection.end-selectionOffset;$textarea.val($textarea.val().replace(openWith,replaceBy)).setSelection(selection);});var $button=$textarea.siblings('.markItUpHeader').find('.'+e.className);$('.ui-colorpicker:visible').css('top',$button.offset().top+$button.height()).css('left',$button.offset().left);$('.ui-colorpicker').draggable();$('.ui-colorpicker-rgb-r .ui-colorpicker-number').focus();return e;}function backgroundImage(e){var $textarea=$(e.textarea);var selection=$textarea.getSelection();var openWith=e.openWith;var $imagePickerOverlay=$('#backgroundImagePicker');if($imagePickerOverlay.is(':visible')){$imagePickerOverlay.dialog('close');}$imagePickerOverlay.find('input:checked').prop('checked',false);$imagePickerOverlay.find('.url').val('http://').focus();openOverlay($imagePickerOverlay,{type:'inline',title:locaKeys.backgroundImage,close:function(){var imageText=$imagePickerOverlay.find('.url').val();var checkedX=$imagePickerOverlay.find('.repeatX:checked').length;var checkedY=$imagePickerOverlay.find('.repeatY:checked').length;var repeat="";if(checkedX&&checkedY){repeat="yes";}else if(checkedX){repeat="yes-x";}else if(checkedY){repeat="yes-y";}if(repeat.length){imageText+=" image-repeat="+repeat;}var replaceBy=openWith.replace(/%image%/,imageText);// determine new text selection
var selectionOffset="%image%".length-imageText.length;selection.start=selection.start-selectionOffset;selection.end=selection.end-selectionOffset;$textarea.val($textarea.val().replace(openWith,replaceBy)).setSelection(selection);}});var $button=$textarea.siblings('.markItUpHeader').find('.'+e.className);$imagePickerOverlay.parent().css('top',$button.offset().top+$button.height()).css('left',$button.offset().left);return e;}// END function backgroundImage(e)
var markupSetBasic=lite?[{name:locaKeys.bold,key:'B',openWith:'[b]',closeWith:'[/b]',className:'bold'},{name:locaKeys.italic,key:'I',openWith:'[i]',closeWith:'[/i]',className:'italic'},{name:locaKeys.fontColor,afterInsert:colorPicker,openWith:'[color=%colorCode%]',closeWith:'[/color]',placeHolder:locaKeys.textPlaceHolder,className:'fontColor'},{name:locaKeys.fontSize,className:'fontSize',dropMenu:fontSizeArray},{name:locaKeys.list,openWith:'[*]',multiline:true,openBlockWith:'[list]\n',closeBlockWith:'\n[/list]',className:'list',afterMultiInsert:multiInsertSelectionFix,placeHolder:locaKeys.textPlaceHolder},{name:locaKeys.coordinates,openWith:'[coordinates]',closeWith:'[/coordinates]',placeHolder:locaKeys.coordinatePlaceHolder,className:'coordinates'}]:[{name:locaKeys.bold,key:'B',openWith:'[b]',closeWith:'[/b]',className:'bold'},{name:locaKeys.italic,key:'I',openWith:'[i]',closeWith:'[/i]',className:'italic'},{name:locaKeys.fontColor,afterInsert:colorPicker,openWith:'[color=%colorCode%]',closeWith:'[/color]',placeHolder:locaKeys.textPlaceHolder,className:'fontColor'},{name:locaKeys.fontSize,className:'fontSize',dropMenu:fontSizeArray},{name:locaKeys.list,openWith:'[*]',multiline:true,openBlockWith:'[list]\n',closeBlockWith:'\n[/list]',className:'list',afterMultiInsert:multiInsertSelectionFix,placeHolder:locaKeys.textPlaceHolder},{name:locaKeys.link,key:'L',openWith:'[url=[!['+locaKeys.link+':!:http://]!]]',closeWith:'[/url]',placeHolder:locaKeys.textPlaceHolder,className:'link'},{name:locaKeys.coordinates,openWith:'[coordinates]',closeWith:'[/coordinates]',placeHolder:locaKeys.coordinatePlaceHolder,className:'coordinates'}];var markupSetAdvanced=lite?[{name:locaKeys.underline,key:'U',openWith:'[u]',closeWith:'[/u]',className:'underline'},{name:locaKeys.stroke,key:'S',openWith:'[s]',closeWith:'[/s]',className:'strikeThrough'},{name:locaKeys.sub,openWith:'[sub]',closeWith:'[/sub]',className:'sub'},{name:locaKeys.sup,openWith:'[sup]',closeWith:'[/sup]',className:'sup'},{separator:'-'},{name:locaKeys.item,className:'item',dropMenu:itemDropdownArray},{name:locaKeys.player,openWith:'[player]',closeWith:'[/player]',placeHolder:locaKeys.playerPlaceHolder,className:'player'},{separator:'-'},{name:locaKeys.alignLeft,openWith:'[align=left]',closeWith:'[/align]',className:'leftAlign'},{name:locaKeys.alignCenter,openWith:'[align=center]',closeWith:'[/align]',className:'centerAlign'},{name:locaKeys.alignRight,openWith:'[align=right]',closeWith:'[/align]',className:'rightAlign'},{name:locaKeys.alignJustify,openWith:'[align=justify]',closeWith:'[/align]',className:'justifyAlign'},{separator:'-'},{name:locaKeys.code,openWith:'[code]',closeWith:'[/code]',className:'code'},{separator:'-'},{name:locaKeys.email,key:'E',openWith:'[email=[!['+locaKeys.email+':!:]!]]',closeWith:'[/email]',placeHolder:locaKeys.textPlaceHolder,className:'email'},{name:locaKeys.preview,className:'preview',call:'preview'}]:[{name:locaKeys.underline,key:'U',openWith:'[u]',closeWith:'[/u]',className:'underline'},{name:locaKeys.stroke,key:'S',openWith:'[s]',closeWith:'[/s]',className:'strikeThrough'},{name:locaKeys.sub,openWith:'[sub]',closeWith:'[/sub]',className:'sub'},{name:locaKeys.sup,openWith:'[sup]',closeWith:'[/sup]',className:'sup'},{name:locaKeys.backgroundColor,afterInsert:colorPicker,openWith:'[background color=%colorCode%]',closeWith:'[/background]',placeHolder:locaKeys.textPlaceHolder,className:'backgroundColor'},{name:locaKeys.backgroundImage,afterInsert:backgroundImage,openWith:'[background image=%image%]',closeWith:'[/background]',placeHolder:locaKeys.textPlaceHolder,className:'backgroundImage'},{separator:'-'},{name:locaKeys.item,className:'item',dropMenu:itemDropdownArray},{name:locaKeys.player,openWith:'[player]',closeWith:'[/player]',placeHolder:locaKeys.playerPlaceHolder,className:'player'},{name:locaKeys.tooltip,openWith:'[tooltip position="top" text="[![Tooltip Text:!:Tooltip Text]!]"]',closeWith:'[/tooltip]',placeHolder:locaKeys.textPlaceHolder,className:'tooltip'},{separator:'-'},{name:locaKeys.alignLeft,openWith:'[align=left]',closeWith:'[/align]',className:'leftAlign'},{name:locaKeys.alignCenter,openWith:'[align=center]',closeWith:'[/align]',className:'centerAlign'},{name:locaKeys.alignRight,openWith:'[align=right]',closeWith:'[/align]',className:'rightAlign'},{name:locaKeys.alignJustify,openWith:'[align=justify]',closeWith:'[/align]',className:'justifyAlign'},{separator:'-'},{name:locaKeys.block,openWith:'[p]',closeWith:'[/p]',className:'block'},{name:locaKeys.code,openWith:'[code]',closeWith:'[/code]',className:'code'},{name:locaKeys.spoiler,openWith:'[spoiler]',closeWith:'[/spoiler]',className:'spoiler'},{separator:'-'},{name:locaKeys.hr,openWith:'[hr]',className:'hr'},{separator:'-'},{name:locaKeys.picture,key:'Z',replaceWith:'[img][!['+locaKeys.picture+':!:http://]!][/img]',className:'picture'},{name:locaKeys.email,key:'E',openWith:'[email=[!['+locaKeys.email+':!:]!]]',closeWith:'[/email]',placeHolder:locaKeys.textPlaceHolder,className:'email'},{name:locaKeys.preview,className:'preview',call:'preview'}];if(!imagesAllowed){$.each(markupSetAdvanced,function(index){if(this.className=='picture'||this.className=='backgroundImage'){markupSetAdvanced.splice(index,1);}});}if(isMobile){// dont show colorpickers on ipad
$.each(markupSetBasic,function(index){if(this.className=='fontColor'||this.className=='backgroundColor'){markupSetBasic.splice(index,1);}});$.each(markupSetAdvanced,function(index){if(this.className=='fontColor'||this.className=='backgroundColor'){markupSetAdvanced.splice(index,1);}});}var editorSettings={onShiftEnter:{keepDefault:false,replaceWith:'\n'},onCtrlEnter:{keepDefault:false,openWith:'\n[p]',closeWith:'[/p]'},onTab:{keepDefault:false,replaceWith:'\t'},markupSet:[markupSetBasic,markupSetAdvanced],resizeHandle:false,previewParserPath:bbcodePreviewUrl+"&imgAllowed="+(imagesAllowed?1:0),previewAutoRefresh:true,previewParserVar:'text',previewInElement:$('<div class="miu_preview_container"></div>'),afterInsert:function(e){$(e.textarea).trigger('keyup');}};$.colorpicker.regional['custom']=locaKeys.colorPicker;$textareas.each(function(){var $this=$(this);$this.markItUp(editorSettings)// create colorpicker
.after($('<input type="hidden" class="colorpicker"/>').colorpicker({color:'#000000',colorFormat:"#HEX",hsv:false,parts:'popup',regional:'custom',showCancelButton:false}));// The preview element needs to be inserted after creation of editor to be in the right place
editorSettings.previewInElement.insertAfter($this);// preview action as link and not as set button
$('.miu_advanced .preview').hide();// create a footer for char count and preview link
var $miuFooter=$('<div class="miu_footer clearfix"></div>');$miuFooter.append('<a role="button" class="fright txt_link btn_blue preview_link">'+locaKeys.preview+'</a>').append('<span class="fleft"><span class="cnt_chars">'+maxChars+'</span> '+locaKeys.charsLeft+'</span>');$miuFooter.insertAfter($this);$this.on('keyup.bbCodeEditor',function(){if($this.val().length>maxChars){$this.val($this.val().substr(0,maxChars));}$this.closest('.markItUpContainer').find('.cnt_chars').html(maxChars-$this.val().length);});$('.miu_preview_container').hide();$('.preview_link').on('click.bbCodeEditor',function(){editorSettings.previewInElement.insertAfter($(event.target).closest('.markItUpContainer').find('.miu_footer'));$(event.target).closest('.markItUpContainer').find('.miu_preview_container').show();$(event.target).closest('.markItUpContainer').find('.preview').click();});if(isMobile){$this.siblings(".markItUpHeader").find("a").attr('title','');$this.siblings(".markItUpHeader").find("li:not(.markItUpDropMenu) a").bind('mouseup',function(){// open keyboard again
$this.focus();});}else{$this.siblings(".markItUpHeader").find("ul ul a").attr('title','');}if($('#backgroundImagePicker').length==0){$("body").append($('<div id="backgroundImagePicker" style="display: none;"><table>'+'<tr><td>'+locaKeys.backgroundImage+':</td><td><input type="text" class="url"/></td></tr>'+'<tr><td>'+locaKeys.backgroundImagePicker.repeatX+':</td><td><input type="checkbox" class="repeatX"/></td></tr>'+'<tr><td>'+locaKeys.backgroundImagePicker.repeatY+':</td><td><input type="checkbox" class="repeatY"/></td></tr>'+'</table>'+'<div><a href="javascript:void(0);" class="btn_blue">'+locaKeys.backgroundImagePicker.ok+'</a></div>'+'</div>'));$('#backgroundImagePicker').find('a').bind('click',function(){$('#backgroundImagePicker').dialog('close');});}});/* *** adding additional event listeners *** */$('.toggle_miu_advanced').on('click.bbCodeEditor',function(){if($('.miu_advanced').is(':visible')){$('.miu_advanced').hide();$(this).removeClass('hide_miu_advanced').addClass('show_miu_advanced');}else{$('.miu_advanced').show();$(this).removeClass('show_miu_advanced').addClass('hide_miu_advanced');}});}function initBBCodes(){$(document).undelegate('.spoilerHeader','click').delegate('.spoilerHeader','click',function(){var thisObj=this;$(this).next('.spoilerText').toggle(0,function(){Tipped.refresh(thisObj);});});}ogame.buddies={initBuddyList:function(){$.tablesorter.addParser({id:'coordinates',is:function(s){return false;},format:function(s){// format your data for normalization
var res=$.trim(s).slice(1,-1).split(':');var result=res[0]*16384+res[1]*32+res[2]*1;return result;},type:'numeric'});$.tablesorter.addParser({id:"commaDigit",is:function(s,table){var c=table.config;return jQuery.tablesorter.isDigit(s.replace(/\./g,""),c);},format:function(s){return jQuery.tablesorter.formatFloat(s.replace(/\./g,""));},type:"numeric"});$('.content_table').tablesorter({widgets:['zebra'],headers:{0:{sorter:false},2:{sorter:'commaDigit'},5:{sorter:'coordinates'},6:{sorter:false}},cssHeader:'ct_sortable_title',cssAsc:'ct_sort_asc',cssDesc:'ct_sort_desc'});$('#buddylist').off('.buddyList');$('#buddylist').on('click.buddyList','.deleteBuddy',deleteBuddy);$('#chatContent').on('click.chat_info','.deleteBuddy',deleteBuddy);},/*
    * Initializes that is needed for the buddies page
    * @returns {undefined}
    */initBuddies:function(){// adding hover style for tables
$('.zebra tr').mouseover(function(){$(this).addClass("over");}).mouseout(function(){$(this).removeClass("over");});// toggles the buddy requests section
$('.js_accordion').accordion({collapsible:true,heightStyle:'content'});// for buddy requests
$('.js_tabs').tabs();$(".js_scrollbar").mCustomScrollbar({theme:"ogame"});}};function initInviteCodes(){$("#buddyinvite .code").click(function(){$(this).selectText();});}function incrementBuddyCount(){var buddyCount=parseInt($("#buddyCount").text())+1;var requestCount=parseInt($("#newRequestCount").text())-1;updateRequestCount(requestCount);updateBuddyCount(buddyCount);}function updateRequestCount(count){$("#newRequestCount").html(count);}function updateBuddyCount(count){$("#buddyCount").html(count);}function reportMessage(id,fromPlayer,toPlayer){$.ajax({type:'POST',url:'?page=reportSpam_ajax',dataType:'json',data:{messageId:id,from:fromPlayer,to:toPlayer},success:function(data){fadeBox(data.message,!data.result);},error:function(){}});}function reportAllyMessage(id,fromPlayer){$.ajax({type:'POST',url:'?page=reportSpam_ajax',dataType:'json',data:{messageId:id,from:fromPlayer},success:function(data){fadeBox(data.message,!data.result);},error:function(){}});}var elem,messageId,senderId;function reportAllyRoundMessage(_elem,_messageId,_senderId,_question){elem=_elem;messageId=_messageId;senderId=_senderId;errorBoxDecision(LocalizationStrings.attention,_question,LocalizationStrings.yes,LocalizationStrings.no,reportMessageCallback);}function reportMessageCallback(){elem.hide();reportAllyMessage(messageId,senderId);}function requestsReady(){$(document).on('click','.acceptRequest',acceptRequest);$(document).on('click','.rejectRequest',rejectRequest);$(document).on('click','.cancelRequest',cancelRequest);$(document).on('click','.reportRequest',reportRequest);}function initBuddyRequestForm(){$(".overlayDiv .buddyRequest form").unbind('submit').bind('submit',function(e){var $thisObj=$(this);e.preventDefault();$.post($thisObj.attr('action'),$thisObj.serialize(),"html").done(function(data){document.open();document.write(data);document.close();}).fail(function(){var currentlocation=window.location.href;window.location=currentlocation.substring(0,currentlocation.indexOf('?'))+'?page=ingame&component=buddies';}).always(function(){return false;});});$('.buddyRequest').each(function(){var $thisObj=$(this);var $overlayTitle=$thisObj.parents('.ui-dialog').find('.ui-dialog-title');if(!$overlayTitle.find('span.buddyName').length){$overlayTitle.append($(document.createElement('span')).addClass('buddyName').text(' ('+$thisObj.attr('data-title')+')'));}});}/**
 *
 * @TODO in 6.0.0 use ogame.buyResources Namespace here!
 *
 */function initBuyResourceOverlay(isLastBuildingSlot,showLastBuildingSlotWarning,localization){$('.close_buyResourceOverlay').on('click',function(){$('#buyResourceOverlayBody').closest('.ui-dialog').find('.ui-icon-closethick').click();});var sendStuff=function(){if(isLastBuildingSlot&&showLastBuildingSlotWarning){errorBoxDecision(localization.allNetworkAttention,localization.slotWarning,localization.allYes,localization.allNo,sendDMAcceptanceForm);}else{sendDMAcceptanceForm();}};$('#premiumConfirmButton').on('click',function(event){event.preventDefault();sendStuff();});$(document).on("ajaxShowOverlay",function(event){$('#premiumConfirmButton').focus();});$('#premiumConfirmButton').on('keyup',function(event){event.stopPropagation();if(event.keyCode==13){sendStuff();}});}function sendDMAcceptanceForm(){$('#premiumAcceptForm').submit();return;}function openBuyResourceDialog(buyResourceDialogLink){openOverlay(buyResourceDialogLink,{'class':"buyResourceDialog"});}function abortBuyResource(){$('.overlaydiv .abort_button').on('click',function(){$('.overlaydiv').dialog('close');});}function initBuyResources(){refreshBars('bar_container','filllevel_bar');$('.fill_resource').on('click','.fillup',onChangeToPremium)// .on('click', '.btn_blue', onChangeToPremium)
.on('click','.btn_premium',submitBuyRequest);}function onChangeToPremium(e){var $btn=$(e.currentTarget).find('.btn_blue'),$fillup=$btn.closest('.fillup'),$premiumBar=$btn.closest('.fill_resource_ctn').find('.premium_bar');// reset
$('.fillup').removeClass('premium').parent().find('.current_stock span').removeClass('premium_txt').each(function(){// color of the current amount of the selected resource
var $this=$(this);$this.text($this.data('currentAmount'));// reset stock text to current amount
});$('.fill_resource .btn_premium').html(loca.fillUpResource).attr('class','btn_blue');$('.premium_bar').css('width','0%').data('premiumPercent',0);// do not highlight disabled buttons
if($btn.attr('disabled')=='disabled'){return;}$btn.html(loca.buyNow).attr('class','btn_premium small');$fillup.addClass('premium');$fillup.parent().find('.current_stock span').addClass('premium_txt')// color of the current amount of the selected resource
.text($btn.data('newValueFormatted'));// set stock text to the amount the player will have after buying the package
$premiumBar.data('premiumPercent',$btn.data('premiumPercent'));changeTooltip($premiumBar,'+'+tsdpkt(Math.floor($btn.data('premiumValue'))));refreshBars('bar_container','filllevel_bar','premium_bar');}function submitBuyRequest(e){var $btn=$(e.currentTarget),resource=$btn.data('resource'),costs=$btn.data('premiumCosts'),myPackage=$btn.data('packageType'),token=$btn.data('traderBuyResource');$.ajax({url:'index.php?page=traderOverview',data:{buyResource:resource,buyPackage:myPackage,costs:costs,token:token,ajax:1},type:"POST",dataType:"json",success:function(dataFromBuy){refreshToken=function(token){$('.btn_blue').each(function(){$(this).data('traderBuyResource',token);});};refreshToken(dataFromBuy['buyResourceToken']);if(!dataFromBuy.success){fadeBox(dataFromBuy.message,true);return;}getAjaxResourcebox(function(resources){// fuer alle balken
$('.fill_resource .bar_container').each(function(){var $bar=$(this);$bar.data('currentAmount',resources[$bar.data('resource')]['amount']);$bar.parent().find('.current_stock span').html(dataFromBuy[$bar.data('resource')]).data('currentAmount',dataFromBuy[$bar.data('resource')]);refreshBars('fill_resource .bar_container','filllevel_bar');});});$('.fill_resource .fillup').each(function(){var $currentPackage=$(this);var $myButton=$currentPackage.find('a');var myResourceType=$myButton.data('resource');var myPackageType=$myButton.data('packageType');if(!dataFromBuy['possiblePackages'][myResourceType][myPackageType]['isBuyable']){$myButton.attr('disabled','disabled');$currentPackage.attr('disabled','disabled');$currentPackage.addClass('disabled');}$myButton.data('premiumCosts',dataFromBuy['possiblePackages'][myResourceType][myPackageType]['costs']);$myButton.data('premiumValue',dataFromBuy['possiblePackages'][myResourceType][myPackageType]['resources']);$myButton.data('newValueFormatted',dataFromBuy['possiblePackages'][myResourceType][myPackageType]['newValueFormatted']);//console.log(dataFromBuy['possiblePackages'][myResourceType][myPackageType]);
if(dataFromBuy['possiblePackages'][myResourceType][myPackageType]['displayCosts']){$currentPackage.find('.fillup_cost .premium_txt').html(dataFromBuy['possiblePackages'][myResourceType][myPackageType]['formattedCosts']);}else{$currentPackage.find('.fillup_cost').addClass('overmark').html('-');// also kills span with .premium_txt
}if(myPackageType==3)/* LARGE */{var buyButtonClass=$myButton.data('buyButtonClass');if(!dataFromBuy['possiblePackages'][myResourceType][myPackageType]['isCapped']&&$currentPackage.children("."+buyButtonClass).length){// package was capped but isn't capped anymore
$currentPackage.children("."+buyButtonClass).removeClass(buyButtonClass).addClass('fillup_100percent');$currentPackage.children('.fillup_txt').html(loca.fillUpTo);}}});},error:function(){}});}/**/ogame.chat={socket:null,connected:false,connecting:false,timeout:null,retryInterval:5000,playerId:null,associationId:null,data:{association:{}},playernames:{},playerList:null,isLoadingPlayerList:false,playerListSelector:new Array(),/**
     * Initialize connection to the socket
     */initConnection:function(){var $this=ogame.chat;// if its connected or on connecting do nothing
if($this.connecting||$this.connected||$this.isMobile){if(this.socket){$this.socket.disconnect();}}$this.connecting=true;// try to connect
try{$this.socket=io.connect("/chat",nodeParams);$this.socket.on('connect',function(){clearTimeout(this.timeout);// send session for authorize... on success set it to connected else disconnect socket
$this.socket.emit("authorize",session,function(success){$this.connecting=false;if(success){$this.connected=true;}else{$this.socket.disconnect();}});});$this.socket.on("chat",function(data){$this.messageReceived(data);});$this.socket.on('disconnect',function(){$this.connected=false;$this.connecting=false;//$this.retryConnection();
});}catch(e){// TODO: Ursache fuer doppelten Aufruf auf der Chat-Seite finden
$this.connecting=false;// wichtig, damit 2. Aufruf durch geht
}},/**
     * initialize connection and chatlog
     */initialize:function(){var $this=ogame.chat;loadScript(nodeUrl,$this.initConnection);$(".new_msg_count[data-playerid]").each(function(){$this.saveMessageCounter($(this).data('new-messages'),$(this).data('playerid'));});this.updateTotalNewChatCounter();// Aufrufe von Chats ueber die Spielerliste
$('.js_playerlist').on('click','.playerlist_item',function(){var nothing2load=$(this).hasClass('nothingThere');if(!nothing2load){var msgid=$(this).data('msgid');if(msgid){$this.loadChatLogWithPlayer(this,msgid);}else{$this.loadChatLogWithPlayer(this);}}});// Aufruf von Alli/Kolaitions-Chats ueber die Spielerliste
$('.js_playerlist').on('click','.openAssociationChat',function(){var msgid=$(this).data('msgid');if(msgid){$this.loadChatLogWithAssociation(this,msgid);}else{$this.loadChatLogWithAssociation(this);}});// Aufrufe von Chats ueber die Chatliste
$('#chatMsgList').on('click','.msg',function(){var msgPlayerId=$(this).data('playerid');var msgAssociationId=$(this).data('associationid');if(msgPlayerId!==undefined&&msgPlayerId>0){$this.saveMessageCounter(0,msgPlayerId);ogame.messagemarker.setPartnerId(msgPlayerId);ogame.messagemarker.updateNewMarker();ogame.chat.updateTotalNewChatCounter();var msgid=$('.playerlist .playerlist_item[data-playerId='+msgPlayerId+']').data('msgid');if(msgid){$this.loadChatLogWithPlayer(this,msgid);}else{$this.loadChatLogWithPlayer(this);}}else{var msgid=$('.playerlist .playerlist_item[data-associationId='+msgAssociationId+']').data('msgid');$this.saveMessageCounterAssociation(0,msgAssociationId);if(msgid){$this.loadChatLogWithAssociation(this,msgid);}else{$this.loadChatLogWithAssociation(this);}}});$('.chat').on('click','.sys_msg',function(event){var playerIdOfclickedChat=$(this).data('foreign-player-id');var associationIdOfclickedChat=$(this).data('foreign-association-id');var ajaxData={playerId:playerIdOfclickedChat,associationId:associationIdOfclickedChat,ajax:1};$.ajax({url:chatUrlLoadMoreMessages,type:'POST',dataType:'html',data:ajaxData,success:function(data){//Finding the right chat window
$('.chat').each(function(index,element){if(playerIdOfclickedChat!==undefined&&playerIdOfclickedChat==$(element).data('foreign-player-id')){$(element).html(data);//Replace the content of the chat-window with the new data from the backend.
}else if(associationIdOfclickedChat!==undefined&&associationIdOfclickedChat==$(element).data('foreign-association-id')){$(element).html(data);//Replace the content of the chat-window with the new data from the backend.
}});},error:function(jqXHR,textStatus,errorThrown){}});});$('body').on('click','.js_openChat',function(){$this.loadChatLogWithPlayer(this);});//maximize Chat set
if(typeof $.cookie('maximizeId')=="string"||typeof $.cookie('maximizeId')=="number"){$('#chatMsgList .msg[data-playerid="'+$.cookie('maximizeId')+'"]').trigger('click');$.cookie('maximizeId',null);}},/**
     * gets the total new chat counter.
     * 
     * @returns {Number}
     */getTotalNewChatCounter:function(){return ogame.messagecounter.sumNewChatMessages;},/**
     * calc total new chat counter and updates it.
     * 
     * @returns {Number} total new chat counter
     */updateTotalNewChatCounter:function(){var sumNewChatMessages=0;if($(".msg .new_msg_count").length>0){$(".msg .new_msg_count").each(function(){sumNewChatMessages+=Number($(this).data('new-messages'));});}else if($("#chatBarPlayerList .new_msg_count").length>0){$("#chatBarPlayerList .new_msg_count").each(function(){sumNewChatMessages+=Number($(this).data('new-messages'));});}ogame.messagecounter.initialize(ogame.messagecounter.type_chat,ogame.chat.playerId);if(ogame.messagecounter.sumNewChatMessages!==sumNewChatMessages){ogame.messagecounter.initChatCounter(sumNewChatMessages);ogame.messagecounter.sumNewChatMessages=sumNewChatMessages;ogame.messagecounter.update();}return sumNewChatMessages;},/**
     * retry to initialize Connection
     */retryConnection:function(){var $this=ogame.chat;setTimeout(function(){$this.initConnection();},5000);},/**
     * sending the message
     * 
     * @param {number} playerId >> id of the chat partner
     * @param {number} associationId >> id of the association (ally or coalition)
     * @param {string} messageText >> text to send
     * 
     */sendMessage:function(playerId,associationId,messageText,refData){var $this=ogame.chat;if($.trim(messageText).length==0){showError("TEXT_EMPTY");return;}var ajaxData;if(playerId>0){ajaxData={playerId:playerId,text:messageText,mode:1,ajax:1,token:window.ajaxChatToken};}else{ajaxData={associationId:associationId,text:messageText,mode:3,ajax:1,token:window.ajaxChatToken};}if(typeof refData!=="undefined"&&typeof refData.id!=="undefined"){ajaxData.msg2reply=refData.id;}function sendMessageViaAjax(){// send ajax Request
$.ajax({url:chatUrl,type:'POST',dataType:'json',data:ajaxData,success:function(data){addChatMessage(data);window.ajaxChatToken=data.newToken;},error:function(jqXHR,textStatus,errorThrown){}});}function messageSent(data){if(typeof data.refAuthor!=="undefined"&&typeof data.refContent!=="undefined"){$refData={'author':data.refAuthor,'text':data.refContent};}else{$refData=0;}if(data.targetId!==undefined){$this.addChatItem(data.targetId,0,data.text,data.id,false,$refData,data.date);}else{$this.addChatItem(playerId,data.targetAssociationId,data.text,data.id,false,$refData,data.date);}}function showError(errorText){if(chatLoca[errorText]!==undefined){errorBoxNotify(LocalizationStrings.error,chatLoca[errorText],LocalizationStrings.ok);}else{errorBoxNotify(LocalizationStrings.error,errorText,LocalizationStrings.ok);}}function addChatMessage(result){switch(result.status){case'NOT_AUTHORIZED':// do not show this error, try to send with ajax instead
sendMessageViaAjax();break;case'OK':messageSent(result);ogame.chat.cleanupUrl();break;default:showError(result.status);}}sendMessageViaAjax();},/**
     * get new message in chat
     * 
     * @param {object} data >> message data
     * 
     */messageReceived:function(data){var $this=ogame.chat;if(typeof data.refAuthor!=="undefined"&&typeof data.refText!=="undefined"){$refData={'author':data.refAuhtor,'text':data.refText};}else{$refData=0;}// for the association chats we need to get the player names from the backend. 
if(data.senderName!==undefined&&data.senderId!==undefined){//Save names, you get from the backend for later use in addChatItem
$this.playernames[data.senderId]=data.senderName;}if($(".chat_bar_list").length){//only if chat bar is active
if(data.associationId!==undefined&&data.associationId>0){if($this.data.association[data.associationId]===undefined){$this.loadChatLogWithAssociation(data.associationId,null,function(){$this.addChatItem(data.senderId,data.associationId,data.text,data.id,true,$refData,data.date);},false);}else{$this.addChatItem(data.senderId,data.associationId,data.text,data.id,true,$refData,data.date);}}else{if($this.data[data.senderId]===undefined){$this.loadChatLogWithPlayer(data.senderId,null,function(){$this.addChatItem(data.senderId,0,data.text,data.id,true,$refData,data.date);},false);}else{$this.addChatItem(data.senderId,0,data.text,data.id,true,$refData,data.date);}}}if(data.associationId!==undefined&&data.associationId>0){// count new mesages only if chat closed
if($('.chat_bar_list_item.open[data-associationid="'+data.associationId+'"]').length<=0){var newCount=$('.new_msg_count[data-associationid="'+data.associationId+'"]').data('new-messages');if(isNaN(newCount)){newCount=0;}newCount++;$this.saveMessageCounterAssociation(newCount,data.associationId);$this.updateTotalNewChatCounter();}else{// Set received message as read
var ajaxData={associationId:data.associationId,mode:4,ajax:1,updateUnread:1};$.ajax({url:chatUrl,type:'POST',data:ajaxData,success:function(data){},error:function(jqXHR,textStatus,errorThrown){}});}}else if(data.senderId!==undefined&&data.senderId>0){ogame.messagemarker.setPartnerId(data.senderId);if(!$this.isOpen(data.senderId)){ogame.messagecounter.initialize(ogame.messagecounter.type_chat,data.senderId);var newCount=parseInt(ogame.messagecounter.newChats[data.senderId]);if(isNaN(newCount)){newCount=0;}newCount++;$this.saveMessageCounter(newCount,data.senderId);ogame.messagemarker.updateNewMarker();}else{$this.saveMessageCounter(0,$(this).data('playerid'));ogame.messagemarker.updateNewMarker();}}},cleanupUrl:function(){// @todo what is the purpose?
// since twig components always contain a & in their path I need to comment it out
/*
    	var currentUrl = window.location.href;
    	var indexOfMsgid = currentUrl.indexOf('&');
    	
    	if(indexOfMsgid > 0) {
    		var paramIndex = currentUrl.indexOf('?');
    		var firstPartOfUrl = currentUrl.substring(0, paramIndex);
    		var newUrl = firstPartOfUrl+'?page=chat';
        	
        	window.history.pushState({}, "", newUrl);
    	}
    	*/},saveMessageCounter:function(count,playerId){if(isNaN(playerId)||playerId===0){return false;}$('.new_msg_count[data-playerid="'+playerId+'"]').data('new-messages',count);ogame.messagecounter.newChats[playerId]=count;},saveMessageCounterAssociation:function(count,associationId){if(isNaN(associationId)||associationId===0){return false;}$('.new_msg_count[data-associationid="'+associationId+'"]').data('new-messages',count);$('.new_msg_count[data-associationid="'+associationId+'"]').text(count);ogame.messagemarker.updateNewMarker();},/**
     * proof if the chat of the player is open
     * @param {string} playerid
     * @returns {boolean}
     */isOpen:function(playerid){var isChatOpen=false;var chatPartnerId=$(".chatContent").data('chatplayerid');if(chatPartnerId!='undefined'&&chatPartnerId==playerid){isChatOpen=true;}else{$(".chat_box").each(function(){if($(this).attr('data-playerid')==playerid){if($(this).css("display")=="block"){isChatOpen=true;}}});}return isChatOpen;},/**
     * Load chatlog of player and playerinfo
     * 
     * @param {mixed} element >> playerid of the other player
     * @param function callback
     * 
     */loadChatLogWithPlayer:function(element,msg2reply,callback,updateUnread){var $this=ogame.chat;var foreignPlayerId;if(typeof updateUnread=='undefined'){updateUnread=true;}if(typeof element=='number'){foreignPlayerId=element;}else{foreignPlayerId=$(element).attr('data-playerId');}var ajaxData={playerId:foreignPlayerId,mode:2,ajax:1,updateUnread:updateUnread?1:0};if(typeof msg2reply=='number'){ajaxData.msg2reply=msg2reply;}$.ajax({url:chatUrl,type:'POST',data:ajaxData,success:function(data){data=JSON.parse(data);$this.data[data.playerId]={playerstatus:data.playerstatus,playerName:data.playerName,playerId:data.playerId,chatItems:data.chatItems,chatItemsByDateAsc:data.chatItemsByDateAsc};if(typeof callback=='function'){callback();}else if($(element).parents('#chatBarPlayerList').length||$('body')[0].id!='chat'){// use chat bar
$this.showChat(data);}else{$this.showChatHistory(data);}var currentChat=$(".chat_bar_list").find("[data-playerid='"+data.playerId+"']");$this.updateCustomScrollbar(currentChat.find('.chat_box_ctn'));},error:function(jqXHR,textStatus,errorThrown){}});},/**
     * Load chatlog of association chat
     *
     * @param {mixed} element >> associationid of the other player
     * @param function callback
     *
     */loadChatLogWithAssociation:function(element,msg2reply,callback,updateUnread){var $this=ogame.chat;var associationId;if(typeof updateUnread=='undefined'){updateUnread=true;}if(typeof element=='number'){associationId=element;}else{associationId=$(element).attr('data-associationid');}var ajaxData={associationId:associationId,mode:4,ajax:1,updateUnread:updateUnread?1:0};if(typeof msg2reply=='number'){ajaxData.msg2reply=msg2reply;}$.ajax({url:chatUrl,type:'POST',data:ajaxData,success:function(data){data=JSON.parse(data);$this.data.association[data.associationId]={playerstatus:data.playerstatus,associationName:data.associationName,associationId:data.associationId,chatItems:data.chatItems,chatItemsByDateAsc:data.chatItemsByDateAsc};if(typeof callback=='function'){callback();}else if($(element).parents('#chatBarPlayerList').length||$('body')[0].id!='chat'){// use chat bar
$this.showChat(data);}else{$this.showChatHistory(data);}var currentChat=$(".chat_bar_list").find("[data-associationid='"+data.associationId+"']");$this.updateCustomScrollbar(currentChat.find('.chat_box_ctn'));},error:function(jqXHR,textStatus,errorThrown){}});},/**
     * This initializes the node.js chat
     * @returns {undefined}
     */initChat:function(playerId,isMobile){ogame.chat.playerId=playerId;ogame.chat.isMobile=isMobile;ogame.chat.initPlayerlist();ogame.chat.initialize();ogame.chat.toggleVisibility();ogame.chat.setVisibilityState();ogame.chat.initMaximize();ogame.chat.getInMaxChat();},/**
     * get data of a specific message in dom
     * 
     * @return {object} itemData
     */getLastChatItemData:function(){var $this=ogame.chat;var newestChatMessage=null;$(".chat_box_ctn .mCustomScrollBox .mCSB_container").each(function(){var lastMessage=$(this).children('ul.chat').children('li:last');if(newestChatMessage===null||lastMessage.attr('data-chat-id')>newestChatMessage.attr('data-chat-id')){newestChatMessage=lastMessage;}});// Ugly hack to enable chatting when chatbar is disabled
if(newestChatMessage===null){$("ul.largeChat").each(function(){var lastMessage=$(this).children('li:last');if(newestChatMessage===null||lastMessage.attr('data-chat-id')>newestChatMessage.attr('data-chat-id')){newestChatMessage=lastMessage;}});}if(newestChatMessage===null)return null;var msgDate=newestChatMessage.children('.msg_head').find('.msg_date').html();var msgText=newestChatMessage.find('.msg_content').html();var itemData={'date':msgDate,'text':msgText};return itemData;},/**
     * Adds a chat item to a chat in the chat bar and to the Detail Chat Page ( = chatHistory)
     * if we are on that page
     *
     * @param {String} foreignPlayerId
     * @param {String} associationId
     * @param {String} msg
     * @param {int} msgId
     * @param {bool} received
     * @param $refData
     * @param srvTime
     * @return {undefined}
     */addChatItem:function(foreignPlayerId,associationId,msg,msgId,received,$refData,srvTime){var $this=ogame.chat;var currentChat;if(associationId>0){currentChat=$(".chat_bar_list").find("[data-associationid='"+associationId+"']");}else{currentChat=$(".chat_bar_list").find("[data-playerid='"+foreignPlayerId+"']");}var chatItemData={};chatItemData.date=srvTime;//will be formated later in createchatitem
chatItemData.newClass='new';if(received){// the class odd should only be added in case a message was received
if($this.data[foreignPlayerId]!==undefined){chatItemData.playerName=$this.data[foreignPlayerId].playerName;}else{chatItemData.playerName=$this.playernames[foreignPlayerId];}chatItemData.altClass='';}else{chatItemData.playerName=playerName;/* global own playerName */chatItemData.altClass='odd';}chatItemData.chatID=msgId;// this is probably some unique number
chatItemData.chatContent=msg;if(typeof $refData=='object'){chatItemData.refData=$refData;}if(!currentChat.length){// someone new wants to talk to us || we want to talk to someone new \\
var chatBoxContainer=$this.createChatBarContainer(foreignPlayerId);$this.updateChatBar(chatBoxContainer);currentChat=$(".chat_bar_list").find("[data-playerid='"+foreignPlayerId+"']");}var chatItem=$this.createChatItem(chatItemData);var lastItem=$this.getLastChatItemData();// if message already exists
if(lastItem!==null&&(chatItemData.date!=lastItem.date||chatItemData.chatContent!=lastItem.text)){// chatbar
currentChat.find('.chat').append(chatItem);$this.updateCustomScrollbar(currentChat.find('.chat_box_ctn'));var chatHistory=$('.js_chatHistory');if(chatHistory.length&&(chatHistory.data('chatplayerid')==foreignPlayerId||chatHistory.data('associationid')==associationId)){//chat page
chatHistory.find('.chat.clearfix').append(chatItem.clone());$this.updateCustomScrollbar($(".largeChatContainer"));}}},/** 
     * Add items to moreBox
     *
     * @param {Object} chatbarListItems - Array of chatbar list items
     * @return {undefined}
     */addToMoreBox:function(chatbarListItems){var $this=ogame.chat;var listLength=chatbarListItems.length;if(listLength&&$('.more_chat_bar_items').length<1){$('.chat_bar_list').append($this.createMoreBox('more_chat_bar_items'));}var moreItemsList=$('.more_chat_bar_items .more_items');var moreItemsBox=$('.more_chat_bar_items .chat_box');for(var i=0;i<=listLength;i++){moreItemsList.append(chatbarListItems.pop());}$this.updateCustomScrollbar(moreItemsBox);},/**
     * Creates a new chatbar container element.
     *
     * A chatbar container consists of the chatbar list element for the player with the given playerid
     * and the corresponing chatbox (the chatbox is initially open)
     *
     * @param {String} playerid
     * @returns {DOM Object}
     */createChatBarContainer:function(playerid){var $this=ogame.chat;if(!playerid){return;}var chatBarData=$this.data[playerid];$this.data.playerId=playerid;var chatBarItem=$('<li class="chat_bar_list_item open" data-playerid="'+playerid+'"></li>');chatBarItem.append('<span class="playerstatus '+chatBarData.playerstatus+'"></span>');chatBarItem.append('<span class="cb_playername">'+chatBarData.playerName+'</span>');chatBarItem.append('<span class="icon icon_close fright"></span>');// adding the chat to the box
chatBarItem.prepend($this.createChatBox(playerid));return chatBarItem;},/**
     * Creates a new chatbar container element for group chats.
     *
     *
     * @param {String} associationId
     * @returns {DOM Object}
     */createChatBarContainerForAssociations:function(associationId){var $this=ogame.chat;if(!associationId){return;}var chatBarData=$this.data.association[associationId];$this.data.associationId=associationId;var chatBarItem=$('<li class="chat_bar_list_item open" data-associationId="'+associationId+'"></li>');chatBarItem.append('<span class="playerstatus '+chatBarData.playerstatus+'"></span>');chatBarItem.append('<span class="cb_playername">'+chatBarData.associationName+'</span>');chatBarItem.append('<span class="icon icon_close fright"></span>');// adding the chat to the box
chatBarItem.prepend($this.createChatBoxForAssociations(associationId));return chatBarItem;},/**
     * Make it Invisible in the Chatbar
     */closeChatBox:function(playerid,associationid){var chatbaritems=$(".chat_bar_list_item");$.each(chatbaritems,function(key,item){if(playerid!==undefined&&$(item).data('playerid')==playerid){$(item).addClass('outOfChatbar');$(item).removeClass('open');}else if(associationid!==undefined&&$(item).data('associationid')==associationid){$(item).addClass('outOfChatbar');$(item).removeClass('open');}});},/**
     * Get ONLY the chats that should be shown
     * 
     * @returns {Array} visibleChats
     */getVisibleChats:function(){if(typeof visibleChats=="undefined")visibleChats={"chatbar":false,"players":[],"associations":[]};return visibleChats;},/**
     * get playerids from visible chats
     * 
     * @returns {Array} playerIDs
     */getVisibleChatPlayerIds:function(){var $this=ogame.chat;var visibles=$this.getVisibleChats();var playerIDs={};var jsonIndex=0;for(var i=0;i<visibles.players.length;i++){if($.inArray(visibles.players[i]['partnerId'],playerIDs)==-1){playerIDs[jsonIndex]=visibles.players[i]['partnerId'];jsonIndex++;}}return playerIDs;},/**
     * get associationIds from visible chats
     *
     * @returns {Array} playerIDs
     */getVisibleChatAssociationIds:function(){var $this=ogame.chat;var visibles=$this.getVisibleChats();var associationIDs={};var jsonIndex=0;for(var i=0;i<visibles.associations.length;i++){if($.inArray(visibles.associations[i]['partnerId'],associationIDs)==-1){associationIDs[jsonIndex]=visibles.associations[i];jsonIndex++;}}return associationIDs;},/**
     * Set visibility state of chats
     */setVisibilityState:function(){var $this=ogame.chat;var visiblesPlayers=$this.getVisibleChatPlayerIds();var visiblesAssociations=$this.getVisibleChatAssociationIds();var listitems=$('#chatBar .chat_bar_list .chat_bar_list_item');for(var i=0;i<listitems.length;i++){var item=listitems.get(i);var playerid=$(item).data('playerid');var associationid=$(item).data('associationid');//if its not on the visiblelist - close it instant
if(playerid!==undefined&&!$this.isInJson(playerid,visiblesPlayers)){$this.closeChatBox(playerid,0);}else if(associationid!==undefined&&!$this.isInJson(associationid,visiblesAssociations)){$this.closeChatBox(0,associationid);}else{item.style.display='inline';if($(item).hasClass('open')){var box=$(item).find('div.chat_box')[0];box.style.display='inline';$this.updateCustomScrollbar($(item).find('.chat_box_ctn'),1);}}}},/**
     * Search 4 value in json-object
     */isInJson:function(value,json){var returningValue=null;if($.isEmptyObject(json)){returningValue=false;}if(returningValue!==false){$.each(json,function(key,jsonValue){if(jsonValue==value){returningValue=true;}});if(returningValue!==true){false;}}return returningValue;},toggleVisibility:function(){$(".chat_bar_list_item .icon_close").on("click",function(clickObject){var toPlayerId=$(this).parent().data("playerid");var closeThis=$(this).closest('.chat_box');if(!closeThis.length){closeThis=$(this).parent()[0];closeThis.style.display='none';}if(toPlayerId>0){$.ajax({type:"POST",url:"/game/index.php?page=ajaxChatToggleVisibility",data:{from:playerId,to:toPlayerId,showState:0},success:function(e){},error:function(jqXHR,textStatus,errorThrown){}});}});$(".cb_playerlist_box .playerlist_item").on("click",function(){var toPlayerId=$(this).data("playerid");if(toPlayerId){$.ajax({type:"POST",url:"/game/index.php?page=ajaxChatToggleVisibility",data:{from:playerId,to:toPlayerId,showState:1},success:function(e){},error:function(jqXHR,textStatus,errorThrown){}});}});},initMaximize:function(){$('.chat_bar_list').on('click.chatBar','.chat_box .chat_box_title .icon_maximize',function(){var chatTitle=$(this).parent();var playerid=$(chatTitle).parent().data('playerid');$.cookie('maximizeId',playerid);$('.chat_bar_list_item.open .chat_box_title .icon_close').trigger('click');window.location=bigChatLink+'&playerId='+playerid;});},getInMaxChat:function(){var currentLocation=location.href;if(typeof bigChatLink=="undefined")bigChatLink="";if(bigChatLink==currentLocation){if($.cookie('maximizeId')!==null){$('#chatMsgList .msg[data-playerId='+$.cookie('maximizeId')+']').trigger('click');}}$.cookie('maximizeId',null);},/**
     * Create a chatbox item to be shown in the chatbar.
     * A Chatbox contains chatitems
     *
     * @param {String} playerid
     * @returns {DOM Object} $chatBox
     */createChatBox:function(playerid){var $this=ogame.chat;if(!playerid){return;}var chatBarData=$this.data[playerid];var chatBoxHeader=$('<div class="chat_box_title"></div>');chatBoxHeader.append('<span class="icon icon_close fright"></span>');chatBoxHeader.append('<span class="icon icon_maximize fright"></span>');var chatBoxCtn=$('<div class="chat_box_ctn"><ul class="chat clearfix"></ul></div>');var chatItem={};for(var i=0;i<chatBarData.chatItemsByDateAsc.length;i++){chatItem=chatBarData.chatItems[chatBarData.chatItemsByDateAsc[i]];chatBoxCtn.find('.chat').append($this.createChatItem(chatItem));}var chatBox=$('<div class="chat_box" data-playerid="'+playerid+'"></div>');chatBox.append(chatBoxHeader);chatBox.append(chatBoxCtn);chatBox.append('<textarea name="text" class="chat_box_textarea"></textarea>');return chatBox;},/**
     * Create a chatbox item to be shown in the chatbar.
     * A Chatbox contains chatitems
     *
     * @param {String} playerid
     * @returns {DOM Object} $chatBox
     */createChatBoxForAssociations:function(associationId){var $this=ogame.chat;if(!associationId){return;}var chatBarData=$this.data.association[associationId];var chatBoxHeader=$('<div class="chat_box_title"></div>');chatBoxHeader.append('<span class="icon icon_close fright"></span>');chatBoxHeader.append('<span class="icon icon_maximize fright"></span>');var chatBoxCtn=$('<div class="chat_box_ctn"><ul class="chat clearfix"></ul></div>');var chatItem={};for(var i=0;i<chatBarData.chatItemsByDateAsc.length;i++){chatItem=chatBarData.chatItems[chatBarData.chatItemsByDateAsc[i]];chatBoxCtn.find('.chat').append($this.createChatItem(chatItem));}var chatBox=$('<div class="chat_box" data-associationId="'+associationId+'"></div>');chatBox.append(chatBoxHeader);chatBox.append(chatBoxCtn);chatBox.append('<textarea name="text" class="chat_box_textarea"></textarea>');return chatBox;},/**
     * Creates a chatitem
     *
     * A Chatitem can be added to a chatbox in the chatbar or to an existing chat in the chatcontent page.
     *
     * @param {Object} chatData - data needed for the chat item
     * @returns {DOM Object} $chatItem
     */createChatItem:function(chatData){if(!chatData){console.warn('no chatItem given');return;}var chatItemHeader=$('<div class="msg_head"></div>');chatItemHeader.append('<span class="msg_date fright">'+getFormatedDate(chatData.date,'[d].[m].[Y] <span>[H]:[i]:[s]</span>')+'</span>');chatItemHeader.append('<span class="msg_title blue_txt '+chatData.newClass+'">'+chatData.playerName+'</span>');var chatItem=$('<li class="chat_msg '+chatData.altClass+'" data-chat-id="'+chatData.chatID+'"></li>');chatItem.append(chatItemHeader);if(typeof chatData.refData!=="undefined"){var refMsgItem=$('<div class="referenceMsg"></div>');var refAuthorItem='<div class="refAuthor">'+chatData.refData.author+'</div>';var refTextItem='<div class="refText new">'+chatData.refData.text+'</div>';refMsgItem.append(refAuthorItem);refMsgItem.append(refTextItem);chatItem.append(refMsgItem);}chatItem.append('<span class="msg_content">'+chatData.chatContent+'</span>');chatItem.append('<div class="speechbubble_arrow"></div>');return chatItem;},/**
     * Create a a chatbar item of the type moreBox that will be a container for
     * all items that don't fit into the chatbar directly 
     * 
     * @param {String} itemClass
     * @returns {DOM Object} $moreBox
     */createMoreBox:function(itemClass){var moreBox=$('<li class="chat_bar_list_item '+itemClass+'">'+chatLoca['MORE_USERS']+'<span class="icon icon_close fright"></span></li>');moreBox.prepend($('<div class="chat_box"><ul class="more_items clearfix"></ul></div>'));return moreBox;},/**
     * Filters the playerlist after the criteria that are selected in the
     * filter form
     *
     * @returns {undefined}
     */filterPlayerlist:function(){var filters=[];var isChecked;var filterCheckboxes=$('#playerlistFilters').find('input[type="checkbox"]');// get filters to check
filterCheckboxes.each(function(){filters.push($(this).attr('id'));});$('.playerlist_item').show();// we don't need to filter anything if no filter is active
isChecked=false;filterCheckboxes.each(function(){if($(this).prop('checked'))isChecked=true;});if(!isChecked){return;}var doFilter;var listElement;$('.playerlist_item').filter(function(){doFilter=false;listElement=$(this);// for every filter
$.each(filters,function(i,filter){// check if the element matches filter criteria 
// and should be filtered by that criteria
if(listElement.data(filter)==='off'&&$('#'+filter).prop('checked')){doFilter=true;}});// hide the element if it should be filtered out
doFilter===true?listElement.hide():listElement.show();});},/**
     * initializes the functions needed for the display of the chatbar
     *
     * @returns {undefined}
     */initChatBar:function(playerId){var $this=ogame.chat;ogame.chat.playerId=playerId;$('html').off('.chatBar');$(window).resize(function(){$this.updateChatBar();});// var playeridsInList = [];
//
// $('#chatBarPlayerList li.playerlist_item').each(function(index) {
// 	if(!$(this).hasClass('nothingThere')) {
// 		playeridsInList[index] = $(this).data('playerid');
// 	}
// });
//
// if(playeridsInList.length > 0) {
// 	ogame.messagemarker.initMarker(playeridsInList);
// }
//        var chatsum = 0;
//        
//        $('#chatBarPlayerList li.playerlist_item .newMsgMarker').each(function() {
//        	chatsum = chatsum + 1;
//        });
//        
//        ogame.messagecounter.initChatCounter(chatsum);
// $(".new_msg_count").each(function() {
//     $this.saveMessageCounter($(this).data('new-messages'), $(this).data('playerid'));
// });
//
// this.updateTotalNewChatCounter();
$('.chat_bar_list').on('click.chatBar','#chatBarPlayerList',function(e){if($(e.target).attr('id')!=='chatBarPlayerList'&&!$(e.target).hasClass('onlineCount')){return;}$('.cb_playerlist_box').toggle();$this.updateCustomScrollbar($(".scrollContainer"),true);$.ajax({url:chatUrl,type:'POST',dataType:'json',data:{action:'toggleChatBar'},success:function(data){},error:function(jqXHR,textStatus,errorThrown){}});}).on('click.chatBar','.chat_bar_list_item',function(e){e.stopPropagation();if(!isNaN($(this).data('playerid'))){ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chattab,$(this).data('playerid'));ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chatbar,$(this).data('playerid'));$this.saveMessageCounter(0,$(this).data('playerid'));ogame.messagemarker.setPartnerId($(this).data('playerid'));ogame.messagemarker.updateNewMarker();ogame.chat.updateTotalNewChatCounter();}else if(!isNaN($(this).data('associationid')>0)){$this.saveMessageCounterAssociation(0,$(this).data('associationid'));}$.ajax({url:chatUrl,type:'POST',dataType:'json',data:{playerId:$(this).data('playerid'),action:'chatBarListRead'},success:function(data){},error:function(jqXHR,textStatus,errorThrown){}});if($(this).closest('.more_items').length){$this.swapChatBarItem($(this));}else{$this.toggleChatBox($(e.target),$(this));}$this.updateVisibleState();}).on('click.chatBar','.chat_bar_list_item > .icon_close',function(e){e.stopPropagation();var chatbarItem=$(this).closest('.chat_bar_list_item');ogame.chat.closeChatBox(chatbarItem.attr('data-playerid'),chatbarItem.attr('data-associationid'));chatbarItem.remove('open');$this.updateChatBar();}).on('keyup.chatBar','.chat_box_textarea',function(e){if((e.ctrlKey||e.keyCode==10)&&e.keyCode==13){e.preventDefault();var s=$(this).val();$(this).val(s+"\n");}else{if($.trim($(this).val().length>0)){e.preventDefault();$this.submitChatBarMsg($(e.currentTarget),e.which,e.shiftKey,e.delegateTarget.scrollHeight);}}}).on('click.chatBar','.chat_box_textarea',function(e){ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chattab,$(this).parent().parent().parent().data('playerid'));ogame.messagemarker.toggle(ogame.messagemarker.action_remove,ogame.messagemarker.type_chatbar,$(this).parent().parent().parent().data('playerid'));if($(this).data('playerid')>0){$this.saveMessageCounter(0,$(this).data('playerid'));}else if($(this).data('associationid')>0){$this.saveMessageCounterAssociation(0,$(this).data('associationid'));}});//        $this.updateCustomScrollbar($('.chat_box_ctn'));
//        $this.updateCustomScrollbar($(".scrollContainer"), true);
},/**
     * initializes the functions needed for the display of the playerlist
     *
     * @returns {undefined}
     */initPlayerlist:function(){var $this=ogame.chat;var $tools=ogame.tools;// for playerlist toggle
$('.js_accordion').accordion({collapsible:true,heightStyle:'content'});// adding "zebra" to list items
$(".playerlist_item:odd").addClass("odd");$tools.addHover('.playerlist_item, .msg, .playerlist_top_box .playerlist');// playerlist events
$('.js_playerlist').on('click.playerList','.pl_filter_set',function(){$this.filterPlayerlist();});$this.filterPlayerlist();// Do this once, to restore filter settings.
},/**
     * Shows a chat in the chatbar
     *
     * @param data {Object} - the chat data to show
     * @returns {undefined}
     */showChat:function(data){var found=false;var $this=ogame.chat;$('.chat_bar_list_item').each(function(){var $item=$(this);// trigger opening if we found the desired chat
if(data['playerId']!==undefined&&$item.data('playerid')===data['playerId']||data['associationId']!==undefined&&$item.data('associationid')===data['associationId']){found=true;if($item.hasClass('outOfChatbar')){$item.removeClass('outOfChatbar');}if(!$item.hasClass('open')){$item.click();// trigger opening
$item[0].style.display='inline';}else{$item.fadeTo('400',0.3).fadeTo('400',1.0);}$item.find('textarea').focus();}});// add the chat if is not yet in chatbar or more list
if(!found){var chatBarContainer;if(data['playerId']!==undefined){chatBarContainer=$this.createChatBarContainer(data['playerId']);}else{chatBarContainer=$this.createChatBarContainerForAssociations(data['associationId']);}$this.updateChatBar(chatBarContainer);}},/**
     * Shows the (complete) chat history in the detail chat page 
     *
     * @param data {Object} - the chat data to show
     * @returns {undefined}
     */showChatHistory:function(data){var history=$('.js_chatHistory');var documentContent=data['data'];if(history.length){history.remove();}$('#chatList').remove();$(documentContent).insertAfter('#planet');$("li.playerlist_item").removeClass('active');$("li.playerlist_item[data-playerid='"+data.playerId+"']").addClass('active');initBBCodeEditor(locaKeys,itemNames,false,'.new_msg_textarea',2000,true);},/**
     * Handles the display of a sent message in a chat on the chat bar
     * @TODO: Actually send the message as well.
     * @param clickedElement {Object} - 
     * @param pressedKey {Object} - 
     * @param shiftKey {Object} - if shiftkey was pressed simultaneously
     * @param msgScrollHeight {Object} - 
     * @returns {undefined}
     */submitChatBarMsg:function(clickedElement,pressedKey,shiftKey,msgScrollHeight){var $this=ogame.chat;var msgMaxHeight=parseInt($('.chat_box_textarea').css('max-height'));var msgPadding=parseInt($('.chat_box_textarea').css('padding-top'))+parseInt($('.chat_box_textarea').css('padding-bottom'));// enter pressed while shift already was pressed
// == new line without sending the message
if(pressedKey===13&&shiftKey){if(msgScrollHeight<=msgMaxHeight+msgPadding){clickedElement.css('height',msgScrollHeight-msgPadding);}return;}if(pressedKey===13){if(clickedElement.parent('.chat_box').data('playerid')!==undefined){$this.sendMessage(clickedElement.parent('.chat_box').data('playerid'),0,clickedElement.val());}else if(clickedElement.parent('.chat_box').data('associationid')!==undefined){$this.sendMessage(0,clickedElement.parent('.chat_box').data('associationid'),clickedElement.val());}// @TODO: adding the element can only actually happen when the message was sent successfully!
clickedElement.val('');}},/**
     * Removes an item from the list of more items and inserts it as the last item in the chat bar list
     *
     * @param $itemToSwap {DOM Object} - the item that will be swapped
     * @returns {undefined}
     */swapChatBarItem:function(itemToSwapIn){var $this=ogame.chat;// remove item to swap out from the chatbar
var itemToSwapOut=$('.more_chat_bar_items').prev();itemToSwapOut.removeClass('open').find('.icon_close').hide().end().find('.chat_box').hide();itemToSwapOut.remove();// swap item back to chatbar
itemToSwapIn.addClass('open').find('.icon_close').show().end().find('.chat_box').show().end().insertBefore('.more_chat_bar_items');$this.addToMoreBox([itemToSwapOut]);// if after the insertion we would not have enough space we need to correct that
$this.updateChatBar();$this.updateCustomScrollbar(itemToSwapIn.find('.chat_box_ctn'));},/**
     * show the minimal chat for the clicked player on correct position
     * expand/shrink width accordingly
     *
     * @param clickedTarget {DOM Object} - clicked element
     * @param originalTarget {DOM Object} - element that was originally targeted
     * @returns {undefined}
     */toggleChatBox:function(clickedTarget,originalTarget){var $this=ogame.chat;// some elements should not trigger toggle:
if(clickedTarget.parents('.chat_box').length&&!clickedTarget.hasClass('icon_close')){return;}var chatBox=originalTarget.children('.chat_box');// toggling the display of chat contents
if(chatBox.is(':visible')){chatBox.hide();originalTarget.removeClass('open');}else{if(!originalTarget.hasClass('more_chat_bar_items')){originalTarget.addClass('open');$this.updateChatBar();}chatBox.show();var chatboxClass=chatBox.find('.chat_box_ctn');if(originalTarget.hasClass('more_chat_bar_items')){chatboxClass=chatBox;}$this.updateCustomScrollbar(chatboxClass);chatBox.find('textarea').focus();}ogame.messagecounter.resetCounterByType(ogame.messagecounter.type_chat);},/**
     * move item to the morelist
     * 
     * @see important for ogame.chat.updateChatBar
     * @param chatOpenLength, chatClosedLength, widthOpen, widthClosed, widthMoreItems, widthWindow @see ogame.chat.updateChatBar
     */handleTooMuchWindows:function(chatOpenLength,chatClosedLength,widthOpen,widthClosed,widthMoreItems,widthWindow){var $this=ogame.chat;var isTooWide=true;var chatbarListItems=[];$($('.chat_bar_list > .chat_bar_list_item').get().reverse()).each(function(){var listItem=$(this);if(isTooWide){// these element should never be removed:
if(listItem.hasClass('more_chat_bar_items')||listItem.attr('id')==='chatBarPlayerList'){return;}// decide what kind of element shall be removed (swapped out)
if(listItem.hasClass('open')){chatOpenLength--;}else{chatClosedLength--;}// prepare the item and add it to the more list
listItem.removeClass('open').find('.icon_close').hide().end().find('.chat_box').hide();chatbarListItems.push(listItem);listItem.remove();// check if more elements need to be removed
widthTotal=widthClosed*chatClosedLength+widthOpen*chatOpenLength+widthMoreItems;isTooWide=widthTotal>=widthWindow?true:false;}});// update morebox with contents of chatbarListItems
$this.addToMoreBox(chatbarListItems);},/**
     * move item back to the chatbar
     * 
     * @see important for ogame.chat.updateChatBar
     */getItemFromMorelist2Chatbar:function(){// get item from more list then remove it from more list.
var swappedChatBarItem=$('.more_items .chat_bar_list_item').first().remove();var $this=ogame.chat;// add swapped item back to chat bar
swappedChatBarItem.addClass('open').find('.icon_close').show().end().find('.chat_box').show().end().insertBefore('.more_chat_bar_items');// if more list is now empty remove it as well
if($('.more_items .chat_bar_list_item').length<=0){$('.more_chat_bar_items').remove();}$this.updateCustomScrollbar($('.more_chat_bar_items>.chat_box'));$this.updateCustomScrollbar(swappedChatBarItem.find('.chat_box_ctn'));},/**
     * Calculates available horizontal space and updates how many items are shown in the chatbar
     * and moves items to/from more list accordingly
     *
     * @param {DOM Object} chatBarItem - new item to add to chatbar
     */updateChatBar:function(chatBarItem){var $this=ogame.chat;var chatOpenLength=$('.chat_bar_list > .chat_bar_list_item.open').length;var moreItemsLength=$('.more_chat_bar_items').length;var chatClosedLength=$('.chat_bar_list').children().length-chatOpenLength-moreItemsLength;var widthClosed=190;var widthOpen=270;var widthMoreItems=190;// 180 + 10 px space
var widthWindow=$('body').innerWidth();// new items will be directly open
if(chatBarItem){chatOpenLength++;}var widthTotal=widthClosed*chatClosedLength+widthOpen*chatOpenLength+widthMoreItems*moreItemsLength;// if there are more elements than fit in the window
if(widthTotal>=widthWindow){$this.handleTooMuchWindows(chatOpenLength,chatClosedLength,widthOpen,widthClosed,widthMoreItems,widthWindow);}else if(widthTotal+widthOpen<=widthWindow&&$('.more_chat_bar_items').length>0){// if widthTotal is small enough that another open element will fit an we have one in the more list
$this.getItemFromMorelist2Chatbar();}if(chatBarItem){chatBarItem.insertAfter('#chatBarPlayerList');$this.updateCustomScrollbar(chatBarItem.find('.chat_box_ctn'));}},/**
     * update the custom scrollbar or add it if the element has none
     * 
     * @param element {DOM Object} - the element that gets the scrollbar
     * @param skipScrolling bool Skip scrolling to the bottom
     */updateCustomScrollbar:function(element,skipScrolling){if(!element||element.length==0){return;}if(element.hasClass('mCustomScrollbar')){element.mCustomScrollbar('update');}else{element.mCustomScrollbar({theme:"ogame"});}if(skipScrolling!==true){element.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0});}element.each(function(){if($(this).height()+"px"==$(this).css("max-height")){$(this).addClass("scrollbarPresent");}});},updateVisibleState:function(){var visibleChats={"chatbar":false,"players":[],"associations":[]};$('.chat_bar_list>.chat_bar_list_item').each(function(){var $item=$(this);if($item.attr('id')==='chatBarPlayerList'&&$item.children('.cb_playerlist_box').is(':visible')){visibleChats.chatbar=true;}else if($item.data('playerid')&&$item.children('.chat_box').is(':visible')){visibleChats.players.push($item.data('playerid'));}else if($item.data('associationid')&&$item.children('.chat_box').is(':visible')){visibleChats.associations.push($item.data('associationid'));}});$.cookie('visibleChats',JSON.stringify(visibleChats),{expires:7});},showPlayerList:function(selector){var $this=ogame.chat;if(window.deactivateChatBecauseOfLogout){return;}if($.inArray(selector,$this.playerListSelector)===-1){$this.playerListSelector.push(selector);}if($this.isLoadingPlayerList===false&&$this.playerList===null){$this.isLoadingPlayerList=true;$.ajax({url:chatUrl,type:'POST',dataType:'json',data:{action:'showPlayerList'},success:function(data){$this.playerList=data.content;$this.isLoadingPlayerList=false;$this._showPlayerList();},error:function(jqXHR,textStatus,errorThrown){$this.isLoadingPlayerList=false;}});}else{$this._showPlayerList();}},_showPlayerList:function(){var $this=ogame.chat;$.each($this.playerListSelector,function(index,value){$(value).html($this.playerList);});}};/*
 *	allgemeiner Countdown
 */function oldcountdown(leftoverTime,maxDigits,countValue){if(maxDigits==null||maxDigits==""){maxDigits=2;}var thisObj=this;thisObj.countValue=parseInt(countValue)||-1;// config
thisObj.timestamp=0;thisObj.maxDigits=parseInt(maxDigits);// bei 2 werden keine Sekunden gezeigt, wenn der Zeitraum > 1 h ist
thisObj.delimiter=" ";// Trennzeichen
thisObj.approx="";// wird vor Zeitstring angefuegt
thisObj.showunits=true;// Einheiten zeigen
thisObj.zerofill=false;// nullen auffuellen
var localTime=new Date();thisObj.startTime=localTime.getTime();// Script-Startzeit
thisObj.startLeftoverTime=parseInt(leftoverTime);// Sekunden Restzeit
this.getCurrentTimestring=function(){return thisObj.formatTime(thisObj.getLeftoverTime());};this.getLeftoverTime=function(){var currTime=new Date();return Math.round(thisObj.startLeftoverTime+(currTime.getTime()-thisObj.startTime)*thisObj.countValue/1000);};this.formatTime=function(timestamp){return formatTimeWrapper(timestamp,thisObj.maxDigits,thisObj.showunits,thisObj.delimiter,thisObj.zerofill,thisObj.approx);};}/*
 * Sekunden in Zeitintervall fuer die Anzeige umrechnen, zur Benutzung in formatTime
 *
 * @param timestamp int Zeitintervall in Sekunden
 * @param maxDigits int Anzahl der angezeigten Elemente
 * @param showunits bool ob die Einheiten (lokalisiert) angezeigt werden sollen
 * @param delimiter string Trennzeichen zwischen den Elementen
 * @param zerofill bool ob mit Nullen aufgefuellt werden soll, so dass jedes Element 2-stellig ist
 * @param approx Praefix fuer Zeitstring
 * @return formatted time string
 */function formatTimeWrapper(timestamp,maxDigits,showunits,delimiter,zerofill,approx){var timeUnits=[];timeUnits.week=604800;timeUnits.day=86400;timeUnits.hour=3600;timeUnits.minute=60;timeUnits.second=1;var timeString="";for(var k in timeUnits){var nv=Math.floor(timestamp/timeUnits[k]);if(maxDigits>0&&(nv>0||zerofill&&timeString!="")){timestamp=timestamp-nv*timeUnits[k];if(timeString!=""){timeString+=delimiter;if(nv<10&&nv>0&&zerofill){nv="0"+nv;}if(nv==0){nv="00";}}timeString+=nv+(showunits?LocalizationStrings.timeunits['short'][k]:'');maxDigits--;}}if(timestamp>0){timeString=approx+timeString;}return timeString;}/*
* Bau Countdown fuer Buttons (zaehlt einmal auf 0)
*/function bauCountdown(elemId,leftoverTime,totalTime,reloadPage){var htmlObj=$(elemId);if(typeof htmlObj!=='object'){return;}var thisObj=this;thisObj.totalTime=totalTime;// diese elemente werden veraendert
thisObj.startHeight=htmlObj.offsetHeight;thisObj.htmlObj=$(htmlObj);thisObj.timeHtmlObj=thisObj.htmlObj.find('.time');thisObj.imgHtmlObj=thisObj.htmlObj.find('.buildingimg');var backgroundImage=thisObj.imgHtmlObj.css('background-image');var backgroundPosition=thisObj.imgHtmlObj.css('background-position');this.updateCountdown=function(){thisObj.countdown.getCurrentTimestring();timestamp=thisObj.countdown.getLeftoverTime();timestring=thisObj.countdown.getCurrentTimestring();thisObj.timeHtmlObj.text(timestring);var faktor=Math.max(0,timestamp)/thisObj.totalTime;if(faktor>0){var value=100-Math.floor(faktor*100);var colored='rgba(0, 0, 0, 0) '+(value-2)+'%';var grayed='rgba(0, 0, 0, 0.85) '+(value+2)+'%';thisObj.imgHtmlObj.css({background:'linear-gradient('+colored+', '+grayed+'), '+backgroundImage+' '+backgroundPosition});}else{var notify=new ogame.Notify(LocalizationStrings.status.ready);notify.setImage($('.planetPic').attr('src'));notify.show();thisObj.timeHtmlObj.text(LocalizationStrings.status.ready);thisObj.htmlObj.css({'height':thisObj.startHeight+"px",'marginTop':0});if(timestamp<=-1&&timestamp>-6&&!isOverlayOpen()){if(reloadPage!==undefined){reload_page(reloadPage);}else{reload_page(window.location.href);}}}};if(thisObj.timeHtmlObj.length){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime);timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}else{window.status='kein timeHtmlObj';}}/*
* Schiffbau Countdown fuer Buttons (zaehlt mehrmals auf 0)
*/function schiffbauCountdown(htmlObj,shipCount,currentShips,leftoverTime,oneShipTime,reloadPage){if(typeof htmlObj!=='object'){return;}var thisObj=this;thisObj.totalTime=oneShipTime;thisObj.oneShipTime=oneShipTime;thisObj.shipCount=shipCount;thisObj.currentShips=currentShips;// diese elemente werden veraendert
thisObj.startHeight=htmlObj.offsetHeight;thisObj.htmlObj=$(htmlObj);thisObj.timeHtmlObj=document.getElementById('shipyardCountdown');thisObj.countHtmlObj=$(".shipSumCount");thisObj.shipsHtmlObj=$("#shipyardcomponent .stockAmount");this.updateCountdown=function(){thisObj.countdown.getCurrentTimestring();timestamp=thisObj.countdown.getLeftoverTime();timestring=thisObj.countdown.getCurrentTimestring();$("#shipyardCountdown").text(timestring);var faktor=Math.max(0,timestamp)/thisObj.totalTime;if(faktor>0){var height=Math.round(thisObj.startHeight*faktor);thisObj.htmlObj.css({'height':height+"px",'marginTop':thisObj.startHeight-height+"px"});}else{if(thisObj.shipCount>0){thisObj.shipCount--;thisObj.currentShips++;}if(thisObj.shipCount>=0){thisObj.countHtmlObj.text(thisObj.shipCount);$(".shipSumCount").text(thisObj.shipCount);}thisObj.shipsHtmlObj.text(gfNumberGetHumanReadable(thisObj.currentShips));if(thisObj.shipCount>0){thisObj.countdown=new oldcountdown(oneShipTime);$("#shipyardCountdown").text('-');}else{if(timestamp<=-1&&timestamp>-6){if(reloadPage!=null&&!isOverlayOpen()){reload_page(reloadPage);}timerHandler.removeCallback(thisObj.timer);}$("#shipyardCountdown").text(LocalizationStrings.status.ready);}}};if(thisObj.timeHtmlObj&&thisObj.countHtmlObj&&thisObj.shipsHtmlObj){// oldcountdown objekt
totalTime=Math.floor(shipCount*oneShipTime);thisObj.countdown=new oldcountdown(leftoverTime);thisObj.timer=timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}else{window.status='kein: timeHtmlObj oder countHtmlObj oder shipsHtmlObj';}}/*
* Countdown fuer alle 3 Baulisten (zaehlt einmal auf 0)
*/function baulisteCountdown(elemId,leftoverTime,reloadPage,countdownDoneFunction,techDetailsCountdown){var htmlObj=$(elemId);if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=htmlObj;thisObj.updateCountdown=function(techDetailsCountdown){var timeLeftInSeconds=thisObj.countdown.getLeftoverTime();if(timeLeftInSeconds>0){thisObj.timeHtmlObj.html(thisObj.countdown.getCurrentTimestring());$(techDetailsCountdown).html(thisObj.countdown.getCurrentTimestring());}else{thisObj.timeHtmlObj.html(LocalizationStrings.status.ready);$(techDetailsCountdown).html(LocalizationStrings.status.ready);if(typeof countdownDoneFunction=='function'){countdownDoneFunction();}if(timeLeftInSeconds<=-1&&timeLeftInSeconds>-6){if(reloadPage!=null&&!isOverlayOpen()){reload_page(reloadPage);}timerHandler.removeCallback(thisObj.timer);}}};if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime,3);thisObj.timer=timerHandler.appendCallback(function(){thisObj.updateCountdown(techDetailsCountdown);});thisObj.updateCountdown(techDetailsCountdown);}}/*
* Countdown fuer die Eventliste
*/function eventboxCountdown(htmlObj,leftoverTime,parentElement,checkEventsUrl,checkEventIds){if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=htmlObj;this.updateCountdown=function(){thisObj.countdown.getCurrentTimestring();var timestamp=thisObj.countdown.getLeftoverTime();var timestring=thisObj.countdown.getCurrentTimestring();if(timestamp>0){$(thisObj.timeHtmlObj).html(timestring);}else{timerHandler.removeCallback(thisObj.timer);$(thisObj.timeHtmlObj).html(LocalizationStrings.status.ready);// checkEvents NICHT spammen:
if(!timerHandler.checkEventsAlreadyQueued){timerHandler.checkEventsAlreadyQueued=true;setTimeout(function(){$.post(checkEventsUrl,{ids:checkEventIds},function(data){var rowIDs=$.parseJSON(data);for(var index in rowIDs["rows"]){$(parentElement).find("#eventRow-"+rowIDs["rows"][index]).remove();$(".union"+rowIDs["rows"][index]).remove();}$('.eventFleet').removeClass('odd');$('.partnerInfo').removeClass('part-even');$('.eventFleet:odd').addClass('odd');$('.partnerInfo:even').addClass('part-even');timerHandler.checkEventsAlreadyQueued=false;});},2500);}// else: wir sind noch innerhalb der 2,5 Sekunden vom letzten Aufruf (durch anderes Event)
}};if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime,3);thisObj.timer=timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}/*
* Einfacher Countdown mit Funktionsaufruf nach Ende des Countdowns
*/function simpleCountdown(htmlObj,leftoverTime,countdownDoneFunction,countdownTickFunction){if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=$(htmlObj)[0];this.updateCountdown=function(){var timestamp=thisObj.countdownObject.getLeftoverTime();var timestring=thisObj.countdownObject.getCurrentTimestring();if(timestamp>0){$('#'+thisObj.timeHtmlObj.id).text(timestring);if(typeof countdownTickFunction=="string"&&$.isFunction(window[countdownTickFunction])){window[countdownTickFunction]();}else if($.isFunction(countdownTickFunction)){countdownTickFunction();}}else{timerHandler.removeCallback(thisObj.timer);$('#'+thisObj.timeHtmlObj.id).text(LocalizationStrings.status.ready);if(typeof countdownDoneFunction=="string"&&$.isFunction(window[countdownDoneFunction])){window[countdownDoneFunction]();}else if($.isFunction(countdownDoneFunction)){countdownDoneFunction();}}};if(typeof thisObj.timer!='undefined'){timerHandler.removeCallback(thisObj.timer);}if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdownObject=new oldcountdown(leftoverTime,3);thisObj.timer=timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}function countdownWithTickFunction(htmlObj,leftoverTime,totalTime,countdownDoneFunction,countdownTickFunction,maxDigits){if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=htmlObj;if(typeof $(htmlObj).attr("data-oldcountdown")!='undefined'){timerHandler.removeCallback($(htmlObj).attr("data-oldcountdown"));}this.updateCountdown=function(){timestamp=thisObj.countdown.getLeftoverTime();timestring=thisObj.countdown.getCurrentTimestring();if(timestamp>0){thisObj.timeHtmlObj.innerHTML=timestring;if(typeof countdownTickFunction=="string"&&$.isFunction(window[countdownTickFunction])){window[countdownTickFunction](timestamp,totalTime);}else if($.isFunction(countdownTickFunction)){countdownTickFunction(timestamp,totalTime);}}else{timerHandler.removeCallback(thisObj.timer);thisObj.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(typeof countdownDoneFunction=="string"&&$.isFunction(window[countdownDoneFunction])){window[countdownDoneFunction]();}else if($.isFunction(countdownDoneFunction)){countdownDoneFunction();}}};if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime,maxDigits);thisObj.timer=timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();$(htmlObj).attr("data-oldcountdown",thisObj.timer);}return thisObj;}/*
* Countdown mit Reload am Ende
*/function reloadCountdown(htmlObj,leftoverTime,reloadPage){if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=htmlObj;this.updateCountdown=function(){thisObj.countdown.getCurrentTimestring();timestamp=thisObj.countdown.getLeftoverTime();timestring=thisObj.countdown.getCurrentTimestring();if(timestamp>0){thisObj.timeHtmlObj.innerHTML=timestring;}else{thisObj.timeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(timestamp<=-2&&timestamp>-6&&!isOverlayOpen()){reload_page(reloadPage);}}};if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime,3);timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}function movementImageCountdown(htmlObj,leftoverTime,duration,isReturn,isRTL,routeLength){if(typeof htmlObj!=='object'){return;}var thisObj=this;// diese elemente werden veraendert
thisObj.timeHtmlObj=htmlObj;this.updateCountdown=function(){thisObj.countdown.getCurrentTimestring();var timestamp=thisObj.countdown.getLeftoverTime();var timestring=thisObj.countdown.getCurrentTimestring();if(timestamp>0){percent=clampFloat(timestamp/duration,0.0,1.0);if(!isReturn){pixel=Math.abs(routeLength-routeLength*percent);}else{pixel=Math.abs(routeLength*percent);}pixel=clampInt(Math.round(pixel),0,routeLength);if(isRTL){thisObj.timeHtmlObj.style['marginRight']=pixel+'px';}else{thisObj.timeHtmlObj.style['marginLeft']=pixel+'px';}}};if(thisObj.timeHtmlObj){// oldcountdown objekt
thisObj.countdown=new oldcountdown(leftoverTime,3);timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}// Countdown fuer Schiffe & Verteidigung
function shipCountdown(totalTimeObj,unitTimeObj,sumCountObj,unitTime,restTime,timeSum,unitCount,reloadPage){if(typeof totalTimeObj!=='object'||typeof unitTimeObj!=='object'||typeof sumCountObj!=='object'){return;}var thisObj=this;thisObj.totalTimeHtmlObj=totalTimeObj;thisObj.unitTimeHtmlObj=unitTimeObj;thisObj.sumCountHtmlObj=sumCountObj;this.updateCountdown=function(){thisObj.unitCountdown.getCurrentTimestring();unitTimestamp=thisObj.unitCountdown.getLeftoverTime();unitTimestring=thisObj.unitCountdown.getCurrentTimestring();thisObj.totalCountdown.getCurrentTimestring();totalTimestamp=thisObj.totalCountdown.getLeftoverTime();totalTimestring=thisObj.totalCountdown.getCurrentTimestring();if(unitTimestamp>0){thisObj.unitTimeHtmlObj.innerHTML=unitTimestring;}else{unitCount--;thisObj.unitTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(unitCount>0){thisObj.unitCountdown=new oldcountdown(unitTime);thisObj.sumCountHtmlObj.innerHTML=unitCount;}else{thisObj.sumCountHtmlObj.innerHTML=0;}}if(unitCount>0){thisObj.totalTimeHtmlObj.innerHTML=totalTimestring;}else{thisObj.totalTimeHtmlObj.innerHTML=LocalizationStrings.status.ready;if(!isOverlayOpen()){reload_page(reloadPage);}}};if(thisObj.totalTimeHtmlObj&&thisObj.unitTimeHtmlObj&&thisObj.sumCountHtmlObj){// oldcountdown objekt
thisObj.totalCountdown=new oldcountdown(timeSum);thisObj.unitCountdown=new oldcountdown(restTime);timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}/*
* Countdown reload
*/function reload_page(url){if(timerHandler&&timerHandler.pageReloadAlreadyTriggered==false){timerHandler.pageReloadAlreadyTriggered=true;openParentLocation(url);}}var Countdown=Countdown||function(){var instance=null;function createInstance(){var counter=null,countdowns=null;return{startCounter:function(){if(counter==null){counter=setInterval(function(){var now=Math.floor(Date.now()/1000);if(countdowns==null){Countdown.getInstance().refreshCountdowns();}countdowns.each(function(){var $this=$(this),countdownOptions={"units":{"weeks":LocalizationStrings.timeunits["short"]["week"],"days":LocalizationStrings.timeunits["short"]["day"],"hours":LocalizationStrings.timeunits["short"]["hour"],"minutes":LocalizationStrings.timeunits["short"]["minute"],"seconds":LocalizationStrings.timeunits["short"]["second"]}};if($this.data("segments")){countdownOptions.segments=$this.data("segments");}// This is the text that should be displayed once the countdown reaches 0
if($this.data("now")){countdownOptions.now=$this.data("now");}$this.attr("datetime",Formatter.secondsToPeriod($this.data("end")-now)).html(Formatter.secondsToTime($this.data("end")-now,countdownOptions));if($this.data("end")-now<=0){$this.removeClass("countdown");Countdown.getInstance().refreshCountdowns();if($this.data("onfinish")&&typeof window[$this.data("onfinish")]=="function"){window[$this.data("onfinish")].call($this);}}});},1000);}return true;},stopCounter:function(){clearInterval(counter);counter=null;return true;},refreshCountdowns:function(){countdowns=$("time.countdown");return true;}};}return{getInstance:function(){if(instance==null){instance=createInstance();}return instance;}};}();function initItemActivation(currItemUuid){inventoryObj.initalizeSlider(inventoryObj.items_inventory,"js_activeItemSlider",395,172,' ',true,' ',true,true);if(typeof currItemUuid=='undefined'||currItemUuid.length==0||currItemUuid==1){// we can use this selector, because all Items in the set can be activated
var $firstItem=$('.item_img_box .detail_button').filter(':first');// there can only be no items if we're on a moon:
if($firstItem.length===0){$('#noItems').show();$('#itemDetailBox').hide();return;}else{$.bbq.pushState({'item':$firstItem.attr('ref')});}}else{$.bbq.pushState({'item':currItemUuid});$(window).trigger('hashchange');}// show cooldown for all active items:
$('#activeBuffDetails .js_is_active').each(function(){$durationEl=$(this).parent().siblings('.js_duration');$pusherEl=$(this).parent().siblings('.pusher');startCooldown($durationEl,$pusherEl,75);});$(document).undelegate('#activeBuffDetails .detail_button','click.updateItemDetails').delegate('#activeBuffDetails .detail_button','click.updateItemDetails',function(){if($(this).hasClass('active')){return;}$('#activeBuffDetails .detail_button').removeClass('active');$(this).addClass('active');$.bbq.pushState({'item':$(this).attr('ref')});}).undelegate('#activeBuffDetails .build-it','click.activateItem').delegate('#activeBuffDetails .build-it','click.activateItem',function(){activateItem($(this).attr('ref'));}).undelegate('#activeBuffDetails .buyAndActivate.dm.build-it_disabled','click.activateItem').delegate('#activeBuffDetails .buyAndActivate.dm.build-it_disabled','click.activateItem',function(){if(vacation){return;}var uuid=$(this).attr('ref');if($("#js_activeItemSlider>li a[ref='"+uuid+"']").length==0){return;}errorBoxDecision(LocalizationStrings.error,translation.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=$("#darkmatter_box a").attr("href");});}).undelegate('#activeBuffDetails .close_detail','click.changeHash').delegate('#activeBuffDetails .close_detail','click.changeHash',function(){$.bbq.pushState({'item':''});});}function initBuffBar(){$('.sliderWrapper .active_items').anythingSlider({resizeContents:false,/* der inhalt hat die richtige groesse, basta! */buildNavigation:false,/* keine navigation zu einzelnen seiten */buildStartStop:false,/* keine start oder stop buttons */infiniteSlides:false,/* round robin abschalten */stopAtEnd:true/* zurueckspulen verhindern */});$('.sliderWrapper .active_items').removeClass('hidden');$(window).unbind("hashchange.openBuffBar").bind("hashchange.openBuffBar",function(hash){var url=$.deparam.fragment(hash.fragment);if(typeof url['item']!='undefined'){var $activateItem=$('#buffBar .activate_item');$("#buffBar a").removeClass('active');var itemUuid=url['item'];if(itemUuid!=''){if($("#activeBuffDetails:visible").length){if(typeof inventoryObj.items_inventory[itemUuid]=='undefined'){var $firstItem=$('#activeBuffDetails .detail_button').filter(':first');$.bbq.pushState({'item':$firstItem.attr('ref')});return;}$("#buffBar a[ref='"+url['item']+"']").addClass('active');$activateItem.addClass('active');$('#noItems').hide();$('#itemDetailBox').show();updateItemDetails(itemUuid);}else{$("#buffBar a[ref='"+url['item']+"']").addClass('active');$activateItem.addClass('active');gfSlider.slideIn(getElementByIdWithCache("detail"),itemUuid);}}else{if($('#activeBuffDetails .detail_button').filter(':first').length===0){$('#noItems').show();$('#itemDetailBox').hide();}$("#activeBuffDetails .close_details").click();$activateItem.removeClass('active');}}});$(document).undelegate('#buffBar a','click.openDetails').delegate('#buffBar a','click.openDetails',function(){if($(this).hasClass('active')){$.bbq.pushState({'item':''});}else{$.bbq.pushState({'item':$(this).attr('ref')});}});$('#buffBar').unbind('click.openDetails').bind('click.openDetails',function(event){if(!$(event.target).is('#buffBar .activate_item')&&!$(event.target).is('.arrow a')){$('#buffBar .activate_item').click();}});$('#buffBar .active_items div:not(.activate_item)').each(function(){$durationEl=$(this).find('.js_duration');$pusherEl=$(this).find('.pusher');startCooldown($durationEl,$pusherEl,32);});$(window).trigger('hashchange');}function getItem(uuid){if(typeof inventoryObj.items_inventory[uuid]!='undefined'){return inventoryObj.items_inventory[uuid];}return null;}function updateItemDetails(uuid){var item=getItem(uuid);$('#activeBuffDetails .detail_button').removeClass('active');$('#activeBuffDetails .detail_button[ref="'+uuid+'"]').addClass('active');$('#activeBuffDetails .js_itemName').html(item.name);$('#activeBuffDetails .js_itemEffect').html(item.effect);$('#activeBuffDetails .js_itemAmount').html(item.amount);if(item.firstStatus){$('#activeBuffDetails .js_itemDurationStatus').html(translation.durationType[item.firstStatus]);}else{$('#activeBuffDetails .js_itemDurationStatus').html(translation.durationType.effecting);}if(item.duration){if(item.durationExtension){$('#activeBuffDetails .js_itemDuration').html(formatTimeWrapper(item.duration,2,true," ",false,"")+item.durationExtension);}else{$('#activeBuffDetails .js_itemDuration').html(formatTimeWrapper(item.duration,2,true," ",false,""));}}else if(item.duration===null){if(item.moonOnlyItem){$('#activeBuffDetails .js_itemDuration').html(translation.permanentMoon);}else{$('#activeBuffDetails .js_itemDuration').html(translation.permanent);}}else{$('#activeBuffDetails .js_itemDuration').html(translation.now);}if(item.timeLeft){$('#activeBuffDetails .js_itemTimeLeftTxt').show();$('#activeBuffDetails .js_itemTimeLeft').html(formatTimeWrapper(item.timeLeft,2,true," ",false,""));}else{$('#activeBuffDetails .js_itemTimeLeftTxt').hide();}var $activateBtn=$('#activationButton');$activateBtn.attr('ref',uuid);$activateBtn.removeClass('buyAndActivate activateItem build-it_disabled build-it dm bp').addClass(item.currency);if(item.amount>0){$activateBtn.addClass('activateItem').html('<span>'+(item.timeLeft>0&&item.extendable?translation.extend:translation.activate)+'</span>').addClass(item.canBeActivated?'build-it':'build-it_disabled');}else{var buyString=item.timeLeft>0&&item.extendable?translation.buyAndExtend:translation.buyAndActivate;buyString=buyString.replace(/%price%/,tsdpkt(item.costs));buyString=buyString.replace(/%currency%/,translation.currencies[item.currency]);$activateBtn.addClass('buyAndActivate').html('<span>'+buyString+'</span>').addClass(item.canBeBoughtAndActivated&&item.hasEnoughCurrency?'build-it':'build-it_disabled');}}function activateItem(uuid){var dataObject={ajax:1,token:activateToken,referrerPage:$.deparam.querystring().page};var item=getItem(uuid);if(item.amount>0){dataObject.item=uuid;}else{dataObject.buyAndActivate=uuid;}function updateItemAjax(){$.ajax({cache:false,url:inventoryObj.inventoryUrl,data:dataObject,type:"POST",dataType:"json",success:function(data,textStatus,jqXHR){activateToken=data.newToken;if(data.error){fadeBox(data.message,true);return;}if(data.message.reload){location.href=getRedirectLink();return;}fadeBox(data.message.message,false);if(data.message.buff!=false){// animate buff activation
var item=getItem(data.message.buff);var isNew=true;var $activeItems=$('.active_items');var activeItemsSlider=$activeItems.data('AnythingSlider');var $buffElement;$activeItems.find('li a').removeClass('active');$activeItems.find('li a.activate_item').addClass('active');// Prolong existing buff
$activeItems.find('div[data-id='+data.message.buffId+']').each(function(){$(this).hide().show('pulsate').find('a').addClass('active');isNew=false;$buffElement=$(this);});// Add a new buff
if(isNew==true){var $newItem=$('<div data-uuid="'+item.ref+'" data-id="'+data.message.buffId+'">'+'<div class="js_duration" style="display: none;"></div>'+'<a href="javascript:void(0);" ref="'+item.ref+'" class="detail_button slideIn active_item active r_'+data.message.item.rarity+' border3px tooltipHTML" title="'+data.message.item.toolTip+'">'+'<div class="pusher" style="height: 0%; "></div>'+'<img src="/cdn/img/item-images/'+item.image+'-small.png" alt=""/>'+'</a>'+'</div>');var numberOfVisibleItemsInARow=14;// gleicher Name in PHP
// Store the number of the currently viewed page
// In case the new item is appended to the page we already see, do not animate the slider
// when switching to the new last page after repagination
var currentSliderPage=activeItemsSlider.currentPage;var sliderAnimationTime=activeItemsSlider.options.animationTime;// If the new item leads to removal of existing buffs, handle that first
if(typeof data.message.upgraded!='undefined'){// Remove buffs that are marked as upgraded
for(var upgradedCounter in data.message.upgraded){var upgradedUuid=data.message.upgraded[upgradedCounter];$activeItems.find('div[data-uuid='+upgradedUuid+']').remove();}// Repaginate buff bar
var $newPagination=$(document.createDocumentFragment());var $buffs=$activeItems.find("li > div");$buffs.each(function(i,e){if(i%numberOfVisibleItemsInARow==0){//$('<li/>').appendTo($newPagination);
}$(this).appendTo($newPagination.children().last());});// we had to comment this line out to prevent emtyping the activeitems list which caused the issue described in Ticket #OG-7748
//$activeItems.empty().append($newPagination);
activeItemsSlider.updateSlider();}// Add new item
var numberOfBuffsInLastPage=$activeItems.children().last().children().length;if(numberOfBuffsInLastPage<numberOfVisibleItemsInARow){// Item can be appended to existing last page
$newItem.hide().appendTo($activeItems.children().last()).show('pulsate');if(currentSliderPage==activeItemsSlider.pages){activeItemsSlider.options.animationTime=0;}activeItemsSlider.gotoPage(activeItemsSlider.pages);if(currentSliderPage==activeItemsSlider.pages){activeItemsSlider.options.animationTime=sliderAnimationTime;}}else{// Item does not fit into last page, so create new page
$newItem=$newItem.hide().wrap('<li/>');$newItem.parent().appendTo($activeItems).children().last();activeItemsSlider.updateSlider();if(currentSliderPage==activeItemsSlider.pages){activeItemsSlider.options.animationTime=0;}activeItemsSlider.gotoPage(activeItemsSlider.pages);if(currentSliderPage==activeItemsSlider.pages){activeItemsSlider.options.animationTime=sliderAnimationTime;}$newItem.show('pulsate');}$buffElement=$newItem;}else{console.log(item.ref);var $oldItem=$('<div data-uuid="'+item.ref+'" data-id="'+data.message.buffId+'">'+'<div class="js_duration" style="display: none;"></div>'+'<a href="javascript:void(0);" ref="'+item.ref+'" class="detail_button slideIn active_item active r_'+data.message.item.rarity+' border3px tooltipHTML" title="'+data.message.item.toolTip+'">'+'<div class="pusher" style="height: 0%; "></div>'+'<img src="/cdn/img/item-images/'+item.image+'-small.png" alt=""/>'+'</a>'+'</div>');var upgradedUuid=item.ref;$activeItems.find('div[data-uuid='+upgradedUuid+']').remove();$oldItem.hide().appendTo($activeItems.children().last()).show('pulsate');$buffElement=$oldItem;}}var $pusherElement=$buffElement.find('.pusher');var $durationElement=$buffElement.find('.js_duration');$durationElement.attr('data-total-duration',data.message.totalDuration).text(data.message.item.timeLeft);startCooldown($durationElement,$pusherElement,32);// renew item buff box
getAjaxResourcebox();$.ajax({type:"POST",url:detailUrl,data:{type:uuid},beforeSend:function(){$('#detailWrapper .detail_screen').html('<p class="ajaxLoad">'+LocalizationStrings.loading+'</p>');},success:function(data){$('#detailWrapper .detail_screen').html(data);}});},error:function(data){fadeBox("Error!",true);}});}if(item.isAnUpgrade){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,updateItemAjax);}// character class items need extra confirmation box
else if(item.isCharacterClassItem){if(item.amount>0){errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.activateItemQuestion.replace('#characterClassName#',item.name),LocalizationStrings.yes,LocalizationStrings.no,updateItemAjax);}else{errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.buyAndActivateItemQuestion.replace('#characterClassName#',item.name).replace('#darkmatter#',tsdpkt(item.costs)),LocalizationStrings.yes,LocalizationStrings.no,updateItemAjax);}}else{updateItemAjax();}}function initEmpireEquipment(){$(".overview_equipment .item_img_box .hidden").each(function(){startCooldown($(this),$(this).parent().parent().find('.pusher'),32);});}function startCooldown($durationEl,$pusherEl,maxHeight){if($.trim($durationEl.text()).match(/^\d+$/)){var countdown=new countdownWithTickFunction($durationEl[0],parseInt($.trim($durationEl.text())),parseInt($durationEl.attr("data-total-duration")),function(){location.href=getRedirectLink();// reload, damit das item verschwindet
},function(duration,totalDuration){var faktor=1-duration/totalDuration;var realHeight=Math.floor(maxHeight*faktor);$pusherEl.css("height",realHeight+"px");});}}function errorBoxAsArray(data){if(data["type"]=="notify"){notifyBoxAsArray(data);}else if(data["type"]=="decision"){decisionBoxAsArray(data);}else if(data["type"]=="fadeBox"){fadeBox(data["text"],data["failed"]);}}function notifyBoxAsArray(data){errorBoxNotify(data["title"],data["text"],data["buttonOk"],String(data["okFunction"]),data["removeOpen"],data["modal"]);}function fadeBox(message,failed,callback,duration){if(failed){$("#fadeBoxStyle").attr("class","failed");}else{$("#fadeBoxStyle").attr("class","success");}$("#fadeBoxContent").html(message);$("#fadeBox").stop(false,true).show().fadeOut(duration||10000,callback);}function decisionBoxAsArray(data){errorBoxDecision(data["title"],data["text"],data["buttonOk"],data["buttonNOk"],String(data["okFunction"]),String(data["nokFunction"]),data["removeOpen"]);}function errorBoxDecision(head,content,yes,no,yesHandler,noHandler,useHashCharacter){var useHash=getIEVersion()<=9&&(useHashCharacter||false);var errorBox=$("#errorBoxDecision");errorBox.find("#errorBoxDecisionHead").html(head);errorBox.find("#errorBoxDecisionContent").html(content);var yesFunction=function(e){e.stopPropagation();if(typeof errorBox.data('uiDialog')!='undefined'){errorBox.dialog('destroy');}if(typeof yesHandler=='function'){yesHandler();}if(yesHandler=='submit_form'){$('#planetMaintenanceDelete').submit();}};var noFunction=function(e){e.stopPropagation();if(typeof errorBox.data('uiDialog')!='undefined'){errorBox.dialog('destroy');}if(noHandler=='checkPassword'){location.reload();}if(typeof noHandler=='function'){noHandler();}};// workaround for firefox instantly firing yes on click event when the error box was opened via keyboard enter event:
// setting a timeout with the event bindings
errorBox.find(".yes, .no").unbind('click');errorBox.unbind('keydown.yesHandler');setTimeout(function(){var $yesButton=errorBox.find('.yes');var $noButton=errorBox.find('.no');$yesButton.unbind('click').bind('click',yesFunction).focus().find("#errorBoxDecisionYes").html(yes);$noButton.unbind('click').bind('click',noFunction).find("#errorBoxDecisionNo").html(no);if(useHash){$yesButton.attr('href','#');$noButton.attr('href','#');}else{$yesButton.attr('href','javascript:void(0);');$noButton.attr('href','javascript:void(0);');}errorBox.bind('keydown.yesHandler',function(e){if(e.which==KeyEvent.DOM_VK_RETURN){errorBox.find('.yes').trigger('click');}});},100);Tipped.hideAll();errorBox.dialog({resizable:false,modal:true,title:head,close:noFunction,width:400,dialogClass:'errorBox'});}function errorBoxNotify(head,content,ok,okHandler,useHashCharacter){var useHash=getIEVersion()<=9&&(useHashCharacter||false);var errorBox=$("#errorBoxNotify");errorBox.find("#errorBoxNotifyHead").html(head);errorBox.find("#errorBoxNotifyContent").html(content);var okFunction=function(e){e.stopPropagation();errorBox.dialog('destroy');if(typeof okHandler=='function'){okHandler();}else if(typeof window[okHandler]=="function"){window[okHandler]();}};var $okButton=errorBox.find('.ok');$okButton.unbind('click').bind('click',okFunction).find("#errorBoxNotifyOk").html(ok);if(useHash){$okButton.attr('href','#');}else{$okButton.attr('href','javascript:void(0);');}Tipped.hideAll();errorBox.dialog({resizable:false,modal:true,title:head,close:okFunction,width:400,dialogClass:'errorBox'});}/* 
    Document   : eventBirthday
    Created on : 31.08.2012, 12:16:13
    Author     : stefanie.knoth
    Description:
        This file contains the javascript that is neccessary for the Birthday 
        Event
*/function eventBDayInitGalaxy(){if(isMobile){$('.js_bday_details').hide();$('.bdaySlotBox .name').click(function(e){$('.row').children().each(function(){if($(this).html().trim())$(this).removeClass('active');});$('.bdaySlotBox .name').removeClass('active');$('.js_detailRow').hide();$(this).toggleClass('active');if($(e.target).attr('class').indexOf('planet')!==-1){$('.js_detailRowPlanet17').toggle();}else if($(e.target).attr('class').indexOf('debris')!==-1){$('.js_detailRowDebris17').toggle();}});}}function eventBDayInit(){var $event_box=$('.event_box');$('#eventBDayWrapper').click(function(e){if($(e.target).attr('id')==='BDayContent'||$(e.target).attr('id')==='BDayEventClose'||$(e.target).closest('#BDayHeader').length>0){$event_box.hide();$('.bday_box').removeClass('active');}e.stopPropagation();});$('.bday_box').click(function(e){$('.bday_box').removeClass('active');var boxId=$(e.target).closest('.bday_box').attr('id').replace('box','');$event_box.removeClass().addClass('event_box '+eventBoxData[boxId].eventTypeClass);if(eventBoxData[boxId]!==undefined){$event_box.attr('id','eventBox'+boxId).show();$('#box'+boxId).addClass('active');if(eventBoxData[boxId].eventTypeClass!=='future'){$('#eventBox'+boxId+' #BDayEventDate').html(eventBoxData[boxId].date+': ');}else{$('#eventBox'+boxId+' #BDayEventDate').html('');}$('#eventBox'+boxId+' #BDayEventTitle').html(eventBoxData[boxId].title);$('#eventBox'+boxId+' #BDayofficerImg').attr('src',eventBoxData[boxId].eventOfficerImgSrc);if(eventBoxData[boxId].eventTypeClass!=='future'||eventBoxData[boxId].txtChronic!==undefined){$('#eventBox'+boxId+' #BDayEventTxtChronic').html(eventBoxData[boxId].txtChronic);$('#eventBox'+boxId+' #BDayChronic').show();}else{$('#eventBox'+boxId+' #BDayChronic').hide();}if(eventBoxData[boxId].eventImgSrc===undefined&&eventBoxData[boxId].eventTypeClass==='future'){$('#eventBox'+boxId+' #BDayEventImg').attr('src','//gf3.geo.gfsrv.net/cdn82/d995359d038c9a0c21aed16b3cc162.png');}else{$('#eventBox'+boxId+' #BDayEventImg').attr('src',eventBoxData[boxId].eventImgSrc);}if(eventBoxData[boxId].eventTxtDesc===undefined){$('#eventBox'+boxId+' #BDayEventTxtDesc').html('');}else{$('#eventBox'+boxId+' #BDayEventTxtDesc').html(eventBoxData[boxId].eventTxtDesc);}$('#eventBox'+boxId+' #BDayEventPastTxt').hide();if(eventBoxData[boxId].eventTypeClass==='past'){$('#eventBox'+boxId+' #BDayEventPastTxt').html(eventPastTxt).show();}$('#eventBox'+boxId+' #BDayEventBtnCTA').hide();if(eventBoxData[boxId].eventTypeClass!==('past'||'future')&&eventBoxData[boxId].btnCTA!==undefined){$('#eventBox'+boxId+' #BDayEventBtnCTA').html(eventBoxData[boxId].btnCTA).attr('href',eventBoxData[boxId].btnCTALink).show();}}});}function initBDayEventHints(){$(document).undelegate('.event_build_faster, .event_active_hint','click').delegate('.event_build_faster, .event_active_hint','click',function(e){e.stopPropagation();if($(this).parent().attr('id')==='expeditionbutton'){doExpedition();}else{$(this).siblings('.detail_button').click();}});}function toggleEvents(doNotClose){if($("#eventboxContent").is(":hidden")){$("#eventboxContent").slideDown('fast');$('#js_eventDetailsClosed').hide();$('#js_eventDetailsOpen').show();if(typeof toggleEvents.loaded=='undefined'||!toggleEvents.loaded){$("#eventboxContent").html('<img height="16" width="16" src="//gf3.geo.gfsrv.net/cdne3/3f9884806436537bdec305aa26fc60.gif" />');$.ajax({url:eventlistLink,success:function(response){$("#eventboxContent").html(response);toggleEvents.loaded=true;}});}}else{if(doNotClose){return;}$("#eventboxContent").slideUp('fast');$('#js_eventDetailsClosed').show();$('#js_eventDetailsOpen').hide();}$("#contentWrapper select").ogameDropDown('hide');}function toggleDetails(){var relTr=$(".partnerInfo."+$(this).attr("rel"));if($(relTr).is(":hidden")){$(relTr).show();$(this).parents("tr").addClass("detailsOpened").removeClass("detailsClosed");}else{$(relTr).hide();$(this).parents("tr").addClass("detailsClosed").removeClass("detailsOpened");}}function Exodus(cfg){this.loca=cfg.loca;this.initServerSelect(cfg);}Exodus.prototype.onAjaxDone=function(){this.loadingIndicator.hide();//@todo handle error
};Exodus.prototype.onAjaxError=function(){};Exodus.prototype.updateToken=function(){};Exodus.prototype.initCommon=function(cfg){this.serverWrapper=$('.exodus #serverNumbers');this.loadingIndicator=this.serverWrapper.ogameLoadingIndicator();this.serverLanguage=$('.exodus #serverLanguage');this.serverNumber=$('.exodus #serverNumber');this.serverNumbers=null;this.selectedLanguage=null;this.serverSelection=$('#serverSelection');this.table=this.serverLanguage.closest('.og-table');this.availableLanguages=cfg.availableLanguages;this.urlServerIds=cfg.urlServerIds||null;this.urlIsReady=cfg.urlIsReady||null;this.urlSubmitExodus=cfg.urlSubmitExodus||null;this.isReadyForExodus=cfg.isReadyForExodus||false;this.serverAmount=0;};Exodus.prototype.initServerSelect=function(cfg){this.initCommon(cfg);this.dropDownLanguageSelect=$('.exodus #serverLanguage');this.dropDownServerSelect=$('.exodus #serverNumber');this.exodusSubmitButton=$('.exodus #submitExodus');this.exodusSubmitButton.on('click',this.onClickExecute.bind(this));this.dropDownLanguageSelect.on('change',this.onChangeServerLanguage.bind(this));this.dropDownServerSelect.on('change',this.onChangeServerNumber.bind(this));this.resetLanguage();this.refreshLanguage();};Exodus.prototype.onChangeServerLanguage=function(e){this.selectedLanguage=this.dropDownLanguageSelect.val();this.refreshLanguage();this.fetchServerNumbers();};Exodus.prototype.onChangeServerNumber=function(e){this.selectedServer=this.dropDownServerSelect.val();this.refreshServer();};Exodus.prototype.onClickExecute=function(e){e.stopPropagation();e.preventDefault();let serverName=this.dropDownServerSelect.find('option[value="'+this.selectedServer+'"]').html();this.loadingIndicator.show();let that=this;errorBoxDecision(this.loca.LOCA_EXODUS_TRANSFER_QUESTION_TITLE,this.loca.LOCA_EXODUS_TRANSFER_QUESTION.replace('#uniname#',serverName),this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){let data={serverNumber:parseInt(that.selectedServer),serverLanguage:that.selectedLanguage};$.post(that.urlSubmitExodus,data,that.handleSubmitExodusResponse.bind(that)).done(that.onAjaxDone.bind(that));},function(){that.loadingIndicator.hide();});};Exodus.prototype.fetchServerNumbers=function(){this.loadingIndicator.show();let data={language:this.selectedLanguage};$.getJSON(this.urlServerIds,data,this.onFetchServerNumbers.bind(this)).done(this.onAjaxDone.bind(this));};Exodus.prototype.checkIsReady=function(){let data={};if(this.serverAmount>0){$.getJSON(this.urlIsReady,data,this.onCheckIsReady.bind(this)).done(this.onAjaxDone.bind(this));}};Exodus.prototype.setLanguage=function(language){let languageOld=this.selectedLanguage;this.selectedLanguage=language;if(this.selectedLanguage!==languageOld){this.resetLanguage();this.refreshLanguage();this.fetchServerNumbers();this.resetServer();this.checkIsReady();}};Exodus.prototype.setServer=function(number){let serverOld=this.selectedServer;this.selectedServer=number;if(this.selectedServer!==serverOld){this.resetServer();this.refreshServer();this.checkIsReady();}};Exodus.prototype.refreshLanguage=function(){this.dropDownLanguageSelect.find('option').removeAttr('selected');if(this.selectedLanguage){this.dropDownLanguageSelect.find('option[value="'+this.selectedLanguage+'"]').attr('selected','selected');}};Exodus.prototype.refreshServer=function(){this.dropDownServerSelect.find('option').removeAttr('selected');if(this.selectedServer){this.dropDownServerSelect.find('option[value="'+this.selectedServer+'"]').attr('selected','selected');}};Exodus.prototype.resetLanguage=function(){this.setLanguage(this.getFirstLanguage());};Exodus.prototype.resetServer=function(){this.setServer(this.selectedServer);};Exodus.prototype.getFirstLanguage=function(){return this.availableLanguages[0];};Exodus.prototype.onCheckIsReady=function(data){this.isReadyForExodus=data.isReady;if(this.isReadyForExodus&&this.selectedServer!==0){this.exodusSubmitButton.removeClass('disabled');}else{this.exodusSubmitButton.addClass('disabled');}};Exodus.prototype.handleSubmitExodusResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';if(status==='success'){fadeBox(data.message,false);window.location=data.redirectUrl;}else{this.displayErrors(data.errors);}};Exodus.prototype.displayErrors=function(errors){// only display the first error
let error=errors[0]||undefined;if(error){fadeBox(error.message,true);}};Exodus.prototype.onFetchServerNumbers=function(data){if(data.serverNumbers.length===0||this.isReadyForExodus===false){if(data.serverNumbers.length===0){this.serverSelection.html('<span id="noServer">'+this.loca.LOCA_EXODUS_NO_SERVER_AVAILABLE+'</span>');}if(this.isReadyForExodus===false){this.serverSelection.html('<span id="noServer">'+this.loca.LOCA_EXODUS_RESTRICTION_NOT_FULFILLED+'</span>');}this.exodusSubmitButton.addClass('disabled');this.serverAmount=0;this.selectedServer=0;return;}else{this.serverSelection.html('<select id="serverNumber" type="text" class="og-input" name="serverNumber"></select>');this.exodusSubmitButton.removeClass('disabled');this.dropDownServerSelect=$('.exodus #serverNumber');this.dropDownServerSelect.on('change',this.onChangeServerNumber.bind(this));this.serverAmount=data.serverNumbers.length;}this.selectedServer=data.serverNumbers[0].number;this.serverNumbers=data.serverNumbers;var select=this.dropDownServerSelect;if(select.prop){var options=select.prop('options');}else{var options=select.attr('options');}$('option',select).remove();let htmlOptions='';$.each(data.serverNumbers,function(key,server){options[options.length]=new Option(server.name,server.number);htmlOptions+='<option value="'+server.number+'">'+server.name+'</option>';});this.dropDownServerSelect.ogameDropDown('destroy');this.dropDownServerSelect.html('');this.dropDownServerSelect.html(htmlOptions).ogameDropDown();};function initFleet2(){updateVariables();timerHandler.appendCallback(updateTimesFleet2);if(!isMobile)$("#galaxy").focus();initToggleHeader('fleet2');initBackButton();focusOnTabChange("#continue",true);detachEventHandlers();attachEventHandlers();if($(".combatunits>option:selected").length){$(".combatunits>option:selected").change();}}function attachEventHandlers(){var $speedInput=$("#speed");$(document).on('mouseover focus','#speedLinks>a',function(e){$speedInput.val($(this).attr('data-value'));updateVariables();}).on('mouseleave blur','#speedLinks>a',function(e){resetSpeedToSelected();}).on('mouseup touchstart','#speedLinks>a',function(e){$("#speedLinks>a.selected").removeClass('selected');$(this).addClass('selected').focus();$speedInput.val($(this).attr('data-value'));updateVariables();}).on('keyup','#speedLinks>a',function(e){if(e.keyCode==KeyEvent.DOM_VK_LEFT){$(this).prev().focus();}else if(e.keyCode==KeyEvent.DOM_VK_RIGHT){$(this).next().focus();}else if(e.keyCode==KeyEvent.DOM_VK_RETURN){e.stopPropagation();e.preventDefault();if($(this).hasClass('selected')){trySubmit();}else{$(this).trigger("mouseup");}}}).on('keypress','#speedLinks>a',function(e){if(e.keyCode==KeyEvent.DOM_VK_RETURN){e.stopPropagation();e.preventDefault();if($(this).hasClass('selected')){trySubmit();}else{$(this).click();}}}).on('keypress','#contentWrapper #inhalt',submitOnEnter);}function detachEventHandlers(){$(document).off('mouseover focus mouseleave blur mouseup touchstart keyup keypress','#speedLinks>a').off('keypress','#contentWrapper #inhalt');}function resetSpeedToSelected(){if(currentPage=="fleet2"){$("#speed").val($("#speedLinks>a.selected").attr('data-value'));updateVariables();}}function initBackButton(){$("#back").unbind('click').bind('click',function(){resetSpeedToSelected();$(this).parents('form').attr('action',returnLink).submit();});}function prepareVariables(){checkCoords();speed=$("#speedPercentage").attr('percent');}function setTType(type){type=type==null?$("#type").val():type;if(type==1){$("#pbutton").attr("class","planet_selected");}else{$("#pbutton").attr("class","planet");}if(type==2){$("#dbutton").attr("class","debris_selected");}else{$("#dbutton").attr("class","debris");}if(type==3){$("#mbutton").attr("class","moon_selected");}else{$("#mbutton").attr("class","moon");}if(type==1){$("#targetPlanetName").html(locaAllPlanet);}else if(type==2){$("#targetPlanetName").html(locaAllDebris);}else if(type==3){$("#targetPlanetName").html(locaAllMoon);}$("#type").val(type);}/**
 * Bei Auswahl eines Shortlinks (eigene Ziele oder Verband) das Ziel setzen
 * @param aks
 */function shortLinkChange(aks){var value;if(aks!=null){value=$("#aksbox").val();}else{value=$("#slbox").val();}if(value!="-"){var parts=value.split("#");$("#galaxy").val(parts[0]);$("#system").val(parts[1]);$("#position").val(parts[2]);setTType(parts[3]);$("#targetPlanetName").html(parts[4]);targetGalaxy=parts[0];targetSystem=parts[1];targetPosition=parts[2];}focusContinueButton();}function focusContinueButton(){// Fokus auf "weiter" Button, damit man mit Return das Formular absenden kann
setTimeout(function(){$('#continue').focus();},100);}function handleUnion(){if($("#aksbox").val()=="-"){document.details.union.value=0;document.details.mission.value=mission;}else{parts=$("#aksbox").val().split("#");document.details.union.value=parts[5];document.details.mission.value=missionUnionattack;}}function hideStatusBar(){if($(".fleetStatus")&&(targetGalaxy!=defaultTargetGalaxy||targetSystem!=defaultTargetSystem||targetPosition!=defaultTargetPosition)){$(".fleetStatus").hide();$("input[name='mission']").value="";}}function checkCoords(){checkIntInput("#galaxy",1,maxGalaxy);checkIntInput("#system",1,maxSystem);checkIntInput("#position",1,maxPosition);targetGalaxy=$("#galaxy").val();targetSystem=$("#system").val();targetPosition=$("#position").val();if(targetPosition==16){setTType(1);modifyPlanetName();checkOk();}}function checkTarget(){var url=checkUrl;var params={};params.galaxy=$("#galaxy").val();params.system=$("#system").val();params.planet=$("#position").val();params.type=$("#type").val();if($("form[name='details'] input[name='am"+colonizationID+"']").length>0&&$("form[name='details'] input[name='am"+colonizationID+"']").val()>0){params.cs=1;}if($("form[name='details'] input[name='am"+recyclerID+"']").length>0&&$("form[name='details'] input[name='am"+recyclerID+"']").val()>0){params.recycler=1;}$.post(url,params,displayError);}function updateTimesFleet2(){//serverTime.setSeconds(serverTime.getSeconds()+0.5);
var arrivalTime=getFormatedDate(serverTime.getTime()+1000*duration,'[d].[m].[y] [G]:[i]:[s]');var returnTime=getFormatedDate(serverTime.getTime()+1000*2*duration,'[d].[m].[y] [G]:[i]:[s]');if(document.getElementById){$("#arrivalTime").html(arrivalTime);$("#returnTime").html(returnTime);}}function initFleet3(){timerHandler.appendCallback(updateTimesFleet3);if(!isMobile)$("#metal").focus();initToggleHeader('fleet3');initBackButton();updatePrioButtons();if($("#missions .on .selected").length){$("#missions .on .selected")[0].onclick();}$('#contentWrapper #inhalt').unbind('keydown.continue').bind('keydown.continue',function(e){if(e.keyCode==KeyEvent.DOM_VK_RETURN){trySubmit();}});}function updatePrioButtons(){$('#prioM1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioM2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioM3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(prioMetal){case 1:$('#prioM1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioM2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioM3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}$('#prioC1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioC2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioC3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(prioCrystal){case 1:$('#prioC1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioC2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioC3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}$('#prioD1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioD2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioD3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(prioDeuterium){case 1:$('#prioD1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioD2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioD3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}}function selectPrio(type,prio){switch(type){case'metal':if(prioMetal==prio){break;}if(prioCrystal==prio)prioCrystal=prioMetal;if(prioDeuterium==prio)prioDeuterium=prioMetal;prioMetal=prio;break;case'crystal':if(prioCrystal==prio){break;}if(prioMetal==prio){prioMetal=prioCrystal;}if(prioDeuterium==prio){prioDeuterium=prioCrystal;}prioCrystal=prio;break;case'deuterium':if(prioDeuterium==prio){break;}if(prioMetal==prio){prioMetal=prioDeuterium;}if(prioCrystal==prio){prioCrystal=prioDeuterium;}prioDeuterium=prio;break;}$('form input[name="prioMetal"]').val(prioMetal);$('form input[name="prioCrystal"]').val(prioCrystal);$('form input[name="prioDeuterium"]').val(prioDeuterium);updatePrioButtons();}function updateHoldingOrExpTime(){if($('form input[name="mission"]').val()==missionHold){$('form input[name="holdingOrExpTime"]').val($('form input[name="holdingtime"]').val());holdingTime=$('form [name="holdingtime"]').val();}else if($('form input[name="mission"]').val()==missionExpedition){$('form input[name="holdingOrExpTime"]').val($('form input[name="expeditiontime"]').val());holdingTime=$('form [name="expeditiontime"]').val();}else{$('form input[name="holdingOrExpTime"]').val(0);holdingTime=0;}}function checkRessourceByType(type){var ressValue=getValue($("#"+type).val());var ressOnPlanet=0;var ressCargoDiff=0;if(type=='metal'){ressOnPlanet=metalOnPlanet;ressCargoDiff=cargoSpace-crystal-deuterium;}else if(type=='crystal'){ressOnPlanet=crystalOnPlanet;ressCargoDiff=cargoSpace-metal-deuterium;}else if(type=='deuterium'){ressOnPlanet=deuteriumOnPlanet;ressCargoDiff=cargoSpace-metal-crystal;}else{ressOnPlanet=metalOnPlanet;ressCargoDiff=cargoSpace-crystal-deuterium;}if(ressValue!=""){var intVal=parseInt(ressValue);intVal=isNaN(intVal)?0:intVal;intVal=Math.abs(intVal);intVal=Math.min(intVal,ressOnPlanet);if(intVal>ressCargoDiff)intVal=ressCargoDiff;updateRessVarByType(type,intVal);formatNumber($("#"+type),intVal);}else{updateRessVarByType(type,0);}}function updateRessVarByType(type,value){if(type=='metal'){metal=value;}else if(type=='crystal'){crystal=value;}else if(type=='deuterium'){deuterium=value;}else{metal=value;}}function resetByRessourceType(type){if(type=='metal'){metal=0;}if(type=='crystal'){crystal=0;}if(type=='deuterium'){deuterium=0;}$('#'+type).val(0);updateVariables();}function maxMetal(){var amount;amount=cargoSpace-crystal-deuterium;amount=Math.max(amount,0);amount=Math.min(amount,metalOnPlanet);metal=Math.max(metal,amount);formatNumber($("#metal"),metal);}function maxCrystal(){var amount;amount=cargoSpace-metal-deuterium;amount=Math.max(amount,0);amount=Math.min(amount,crystalOnPlanet);crystal=Math.max(crystal,amount);formatNumber($("#crystal"),crystal);}function maxDeuterium(){var amount;amount=cargoSpace-metal-crystal;amount=Math.max(amount,0);amount=Math.min(amount,deuteriumOnPlanet-consumption);amount=Math.max(amount,0);deuterium=Math.max(deuterium,amount);formatNumber($("#deuterium"),deuterium);}function maxAll(){metal=0;crystal=0;deuterium=0;maxDeuterium();maxCrystal();maxMetal();}function updateTimesFleet3(){durationAKS=durationAKS-1;//serverTime.setSeconds(serverTime.getSeconds()+0.5);
checkTimes();}function checkTimes(){var usedDuration=duration;if($("#missionButton2").hasClass('selected')){usedDuration=Math.max(durationAKS,duration);}var arrivalTime=serverTime.getTime()+1000*usedDuration;var returnTime=arrivalTime+1000*duration+holdingTime*3600*1000;// milliseconds... don't forget about it
if(durationAKS>=duration){$("#durationAKS").html(getFormatedTime(durationAKS));}$("#arrivalTime").text(getFormatedDate(arrivalTime,'[d].[m].[y] [G]:[i]:[s]'));$("#returnTime").text(getFormatedDate(returnTime,'[d].[m].[y] [G]:[i]:[s]'));}function setSelected(mission){$("#missions>li>a.selected").removeClass('selected');$("#missionButton"+mission).addClass('selected');isAggressiveMission=mission==1||mission==2||mission==6||mission==9;$("#fightAfterRetreat,"+"#aks,"+"#holdtimeline,"+"#expeditiontimeline,"+".prioButton").hide();switch(mission){case 1:$("#fightAfterRetreat").show();$(".prioButton").show();break;case 2:$('#aks').show();$(".prioButton").show();break;case 5:$('#holdtimeline').show();break;case 8:$('#expeditiontimeline').hide();break;case 15:$("#expeditiontimeline").show();break;}checkTimes();}

function updateMission(missionName, missionDescription, status, missionVal) {
    $('.missionName').text(missionName);
    $('.mission_description').text(missionDescription);
    $('#missionNameWrapper').removeClass('off');
    $('.briefing_overlay').hide();
    $('form input[name="mission"]').val(missionVal);
    updateHoldingOrExpTime();
    updateVariables();
}var validated=false;var sendingEnabled=true;var shipIDs=[];var speeds=[];var completeConsumptions=[];var storageCapacity=null;var probeStorageCapacity=null;var tankSpace=null;var probeCompleteConsumption=null;var maxSpeed=0;var speedFactor=1;var maxGalaxy=null;var maxSystem=null;var maxPosition=null;var DONUT_GALAXY=null;var DONUT_SYSTEM=null;var currentGalaxy=1;var currentSystem=1;var currentPosition=1;var currentPlanetType=1;var targetGalaxy=1;var targetSystem=1;var targetPosition=1;var defaultTargetGalaxy=1;var defaultTargetSystem=1;var defaultTargetPosition=1;var speed=0;var holdingTime=0;var metal=0;var crystal=0;var deuterium=0;var currentDeuterium=0;var returnLink="";var checkUrl="";var colonizationID=0;var missionNone=null;var missionUnionattack=null;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;var cargoLeft=0;var locaAllPlanet="";var locaAllMoon="";var locaAllDebris="";var storageCapacity=0;var probeStorageCapacity=0;var probeCompleteConsumption=0;var metal=0;var crystal=0;var deuterium=0;var distance=5;var duration=0;var consumption=0;var cargoSpace=0;/* @TODO-merge <- old -> 6.7.2*/var cargoCapacity=0;var tankSpace=0;var fuelCapacity=0;var metalOnPlanet=0;var crystalOnPlanet=0;var deuteriumOnPlanet=0;var returnLink="";var missionHold=null;var missionExpedition=null;var durationAKS=0;var prioMetal;var prioCrystal;var prioDeuterium;var isAggressiveMission=false;function getDistance(){var diffGalaxy;var diffSystem;var diffPlanet;var diff2;diffGalaxy=Math.abs(currentGalaxy-targetGalaxy);diffSystem=Math.abs(currentSystem-targetSystem);diffPlanet=Math.abs(currentPosition-targetPosition);if(diffGalaxy!=0){diff2=Math.abs(diffGalaxy-maxGalaxy);if(DONUT_GALAXY==1&&diff2<diffGalaxy){return diff2*20000;}else{return diffGalaxy*20000;}}else if(diffSystem!=0){diff2=Math.abs(diffSystem-maxSystem);if(DONUT_SYSTEM==1&&diff2<diffSystem){return diff2*5*19+2700;}else{return diffSystem*5*19+2700;}}else if(diffPlanet!=0){return diffPlanet*5+1000;}else{return 5;}}function getDuration(){return Math.round((35000/speed*Math.sqrt(distance*10/maxSpeed)+10)/speedFactor);}function getConsumption(onlyID){var consumptionCounter=0;var holdingConsumption=0;var countedShips=0;var speedValue=Math.max(1,duration*speedFactor-10);for(i=0,maxI=shipIDs.length;i<maxI;i++){if(onlyID==0||onlyID==null||shipIDs[i]==onlyID){countedShips++;shipSpeedValue=35000/speedValue*Math.sqrt(distance*10/speeds[i]);holdingConsumption+=completeConsumptions[i]*holdingTime;consumptionCounter+=completeConsumptions[i]*distance/35000*(shipSpeedValue/10+1)*(shipSpeedValue/10+1);}}if(countedShips>0){consumptionCounter=Math.round(consumptionCounter)+1;if(holdingTime>0){consumptionCounter+=Math.max(Math.floor(holdingConsumption/10),1);}//consumptionCounter = Math.ceil(Math.round(consumptionCounter * fleetDeutSaveFactor));
return consumptionCounter;}else{return 0;}}function getFreeStorage(){return cargoCapacity;/* @TODO-merge from 6.7.2*/ //return storageCapacity;
}function updateVariables(){if(currentPage=="fleet2"){prepareVariables();}distance=getDistance();duration=getDuration();consumption=getConsumption();cargoSpace=getFreeStorage();cargoLeft=cargoSpace-metal-crystal-deuterium;refreshFormData();}function refreshFormData(){$("#duration").html(formatTime(duration)+" h");$("#distanceValue").html(tsdpkt(distance));styleClass=cargoSpace<0?"overmark":"undermark";$("#storage").html("<span class=\""+styleClass+"\">"+tsdpkt(cargoSpace)+"</span>");/* @TODO-merge old?    styleClass = ((consumption > tankSpace) || (consumption > $('#resources_deuterium').text().replace(/\./g,''))) ? "overmark" : "undermark";

    $("#consumption").html("<span class=\"" + styleClass + "\">" + tsdpkt(consumption) + " (" + Math.ceil(100 * consumption/tankSpace) + "%)</span>");
*/styleClass=consumption>fuelCapacity||consumption>$('#resources_deuterium').text().replace(/\./g,'')?"overmark":"undermark";$("#consumption").html("<span class=\""+styleClass+"\">"+tsdpkt(consumption)+" ("+Math.ceil(100*consumption/fuelCapacity)+"%)</span>");styleClass=cargoLeft<0?"overmark":"undermark";$("#remainingresources").html("<span class=\""+styleClass+"\">"+tsdpkt(cargoLeft)+"</style>");$('.bar_container').data('currentAmount',cargoSpace-cargoLeft);$('.bar_container').data('capacity',cargoSpace);refreshBars('bar_container','filllevel_bar');setTType();if(currentPage=="fleet2")modifyPlanetName();checkOk();}function modifyPlanetName(){newName=getOwnName();if(newName!=""){$("#targetPlanetName").html(newName);$("#statusTarget").html(newName);}hideStatusBar();}function checkOk(){switch(currentPage){case"fleet2":if(currentGalaxy==$("#galaxy").val()&&currentSystem==$("#system").val()&&currentPosition==$("#position").val()&&currentPlanetType==$("#type").val()||$("#galaxy").val()==""||$("#system").val()==""||$("#position").val()==""||consumption>currentDeuterium||consumption>fuelCapacity/* @TODO-merge old? tankSpace*/||cargoSpace<0){validated=false;$("#continue").attr("class","off");}else{validated=true;$("#continue").attr("class","on");}break;case"fleet3":if(isMissionValid()&&cargoLeft>=0){validated=true;$("#start").attr("class","on");}else{validated=false;$("#start").attr("class","off");}break;}}/**
 * Object.assign polyfill
 * @see https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill
 */if(typeof Object.assign!=="function"){Object.assign=function(target){if(target==null){throw new TypeError("Cannot convert undefined or null to object");}target=Object(target);for(var i=1;i<arguments.length;i++){var source=arguments[i];if(source!=null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}}return target;};}/**
 * Number.isInteger polyfill
 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger#Polyfill
 */if(typeof Number.isInteger!=="function"){//noinspection JSPrimitiveTypeWrapperUsage
Number.isInteger=function(number){return typeof number==="number"&&isFinite(number)&&number>-9007199254740992&&number<9007199254740992&&Math.floor(number)===number;};}var Formatter={// #################################################################################################################
// ##  DATE, TIME & PERIOD  ########################################################################################
// #################################################################################################################
/**
     * Human-readable time units
     */"timeUnits":{"second":1,"minute":60,"hour":60*60,"day":24*60*60,"week":7*24*60*60},/**
     * Format seconds to human readable time (weeks, days, hours, minutes, seconds)
     *
     * @param {int} seconds
     * @param {Array} options
     * @returns {string}
     */"secondsToTime":function(seconds,options){var defaults={"segments":-1,"delimiter":" ","units":{"weeks":"w","days":"d","hours":"h","minutes":"m","seconds":"s"},"now":"now"};options=Object.assign(defaults,options);if(!Number.isInteger(seconds)){throw"Integer expected for parameter seconds";}if(seconds<=0){return options.now;}var time={"weeks":Math.floor(seconds/Formatter.timeUnits.week),"days":Math.floor(seconds%Formatter.timeUnits.week/Formatter.timeUnits.day),"hours":Math.floor(seconds%Formatter.timeUnits.day/Formatter.timeUnits.hour),"minutes":Math.floor(seconds%Formatter.timeUnits.hour/Formatter.timeUnits.minute),"seconds":seconds%Formatter.timeUnits.minute};var formattedTime=[];for(var segment in time){if(time[segment]>0&&(options.segments==-1||formattedTime.length<options.segments)){formattedTime.push(time[segment]+options.units[segment]);}}return formattedTime.join(options.delimiter);},/**
     * Format seconds to period string (PDTHMS)
     *
     * @param {int} seconds
     * @returns {string}
     */"secondsToPeriod":function(seconds){if(!Number.isInteger(seconds)){throw"Integer expected for parameter seconds";}if(seconds<=0){return"PT0H0M0S";}var period={"days":{"value":Math.floor(seconds/Formatter.timeUnits.day),"unit":"D"},"hours":{"value":Math.floor(seconds%Formatter.timeUnits.day/Formatter.timeUnits.hour),"unit":"H"},"minutes":{"value":Math.floor(seconds%Formatter.timeUnits.hour/Formatter.timeUnits.minute),"unit":"M"},"seconds":{"value":seconds%Formatter.timeUnits.minute,"unit":"S"}};var formattedPeriodDays=[],formattedPeriodTime=[];for(var segment in period){if(period[segment].value>0){if(segment=="days"){formattedPeriodDays.push(period[segment].value+period[segment].unit);}else{formattedPeriodTime.push(period[segment].value+period[segment].unit);}}}return"P"+formattedPeriodDays.join("")+(formattedPeriodTime.length>0?"T"+formattedPeriodTime.join(""):"");},// #################################################################################################################
// ##  NUMBER ######################################################################################################
// #################################################################################################################
/**
     * Format number to string
     *
     * @param {number} number
     * @param {Array} options
     * @returns {string}
     */"numberToString":function(number,options){var NUMBER_PRECISION_MINIMUM=0;var NUMBER_PRECISION_MAXIMUM=3;var NUMBER_TRANSFORM_ROUND=1;var NUMBER_TRANSFORM_CEIL=2;var NUMBER_TRANSFORM_FLOOR=3;/**
         * Round fractions up or down with precision
         *
         * @param {number} number
         * @param {int} precision
         * @returns {number}
         */var round=function(number,precision){if(typeof number!=="number"){throw"Numeric expected for parameter number";}if(!Number.isInteger(precision)){throw"Integer expected for parameter precision";}if(precision<=0){return Math.round(number);}return Math.round(number*Math.pow(10,precision))/Math.pow(10,precision);};/**
         * Round fractions up with precision
         *
         * @param {number} number
         * @param {int} precision
         * @returns {number}
         */var ceil=function(number,precision){if(typeof number!=="number"){throw"Numeric expected for parameter number";}if(!Number.isInteger(precision)){throw"Integer expected for parameter precision";}if(precision<=0){return Math.ceil(number);}return Math.ceil(number*Math.pow(10,precision))/Math.pow(10,precision);};/**
         * Round fractions down with precision
         *
         * @param {number} number
         * @param {int} precision
         * @returns {number}
         */var floor=function(number,precision){if(typeof number!=="number"){throw"Numeric expected for parameter number";}if(!Number.isInteger(precision)){throw"Integer expected for parameter precision";}if(precision<=0){return Math.floor(number);}return Math.floor(number*Math.pow(10,precision))/Math.pow(10,precision);};/**
         * Transform number using round, ceil or floor
         *
         * @param {number} number
         * @param {int} mode
         * @param {int} precision
         * @returns {number}
         */var transformNumber=function(number,mode,precision){switch(mode){case NUMBER_TRANSFORM_ROUND:number=round(number,precision);break;case NUMBER_TRANSFORM_CEIL:number=ceil(number,precision);break;case NUMBER_TRANSFORM_FLOOR:number=floor(number,precision);break;}return number;};var defaults={"transform":NUMBER_TRANSFORM_ROUND,"precision":{"minimum":NUMBER_PRECISION_MINIMUM,"maximum":NUMBER_PRECISION_MAXIMUM},"separators":{"thousands":",","decimals":"."},"boundaries":{/*1000:           "K",*/1000000:"M",1000000000:"Bn"}};options=Object.assign(defaults,options);if(typeof number!=="number"){throw"Numeric expected for parameter number";}if(typeof options.precision==="undefined"||typeof options.precision.minimum==="undefined"){throw"Minimum precision not specified";}if(typeof options.precision==="undefined"||typeof options.precision.maximum==="undefined"){throw"Maximum precision not specified";}if(options.precision.minimum>options.precision.maximum){throw"Minimum precision larger than maximum precision";}var boundaries=Object.keys(options.boundaries).sort(function(a,b){return parseFloat(b)-parseFloat(a);});var unit="";for(var i=0;i<boundaries.length;i++){var boundary=parseInt(boundaries[i]);if(boundary===0){continue;}if(Math.abs(number)>=boundary){number/=boundary;unit=options.boundaries[boundaries[i]];break;}}var precision=options.precision.maximum;while((number=transformNumber(number,options.transform,precision))==transformNumber(number,options.transform,precision-1)&&precision>options.precision.minimum){precision--;}number=number.toFixed(precision);var numberParts=number.toString().split(".");numberParts[0]=numberParts[0].replace(/\B(?=(\d{3})+(?!\d))/g,options.separators.thousands);return numberParts.join(options.separators.decimals)+unit;}};function Graveyard(cfg){this.loca=cfg.loca;this.initServerSelect(cfg);}Graveyard.prototype.onAjaxDone=function(){this.loadingIndicator.hide();//@todo handle error
};Graveyard.prototype.onAjaxError=function(){};Graveyard.prototype.updateToken=function(){};Graveyard.prototype.initCommon=function(cfg){this.serverWrapper=$('.graveyard #serverNumbers');this.loadingIndicator=this.serverWrapper.ogameLoadingIndicator();this.serverLanguage=$('.graveyard #serverLanguage');this.serverNumber=$('.graveyard #serverNumber');this.serverNumbers=null;this.selectedLanguage=null;this.serverSelection=$('#serverSelection');this.table=this.serverLanguage.closest('.og-table');this.availableLanguages=cfg.availableLanguages;this.urlServerIds=cfg.urlServerIds||null;this.urlIsReady=cfg.urlIsReady||null;this.urlSubmitExodus=cfg.urlSubmitExodus||null;this.isReadyForExodus=cfg.isReadyForExodus||false;this.serverAmount=0;};Graveyard.prototype.initServerSelect=function(cfg){this.initCommon(cfg);this.dropDownLanguageSelect=$('.graveyard #serverLanguage');this.dropDownServerSelect=$('.graveyard #serverNumber');this.exodusSubmitButton=$('.graveyard #submitExodus');this.exodusSubmitButton.on('click',this.onClickExecute.bind(this));this.dropDownLanguageSelect.on('change',this.onChangeServerLanguage.bind(this));this.dropDownServerSelect.on('change',this.onChangeServerNumber.bind(this));this.resetLanguage();this.refreshLanguage();};Graveyard.prototype.onChangeServerLanguage=function(e){this.selectedLanguage=this.dropDownLanguageSelect.val();this.refreshLanguage();this.fetchServerNumbers();};Graveyard.prototype.onChangeServerNumber=function(e){this.selectedServer=this.dropDownServerSelect.val();this.refreshServer();};Graveyard.prototype.onClickExecute=function(e){e.stopPropagation();e.preventDefault();let serverName=this.dropDownServerSelect.find('option[value="'+this.selectedServer+'"]').html();this.loadingIndicator.show();let that=this;errorBoxDecision(this.loca.LOCA_EXODUS_TRANSFER_QUESTION_TITLE,this.loca.LOCA_EXODUS_TRANSFER_QUESTION.replace('#uniname#',serverName),this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){let data={serverNumber:parseInt(that.selectedServer),serverLanguage:that.selectedLanguage};$.post(that.urlSubmitExodus,data,that.handleSubmitExodusResponse.bind(that)).done(that.onAjaxDone.bind(that));},function(){that.loadingIndicator.hide();});};Graveyard.prototype.fetchServerNumbers=function(){this.loadingIndicator.show();let data={language:this.selectedLanguage};$.getJSON(this.urlServerIds,data,this.onFetchServerNumbers.bind(this)).done(this.onAjaxDone.bind(this));};Graveyard.prototype.checkIsReady=function(){let data={};if(this.serverAmount>0){$.getJSON(this.urlIsReady,data,this.onCheckIsReady.bind(this)).done(this.onAjaxDone.bind(this));}};Graveyard.prototype.setLanguage=function(language){let languageOld=this.selectedLanguage;this.selectedLanguage=language;if(this.selectedLanguage!==languageOld){this.resetLanguage();this.refreshLanguage();this.fetchServerNumbers();this.resetServer();this.checkIsReady();}};Graveyard.prototype.setServer=function(number){let serverOld=this.selectedServer;this.selectedServer=number;if(this.selectedServer!==serverOld){this.resetServer();this.refreshServer();this.checkIsReady();}};Graveyard.prototype.refreshLanguage=function(){this.dropDownLanguageSelect.find('option').removeAttr('selected');if(this.selectedLanguage){this.dropDownLanguageSelect.find('option[value="'+this.selectedLanguage+'"]').attr('selected','selected');}};Graveyard.prototype.refreshServer=function(){this.dropDownServerSelect.find('option').removeAttr('selected');if(this.selectedServer){this.dropDownServerSelect.find('option[value="'+this.selectedServer+'"]').attr('selected','selected');}};Graveyard.prototype.resetLanguage=function(){this.setLanguage(this.getFirstLanguage());};Graveyard.prototype.resetServer=function(){this.setServer(this.selectedServer);};Graveyard.prototype.getFirstLanguage=function(){return this.availableLanguages[0];};Graveyard.prototype.onCheckIsReady=function(data){this.isReadyForExodus=data.isReady;if(this.isReadyForExodus&&this.selectedServer!==0){this.exodusSubmitButton.removeClass('disabled');}else{this.exodusSubmitButton.addClass('disabled');}};Graveyard.prototype.handleSubmitExodusResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';if(status==='success'){fadeBox(data.message,false);window.location=data.redirectUrl;}else{this.displayErrors(data.errors);}};Graveyard.prototype.displayErrors=function(errors){// only display the first error
let error=errors[0]||undefined;if(error){fadeBox(error.message,true);}};Graveyard.prototype.onFetchServerNumbers=function(data){if(data.serverNumbers.length===0){if(data.serverNumbers.length===0){this.serverSelection.html('<span id="noServer">'+this.loca.LOCA_EXODUS_NO_SERVER_AVAILABLE+'</span>');}if(this.isReadyForExodus===false){this.serverSelection.html('<span id="noServer">'+this.loca.LOCA_EXODUS_RESTRICTION_NOT_FULFILLED+'</span>');}this.exodusSubmitButton.addClass('disabled');this.serverAmount=0;this.selectedServer=0;return;}else{this.serverSelection.html('<select id="serverNumber" type="text" class="og-input" name="serverNumber"></select>');this.exodusSubmitButton.removeClass('disabled');this.dropDownServerSelect=$('.graveyard #serverNumber');this.dropDownServerSelect.on('change',this.onChangeServerNumber.bind(this));this.serverAmount=data.serverNumbers.length;}this.selectedServer=data.serverNumbers[0].number;this.serverNumbers=data.serverNumbers;var select=this.dropDownServerSelect;if(select.prop){var options=select.prop('options');}else{var options=select.attr('options');}$('option',select).remove();let htmlOptions='';$.each(data.serverNumbers,function(key,server){options[options.length]=new Option(server.name,server.number);htmlOptions+='<option value="'+server.number+'">'+server.name+'</option>';});this.dropDownServerSelect.ogameDropDown('destroy');this.dropDownServerSelect.html('');this.dropDownServerSelect.html(htmlOptions).ogameDropDown();};/**
 * getElementById-Funktion mit Cache
 */var DOM_GET_ELEMENT_BY_ID_CACHE=[];function getElementByIdWithCache(uid){if(!DOM_GET_ELEMENT_BY_ID_CACHE[uid]){DOM_GET_ELEMENT_BY_ID_CACHE[uid]=document.getElementById(uid);}return DOM_GET_ELEMENT_BY_ID_CACHE[uid];}/**
 *  returns a formated number like php number_format()
 *
 * @see http://de3.php.net/number_format
 */function number_format(number,decimals,dec_point,thousands_sep){dec_point=dec_point||LocalizationStrings['decimalPoint'];thousands_sep=thousands_sep||LocalizationStrings['thousandSeperator'];var exponent="";var numberstr=number.toString();var eindex=numberstr.indexOf("e");if(eindex>-1){exponent=numberstr.substring(eindex);number=parseFloat(numberstr.substring(0,eindex));}if(decimals!=null){var temp=Math.pow(10,decimals);number=Math.round(number*temp)/temp;}var sign=number<0?"-":"";var integer=(number>0?Math.floor(number):Math.abs(Math.ceil(number))).toString();var fractional=number.toString().substring(integer.length+sign.length);dec_point=dec_point!=null?dec_point:".";fractional=decimals!=null&&decimals>0||fractional.length>1?dec_point+fractional.substring(1):"";if(decimals!=null&&decimals>0){for(i=fractional.length-1,z=decimals;i<z;++i)fractional+="0";}thousands_sep=thousands_sep!=dec_point||fractional.length==0?thousands_sep:null;if(thousands_sep!=null&&thousands_sep!=""){for(i=integer.length-3;i>0;i-=3)integer=integer.substring(0,i)+thousands_sep+integer.substring(i);}return sign+integer+fractional+exponent;}function gfNumberGetHumanReadable(value,shortForm,precision){value=Math.floor(value);shortForm=shortForm||false;var unit='';var precision=precision||3;if(shortForm){if(value>=1000000000){unit=LocalizationStrings['unitMilliard'];value=value/1000000000;}else if(value>=1000000){unit=LocalizationStrings['unitMega'];value=value/1000000;}}floorWithPrecision=function(value,precision){return Math.floor(value*Math.pow(10,precision))/Math.pow(10,precision);};value=floorWithPrecision(value,precision);while(precision>=0){if(floorWithPrecision(value,precision-1)!=value){break;}precision=precision-1;}return number_format(value,precision,LocalizationStrings['decimalPoint'],LocalizationStrings['thousandSeperator'])+unit;}function getNumberFormatShort(value,precision){if(typeof precision=='undefined'){precision=0;}value=Math.floor(value);var unit='';if(value>=1000000000){unit=LocalizationStrings['unitMilliard'];value=value/1000000000;}if(value>=1000000){unit=LocalizationStrings['unitMega'];value=value/1000000;}if(value>=1000){unit=LocalizationStrings['unitKilo'];value=value/1000;}return number_format(value,precision,LocalizationStrings['decimalPoint'],LocalizationStrings['thousandSeperator'])+unit;}function createExpireTime(timestamp){var date=new Date();timestamp=timestamp*1000;date.setTime(timestamp);return date;}function initHighscore(){$("a.navButton, a.subnavButton").click(function(){var type=$(this).attr('rel');var $parent=$(this).parent();var searchRelString="";if($parent.attr('id')=='typeButtons'){$("#typeButtons > a.active").removeClass('active');}else if($parent.attr('id')=='categoryButtons'){$('#categoryButtons > a.active').removeClass('active');$("#typeButtons a.active").each(function(){type=$(this).attr('rel');});}if(searchRelId!=null&&$parent.attr('id')=='typeButtons'||$parent.attr('id')=='subnav_fleet'){searchRelString="&searchRelId="+searchRelId;}$(".subnavButton[rel!="+type+"]").removeClass('active');$('#stat_list_content').html(LocalizationStrings['loading']);$(this).addClass('active');var category=$("#categoryButtons > a.active").attr('rel');var url=highscoreContentUrl+'&category='+category+'&type='+type+searchRelString;if(($parent.attr('id')=='typeButtons'||$(this).hasClass('subnavButton'))&&searchSite!=site){url=url+"&site="+site;}removeTooltip(getTooltipSelector('#highscoreContent #ranks'));ajaxSubmit(url,'#send','#stat_list_content',initHighscoreContent);if($('.navButton.active').attr('rel')==1){$('#highscoreContent .header h2').text(highscoreLoca.playerHighscore);}else{$('#highscoreContent .header h2').text(highscoreLoca.allianceHighscore);}});$(".stat_filter").click(function(){var subnav=$(this).attr('id');$('.subnav').hide();$('#subnav_'+subnav).fadeIn('slow');});// scroll to top buttons
var threshold=$("#ranks").offset().top;var scrollToTopButton=$("#scrollToTop");$(window).unbind('scroll.highscoreTop').bind('scroll.highscoreTop',function(e){var scrollTop=$(this).scrollTop();if(scrollTop>threshold){scrollToTopButton.css('visibility','visible');}else{scrollToTopButton.css('visibility','hidden');}});$(document).undelegate('.scrollToTop','click').delegate('.scrollToTop','click',function(){$('html, body').animate({scrollTop:0},50);});}function initHighscoreContent(){if(userWantsFocus){if($("#position"+searchPosition).length>0){$('html, body').animate({scrollTop:Math.max(0,$("#position"+searchPosition).offset().top-200)},1000);}}$(".changeSite").change(function(){var value=$(this).val();$("#stat_list_content").html('<div class="ajaxLoad">'+LocalizationStrings.loading+'</div>');ajaxCall(highscoreContentUrl+'&category='+currentCategory+'&type='+currentType+'&site='+value,'#stat_list_content',initHighscoreContent);});// scroll to top buttons
var scrollToTopButton=$("#scrollToTop");var positionCell=$("#ranks thead .score");function positionScrollButton(){if(positionCell.length){scrollToTopButton.css('left',positionCell.offset().left);}}positionScrollButton();$(window).unbind('resize.highscoreTop').bind('resize.highscoreTop',positionScrollButton);}/**
 * Save the current sort order to the cookie
 *
 * @param string destination
 */function saveImperiumOrder(destination,isMoon){var typeName="impSortOrder";if(isMoon){typeName="impSortOrderMoon";}$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:typeName,planets:$(destination).sortable('toArray')}});}/**
 * Reset the current sort order
 *
 */function clearImperiumOrder(){$.ajax({url:saveUrl,method:"post",dataType:"json",data:{ajax:1,type:'reset'},success:function(data){if(!data.error){location.reload();}}});}/**
 * Generates the summary column for the imperium overview table
 *
 * @see createImperiumHtml()
 * @param array data
 * @return string
 */function createSummaryHtml(data){// Some variables we use
var content='';var planet=null;var value=0;var i=0;var key='';content=content+'<div class="planetHead">'+'<div class="planetname">'+data.translations.summary+'</div>'+'<div class="planetImg"><img src="//gf3.geo.gfsrv.net/cdn8a/7efb2e73ca11d2344bbed43668da10.jpg"/></div>'+'<div class="planetData">'+'<ul>'+'<li class="coords textLeft"></li>'+'<li class="fields textRight"></li>'+'</ul>'+'</div>'+'<div class="clearfloat"/>'+'</div>';// Generate the content
for(group in data.groups){content=content+'<div class="row" />'+'<div class="values '+group+' group'+group+'">';for(i=0;key=data.groups[group][i];i++){if(data.translations.planets[key]==null){continue;}var production={hourly:0,daily:0,weekly:0};if(key=='name'){value=data.translations.summary;}else{value=0;if(group=="research"){if(!isNaN(data.planets[0][key])){value=data.planets[0][key];}}else{$.each(data.planets,function(){planet=this;if(!isNaN(planet[key])){value=value+parseInt(planet[key]);if(group=="supply"&&!isNaN(planet['production']['hourly'][key-1])){production.hourly+=planet['production']['hourly'][key-1];production.daily+=planet['production']['daily'][key-1];production.weekly+=planet['production']['weekly'][key-1];}}});}}if(group=="supply"||group=="facilities"){value="&#x00F8; "+tsdpkt(round(value/data.planets.length,1));}else if(group=="items"){value="&nbsp;";}else{value=tsdpkt(value);}if(group=="supply"&&key!="name"&&production.hourly>0){var tooltip='<table>'+"<tr><td>"+data.translations.production.hourly+':</td><td style=&quot;text-align: right;&quot;>'+tsdpkt(production.hourly)+"</td></tr>"+"<tr><td>"+data.translations.production.daily+':</td><td style=&quot;text-align: right;&quot;>'+tsdpkt(production.daily)+"</td></tr>"+"<tr><td>"+data.translations.production.weekly+':</td><td style=&quot;text-align: right;&quot;>'+tsdpkt(production.weekly)+"</td></tr></table>";tooltip=tooltip.replace(/</,"&lt;").replace(/>/,"&gt;");content=content+'<div class="tooltipRight '+key+'" title="'+tooltip+'">'+value+'</div>';}else{content=content+'<div class="'+key+'">'+value+'</div>';}}content=content+'</div>';}// Add the outer div to the output
content='<div id="planet0" class="planet summary">'+content+'</div>';return content;}/**
 * Generates the first header column for the imperium table
 *
 * @see createImerpiumHtml()
 * @param array data
 * @return string
 */function createHeaderHtml(data){// Some variables we use 
var content='';var i=0;var key='';content=content+'<div id="wrapTL">'+'<div id="tab-left">'+'<a id="planetsTab" href="javascript:void(0);" class="active" title="">'+'<span>'+data.translations['planetsTab']+'</span>'+'</a>'+'<a id="moonsTab" href="javascript:void(0);" title="" class="">'+'<span>'+data.translations['moonsTab']+'</span>'+'</a>'+'</div>'+'</div>';// Generate the content
for(group in data.groups){content=content+'<div id="'+group+'" class="firstCat headers '+group+' headers'+group+'" group="'+group+'">'+'<h3 class="open">'+'<span>'+data.translations.groups[group]+'</span>'+'</h3>'+'<ul class="secondCat '+group+' group'+group+'">';for(i=0;key=data.groups[group][i];i++){if(data.translations.planets[key]==null){continue;}content+='<li class="'+key+'">';if(data.translations.planets[key+'_full']!=data.translations.planets[key]){content+='<span class="tooltipLeft" title="'+data.translations.planets[key+'_full']+'">'+data.translations.planets[key]+'</span>';}else{content+='<span>'+data.translations.planets[key]+'</span>';}content+='</li>';}content=content+'</ul>'+'</div>';}// Add the outer div to the output
content='<div id="empireTab">'+'<div class="wrapTab">'+'<div class="tab-part01"></div>'+'<h2>'+data.translations.header+'</h2>'+'<span class="reset"><img src="//gf2.geo.gfsrv.net/cdnab/f805c477d15ae3131b7c39c7d70e48.gif" width="16" height="16"><a href="javascript:void(0);" onClick="clearImperiumOrder(); return false;">'+data.translations.reset+'</a></span>'+'<div class="wrapCorner"></div>'+'<br class="clearfloat"/>'+'</div>'+'</div>'+'<div class="header">'+content+'</div>';// Return the content
return content;}/**
 * Generates all the planet columns for the imperium overview table
 *
 * @see createImperiumHtml()
 * @param array data
 * @return string
 */function createPlanetsHtml(data){// Some basic variables we use
var planet='';var shortname='';var content='';var headerKey='';var newContent='';var i=0;var key='';// Iterate over the planets
$.each(data.planets,function(){planet=this;content='';headerKey='';shortname=planet.name.length>13?planet.name.substr(0,11)+'...':planet.name;content+='<div class="planetHead">';if(planet.name!=shortname){content+='<div class="planetname tooltip" title="'+planet.name+'">'+shortname+'</div>';}else{content+='<div class="planetname">'+shortname+'</div>';}if(isMobile){content+='<div class="planetImg"><img class="'+planet.border+'" src="'+planet.image+'"/></div>'+'<div class="planetData">'+'<div class="planetDataTop odd">'+'<ul>'+'<li class="coords textLeft"><a class="dark_highlight_tablet" href="'+planet.coordinatesLink+'" >'+planet.coordinates+'</a></li>'+'<li class="coords">'+'<span class="dark_highlight_tablet energy tooltipRight" title="'+(planet.type==3?planet.diameterTooltip:planet.energyTooltip)+'">'+(planet.type==3?"\u2300: "+planet.diameter:planet.energyDescr+planet.energy)+'</span>'+'</li>'+'</ul>'+'</div>'+'<div class="planetDataTop">'+'<ul class="planet_data_2">'+'<li class="fields textLeft">'+planet.fieldUsed+'/'+planet.fieldMax+'</li>'+'<li class="fields textLeft">'+planet.temperature+'</li>'+'</ul>'+'</div>'+'</div>'+'<div class="clearfloat"/>'+'</div>';}else{content+='<div class="planetImg"><img class="'+planet.border+'" src="'+planet.image+'"/></div>'+'<div class="planetData">'+'<div class="planetDataTop odd">'+'<ul>'+'<li class="coords textLeft"><a href="'+planet.coordinatesLink+'" >'+planet.coordinates+'</a></li>'+'<li class="fields textRight">'+planet.fieldUsed+'/'+planet.fieldMax+'</li>'+'</ul>'+'</div>'+'<div class="planetDataTop">'+'<ul>'+'<li class="coords textLeft">'+(planet.type==3?planet.diameterDescr:planet.energyDescr)+'</li>'+'<li class="coords textRight">'+(planet.type==3?planet.diameter:planet.energy)+'</li>'+'</ul>'+'</div>'+'<div class="planetDataBottom odd">'+'<ul>'+'<li class="fields textCenter">'+planet.temperature+'</li>'+'</ul>'+'</div>'+'</div>'+'<div class="clearfloat"/>'+'</div>';}// Generate the content
for(var group in data.groups){content=content+'<div class="row" />'+'<div class="values '+group+' group'+group+'">';for(i=0;key=data.groups[group][i];i++){key=String(key);// We have some special html for this!
if(planet[key+'_html']!=null){key=key+'_html';}// Define the header key
headerKey=key;if(key.substring(key.length-5)=='_html'){headerKey=key.substring(0,key.length-5);}content=content+'<div class="'+headerKey+'">'+planet[key]+'</div>';}content=content+'</div>';}// And add the planet to the planetlist
newContent=newContent+'<div id="planet'+this.id+'" class="planet">'+content+'</div>';});return newContent;}/**
 * Generates the imperium overview table
 *
 * @param string destination
 * @param string loading
 * @param array data
 */function createImperiumHtml(destination,loading,data,isMoon){// Set width to wrapper
var planetCount=0;if(typeof data.planets!="undefined"){planetCount=data["planets"].length;}var wrapperWidth=345+planetCount*165;$("#mainWrapper").attr("style","width: "+wrapperWidth+"px");// Show the loading "screen"
$(loading).show();// Lets build up the new content
var newContent=createHeaderHtml(data)+'<div class="planetWrapper">'+createPlanetsHtml(data)+createSummaryHtml(data)+'</div>'+'<br class="clearfloat"/>';// Update the destination with the new content
$(destination).append(newContent);// Finally we need the whole planetlist to be sortable
$(destination+' .planetWrapper').sortable({start:function(){removeTooltip(getTooltipSelector());},update:function(){saveImperiumOrder(destination+' .planetWrapper',isMoon);}}).disableSelection();// Make the groups clickable and load the toggle state
for(group in data.groups){$(destination+' .headers'+group).click(function(){var selector=destination+' .group'+$(this).attr('group');var selectorHeader="#"+$(this).attr('group')+" h3";$(selector).toggle();$(selectorHeader).removeClass('openhover').removeClass('closehover').removeClass('close').removeClass('open');if($(selector).attr('style').toLowerCase().substr(9,4)=='none'){$(selectorHeader).addClass("close");$.cookie('impToggleState'+$(this).attr('group'),'1',{expires:365});}else{$(selectorHeader).addClass("open");$.cookie('impToggleState'+$(this).attr('group'),'0',{expires:365});}});var cookie=$.cookie('impToggleState'+group);if(cookie!=null&&cookie=='1'){$("#"+group+" > h3").removeClass('open');$("#"+group+" > h3").addClass('close');$(destination+' .group'+group).toggle();}}// Hide the loading "screen"
$(loading).hide();var summaryIndex=$.inArray(0,empireOrder);if(summaryIndex>-1){$('.planetWrapper .planet:eq('+summaryIndex+'):not(:last-child)').before($("#planet0"));}// Load Tooltips
initTooltips();}function displayMessage(response){// bei Upgrades steht in der response nur 1 oder nichts... nichts was man anzeigen sollte. also nur reload
location.reload(true);// true == NICHT aus dem Cache ^^
}function doUpgrade(techID,planetID,modus,listID,showSlotWarning){if(forcedToVacation){errorBoxNotify(LocalizationStrings.error,LocalizationStrings.forcedVacationWarning,LocalizationStrings.ok);return;}var params={};params.modus=modus;params.techid=techID;params.listid=listID;params.planet=planetID;var warning=LocalizationStrings.lastSlotWarningPlanet;var url=upgradeUrl;if(modus==2){url+='&token='+cancelBuildingToken;}if(planetType==1){warning=LocalizationStrings.lastSlotWarningMoon;}if(showSlotWarning){errorBoxDecision(LocalizationStrings.attention,warning,LocalizationStrings.yes,LocalizationStrings.no,function(){$.post(url,params,displayMessage);});}else{$.post(url,params,displayMessage);}}function initEmpire(){initConnectionErrorFunction();$(".secondCat").each(function(){$(this).find('li:last').addClass("catbox-end");});$('.values').each(function(){if(!$(this).hasClass('groupitems')){$(this).find('div:even').addClass('even');$(this).find('div:odd').addClass('odd');$(this).find('div:last').addClass('box-end');}if($(this).children().hasClass('equipment')){$(this).children('.equipment').addClass('box-end');}});$("#settings li:last").addClass("set-end");$('.header h3').hover(function(){$(this).addClass($(this).attr('class')+'hover');},function(){$(this).removeClass('openhover').removeClass('closehover');});$('.header h3').click(function(){$(this).removeClass('openhover').removeClass('closehover');var actualClass=$(this).attr('class');if(actualClass=="open"){$(this).addClass("close");}else{$(this).addClass("open");}$(this).removeClass(actualClass);});$(".planet").hover(function(){$(this).addClass("move");},function(){$(this).removeClass("move");});$('.values div img').hover(function(){$(this).addClass('imghover');},function(){$(this).removeClass('imghover');});$("#planetsTab").click(function(){window.location.href=empireUrl+"&planetType=0";});if(moonCount>0){$("#moonsTab").click(function(){window.location.href=empireUrl+"&planetType=1";});}else{$("#moonsTab").addClass('nomoons');}if(planetType==1){$("#planetsTab").removeClass('active');$("#moonsTab").addClass('active');}initBuffBarEmpire();}function initBuffBarEmpire(){var listOfEmpireItems=$('.empireItems');listOfEmpireItems.anythingSlider({resizeContents:false,/* der inhalt hat die richtige groesse, basta! */buildNavigation:false,/* keine navigation zu einzelnen seiten */buildStartStop:false,/* keine start oder stop buttons */infiniteSlides:false,/* round robin abschalten */stopAtEnd:true/* zurueckspulen verhindern */});listOfEmpireItems.removeClass('hidden');}function showGoogleAnalytics(){var gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";document.write(decodeURI("%3Cscript src='"+gaJsHost+"google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));try{var pageTracker=_gat._getTracker("UA-11968132-1");pageTracker._setDomainName(".ogame.gameforge.com");pageTracker._trackPageview();}catch(err){}}function changeSetting(key,value,success,error,showError){$.ajax({type:'POST',url:changeSettingsLink,dataType:'json',data:{token:changeSettingsToken,key:key,value:value},success:function(data){changeSettingsToken=data.newToken;if(data.message.length>0){fadeBox(data.message,data.error);}if(!data.error&&typeof success=='function'){success();}else if(data.error&&typeof error=='function'){error();}},error:function(data){if(typeof showError=='undefined'||showError){fadeBox(LocalizationStrings['error'],true);}if(data.error&&typeof error=='function'){error();}}});}function getOverlayText($thisObj){if($thisObj.hasClass('building')&&$thisObj.children().hasClass('build-faster-img')){return questionbuilding;}else if($thisObj.hasClass('building')&&$thisObj.children().hasClass('build-finish-img')){return questionbuilding;}else if($thisObj.hasClass('ship')&&$thisObj.children().hasClass('build-faster-img')){return questionship;}else if($thisObj.hasClass('ship')&&$thisObj.children().hasClass('build-finish-img')){return questionship;}else if($thisObj.hasClass('research')&&$thisObj.children().hasClass('build-faster-img')){return questionresearch;}else if($thisObj.hasClass('research')&&$thisObj.children().hasClass('build-finish-img')){return questionresearch;}}function getFastBuildPrice($thisObj){if($thisObj.hasClass('building')){return pricebuilding;}else if($thisObj.hasClass('research')){return priceresearch;}else if($thisObj.hasClass('ship')){return priceship;}}function getRedirectLink(params){var finalParams={};if(params!=undefined){for(var key in params){finalParams[key]=params[key];}return $.param.fragment($.param.querystring(window.location.href,finalParams),{});//Return witch anchor and added params
}else{return window.location.href.split('#')[0];//return url without anchor
}}function sendShips(order,galaxy,system,planet,planettype,shipCount){if(shipsendingDone==1){shipsendingDone=0;params={mission:order,galaxy:galaxy,system:system,position:planet,type:planettype,shipCount:shipCount,token:miniFleetToken};$.ajax(miniFleetLink,{data:params,dataType:"json",type:"POST",success:function(data){if(typeof data.newToken!="undefined"){miniFleetToken=data.newToken;}displayMiniFleetMessage(data.response);}});}}function sendShipsWithPopup(order,galaxy,system,planet,planettype,shipCount){params={mission:order,galaxy:galaxy,system:system,position:planet,type:planettype,shipCount:shipCount,token:miniFleetToken};$.ajax(miniFleetLink,{data:params,dataType:"json",type:"POST",success:function(data){if(typeof data.newToken!="undefined"){miniFleetToken=data.newToken;}fadeBox(data.response.message+' '+data.response.coordinates.galaxy+":"+data.response.coordinates.system+":"+data.response.coordinates.position,!data.response.success);}});}function outlawWarning(order,galaxy,system,planet,planettype,shipCount,callbackFunction){if(typeof callbackFunction!='function'){if(order==constants.espionage){callbackFunction=sendEspionageProbes;}else if(order==constants.missleattack){callbackFunction=openMissleLaunchBox;}}if(showOutlawWarning){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.outlawWarning,LocalizationStrings.yes,LocalizationStrings.no,callbackFunction);}else{callbackFunction();}function sendEspionageProbes(){sendShips(order,galaxy,system,planet,planettype,shipCount);}function openMissleLaunchBox(){openOverlay(missleAttackLink+'&galaxy='+galaxy+'&system='+system+'&position='+planet+'&planetType='+planettype,{modal:true});}}function initThousandSeparator(){$('.checkThousandSeparator').unbind('keyup.checkThousandSeparator').bind('keyup.checkThousandSeparator',function(event){if(event.which==8||event.which==46){var range=$(this).getSelection();var text=$(this).val();if(text.substr(range.start-1,1)==LocalizationStrings['thousandSeperator']){var value;if(event.which==8){value=text.substr(0,range.start-2)+text.substr(range.start-1);}else{value=text.substr(0,range.start)+text.substr(range.start+1);}formatNumber($(this),value);}}});}// overall index page
function initIndex(){initConnectionErrorFunction();timerHandler.appendCallback(function(){localTime=new Date();serverTime=new Date(localTime.valueOf()+timeDiff);$('.OGameClock').html(getFormatedDate(serverTime.getTime(),'[d].[m].[Y] <span>[H]:[i]:[s]</span>'));});$('select').ogameDropDown();$('#planet .slot').hover(function(){$(this).addClass('slot-hover');},function(){$(this).removeClass('slot-hover');});$('#eventboxFilled').hover(function(){$(this).addClass('eventboxHover');},function(){$(this).removeClass('qeventboxHover');});$(document).undelegate('a.build-faster','click').delegate('a.build-faster','click',function(){var $thisObj=$(this);if(darkMatter<getFastBuildPrice($thisObj)){errorBoxDecision(LocalizationStrings.error,LocalizationStrings.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return;}var referrerPage=$.deparam.querystring().page;errorBoxDecision(LocalizationStrings.notice,getOverlayText($thisObj),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:$thisObj.attr('rel'),data:{ajax:1,token:$thisObj.attr('token'),referrerPage:referrerPage},type:"POST",dataType:"json",error:function(){fadeBox(LocalizationStrings['error'],true);$thisObj.addClass('disabled');},success:function(data){activateToken=data.newToken;if(data.error){fadeBox(data.message,true);$thisObj.addClass('disabled');}else{location.href=getRedirectLink();}}});return false;});})// detail slides
.undelegate('.slideIn','click').delegate('.slideIn','click',function(){$(".slideIn").removeClass("active");var id=$(this).attr("ref");$("a[ref='"+id+"']").addClass("active");Tipped.hideAll();$('html, body').animate({scrollTop:0},500);gfSlider.slideIn(getElementByIdWithCache("detail"),id);}).undelegate('a.close_details','click').delegate('a.close_details','click',function(){if(window.gfSlider!==undefined){gfSlider.hide(getElementByIdWithCache('detail'));}});$("#banner_skyscraper a.close_details").click(function(){changeSetting("hideBanner",$(this).attr("ref"),function(){$("#banner_skyscraper").remove();});});var wreckfield=$("#wreckFieldCountDown");if(wreckfield){new simpleCountdown(wreckfield,wreckfield.data('duration'),null);}initHideElements();initOverlays();initThousandSeparator();initTooltips();initPlanetSorting();// for Tablets only
initRetinaImages();//just during the birthday events
initBDayEventHints();}function initPlanetSorting(){$("#planetList.sortable").sortable({start:function(){Tipped.hideAll();},stop:function(){Tipped.hideAll();changeSetting('customPlanetOrder',$(this).sortable('toArray'));}});if($('.lockPlanets').hasClass('closed')){$("#planetList.sortable").sortable('disable');}$('.lockPlanets').unbind('click').bind('click',function(){var $thisObj=$(this);changeSetting('planetOrderLocked',$thisObj.hasClass('open')?1:0,function(){var text;if($thisObj.hasClass('open')){$thisObj.removeClass('open').addClass('closed');$("#planetList.sortable").sortable('disable');text=LocalizationStrings.planetOrder.unlock;}else{$thisObj.removeClass('closed').addClass('open');$("#planetList.sortable").sortable('enable');text=LocalizationStrings.planetOrder.lock;}changeTooltip($thisObj,text);});});}function initHideElements(){$(document).undelegate('html','touchstart.hideElem click.hideElem').delegate('html','touchstart.hideElem click.hideElem',function(e){e.stopPropagation();if($(this).data('noclick')){return;}if(isMobile){var targetTagName=e.target.tagName.toUpperCase();if(!(targetTagName==='TEXTAREA'||targetTagName==='INPUT'||targetTagName==='SELECT')){document.activeElement.blur();}if(!$(e.target).parents('.markItUpHeader ul').length){$('.markItUpHeader ul ul').hide();}}else{if($(e.target).parents('.ui-dialog').length||$(e.target).parents('.tpd-tooltip').length){// don't hide overlays when click was inside overlay itself or a tooltip
// (tooltips might be part of the overlay even though they're technically located outside)
return;}var $overlayDivs=$('.overlayDiv');if(typeof $overlayDivs.data('uiDialog')!="undefined"){// schliesse auch die Dropdowns sofern vorhanden
var dropDowns=$overlayDivs.find('.markItUpDropMenu[id]');for(var i=0;i<dropDowns.length;++i){var $innerUl=$('body>ul[rel='+dropDowns[i].id+']');$innerUl.hide();}$overlayDivs.dialog('close');}}});}function initJumpgate(){$('select').ogameDropDown();$(".list tr:even").addClass("alt");$(document).undelegate('#jumpgateForm .ship_input_row .textinput','keyup change input').delegate('#jumpgateForm .ship_input_row .textinput','keyup change input',function(){checkIntInput(this,0,$(this).attr('rel'));}).undelegate('#jumpgateForm .ship_input_row .textinput','focus').delegate('#jumpgateForm .ship_input_row .textinput','focus',function(){$(this).val("");});$('#jumpgate .answerHeadline, .js_openStandardMoonMenu').click(function(){if(!player.hasCommander){errorBoxNotify(LocalizationStrings.error,translation.changeSettingOnlyWithCommander,LocalizationStrings.ok,null,false);}else{$('#jumpgate').find('.answerHeadline').toggleClass('open');$('.thirdCol').toggleClass('hidden');}});$('.js_executeJumpButton').click(function(){var selectedMoon=$('#jumpgateForm').find('select[name="zm"]').val();window.jumpGateTargetId=selectedMoon;if(selectedMoon!=0){var noShipsSelected=true;$('.ship_selection_table input').each(function(){if($(this).val()>0){noShipsSelected=false;}});if(!noShipsSelected){ajaxFormSubmit('jumpgateForm',$(this).attr('data-url'),jumpgateDone);}else{fadeBox(translation.noShipsWereSelected,true);}}else{fadeBox(translation.validTargetNeeded,true);}});}function jumpgateDone(data){var data=$.parseJSON(data);if(data["status"]){planet=data["targetMoon"];$('.overlayDiv').dialog('destroy');}errorBoxAsArray(data["errorbox"]);if(typeof data.newToken!='undefined'){setNewTokenData(data.newToken);}}function jumpgateDefaultTargetSelectionCallback(data){var data=$.parseJSON(data);if(data["status"]){var targetSelect=$('#jumpgateForm').find('select[name="zm"]');targetSelect.find('option').removeAttr('selected');var optionNode=targetSelect.find('option[value="'+data["targetMoon"]+'"]');if(optionNode.length){optionNode.attr('selected','selected');}else{if(targetSelect.find('option[value="0"]').length==0){targetSelect.append($(document.createElement('option')).attr('value',0).attr('selected','selected').text('--'));}else{targetSelect.find('option[value="0"]').attr('selected','selected');}}targetSelect.trigger('change');// not sure if the following is enough to refresh that dropdown
targetSelect.ogameDropDown('refresh');}errorBoxAsArray(data["errorbox"]);if(typeof data.newToken!='undefined'){setNewTokenData(data.newToken);}}function setNewTokenData(newToken){$('#jumpgateForm input[name="token"]').val(newToken);$('#jumpgateDefaultTargetSelectionForm input[name="token"]').val(newToken);}function openJumpgate(){//if($(".ui-dialog #content #jumpgate").length == 0) {
openOverlay(jumpGateLink,{title:jumpGateLoca.LOCA_STATION_JUMPGATE_HEADLINE});//}
}function redirectLogout(){location.href=redirectLogoutLink;}function redirectOverview(){location.href=redirectOverviewLink;}function redirectSpaceDock(){location.href=redirectSpaceDockLink;}if(typeof KeyEvent=="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224};}(function($){$.fn.extend({ogameDropDown:function(functionName){if($("body.showOldDropdowns").length){return this;}function positionList($ul){var ulHeight=$ul.outerHeight();var $dropdown=$('.dropdown.currentlySelected[rel="'+$ul.attr('id')+'"]');if($dropdown.length){var left=Math.min($(window).innerWidth()+$(window).scrollLeft()-$ul.width()-3,$dropdown.offset().left);var top;var dropdownTop=Math.ceil($dropdown.offset().top);if(dropdownTop+$dropdown.height()+ulHeight+$('#siteFooter').outerHeight()>=$(window).innerHeight()+$(window).scrollTop()){top=dropdownTop-ulHeight+1;}else{top=dropdownTop+$dropdown.height()+1;}$ul.css('left',left).css('top',top).css('min-width',$dropdown.width());}}var functions={destroy:function(){$(this).filter('select.dropdownInitialized').each(function(){var $this=$(this);$('.dropdown[rel="'+$this.data('dropdownId')+'"]').remove();$('ul#'+$this.data('dropdownId')).remove();$this.removeClass('dropdownInitialized').data('dropdownId','').show();});},hide:function(){$(this).filter('select.dropdownInitialized').each(function(){var $currentlySelected=$('.currentlySelected[rel="'+$(this).data('dropdownId')+'"]');$currentlySelected.find('a').removeClass('hover');$('.dropdownList#'+$currentlySelected.attr('rel')).hide();});},reposition:function(){$(this).filter('select.dropdownInitialized').each(function(){positionList($('#'+$(this).data('dropdownId')));});},refresh:function(){var selected=$(this).find("option[selected]");// get selected <option>
var href=getIEVersion()<999?'#':'javascript:void(0);';var $currentItem=$('a[class="'+selected.attr('class')+'"][rel="'+$(this).data('dropdownId')+'"]').text(selected.text());},select:function(value){$(this).find("option").prop("selected",false).removeAttr("selected");if(typeof value=='string'&&value.length>0){// select value and refresh
let selected=$(this).find("option[value='"+value+"']");if(selected.length>0){selected.prop("selected",true).attr('selected','selected');functions.refresh.call(this);return;}}// select default value and refesh
let defaultOption=$(this.find("option[value='-']"));if(defaultOption.length>0){defaultOption.prop("selected",true).attr('selected','selected');functions.refresh.call(this);}}};if(typeof functionName=='string'){if(typeof functions[functionName]=='function'){let args=Array.prototype.slice.call(arguments);args.shift();functions[functionName].apply(this,args);}return this;}$(this).filter('select:not(.dropdownInitialized)').each(function(){var $this=$(this);var randomId='dropdown'+Math.floor(Math.random()*1000);var selected=$this.find("option[selected]");// get selected <option>
if(selected.length==0){selected=$this.find('option:first-child');}var href=getIEVersion()<999?'#':'javascript:void(0);';var $currentItem=$('<a class="'+selected.attr('class')+'" data-value="'+selected.val()+'" rel="'+randomId+'" href="'+href+'">'+selected.text()+'</a>');var $dropdown=$('<span class="dropdown currentlySelected '+$this.attr('class')+'" rel="'+randomId+'"></span>').append($currentItem).width($this.css('width').length?$this.css('width'):$this.width()).data('selectElement',$this);if($this.is('[readonly]')||$this.is(':disabled')){$dropdown.addClass('disabled');}$this.after($dropdown).hide().addClass('dropdownInitialized').data('dropdownId',randomId);// iterate through all the <option> elements and create UL
var $ul=$('<ul class="dropdown dropdownList" id="'+randomId+'"></ul>').delegate('a','click',function(e){e.stopPropagation();$currentItem.html($(this).html()).attr('class',$(this).attr('class')).attr('data-value',$(this).attr('data-value'));$ul.hide().find('a').removeClass('focus');$(this).addClass('focus');var value=$(this).attr('data-value');$this.val($(this).attr('data-value')).trigger('change').find('option[value="'+value+'"], option:contains("'+value+'")').trigger('click');});function initialize(){if($this.is($this.is('[readonly]')||':disabled')){return;}if(!$ul.hasClass('initialized')){$ul.addClass('initialized');$this.find("option").each(function(){var html=$(this).html();if(typeof $(this).attr('data-html')!='undefined'){html=$(this).attr('data-html');}if(typeof $(this).attr('data-html-prepend')!='undefined'){html=$(this).attr('data-html-prepend')+html;}if(typeof $(this).attr('data-html-append')!='undefined'){html+=$(this).attr('data-html-append');}$li=$('<li><a '+'class="'+$(this).attr('class')+'" '+'data-value="'+$(this).val()+'">'+html+'</a></li>');$ul.append($li);if($(this).is(':selected')){$li.find('a').addClass('focus');}});}}$currentItem.bind('focus',function(e){$(".dropdownList").not($ul).hide();$(".dropdown.currentlySelected").removeClass('focus');$(this).addClass('hover');$dropdown.addClass('focus');initialize();}).bind('mousewheel',function(e){initialize();$(this).unbind('mousewheel');}).bind('click',function(e){e.preventDefault();if($this.is($this.is('[readonly]')||':disabled')){return;}$(".dropdownList").not($ul).hide();$(".dropdown.currentlySelected").removeClass('focus');$dropdown.addClass('focus');if($ul.is(':hidden')){$(this).addClass('hover');initialize();positionList($ul);$(window).unbind('resize.dropdown'+randomId).bind('resize.dropdown'+randomId,function(){positionList($ul);});$ul.show();if($ul.hasScrollbar()){$ul.find('a').css('padding-right',22);}}else{$(this).removeClass('hover');$(window).unbind('resize.dropdown'+randomId);$ul.hide();}});$('body').append($ul);});var currentlyTyped="";var currentlyTypedInterval;function updateCurrentlyTyped(text,e){currentlyTyped=text;clearTimeout(currentlyTypedInterval);currentlyTypedInterval=setTimeout(function(){currentlyTyped="";},1500);var $list=$('.dropdownList:visible');var instantSelect=false;if($list.length==0){var $focusedElement=$('.dropdown.currentlySelected.focus');if($focusedElement.length){$list=$("#"+$focusedElement.attr('rel'));instantSelect=true;}else{return;}}var lowerText=currentlyTyped.toLowerCase();var $focusElement=$list.find('a').filter(function(){if($(this).attr('data-value').toLowerCase().indexOf(lowerText)==0){return true;}return $(this).text().trim().toLowerCase().indexOf(lowerText)==0;});if($focusElement.length){e.preventDefault();$list.find('a').removeClass('focus');$($focusElement.get(0)).addClass('focus').focus();if(instantSelect){$focusElement.click();}}else{clearTimeout(currentlyTypedInterval);currentlyTyped="";}}$(document)// hide the dropdown
.undelegate('html','touchstart.dropdown click.dropdown').delegate('html','touchstart.dropdown click.dropdown',function(e){if($(e.target).closest(".dropdown").length==0){$(".dropdownList").hide();//$(".currentlySelected a").removeClass('hover');
//$(".currentlySelected").removeClass('focus');
}}).undelegate('.dropdown','mousewheel.dropdown').delegate('.dropdown','mousewheel.dropdown',function(e,delta){e.preventDefault();var $target=$(e.target).closest('.dropdown');var $list;if($target.hasClass('currentlySelected')){$list=$("#"+$target.attr('rel'));}else{$list=$target;}var $currentItem=$('[rel="'+$list.attr('id')+'"] a');var $focussed=$list.find('a:focus');if($focussed.length==0){$focussed=$list.find('a.focus');}if($focussed.length==0){$focussed=$list.find('a[data-value="'+$currentItem.attr('data-value')+'"]');}var $focussedListElement=$focussed.parent();var $focusElement=null;var amount=Math.abs(delta);if(delta>0){for(var amountCounter=0;amountCounter<amount;amountCounter++){if($focussedListElement.is(':first-child')){$focusElement=$focussedListElement.find('a');break;}else{$focusElement=$focussedListElement.prev().find('a');}$focussedListElement=$focusElement.parent();}}else{for(var amountCounter=0;amountCounter<amount;amountCounter++){if($focussedListElement.is(':last-child')){$focusElement=$focussedListElement.find('a');break;}else{$focusElement=$focussedListElement.next().find('a');}$focussedListElement=$focusElement.parent();}}if($focusElement!=null){$focussedListElement=$focusElement.parent();$list.find('a').removeClass('focus');$focusElement.addClass('focus').focus();if($list.is(':hidden')){$focusElement.click();}else{var currentPosition=$focussedListElement.position().top;if(currentPosition<0){$list.scrollTop($list.scrollTop()+currentPosition);}else if(currentPosition+$focussedListElement.outerHeight()>$list.innerHeight()){$list.scrollTop($list.scrollTop()+currentPosition+$focussedListElement.outerHeight()-$list.innerHeight());}}}}).undelegate('*','focus.dropdown').delegate('*','focus.dropdown',function(e){if($(e.target).closest(".dropdown").length==0){$(".currentlySelected a").removeClass('hover');$(".currentlySelected").removeClass('focus');}})// get keyboard arrow keys and backspace typing
.unbind('keydown.dropdown').bind('keydown.dropdown ',function(e){if($(':focus').length>0&&$(':focus').parents('.dropdown').length==0){return;}var instantSelect=false;var $list=$('.dropdownList:visible');if($list.length==0){var $focusedElement=$('.dropdown.currentlySelected.focus');if($focusedElement.length){$list=$("#"+$focusedElement.attr('rel'));instantSelect=true;}else{return;}}var $currentItem=$('[rel="'+$list.attr('id')+'"] a');var $focussed=$list.find('a:focus');if($focussed.length==0){$focussed=$list.find('a.focus');}if($focussed.length==0){$focussed=$list.find('a[data-value="'+$currentItem.attr('data-value')+'"]');}var $focussedListElement=$focussed.parent();var $focusElement=null;// arrow keys
if(e.keyCode==KeyEvent.DOM_VK_UP||e.keyCode==KeyEvent.DOM_VK_DOWN){if(e.keyCode==KeyEvent.DOM_VK_UP){if($focussedListElement.is(':first-child')){$focusElement=$focussedListElement.find('a');}else{$focusElement=$focussedListElement.prev().find('a');}$focussedListElement=$focusElement.parent();}else{if($focussedListElement.is(':last-child')){$focusElement=$focussedListElement.find('a');}else{$focusElement=$focussedListElement.next().find('a');}$focussedListElement=$focusElement.parent();}e.preventDefault();}else if(e.keyCode==KeyEvent.DOM_VK_BACK_SPACE){// simulate keyboard typing
updateCurrentlyTyped(currentlyTyped.substring(0,currentlyTyped.length-1),e);}else if(e.keyCode==KeyEvent.DOM_VK_RETURN){e.preventDefault();if(instantSelect){$currentItem.parents('form').submit();return;}else{instantSelect=true;$focusElement=$focussed;}}else if(e.keyCode==KeyEvent.DOM_VK_ESCAPE){$focusElement=$list.find('[data-value="'+$currentItem.attr('data-value')+'"]');instantSelect=true;}if($focusElement!=null){$focussedListElement=$focusElement.parent();$list.find('a').removeClass('focus');$focusElement.addClass('focus').focus();if(instantSelect){$focusElement.click();}else{var currentPosition=$focussedListElement.position().top;if(currentPosition<0){$list.scrollTop($list.scrollTop()+currentPosition);}else if(currentPosition+$focussedListElement.outerHeight()>$list.innerHeight()){$list.scrollTop($list.scrollTop()+currentPosition+$focussedListElement.outerHeight()-$list.innerHeight());}}}})// simulate keyboard typing
.unbind('keypress.dropdown').bind('keypress.dropdown',function(e){if($(':focus').length>0&&$(':focus').parents('.dropdown').length==0||e.charCode==0){return;}updateCurrentlyTyped(currentlyTyped+String.fromCharCode(e.charCode),e);});return $(this);},/**
        * @url http://stackoverflow.com/a/9217301/1386610
        */selectText:function(){var range,selection,obj=this[0],type={func:'function',obj:'object'},// Convenience
is=function(type,o){return typeof o===type;};if(is(type.obj,obj.ownerDocument)&&is(type.obj,obj.ownerDocument.defaultView)&&is(type.func,obj.ownerDocument.defaultView.getSelection)){selection=obj.ownerDocument.defaultView.getSelection();if(is(type.func,selection.setBaseAndExtent)){// Chrome, Safari - nice and easy
selection.setBaseAndExtent(obj,0,obj,$(obj).contents().size());}else if(is(type.func,obj.ownerDocument.createRange)){range=obj.ownerDocument.createRange();if(is(type.func,range.selectNodeContents)&&is(type.func,selection.removeAllRanges)&&is(type.func,selection.addRange)){// Mozilla
range.selectNodeContents(obj);selection.removeAllRanges();selection.addRange(range);}}}else if(is(type.obj,document.body)&&is(type.obj,document.body.createTextRange)){range=document.body.createTextRange();if(is(type.obj,range.moveToElementText)&&is(type.obj,range.select)){// IE most likely
range.moveToElementText(obj);range.select();}}// Chainable
return this;},hasScrollbar:function(){return this.get(0).scrollHeight>this.innerHeight();}});})(jQuery);ogame.messagecounter={countData:{'chat':0,'messages':0,'buddy':0},newChats:Array(),type_chat:10,type_message:11,type_buddy:12,currentLinkSelector:null,currentType:0,currentPlayer:null,sumNewChatMessages:0,initialize:function(type,player){var $this=ogame.messagecounter;if(typeof player=='undefined'&&type!==$this.type_chat){$this.currentPlayer=0;}if(typeof player=='undefined'&&type==$this.type_chat){return false;}if(typeof player!=='undefined'){$this.currentPlayer=player;}$this.currentType=type;switch(type){case $this.type_chat:$this.currentLinkSelector=$('a.comm_menu.chat');break;case $this.type_message:$this.currentLinkSelector=$('a.comm_menu.messages');break;case $this.type_buddy:$this.currentLinkSelector=$('a.comm_menu.buddies');break;default:return false;}$this.update();},initChatCounter:function(counter){var $this=ogame.messagecounter;$this.currentLinkSelector=$('a.comm_menu.chat');$this.currentType=$this.type_chat;$this.setCount(counter);//        if(counter > 0) {
$this.update();//        }
},/**
     * Update Count of new Chatmessages
     */update:function(locakey){var $this=ogame.messagecounter;//        $this.updateCountData();
/*
        if ($this.shouldAddCounter() && $this.getCount() > 0) {
            $this.setNewCounter($this.currentLinkSelector, $this.getCounterHtml($this.getCount()));
        } else {
            if ($this.getCount() == 0) {
                $this.resetCounterByType($this.currentType)
            } else {
                $this.setNewCounter($this.getCountSelectorByType($this.currentType), $this.getCount());
            }
        } */var loca;if(locakey===undefined){loca=chatLoca.X_NEW_CHATS;}else{loca=locakey;}changeTooltip($this.currentLinkSelector,loca.replace('#+#',$this.getCount()));},resetCounterByType:function(type,locakey){var $this=ogame.messagecounter;var selector=$this.getIconSelectorByType(type);//        $this.setNewCounter(selector, '');
var loca;if(locakey===undefined){loca='';//chatLoca.X_NEW_CHATS;
}else{loca=locakey;}changeTooltip(selector,loca.replace('#+#',0));},/**
     * Get the Selector of the right counterbox
     *
     * @param int type -> right codes see@top
     *
     * @return jquery-object unreadSelector
     */getCountSelectorByType:function(type){var $this=ogame.messagecounter;var unreadSelector='';switch(type){case $this.type_chat:unreadSelector=$('a.comm_menu.chat .new_msg_count');break;case $this.type_message:unreadSelector=$('a.comm_menu.messages .new_msg_count');break;case $this.type_buddy:unreadSelector=$('a.comm_menu.buddies .new_msg_count');}return unreadSelector;},/**
     * Get the Selector of the right icon
     *
     * @param int type -> right codes see@top
     *
     * @return jquery-object unreadSelector
     */getIconSelectorByType:function(type){var $this=ogame.messagecounter;var selector='';switch(type){case $this.type_chat:selector=$('a.comm_menu.chat');break;case $this.type_message:selector=$('a.comm_menu.messages');break;case $this.type_buddy:selector=$('a.comm_menu.buddies');}return selector;},/**
     * Get the Html-String to create a counter
     *
     * @param string count
     *
     * @return string counter
     */getCounterHtml:function(count){var counter='<span class="new_msg_count">'+count+'</span>';return counter;},/**
     * Get count from type
     *
     * @return int $this.countData.[type]
     */getCount:function(){var $this=ogame.messagecounter;switch($this.currentType){case $this.type_chat:return $this.countData.chat;case $this.type_message:return $this.countData.messages;case $this.type_buddy:return $this.countData.buddy;}},/**
     * Set count for type
     *
     * @param mixed value
     */setCount:function(value){var $this=ogame.messagecounter;switch($this.currentType){case $this.type_chat:$this.countData.chat=value;break;case $this.type_message:$this.countData.messages=value;break;case $this.type_buddy:$this.countData.buddy=value;break;}},/**
     * Update Count for type
     */updateCountData:function(){var $this=ogame.messagecounter;if($this.isOpen()){$this.setCount(0);}else{if($this.shouldAddCounter()){var unreadMessages=1;}else{var unreadMessagesSelector=$this.getCountSelectorByType($this.currentType);var unreadMessages=unreadMessagesSelector.html();unreadMessages=parseInt(unreadMessages)+1;}$this.setCount(unreadMessages);}},/**
     * Returns if u should add the counter first
     *
     * @return boolean addCounter
     */shouldAddCounter:function(){var $this=ogame.messagecounter;var unreadMessagesSelector=$this.getCountSelectorByType($this.currentType);var unreadMessages=unreadMessagesSelector.html();var addCounter=false;if(typeof unreadMessages=='undefined'){addCounter=true;}return addCounter;},/**
     * Set counter for new chatmessages
     *
     * @param jquery-object selector
     * @param string html    >> html for the counter on the chatsymbole
     */setNewCounter:function(selector,html){selector.html(html);},/**
     * proof if the chat of the player is open
     */isOpen:function(){var $this=ogame.messagecounter;var returnValue=false;switch($this.currentType){case $this.type_chat:returnValue=ogame.chat.isOpen($this.currentPlayer);//                $('.chat_box').each(function () {
//                    if ($(this).attr('data-playerid') == $this.currentPlayer) {
//                        if ($(this).css('display') == 'block') {
//                            returnValue = true;
//                        }
//                    }
//                });
break;case $this.type_message:returnValue=location.href.indexOf('page=messages')>-1;break;case $this.type_buddy:returnValue=location.href.indexOf('page=ingame&component=buddies')>-1;break;}return returnValue;}};ogame.messagemarker={type_chatbar:10,type_chattab:11,action_remove:20,action_add:21,currentCount:'',currentSelector:'',currentPlayernameObject:'',currentListPlayernameObject:'',currentPartnerId:'',currentListItemSelector:'',totalNewMessages:0,playerlist:new Array(),newsInitialized:false,effect:'none',initialize:function(){$('.new_msg_count[data-playerid]').each(function(){var $this=ogame.messagemarker;var playerId=$(this).data('playerid');if(playerId&&$.inArray(playerId,$this.playerlist)===-1){$this.playerlist.push(playerId);$this.setPartnerId(playerId);$this.updateNewMarker();}});//define effect to indicate new messages
ogame.messagemarker.effect='highlight';//        $('.new_msg_count.news').each(function() {
//            var $this = ogame.messagemarker;
//            
//            if (!$this.newsInitialized) {
//                var $this = ogame.messagemarker;
//                $this.newsInitialized = true;
//                $this.setPartnerId('News');
////                $this.updateNewMarker();
//            }
//        });
},initMarker:function(playerids){var $this=ogame.messagemarker;var chatCount=0;$.each(playerids,function(index,value){$this.setPartnerId(value);var messageCount=$('.new_msg_count[data-playerid="'+value+'"]').data('new-messages');if(messageCount!=null&&messageCount>0){$this.setSelectorByType($this.type_chatbar);$this.mark($this.currentSelector,$this.currentPlayernameObject,messageCount);$this.mark($this.currentListItemSelector,$this.currentListPlayernameObject,messageCount);$this.setSelectorByType($this.type_chattab);$this.mark($this.currentSelector,$this.currentPlayernameObject,messageCount);}chatCount=chatCount+1;});return chatCount;},setCounter:function(partnerId,counter){this.setPartnerId(partnerId);$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data('new-messages',counter);this.updateNewMarker();},toggle:function(action,type,partnerId,currentState){this.setPartnerId(partnerId);this.currentCount=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data('new-messages'));//        this.setSelectorByType(type);
if(action===this.action_add){//            var newState = parseInt(currentState) + 1;
//            this.currentCount = this.currentCount + 1;
//            $.cookie('messageCount' + this.currentPartnerId, this.currentCount);
this.updateNewMarker();//            this.addNewMarker();
}if(action===this.action_remove){this.removeNewMarker();}},mark:function(selector,playerObject,count){//        var htmlmarker = '<span class="newMsgMarker"><b><span>( <span class="newMsgCount">'+count+'</span> )</span></b></span>';
//        $(selector).append(htmlmarker);
//        playerObject.css('font-weight', 'bold');
$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css('font-weight','bold');$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css('font-weight','bold');},addNewMarker:function(){var added=false;if(!$(this.currentSelector).find('.newMsgMarker').length){this.mark(this.currentSelector,this.currentPlayernameObject,this.currentCount);added=true;}if(!$(this.currentListItemSelector).find('.newMsgMarker').length){this.mark(this.currentListItemSelector,this.currentListPlayernameObject,this.currentCount);added=true;}if(!added){this.updateNewMarker();}},removeNewMarker:function(){$('.playerlist_item[data-playerid="'+this.currentPartnerId+'"] .playername').css('font-weight','normal');$('.cb_playername[data-playerid="'+this.currentPartnerId+'"]').css('font-weight','normal');//        $(this.currentSelector).find('.newMsgMarker').remove();
//        $(this.currentListItemSelector).find('.newMsgMarker').remove();
},updateNewMarker:function(){//        var newMarker = $(this.currentSelector).find('.newMsgCount');
//        var newlistMarker = $(this.currentListItemSelector).find('.newMsgCount');
//        var currentValue = parseInt(newMarker.html());
//        newMarker.html(currentValue+1);
//        newlistMarker.html(currentValue+1);
//        $(this.currentSelector + ' .new_msg_count').text(currentValue+1).effect('highlight', {}, 500);
//        $(this.currentListItemSelector + ' .new_msg_count').text(currentValue+1).effect('highlight', {}, 500);
var newAmount=parseInt($('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').data('new-messages'));var sumNewMessagesChatBefore=$('.new_msg_count.totalChatMessages').text();var sumNewMessagesChat=ogame.chat.updateTotalNewChatCounter();if(newAmount===0){if(isNaN(this.currentPartnerId)){$('.new_msg_count.totalMessages.news').text(newAmount).addClass('noMessage');}else{$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(newAmount).addClass('noMessage');if(sumNewMessagesChat===0){$('.new_msg_count.totalChatMessages').text(sumNewMessagesChat).addClass('noMessage');}else{if(sumNewMessagesChatBefore!=sumNewMessagesChat){$('.new_msg_count.totalChatMessages').text(sumNewMessagesChat).removeClass('noMessage').effect(ogame.messagemarker.effect,{},500);}}}}else{if(isNaN(this.currentPartnerId)){if(isNaN(newAmount)){$('.new_msg_count.totalMessages.news').text(0).addClass('noMessage');}else{$('.new_msg_count.totalMessages.news').text(newAmount).removeClass('noMessage').effect(ogame.messagemarker.effect,{},500);}}else{$('.msg[data-playerid="'+this.currentPartnerId+'"]').addClass('msg_new');$('.new_msg_count[data-playerid="'+this.currentPartnerId+'"]').text(newAmount).removeClass('noMessage').effect(ogame.messagemarker.effect,{},500);if(sumNewMessagesChatBefore!=sumNewMessagesChat){$('.new_msg_count.totalChatMessages').text(sumNewMessagesChat).removeClass('noMessage').effect(ogame.messagemarker.effect,{},500);}}}//        $('.new_msg_count.totalChatMessages').text(this.totalNewMessages).effect('highlight', {}, 500);
},setSelectorByType:function(type){selector='';if(type==this.type_chatbar){selector='ul.chat_bar_list li.chat_bar_list_item[data-playerid="'+this.currentPartnerId+'"]';//evtl muss hier noch um die id gnsefsschen
}if(type==this.type_chattab){selector='ul#chatMsgList li.msg[data-playerid="'+this.currentPartnerId+'"]';//evtl muss hier noch um die id gnsefsschen
}this.currentListItemSelector='.js_playerlist ul.playerlist li.playerlist_item[data-playerid="'+this.currentPartnerId+'"]';this.currentSelector=selector;this.currentPlayernameObject=$(selector).find('.cb_playername');this.currentListPlayernameObject=$(this.currentListItemSelector).find('.playername');},setPartnerId:function(partnerId){this.currentPartnerId=partnerId;}};ogame.messages={data:{initActions:{'tabs-nfFleets':'initTabFleets','tabs-nfCommunication':'initTabCommunication','tabs-nfMarket':'initTabMarket','subtabs-nfCommunicationMessages':'initSubTabMessages'}},/**
     * Adds a message to the given tab or subtab (whithout check of timestamp,
     * because this will in almost all cases be the newest message)
     *
     **/addMessage:function($tabOrSubtab,msgData,insertAtBeginning){if(insertAtBeginning!==false){insertAtBeginning=true;}if($tabOrSubtab.attr('aria-selected')!=='true'){console.warn('addMessage: not correct Tab, aria-selected = ',$tabOrSubtab.attr('aria-selected'),$tabOrSubtab);return;}if(!msgData){console.warn('addMessage: msgData is ',msgData);return;}var tabContentObject=$('#'+$tabOrSubtab.attr('aria-controls')).find('.tab_inner');var addBefore=false;//get id of active Tab, create the message and add it
if(insertAtBeginning){addBefore=true;}ogame.messages.createMessageItem(msgData,tabContentObject,addBefore);},/**
     *  Creates a message for tab messages
     *  That can then be inserted upon sending the message
     * @param before
     * @param messageData
     * @param tabObject
     */createMessageItem:function(messageData,tabObject,before){var idArray={};for(var msgData in messageData){var data=messageData[msgData];idArray[msgData]=data.msgID;}var ids=JSON.stringify(idArray);// fetch message.tpl.php
$.ajax({url:'?page=messages',type:'POST',dataType:'html',data:{messageId:ids,//details: messageData.detailURL, WTF?
tabid:this.getCurrentMessageTab(),action:121,// \OGame\Messages\Message::ACTION_ADD
ajax:1},success:function(data){if(before){tabObject.prepend(data);}else{var favCount=tabObject.find('.favoriteCount');if(favCount.length>0){$(data).insertBefore(favCount);}else{tabObject.append(data);}}},error:function(jqXHR,textStatus,errorThrown){}});},/**
     *  Creates a message (=Rundmail) for the subtab messages
     *  That can then be inserted upon sending the message
     *  @param {String} msgData - Data to fill the message with
    */createBroadcastMsgItem:function(msgData){if(!msgData){console.warn('createMessageItem: msgData is missing!');return undefined;}var $msgItemHeader=$('<div class="msg_head"></div>');$msgItemHeader.append('<span class="msg_title blue_txt">'+msgData.title+'</span>');$msgItemHeader.append('<span class="msg_date fright">'+msgData.date+'</span><br>');$msgItemHeader.append('<span class="msg_sender_label">'+loca.LOCA_WRITE_MSG_FROM+': </span>');$msgItemHeader.append('<span class="msg_sender">'+msgData.senderName+'</span>');var $msgItemFooter=$('<div class="msg_actions clearfix"></div>');$msgItemFooter.append('<a class="fright txt_link overlay" href="'+msgData.detailURL+'" '+'data-overlay-title="'+loca.broadcasts+'">'+loca.details+'</a>');$msgItemFooter.append('<a class="fright txt_link comments_link overlay" href="'+msgData.commentsURL+'" '+'data-overlay-title="'+loca.broadcasts+'">'+msgData.commentsCount+' <span class="comments"></span></a></a>');var $msgItem=$('<li class="msg '+msgData.newClass+'" data-msg-id="'+msgData.msgID+'"></li>');$msgItem.append('<div class="msg_status"></div>');$msgItem.append($msgItemHeader);$msgItem.append('<span class="msg_content">'+msgData.msgContent+'</span>');$msgItem.append($msgItemFooter);return $msgItem;},/**
     * Creates the html elements for the recipients
     * @param {String} recipientId
     * @param {String} recipientCat
     * @param {String} name
     */createRecipient:function(recipientId,recipientCat,name){var $inputReplacement,pattern;$('.input_replacement').each(function(){pattern=new RegExp($(this).data('recipient-cat'));if(pattern.test(recipientCat)){$inputReplacement=$(this);}});// stop if the corresponding inputbox cannot be found
if($inputReplacement===undefined)return;var found=$inputReplacement.children('.recipient_txt').filter(function(){return $(this).data('recipient-id')===recipientId;});// the element only gets created if it was not there before
if(found.length===0){if(!$inputReplacement.hasClass('focus')){$inputReplacement.addClass('focus');}$inputReplacement.append('<div class="recipient_txt" data-recipient-id="'+recipientId+'" data-recipient-cat="'+recipientCat+'">'+name+'<a role="button" class="remove_recipient"></a></div>');}},/**
     * checks if the given action is valid and calls it
     * @param {String} action - determines which action shall be performed
     * @returns {unresolved}
     */doInitAction:function(action){if(typeof ogame.messages[ogame.messages.data.initActions[action]]==='function'){return ogame.messages[ogame.messages.data.initActions[action]]();}else{return console.warn('These is no function defined for action: ',action);}},initCombatReportDetails:function(){if($('select').length>0){$('select').ogameDropDown();}},/**
     * Initializes detail messages
     * @param {Boolean} commentsAllowed - if true, initialize comments as well
     * @returns {undefined}
     */initDetailMessages:function(commentsAllowed){$('.detail_list_el:nth-of-type(4n + 3), .detail_list_el:nth-of-type(4n + 4)').addClass("odd");//max Height of the overlay is browsersize - (header of overlay + a little puffer)
var newHeight=$(window).height()-200;$('.detail_msg_ctn').css('height',newHeight);$('.detail_msg_ctn').mCustomScrollbar({theme:"ogame"});if(commentsAllowed){// we need a a scroll to event, because anker won't work with customScrollbar
$("#scrollToComments").on('click',function(){$('.detail_msg_ctn').mCustomScrollbar('scrollTo','bottom');});initBBCodeEditor(locaKeys,itemNames,false,'.comment_textarea',2000);}$('#messages ul.pagination').on('click','li.p_li a',function(){var currentTab=$(this).data('tabid');var messageId=$(this).data('messageid');$.post('?page=messages',{tabid:currentTab,messageId:messageId,ajax:1},function(data){var ajaxTableContent=$(data).find('#messages .ui-dialog');$('.overlayDiv').html(data);});});},initMessages:function(){$('.js_tabs .tabs_btn_img').each(function(){if($(this).attr('rel')){$(this).attr('href',$(this).attr('rel'));}});ogame.messages.initTabs($('.js_tabs'));var currentTab=ogame.messages.getCurrentMessageTab();$('#contentWrapper #buttonz div.js_tabs.tabs_wrap.ui-tabs').on('click','ul li.list_item',function(){var currentTab=ogame.messages.getCurrentMessageTab();});$('body').on('click','.msg_actions .icon_not_favorited',function(event){var messageId=$(this).parents('li.msg').data('msg-id')||$(this).parents('div.detail_msg').data('msg-id');// \OGame\Messages\Message::ACTION_ARCHIVE == 101
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:currentTab,messageId:messageId,action:101,ajax:1},success:function(data){if(data[messageId]['result']==true){$(event.target).removeClass('icon_not_favorited').addClass('icon_favorited');changeTooltip($(event.target),loca.DELETE_FAV);var $counter=$('.favoriteTabFreeSlotCount');$counter.html(parseInt($counter.html())-1);}else if(data[messageId]['reason']!=='undefined'){fadeBox(data[messageId]['reason'],1);}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.msg_actions .icon_favorited',function(event){var messageId=$(this).parents('li.msg').data('msg-id')||$(this).parents('div.detail_msg').data('msg-id');;// \OGame\Messages\Message::ACTION_ARCHIVE_REMOVE == 102
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:currentTab,messageId:messageId,action:102,ajax:1},success:function(data){if(data[messageId]['result']==true){$(event.target).removeClass('icon_favorited').addClass('icon_not_favorited');changeTooltip($(event.target),loca.ADD_FAV);var $counter=$('.favoriteTabFreeSlotCount');$counter.html(parseInt($counter.html())+1);}else if(data[messageId]['reason']!=='undefined'){fadeBox(data[messageId]['reason'],1);}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionKill',function(event){var messageId=$(this).parents('li.msg').data('msg-id');// \OGame\Messages\Message::ACTION_KILL == 103
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{messageId:messageId,action:103,ajax:1},success:function(data){if(data[messageId]==true){$(event.target).parents('li.msg').remove();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionKillAll',function(event){// \OGame\Messages\Message::ACTION_KILL == 103
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:103,ajax:1},success:function(data){if(data["result"]==true){location.reload();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionKillDetail',function(event){var messageId=$('.overlayDiv .detail_msg').data('msg-id');// \OGame\Messages\Message::ACTION_KILL == 103
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{messageId:messageId,action:103,ajax:1},success:function(data){if(data[messageId]==true){location.reload();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionRevive',function(event){var messageId=$(this).parents('li.msg').data('msg-id');if(messageId===undefined){messageId=$(this).parents('div.detail_msg').data('msg-id');}// \OGame\Messages\Message::ACTION_REVIVE == 104
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:currentTab,messageId:messageId,action:104,ajax:1},success:function(data){if(data[messageId]==true){//in message list view
$(event.target).parents('li.msg').remove();//in message detail view
$(event.target).parents('div.ui-dialog').remove();$('li.msg[data-msg-id='+messageId+']').remove();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionReviveAll',function(event){// \OGame\Messages\Message::ACTION_REVIVE == 104
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:104,ajax:1},success:function(data){if(data["result"]==true){location.reload();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionDelete',function(event){var messageId=$(this).parents('li.msg').data('msg-id');// \OGame\Messages\Message::ACTION_DELETE == 105
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:currentTab,messageId:messageId,action:105,ajax:1},success:function(data){if(data[messageId]==true){$(event.target).parents('li.msg').remove();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.js_actionDeleteAll',function(event){var messageId=$(this).parents('li.msg').data('msg-id');// \OGame\Messages\Message::ACTION_DELETE == 105
$.ajax({type:'POST',url:'?page=messages',dataType:'json',data:{tabid:ogame.messages.getCurrentMessageTab(),messageId:-1,action:105,ajax:1},success:function(data){if(data["result"]==true){location.reload();}else{fadeBox(loca.LOCA_GALAXY_ERROR_OCCURED,1);}},error:function(){}});}).on('click','.paginator',function(event){var currentTab=$(this).data('tab');var page=$(this).data('page');var bla=$(this).closest('div[class^="ui-tabs-panel"]');$.ajax({type:'POST',url:'?page=messages',dataType:'html',data:{messageId:-1,tabid:currentTab,action:107,pagination:page,ajax:1},success:function(data){bla.html(data);},error:function(){}});}).on('click','.jumpToAllianceApplications',function(event){location.href='index.php?page=alliance&tab=applications';}).on('click','a.js_actionCollect',function(event){event.preventDefault();let url=$(event.currentTarget).attr('href');$.ajax({type:'POST',url:url,dataType:'json',data:{newToken:ogame.messages.newToken||''},success:function(data){let status=data.status||'failure';let statusMessage=data.statusMessage||'';if(status==='success'){ogame.messages.newToken=data.newToken;$(event.currentTarget).hide();$(event.currentTarget).replaceWith(statusMessage);fadeBox(data.message||'',false);getAjaxResourcebox();}if(status==='failure'){let error=data.errors[0]||undefined;if(error){fadeBox(error.message,true);}}},error:function(data){}});});},selectCurrentMessageTab:function(){var currentTab=$('.subtabs .ui-state-active:visible');if(!currentTab.length){// none of the subTabs is visible
currentTab=$('.js_tabs .ui-state-active:visible');}return currentTab;},getCurrentMessageTab:function(){var currentTab=$('.subtabs .ui-state-active:visible').attr('data-tabid');if(!currentTab){// none of the subTabs is visible
currentTab=$('.js_tabs .ui-state-active:visible').attr('data-tabid');}return currentTab;},getCurrentEarliestMessage:function(){//console.log($('.ui-tabs-panel .tab_inner .msg:visible'));
return $('.ui-tabs-panel .tab_inner .msg:visible').last().attr('data-msg-id');},initCommentForm:function(){ogame.messages.initWriteNewMsgBox($('#newCommentForm'));$('#newCommentForm').on('click','.js_send_comment',function(e){e.preventDefault();var $myForm=$(this).closest('form');var $messageId=$myForm.find('input[name=messageId]').val();$.ajax({type:'POST',url:$myForm.attr('action'),dataType:'json',data:{messageId:$messageId,ajax:1,action:108,// \OGame\Messages\Message::ACTION_COMMENT
text:$myForm.find('textarea[name=text]').val()},success:function(data){fadeBox(data.message,data.error);$myForm.find('textarea[name=text]').val('');$myForm.parent().after('<li class="msg"><div class="msg_status"></div><div class="msg_head">'+data.commentheader+'</div><div class="msg_content">'+data.commentcontent+'</div></li>');$('#scrollToComments').text(data.commentcount);},error:function(data){}});});},/**
     * initializes the overlay for sharing reports
     * @returns {undefined}
     */initShareReportOverlay:function(){ogame.messages.initWriteNewMsgBox($('#newSharedReportForm'));$('#newSharedReportForm').on('click','.js_send_msg_share',function(e){e.preventDefault();var $myForm=$(this).closest('form');var $messageId=$myForm.find('input[name=messageId]').val();var $empfaenger=$myForm.find('li.select2-selection__choice');var $myData=[];$empfaenger.each(function(){$myData.push($(this).attr('title'));});$.ajax({type:'POST',url:$myForm.attr('action'),dataType:'json',data:{messageId:$messageId,empfaenger:$myData,ajax:1,action:106,// \OGame\Messages\Message::ACTION_SHARE
text:$myForm.find('textarea[name=text]').val()},success:function(data){fadeBox(data.message,data.error);$myForm.closest('div[class^="overlayDiv"').remove();},error:function(data){}});});},/**
     * initializes the subtab messages where user can write messages (=Rundmails)
     * to members of their allies and federates
     * @returns {undefined}
     */initSubTabMessages:function(){// accordion initialized here, because this is the only tab where it is needed
$('.js_accordion').accordion({collapsible:true,heightStyle:'content',active:false// @TODO: this needs to be updated when the accordion was open on tab/page change
});ogame.messages.initWriteNewMsgBox($('#newMsgForm'));$('html').off('.subtabmessages');$('#newMsgForm').on('click.subtabmessages','.js_send_msg',function(e){e.preventDefault();var $myForm=$(this).parents('form');var recipientIDs={};$('.input_replacement').children().each(function(){if(typeof recipientIDs[$(this).data('recipient-cat')]=='undefined'){recipientIDs[$(this).data('recipient-cat')]=[];}recipientIDs[$(this).data('recipient-cat')].push($(this).data('recipient-id'));});$.ajax({type:'POST',url:$myForm.attr('action'),dataType:'json',data:{empfaenger:recipientIDs,text:$myForm.find('.new_msg_textarea').val()},success:function(data){fadeBox(data.message,data.error);// add message to this tab if successful todo real data for inserted message needed from php
if(!data.error){ogame.messages.sendSubtabMsg($('.new_msg_textarea').val(),recipientIDs);}},error:function(){}});// @TODO: clear input from message box and recipient fields
});},initTabCommunication:function(){ogame.messages.initTabs($('.js_subtabs_communication'));},initTabFleets:function(){// using a callback function here, because it is the same function for every subtab of fleets
ogame.messages.initTabs($('.js_subtabs_fleets'),ogame.messages.initTrash);},initTabMarket:function(){ogame.messages.initTabs($('.js_subtabs_market'),ogame.messages.initTrash);},/**
     * Wrapper for the initialization of tabs
     * @param {JQuery Object} $el - Element to attach tabs to
     * @param {Function} callbackFunc - a Function to be called after the tabs are loaded
     * @returns {undefined}
     */initTabs:function($el,callbackFunc){$el.tabs({beforeLoad:function(){$('.ajax_load_shadow').show();},load:function(e,el){console.info("load",el.tab.attr('id'));// select functions to initzialize based on id of active tab
ogame.messages.doInitAction(el.tab.attr('id'));$('.ajax_load_shadow').hide();// call the additional callback if one was given
if(typeof callbackFunc==='function'){callbackFunc(el.tab);}},// create is only called once when the tabs are created
create:function(e,el){ogame.messages.doInitAction(el.tab.attr('id'));}});},/**
     *
     */initTrash:function($activeTab){if(!$activeTab)return;$('.js_active_tab').html($activeTab.data('subtabname'));if($activeTab.attr('id')==='subtabs-nfFleetTrash'||$activeTab.attr('id')==='subtabs-nfMarketTrash'){$('.trash_box').addClass('trash_open');$('.in_trash').show();$('.not_in_trash').hide();}else{$('.trash_box').removeClass('trash_open');$('.in_trash').hide();$('.not_in_trash').show();}},/**
     * Initializes the functions and events that are necessary for writing a new message
     * (Used on newsfeed for broadcast messages and new shared reports)
     * @param {Jquery Object} $newMsgForm - Element to attach the new message events to
     * @returns {undefined}
    */initWriteNewMsgBox:function($newMsgForm){initBBCodeEditor(locaKeys,itemNames,false,'.new_msg_textarea',2000);$('html').off('.writeNewMsgBox');// SubTabMessages - close any open recipient select boxes when clicking outside the box:
$('html').on('click.writeNewMsgBox',function(e){if($('.new_msg_label').hasClass('open')&&$(e.target).parents('.recipient_select_box').length<1){$('.input_replacement').removeClass('focus');$('.new_msg_label').removeClass('open');$('.new_msg_label').siblings('.recipient_select_box').hide();}});$newMsgForm.on('click.writeNewMsgBox','.input_replacement',function(e){e.stopPropagation();ogame.messages.toggleRecipientSelectBox($(e.target).data('recipient-cat'));}).on('click.writeNewMsgBox','.new_msg_label',function(e){e.stopPropagation();ogame.messages.toggleRecipientSelectBox($(e.currentTarget).data('recipient-cat'));}).on('click.writeNewMsgBox','.recipient_select_box .ally_rank',function(){ogame.messages.toggleRecipientSelection($(this));})/*           .on('click.writeNewMsgBox', '.js_all_recipients', function() {
                ogame.messages.toggleSelectAllRecipients($(this));
            })*/.on('click.writeNewMsgBox','.remove_recipient',function(){ogame.messages.removeRecipient($(this).closest('.recipient_txt').data('recipient-id'));});},/**
     * Remove Recipient from input field and remove corresponding selection
     * @param {type} recipientId
     * @returns {undefined}
     */removeRecipient:function(recipientId){$('.ally_rank').filter(function(){if($(this).data('recipient-id')===recipientId){$(this).removeClass('selected');}});$('.recipient_txt').filter(function(){if($(this).data('recipient-id')===recipientId){$(this).remove();}});},sendSubtabMsg:function(msg,recipientIDs){if(!msg){// @TODO: show warning
console.warn('sendSubtabMsg: msg was empty');return;}if(!recipientIDs){// @TODO: show warning
console.warn('sendSubtabMsg: msg had no recipients');return;}var msgData={};msgData.date=getFormatedDate(serverTime.getTime(),'[d].[m].[Y] <span>[H]:[i]:[s]</span>');msgData.newClass='msg_new';msgData.title=recipientIDs;msgData.senderName='100011';// needs to be id of current player, where do we get it from?
msgData.msgID='111';// this is probably some unique number
msgData.msgContent=msg;msgData.commentsURL='';msgData.detailURL='';msgData.commentsCount=0;var data=array(msgData);// @TODO: Tell Backend that theres a new message that has to be sent and processed
ogame.messages.addMessage($('#subtabs-nfCommunicationMessages'),data);},/**
     * toggle the box for recipient selection with the correct category
     * @param {String} recipientCat - category of recipients
     * @returns {undefined}
     */toggleRecipientSelectBox:function(recipientCat){$('.input_replacement').filter(function(){if($(this).data('recipient-cat')===recipientCat&&!$(this).hasClass('focus')){$(this).addClass('focus');}});$('.new_msg_label').filter(function(){var $currNewMsgLabel=$(this);if($currNewMsgLabel.data('recipient-cat')===recipientCat){if($currNewMsgLabel.hasClass('open')){//hide current
$currNewMsgLabel.removeClass('open').siblings('.recipient_select_box').hide();}else{var $recipientSelectBox=$currNewMsgLabel.siblings('.recipient_select_box'),$scrollBox=$recipientSelectBox.find('.scroll_box');// hide all
$('.new_msg_label').removeClass('open').siblings('.recipient_select_box').hide();// show current
$currNewMsgLabel.addClass('open');$recipientSelectBox.show();$scrollBox.hasClass('mCustomScrollbar')?$scrollBox.mCustomScrollbar('update'):$scrollBox.mCustomScrollbar();}}});},/**
     * add the clicked element to the corresponding list of recipients if it is
     * not yet in the list, remove it from the list otherwise.
     * @param $recipientLiEl
     */toggleRecipientSelection:function($recipientLiEl){var recipientCat=$recipientLiEl.data('recipient-cat'),recipientId=$recipientLiEl.data('recipient-id');// some ranks (i.e. "founder of the ally") cannot be deselected
if($recipientLiEl.hasClass('always_selected'))return;if($recipientLiEl.hasClass('complete_ally')){ogame.messages.toggleSelectAllRecipients(recipientCat);return;}if(!$recipientLiEl.hasClass('selected')){ogame.messages.createRecipient(recipientId,recipientCat,$recipientLiEl.html());$recipientLiEl.addClass('selected');}else{ogame.messages.removeRecipient(recipientId);}},/**
     * toggle the selection of all recipients from a given list
     */toggleSelectAllRecipients:function(currCat){var cASelected=$('.complete_ally').hasClass('selected'),recipientId=cASelected?'255':'1',name=cASelected?'loca.founder':'loca.completeAlliance';$('.input_replacement').children().remove();ogame.messages.createRecipient(recipientId,currCat,name);$('.recipient_list').filter(function(){if($(this).data('recipient-cat')===currCat){$(this).find('.ally_rank').each(function(){if(!$(this).hasClass('always_selected')){cASelected?$(this).removeClass('selected'):$(this).addClass('selected');}});}});}};// Old Messages Code below this line:
// this seems to only get used in the showmessage.tpl.php which is only called on galaxy.inc.tpl.php and jumpgate.tpl.php
// @TODO is it depreceated???
function initShowMessage(){var $dialog=$('.overlayDiv[data-page="showmessage"]');$(".answerHeadline",$dialog).click(function(){$(this).toggleClass("open");if($(this).hasClass("open")){$(".answerForm",$dialog).show();$(".textWrapper",$dialog).addClass("textWrapperSmall");$(".textWrapper",$dialog).removeClass("textWrapper");}else{$(".answerForm",$dialog).hide();$(".textWrapperSmall",$dialog).addClass("textWrapper");$(".textWrapperSmall",$dialog).removeClass("textWrapperSmall");}});$(".note > div:first-child",$dialog).addClass("newMessage");$(".info:odd",$dialog).css("margin-left","40px");$("div.note p:first").after("<span class=\"seperator\">");$('.answerHeadline',$dialog).hover(function(){$(this).addClass("pushable");},function(){$(this).removeClass("pushable");});$(".melden",$dialog).click(function(){manageErrorbox($(this).attr("rel"),1);});}function initNetworkAjax(){var $myRiders=$(".reiter");if(!$.isFunction(clickFunction)){var clickFunction=function(){$myRiders.removeClass("active");$(this).addClass("active");ajaxLoad($(this).attr("id"),1);};}$myRiders.off('click');$myRiders.click(clickFunction);$("#checkAll").off('click').click(function(){$(".checker").prop("checked",$(this).is(':checked'));});function hide(id){$("#TR"+id).hide();}$(".overlay").click(function(){var msg_id=$(this).attr("id");markAsRead(msg_id);});$("#messageContent select").change(function(){if(typeof $("select option:selected").attr("id")=="undefined"){$(".buttonOK").hide();mod="";}else{$(".buttonOK").show();mod=$("select option:selected").attr("id");}});$(".del").click(function(){mod=$(this).attr("id");});$(".underlined").click(function(){$(".buttonOK").hide();});reduceMsgCount(aktCat);}function MessageSlider(obj){var thisObj=this;thisObj.htmlobject=obj;var maxHeight=document.documentElement.clientHeight-160;this.open=function(){if(!this.inAction){thisObj.startTime=new Date().getTime();thisObj.inAction=true;thisObj.slideInStep();}},this.slideInStep=function(){time=new Date().getTime();height=parseInt(thisObj.currHeight*((time-thisObj.startTime)/500));if(height<thisObj.currHeight){thisObj.htmlobject.style.height=height+'px';window.setTimeout(thisObj.slideInStep,10);}else{thisObj.htmlobject.style.height=thisObj.currHeight+'px';thisObj.inAction=false;}},this.close=function(){if(!thisObj.inAction){thisObj.startTime=new Date().getTime();thisObj.inAction=true;thisObj.htmlobject.style.height="0px";thisObj.inAction=false;}},thisObj.inAction=false;if(document.getElementById('messages')){thisObj.currHeight=Math.min(document.getElementById('messages').offsetHeight,maxHeight);}else{thisObj.currHeight=maxHeight;}}ogame.messages.combatreport={data:[{'combatReportId':$('.detailReport').attr('data-combatreportid')}],loca:[{'weapon':'','shield':'','cover':''}],// __________________________________________________________ATTRIBUTES__________________________________________________________
/**
	 * get the attributes by the active member(s)
	 *
	 * @see ogame.messages.combatreport.setCombatArray >> $this.data.combatArray, $this.data.activeMember must be set
	 * @return object result 	>> 'armorPercentage': armorpower in percentage
	 * 							>> 'weaponPercentage': weaponpower in percentage
	 * 							>> 'shieldPercentage': shieldpower in percentage
	 */getCombatValueByCombatMember:function(){var $this=ogame.messages.combatreport;var member=$this.data.activeMember;var result={'armorPercentage':0,'weaponPercentage':0,'shieldPercentage':0,'characterClassName':'-'};var countit=0;$.each($this.data.combatArray,function(key,combatMember){//if activeMember not selected and on default add all attributes of all combatMembers
if($this.check(true,member,{'values':{'is':{0:'all'}}})){result.armorPercentage+=combatMember.armorPercentage;result.weaponPercentage+=combatMember.weaponPercentage;result.shieldPercentage+=combatMember.shieldPercentage;countit++;}else{if(combatMember.ownerName==member){result.armorPercentage=combatMember.armorPercentage;result.weaponPercentage=combatMember.weaponPercentage;result.shieldPercentage=combatMember.shieldPercentage;result.characterClassName=combatMember.ownerCharacterClassName;countit=1;}}});result.armorPercentage=Math.round(result.armorPercentage/countit);result.weaponPercentage=Math.round(result.weaponPercentage/countit);result.shieldPercentage=Math.round(result.shieldPercentage/countit);return result;},/**
	 * Set the combatMember attributes
	 *
	 * @see ogame.messages.combatreport.getCombatValueByCombatMember >> resultArray with armor, weapon and shield must be set
	 * @see ogame.messages.combatreport.setCombatArray >> combatside must be set
	 */setCombatValue:function(){var $this=ogame.messages.combatreport;//set attributes by new combatmember
var result=$this.getCombatValueByCombatMember();$('.'+$this.data.combatside+'CharacterClass').text($this.loca.characterClass+' '+result.characterClassName);$('.'+$this.data.combatside+'Weapon').text($this.loca.weapon+' '+result.weaponPercentage+'%');$('.'+$this.data.combatside+'Shield').text($this.loca.shield+' '+result.shieldPercentage+'%');$('.'+$this.data.combatside+'Cover').text($this.loca.cover+' '+result.armorPercentage+'%');},setCombatLoca:function(loca_weapon,loca_shield,loca_cover,loca_characterClass){var $this=ogame.messages.combatreport;$this.loca.weapon=loca_weapon;$this.loca.shield=loca_shield;$this.loca.cover=loca_cover;$this.loca.characterClass=loca_characterClass;},// __________________________________________________________ACTIVESTATE__________________________________________________________
/**
	 * returns if a ship is active in the combat
	 *
	 * @param int id				>> shipid to proof
	 * @param object membersArray	>> memberid: object	>> id
	 *
	 * @return string returningValue	>> 'on'||'off' -> for image-css-class
	 */isActive:function(id,membersArray){var $this=ogame.messages.combatreport;// if shipid is not in the membersArray the shipimage is not active (off)
for(var key in membersArray){if(key=='length'){continue;}if($this.check(true,membersArray[key][id])){return'on';}};if($this.check(true,membersArray[id])){return'on';}return'off';},/**
	 * set the active class for all ships
	 *
	 * @param object allShipObjects	>> classes of all shipfields
	 * @param object activeShips	>> all active ships
	 */setActiveFlag4Fleet:function(allShipObjects,activeShips){var $this=ogame.messages.combatreport;var allShipClasses=$this.getAllShipClasses(allShipObjects);$.each(allShipClasses,function(key,classname){var currentShipId=$this.getShipIdByClass(classname);var isActiveClass=$this.isActive(currentShipId,activeShips);var selector=$this.getShipSelectors(currentShipId);$this.changeShipState(isActiveClass,selector['ship']);//clear count
if(isActiveClass=='off'){var shipSelector=selector['shipCount'];var lossSelector=selector['loss'];var counts={'ships':{},'losses':{}};counts['ships'][shipSelector]=0;counts['losses'][lossSelector]="";$this.setShipCount(counts);}$this.toggleShipShowState(selector['ship']);});},/**
	 * Search for the right class of the given shipID
	 *
	 * @param object possibleCategories >> shipcategories to get the right classname for id
	 * @param int id >> shipid for searching
	 *
	 * @return string|bool classname|false	>> returns the classname if it exists else false
	 */search4Class:function(possibleCategories,id){for(var index in possibleCategories){if($('.'+possibleCategories[index]+id)[0]){var classname=possibleCategories[index]+id;return classname;}}return false;},/**
	 * Get an Object with ship- and lossselector
	 *
	 * @param mixed shipID	>> can be a string or a number, id of the ship
	 *
	 * @return object result	>> 'ship': selector
	 * 								'shipCount': selector
	 * 								'loss': selector
	 */getShipSelectors:function(shipID){var $this=ogame.messages.combatreport;var possibleShipClasses=['military','civil','defense'];var classname=$this.search4Class(possibleShipClasses,shipID);var shipSelector='.'+$this.data.combatside+' .'+classname;var shipCountSelector='.'+$this.data.combatside+' .'+classname+' .ecke';var lossCountSelector='.'+$this.data.combatside+' .'+classname+' .lost_ships';var result={'ship':shipSelector,'shipCount':shipCountSelector,'loss':lossCountSelector};return result;},/**
	 * Get the shipid in the given class
	 *
	 * @param string classname	>> class of one shipobject
	 *
	 * @return string shipID
	 */getShipIdByClass:function(classname){var classlength=classname.length;var shipID=classname.substr(classlength-3);return shipID;},/**
	 * change the active state of shipfield
	 *
	 * @see ogame.messages.combatreport.setActiveFlag4Fleet
	 * @param string newState >> the state to set
	 * @param string selector >> the selector of the image
	 */changeShipState:function(newState,selector){if($(selector).hasClass('off')&&newState!='off'){$(selector).removeClass('off');}if($(selector).hasClass('on')&&newState!='on'){$(selector).removeClass('on');}if(!$(selector).hasClass(newState)){$(selector).addClass(newState);}},/**
	 * remove the ship if its marked as disabled and show all non disabled ships
	 *
	 * @param string selector >> the selector of the image
	 */toggleShipShowState:function(selector){if($(selector).hasClass('off')){$(selector).parent().hide();}if($(selector).hasClass('on')){$(selector).parent().show();}},// __________________________________________________________SHIPS__________________________________________________________
/**
	 * get only the ships of the active member(s)
	 *
	 * @param string member	>> selected combatMember
	 *
	 * @return object ships
	 */getShipsByMembers:function(member){var $this=ogame.messages.combatreport;var ships=[];if(!$this.check(true,$this.data.combatArray.shipDetails)){$.each($this.data.combatArray,function(key,combatMember){if(typeof combatMember=="object"&&typeof combatMember.shipDetails!="undefined"){if(typeof ships[combatMember.ownerName]!="undefined"){$.extend(ships[combatMember.ownerName],combatMember.shipDetails);}else{ships[combatMember.ownerName]=combatMember.shipDetails;}}else{if(typeof ships[combatMember.ownerName]=="undefined"){ships[combatMember.ownerName]={};}}});}else{if(typeof ships[$this.data.combatArray.ownerName]!="undefined"){$.extend(ships[$this.data.combatArray.ownerName],$this.data.combatArray.shipDetails);}else{ships[$this.data.combatArray.ownerName]=$this.data.combatArray.shipDetails;}}if(member=='all'){return ships;}else{return ships[member];}},/**
	 * get only the ships of the active member(s) and selected planet/moon
	 *
	 * @param member string	>> selected combatMember
	 * @param coords string >> coordinates of Planet/Moon
	 * @param type int >> 1 = planet, 3 = moon
	 * @return object ships
	 */getShipsByMembersAndCoords:function(member,coords,type){var $this=ogame.messages.combatreport;var ships=[];if(!$this.check(true,$this.data.combatArray.shipDetails)){$.each($this.data.combatArray,function(key,combatMember){if(coords!==0){// a location was selected , so we need to filter based on owner name, coordinates and type
if(typeof combatMember=="object"&&typeof combatMember.shipDetails!="undefined"){if(combatMember.ownerCoordinates===coords&&combatMember.ownerName==member&&combatMember.ownerPlanetType==type){if(typeof ships[combatMember.ownerName]!="undefined"){$.extend(ships[combatMember.ownerName],combatMember.shipDetails);}else{ships[combatMember.ownerName]=combatMember.shipDetails;}}}}else{// an owner name was selected incl. all, so we will group ships based on Owner names)
if(typeof combatMember=="object"&&typeof combatMember.shipDetails!="undefined"){if(typeof ships[combatMember.ownerName]!="undefined"){$.extend(ships[combatMember.ownerName],combatMember.shipDetails);}else{ships[combatMember.ownerName]=combatMember.shipDetails;}}}});}else{// This part of code was there, I have no clue why :D
if(typeof ships[$this.data.combatArray.ownerName]!="undefined"){$.extend(ships[$this.data.combatArray.ownerName],$this.data.combatArray.shipDetails);}else{ships[$this.data.combatArray.ownerName]=$this.data.combatArray.shipDetails;}}if(member=='all'){return ships;}else{return ships[member];}},/**
	 * Get the Array with counts und selectors to set the count of the ships
	 *
	 * @param object ships	>> shipID: count
	 * @param object losses	>> shipID: count
	 *
	 * @return object combatCountArray 	>> 'ships': object >> selector: count
	 * 									>> 'losses': object >> selector: -count
	 */getShipCountArray:function(ships,losses){var $this=ogame.messages.combatreport;var noLosses=$this.check(true,losses,{'types':{0:'isEmpty'}})?false:true;//var noLosses = losses == null || typeof losses == "undefined" || jQuery.isEmptyObject(losses) ? true : false;
var combatShipsArray={};var combatLossArray={};for(var shipID in ships){var selector=$this.getShipSelectors(shipID);var shipSelector=selector['shipCount'];combatShipsArray[shipSelector]=parseInt(ships[shipID]);if(!noLosses){var lossSelector=selector['loss'];if($this.check(true,losses[shipID])){combatLossArray[lossSelector]=parseInt(losses[shipID]);}}}var combatCountArray={'ships':combatShipsArray,'losses':combatLossArray};return combatCountArray;},/**
	 * set the count of active ships by shipcountarray
	 *
	 * @param object shipArray	>> 'ships': object	>> memberID: object	>> shipID: count
	 */setShipCount4All:function(shipArray){var $this=ogame.messages.combatreport;var ships=shipArray['ships'];var losses=$this.check(true,shipArray['losses'])?shipArray['losses']:{};var combatResultArray={};for(var index in ships){var ship=ships[index];var loss=$this.check(true,losses,{'types':{0:'isEmpty'}})&&$this.check(true,losses[index])?losses[index]:{};combatResultArray[index]=$this.getShipCountArray(ship,loss);}var shipResult={};var lossResult={};for(var memberIndex in combatResultArray){var memberShipArray=combatResultArray[memberIndex]['ships'];var memberLossArray=combatResultArray[memberIndex]['losses'];for(var shipid in memberShipArray){if($this.check(true,shipResult[shipid])){shipResult[shipid]=shipResult[shipid]+memberShipArray[shipid];}else{shipResult[shipid]=memberShipArray[shipid];}}for(var shipid in memberLossArray){if($this.check(true,lossResult[shipid])){lossResult[shipid]=lossResult[shipid]+memberLossArray[shipid];}else{lossResult[shipid]=memberLossArray[shipid];}}}var resultCountArray={'ships':shipResult,'losses':lossResult};$this.setShipCount(resultCountArray);},/**
	 * set the Shipcount if a specific combatMember is selected
	 *
	 * @param resultCombatArray object 	>> 'ships': object	>> memberID: object	>> shipID: count
	 * 								   	>> 'losses': object	.. (could be null or empty)
	 * @param memberArray object		>> memberID: object >> 'ownerName': name
	 * @param activeMember string		>> selected member in Dropdown
     * @param coords string             >> coordinates of planet/moon
     * @param planetType int                  >> 1= planet, 3= moon
	 */setShipCountByActiveMember:function(resultCombatArray,memberArray,activeMember,coords,planetType){coords=coords||0;planetType=planetType||1;var $this=ogame.messages.combatreport;var shipCounts={};var lossCounts={};for(var memberID in memberArray){var ownerName=memberArray[memberID]['ownerName'];var ownerCoordinates=memberArray[memberID]['ownerCoordinates'];var ownerPlanetType=memberArray[memberID]['ownerPlanetType'];if(ownerName==activeMember){for(var attr in resultCombatArray['ships'][memberID]){if(coords!==0){if(coords==ownerCoordinates&&planetType==ownerPlanetType){if(!shipCounts.hasOwnProperty(attr)){shipCounts[attr]=resultCombatArray['ships'][memberID][attr];}else{shipCounts[attr]=shipCounts[attr]+resultCombatArray['ships'][memberID][attr];}}}else{if(!shipCounts.hasOwnProperty(attr)){shipCounts[attr]=resultCombatArray['ships'][memberID][attr];}else{shipCounts[attr]=shipCounts[attr]+resultCombatArray['ships'][memberID][attr];}}}if($this.check(true,resultCombatArray['losses'])){for(var attr in resultCombatArray['losses'][memberID]){if(coords!==0){if(coords==ownerCoordinates&&planetType==ownerPlanetType){if(!lossCounts.hasOwnProperty(attr)){lossCounts[attr]=parseInt(resultCombatArray['losses'][memberID][attr]);}else{lossCounts[attr]=lossCounts[attr]+parseInt(resultCombatArray['losses'][memberID][attr]);}}}else{if(!lossCounts.hasOwnProperty(attr)){lossCounts[attr]=parseInt(resultCombatArray['losses'][memberID][attr]);}else{lossCounts[attr]=lossCounts[attr]+parseInt(resultCombatArray['losses'][memberID][attr]);}}}}}}if($this.check(true,shipCounts,{'types':{0:'isEmpty'}})){var countsByMemberArray=$this.getShipCountArray(shipCounts,lossCounts);$this.setShipCount(countsByMemberArray);}},/**
	 * Set Count by given result array
	 *
	 * @param object resultArray	>> 'ships': { selectorstring: count}
	 * 								>> 'losses': ...
	 */setShipCount:function(resultArray){var combatside=ogame.messages.combatreport.data.combatside;var shipResult=resultArray['ships'];var lossResult=resultArray['losses'];if(!$.isEmptyObject(shipResult)){for(var selector in shipResult){$(selector).text(shipResult[selector].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));}}else{// when there are no Ships, then reset all ecke column to 0 in the current combatside (attacker or defender)
$("."+combatside+" .ecke").text('0');}if(!$.isEmptyObject(lossResult)){for(var selector in lossResult){$(selector).text('-'+lossResult[selector].toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));}}else{// when there are no losses, then reset all lost_ships column to - in the current combatside (attacker or defender)
$("."+combatside+" .lost_ships").text('-');}},/**
	 * Get classes of all ships by jqueryobjects of them
	 *
	 * @param object allShips	>> objects
	 *
	 * @return object allShipClasses	>> all classes in array
	 */getAllShipClasses:function(allShips){var id=allShips.map(function(){var id=$(this).attr('class');return id;}).get().join();var allShipClasses=[];$.each(id.split(','),function(key,value){var classArray=value.split(' ');allShipClasses.push(classArray[1]);});return allShipClasses;},/**
	 * Set the attributes to display ships
	 *
	 * @param activeMember object		>> selected member
	 * @param combatside object			>> attacker||defender
	 * @param resultCombatArray object	>> array of the last round
	 * @param memberArray object		>> array of the specific member
     * @param coords string             >> coordinates of planet/moon
     * @param type int                  >> 1= planet, 3 = moon
	 */displayShipData:function(activeMember,combatside,resultCombatArray,memberArray,coords,type){coords=typeof coords!=='undefined'?coords:0;var $this=ogame.messages.combatreport;if($this.check(true,activeMember,{'values':{'isNot':{0:'all'}}})){//if(activeMember != 'all' && typeof activeMember != 'undefined') {
$this.setShipCountByActiveMember(resultCombatArray,memberArray,activeMember,coords,type);}else{$this.setShipCount4All($this.data.combatRounds[combatside][$this.data.combatRounds[combatside].length-1]);}},// __________________________________________________________ROUNDTEXT__________________________________________________________
/**
	 * show the last combatRound first
	 */initCombatText:function(combatData){var $this=ogame.messages.combatreport;var round=combatData['combatRounds'].length-1;$('.combat_round_list .round_id').find('a').removeClass("active");$('.combat_round_list .round_id[data-round='+round+']').find('a').addClass("active");$this.loadDataBySelectedRound(combatData['attackerJSON'],combatData['defenderJSON'],round);},/**
	 * set the text that descripe the combat by selected round
	 *
	 * @param object attackerArray	>> round: object >> 'statistic': object >> 'hits': int hitpoints
	 * 																		>> 'absorbedDamage': int absorbedDamagePoints
	 * 																		>> 'fullStrength': int strength without any absorbance
	 * @param object defenderArray	>> defenderArray @see attackerArray
	 * @param int round				>> selected round
	 */setCombatText:function(attackerArray,defenderArray,round){var $this=ogame.messages.combatreport;var attackerClass='.statistic_attacker';var defenderClass='.statistic_defender';var hitsClass='.hits';var strengthClass='.strength';var absorbedClass='.absorbed';var sumHitsAttacker=0;var sumAbsorbedDamageAttacker=0;var sumFullStrengthAttacker=0;var sumHitsDefender=0;var sumAbsorbedDamageDefender=0;var sumFullStrengthDefender=0;if($this.check(true,attackerArray,{'length':round})){for(var roundindex in attackerArray){sumHitsAttacker=sumHitsAttacker+parseInt(attackerArray[roundindex]['statistic']['hits']);sumAbsorbedDamageAttacker=sumAbsorbedDamageAttacker+parseInt(attackerArray[roundindex]['statistic']['absorbedDamage']);sumFullStrengthAttacker=sumFullStrengthAttacker+parseInt(attackerArray[roundindex]['statistic']['fullStrength']);sumHitsDefender=sumHitsDefender+parseInt(defenderArray[roundindex]['statistic']['hits']);sumAbsorbedDamageDefender=sumAbsorbedDamageDefender+parseInt(defenderArray[roundindex]['statistic']['absorbedDamage']);sumFullStrengthDefender=sumFullStrengthDefender+parseInt(defenderArray[roundindex]['statistic']['fullStrength']);}}else{sumHitsAttacker=parseInt(attackerArray[round]['statistic']['hits']);sumAbsorbedDamageAttacker=parseInt(attackerArray[round]['statistic']['absorbedDamage']);sumFullStrengthAttacker=parseInt(attackerArray[round]['statistic']['fullStrength']);sumHitsDefender=parseInt(defenderArray[round]['statistic']['hits']);sumAbsorbedDamageDefender=parseInt(defenderArray[round]['statistic']['absorbedDamage']);sumFullStrengthDefender=parseInt(defenderArray[round]['statistic']['fullStrength']);}$(attackerClass+hitsClass).text(sumHitsAttacker.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(attackerClass+absorbedClass).text(sumAbsorbedDamageAttacker.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(attackerClass+strengthClass).text(sumFullStrengthAttacker.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(defenderClass+hitsClass).text(sumHitsDefender.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(defenderClass+absorbedClass).text(sumAbsorbedDamageDefender.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));$(defenderClass+strengthClass).text(sumFullStrengthDefender.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."));},// __________________________________________________________MAIN__________________________________________________________
/**
	 * Setup all important information for the combat
	 *
	 * @param object combatArray	>> all important information init
	 * @param object combatside		>> for what side to set the information
	 */setCombatArray:function(originalCombatArray,combatside){// var combatArray = jQuery.extend({}, originalCombatArray); //shallow copy
var combatArray=jQuery.extend(true,{},originalCombatArray);//deep copy
var $this=ogame.messages.combatreport;$this.data.combatside=combatside;$this.data.memberSelection=false;if($('#'+$this.data.combatside+'_select_combatreport').find(':selected').length>0){$this.data.memberSelection=true;}// make sure that activeMember becomes a STRING, else all hell will break loose!
if($this.data.memberSelection){$this.data.activeMember=''+$('#'+$this.data.combatside+'_select_combatreport').find(':selected').val();}else{$this.data.activeMember=''+$('#'+$this.data.combatside+'_select_combatreport').data('memberName');}$this.data.activeMember=$this.data.activeMember.split("|",1)[0];$this.data.combatArray=combatArray.member;$this.data.combatRounds=[];$this.data.combatRounds[combatside]=combatArray.combatRounds;},/**
	 * Setter for combatside
	 *
	 * @param object combatside		>> for what side to set the information
	 */setCombatside:function(combatside){var $this=ogame.messages.combatreport;$this.data.combatside=combatside;},/**
	 * checks if the given object is correct
	 *
	 * @param bool easyCheck		>> the result should be only success or more information
	 * @param object checks			>>
	 *  mixed checkingObject	>> variable, array etc u wanna check - without any parameter check for undefined and null
	 *  object values2check	>> values you wanna compare with the given object ({'values':{'is':{},'isNot'{}}})
	 *  object types2check	>> types you wanna check with typeof (isEmpty, number, object, string)
	 *
	 * @return object result		>> success: bool			|| success
	 * 								>> allErrors: int
	 * 								>> valueErrors: int
	 * 								>> typeErrors: int
	 * 								>> type: string
	 * 								>> length: int
	 * 								>> lengthIsChecked: bool
	 * 								>> lengthError: int (1||0)
	 */check:function(easyCheck,checkingObject,checks){var checks=checks!=null&&typeof checks!='undefined'&&typeof checks=='object'?checks:false;var success=false;var checkingValueErrorCount=0;var checkingTypeErrorCount=0;var checkingLengthErrorCount=0;var length=0;var lengthIsProofed=false;// only if any other checks are given
if(checks!=false){var values2check=checks['values']!=null&&typeof checks['values']!='undefined'&&typeof checks['values']=='object'?checks['values']:{};var types2check=checks['types']!=null&&typeof checks['types']!='undefined'&&typeof checks['types']=='object'?checks['types']:{};var length2check=checks['length']!=null&&typeof checks['length']!='undefined'?checks['length']:false;if(!jQuery.isEmptyObject(values2check)){for(index in values2check){var isValueChecklist=values2check[index];//checking for isValue or isNotValue
if(index=='is'&&!jQuery.isEmptyObject(isValueChecklist)){for(var isValue in isValueChecklist){if(checkingObject!=isValueChecklist[isValue]){checkingValueErrorCount=checkingValueErrorCount+1;}}}if(index=='isNot'&&!jQuery.isEmptyObject(isValueChecklist)){for(var isNotValue in isValueChecklist){if(checkingObject==isValueChecklist[isNotValue]){checkingValueErrorCount=checkingValueErrorCount+1;}}}}}if(!jQuery.isEmptyObject(types2check)){if(types2check['isEmpty']){if(jQuery.isEmptyObject(checkingObject)){checkingTypeErrorCount=checkingTypeErrorCount+1;}}for(var index in types2check){if(typeof checkingObject==types2check[index]){checkingTypeErrorCount=checkingTypeErrorCount+1;}}}if(typeof checkingObject=='object'){for(var index in checkingObject){if(typeof checkingObject[index]!='undefined'){length=length+1;}}}else{var checkingString=checkingObject+"";length=checkingString.length;}if(length2check!==false&&typeof length2check=='number'&&typeof length=='number'){if(length!=length2check){checkingLengthErrorCount=checkingLengthErrorCount+1;}lengthIsProofed=true;}}if(typeof checkingObject=='undefined'||checkingObject==null){checkingTypeErrorCount=checkingTypeErrorCount+1;}var errorCount=checkingValueErrorCount+checkingTypeErrorCount;if(lengthIsProofed!=false){errorCount=errorCount+checkingLengthErrorCount;}if(errorCount==0){success=true;}var result={'success':success,'allErrors':errorCount,'valueErrors':checkingValueErrorCount,'typeErrors':checkingTypeErrorCount,'type':typeof checkingObject,'length':length,'lengthChecked':lengthIsProofed,'lengthError':checkingLengthErrorCount};if(easyCheck){return success;}else{return result;}},/**
	 * set the combatinformation for the report (main-function)
	 *
	 * @param object combatArray	>> all important information init
	 * @param object combatside		>> for what side to set the information
	 */loadData:function(combatArray,combatside){var $this=ogame.messages.combatreport;$this.setCombatArray(combatArray,combatside);$this.loadDataBySelectedCombatMember(combatArray,combatside);$this.setCombatValue();},/**
     * set roundspecific information
     *
     * @see ogame.messages.combatreport.setCombatText for params
     */loadDataBySelectedRound:function(attackerCombatArray,defenderCombatArray,selectedRound){var $this=ogame.messages.combatreport;var round2show=parseInt(selectedRound);var attacker=$('.attacker .participant_select option:selected').val();// get the selected attacker
var defender=$('.defender .participant_select option:selected').val();// get the selected defender
var attacker_coords=$('.attacker .participant_select option:selected').data('coords');// get the coordinates of selected attacker planet (if planet selected)
var defender_coords=$('.defender .participant_select option:selected').data('coords');// get the coordinates of selected defender planet (if planet selected)
var attacker_fleetID=[];var defender_fleetID=[];// check if planet was selected, if so we need to push its fleet Id in fleetIDs and sanitize the member name
if(typeof attacker_coords!="undefined"){ids=attacker.split("|")[1].split(":");attacker_fleetID.push(ids);attacker=attacker.split("|")[0];}else if(attacker!='all'&&typeof attacker!="undefined"){// else if a member selected then we need to push the Ids of all its fleets in fleetIDs
attacker_coords=0;$('.attacker .participant_select option').each(function(){if(attacker==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){attacker_fleetID.push($(this).val().split("|")[1].split(":"));}});}else{// no specifications if all was selected, attacker_fleetID must remain empty
attacker_fleetID=[];}if(typeof defender_coords!="undefined"){ids=defender.split("|")[1].split(":");defender_fleetID.push(ids);defender=defender.split("|")[0];}else if(defender!='all'&&typeof defender!="undefined"){// else if a member selected then we need to push the Ids of all its fleets in fleetIDs
defender_coords=0;$('.defender .participant_select option').each(function(){if(defender==$(this).val().split("|")[0]&&typeof $(this).val().split("|")[1]!="undefined"){defender_fleetID.push($(this).val().split("|")[1].split(":"));}});}else{// no specifications if all was selected, defender_fleetID must remain empty
defender_fleetID=[];}// check if fleetID was not empty , then we need to get results of just this Fleets
if(attacker_fleetID.length>0){for(var level1 in attackerCombatArray){if(level1=='combatRounds'){for(var level2 in attackerCombatArray[level1][round2show]){if(level2=='ships'){for(var shipIds in attackerCombatArray[level1][round2show][level2]){var exist=$.inArray(shipIds,attacker_fleetID[0]);// check if we need the result of this fleet Id
if(exist==-1){// if not , then remove its informations from the global result
delete attackerCombatArray[level1][round2show][level2][shipIds];}}}}}}}if(defender_fleetID.length>0){for(var level1 in defenderCombatArray){if(level1=='combatRounds'){for(var level2 in defenderCombatArray[level1][round2show]){if(level2=='ships'){for(var shipIds in defenderCombatArray[level1][round2show][level2]){var exist=$.inArray(shipIds,defender_fleetID[0]);// check if we need the result of this fleet Id
if(exist==-1){// if not , then remove its informations from the global result
delete defenderCombatArray[level1][round2show][level2][shipIds];}}}}}}}var attackerCombatRounds=attackerCombatArray['combatRounds'];var defenderCombatRounds=defenderCombatArray['combatRounds'];if($this.check(true,attackerCombatRounds,{'length':selectedRound})){round2show=round2show-1;}round2show=round2show+"";$this.setCombatside('attacker');$this.setShipCount4All(attackerCombatRounds[round2show]);$this.setCombatside('defender');$this.setShipCount4All(defenderCombatRounds[round2show]);if($this.data.memberSelection){//$this.resetDropDowns();
}$this.setCombatText(attackerCombatRounds,defenderCombatRounds,selectedRound);},/**
	 * set the 2 dropdowns to no selected member
	 */resetDropDowns:function(){$('#attacker_select_combatreport').val('all').ogameDropDown('refresh');$('#defender_select_combatreport').val('all').ogameDropDown('refresh');},/**
	 * set all memberspecific information
	 *
	 * @param combatArray object	>> all important information init
	 * @param combatside object		>> for what side to set the information
     * @param coords string         >> coordinates of planet
     * @param planetType int              >> 1 = planet, 3 = moon
	 */loadDataBySelectedCombatMember:function(originalCombatArray,combatside,coords,planetType){// var combatArray = jQuery.extend({}, originalCombatArray); //shallow copy
var combatArray=jQuery.extend(true,{},originalCombatArray);//deep copy
// make sure that these params have a "proper" value
coords=coords||0;planetType=planetType||1;var $this=ogame.messages.combatreport;$this.setCombatArray(combatArray,combatside);// set all ships of a combatside and get all active ships
var ships=$('.'+$this.data.combatside+' .buildingimg');// Add defenses as well
var defense=$('.'+$this.data.combatside+' .defenseimg');ships=$.merge(ships,defense);var activeShips=$this.getShipsByMembersAndCoords($this.data.activeMember,coords,planetType);//set isActive-Flag to shippictures
$this.setActiveFlag4Fleet(ships,activeShips);$this.displayShipData($this.data.activeMember,$this.data.combatside,combatArray['combatRounds'][combatArray['combatRounds'].length-1],combatArray['member'],coords,planetType);$this.setCombatValue();}};function closeDetails(id,expireTime){var elem=$("#fleet"+id);elem.children(".openDetails").children().children().attr("src","//gf2.geo.gfsrv.net/cdn10/de1e5f629d9e47d283488eee0c0ede.gif");elem.children(".quantity").show();elem.removeClass("detailsOpened");elem.addClass("detailsClosed");currentMovementTabExtensionStates[id]=[0,expireTime];// set to 0 == closed
updateCookieStatus(currentMovementTabExtensionStates);}function openDetails(id,expireTime){var elem=$("#fleet"+id);elem.children(".openDetails").children().children().attr("src","//gf3.geo.gfsrv.net/cdnb6/577565fadab7780b0997a76d0dca9b.gif");elem.children(".quantity").hide();elem.removeClass("detailsClosed");elem.addClass("detailsOpened");currentMovementTabExtensionStates[id]=[1,expireTime];// set to 0 == closed
updateCookieStatus(currentMovementTabExtensionStates);}function updateCookieStatus(tabStates){var stringifiedState=JSON.stringify(tabStates);var stringifiedOptions=JSON.stringify({expires:Math.round(new Date().getTime()/1000)+7*86400});$.cookie("tabBoxFleets",stringifiedState,stringifiedOptions);}function openCloseDetails(id,expireTime){if($("#fleet"+id).attr("class")=="fleetDetails detailsOpened"){closeDetails(id,expireTime);}else{openDetails(id,expireTime);}}function preCloseMovements(){$.each(currentMovementTabExtensionStates,function(id,data){if(data[0]==0){var elem=$("#fleet"+id+" span.openDetails a");var expireTime=elem.attr('data-end-time');closeDetails(id,expireTime);}});}function initMovement(){initToggleHeader('movement');preCloseMovements();if(showInfos==undefined){var showInfos=0;}$("a.openCloseDetails").click(function(){openCloseDetails($(this).attr('data-mission-id'),$(this).attr('data-end-time'));});$(".closeAll").click(function(){if(showInfos==0){showInfos=1;$(".closeAll").children().removeClass('all_open').addClass('all_closed');}else{showInfos=0;$(".closeAll").children().removeClass('all_closed').addClass('all_open');}$("a.openCloseDetails").each(function(){if(showInfos===1){closeDetails($(this).attr('data-mission-id'),$(this).attr('data-end-time'));}else if(showInfos===0){openDetails($(this).attr('data-mission-id'),$(this).attr('data-end-time'));}});});timerHandler.appendCallback(function(){});}function addUserToUnion(){$("#participantselect").append($("#buddyselect").find("li.ui-selected"));}function removeUserFromUnion(){$("#buddyselect").append($("#participantselect").find("li.ui-selected"));}function addUserToUnionByForm(){var user=$('#unionUserSearch').find('[name="addtogroup"]');var userName=user.val();var participant=$('#participantselect');if(participant.find('li[ref="'+userName+'"]').length==0){participant.append($(document.createElement('li')).attr('ref',userName).text(userName));}user.val('');}function setUnionUsers(){var unionUsers='';$("#participantselect").find("li").each(function(){unionUsers+=$(this).attr('ref')+';';});unionUsers=unionUsers.substring(0,unionUsers.length-1);$('#unionUsers').val(unionUsers);}function unionUser(response){var data=$.parseJSON(response);if(data["status"]){addUserToUnionByForm();}else{errorBoxAsArray(data["errorbox"]);}}function initFederationLayer(){$("#switch").click(function(){var searchFed=$("#searchFed");searchFed.find("> .wrap").toggle();searchFed.find("> #honorWarning").toggle();});$("#buddyselect, #participantselect").selectable({filter:"li:not(.undermark)"});$(document).undelegate('ul#buddyselect li','dblclick').delegate('ul#buddyselect li','dblclick',function(){addUserToUnion();}).undelegate('ul#participantselect li','dblclick').delegate('ul#participantselect li','dblclick',function(){removeUserFromUnion();});}function submit_unionform(){setUnionUsers();ajaxFormSubmit('unionform',$('form#unionform').attr('action'),unionEdit);}function recallShipCountdown(fleetId,currentRecallTime){var thisObj=this;var $element=$(".reversal_time[ref='"+fleetId+"']");if(isMobile&&$element.length){this.updateCountdown=function(){var timestamp=thisObj.countdown.getLeftoverTime();var formattedDate=getFormatedDate(new Date(timestamp*1000+timeDiff),'[d].[m].[Y] [H]:[i]:[s]');$element.html(formattedDate);};// countdown objekt
thisObj.countdown=new oldcountdown(currentRecallTime,3,2);thisObj.timer=timerHandler.appendCallback(thisObj.updateCountdown);thisObj.updateCountdown();}}function initNotesForm(){$('select').ogameDropDown();$("#createNote .text").trigger("keyup");if($('#popupContent').length){initNotes();}}function initNotes(){$('select').ogameDropDown();function formHasChanges(form){var hasChanges=false;$(form).find(':input').each(function(){if(typeof $(this).data('value')!='undefined'){if($(this).data('value')!=$(this).val()){hasChanges=true;}}});return hasChanges;}var $overlayDiv=$('.overlayDiv.notices');$overlayDiv.find('.openOverlay').unbind('click').bind('click',function(){var overlayClass=$(this).attr('data-overlay-class');var options={title:$(this).attr('data-title'),close:function(){var $thisObj=$('.'+overlayClass);if(formHasChanges($thisObj.find('form'))){errorBoxDecision(LocalizationStrings.question,locaNotes.changesNotSaved+"<br/><br/>"+locaNotes.questionSaveChanges,LocalizationStrings.yes,LocalizationStrings.no,function(){$thisObj.find('form').trigger('submit');$thisObj.remove();},function(){$thisObj.remove();},true);}else{$thisObj.remove();}},'class':overlayClass};openOverlay($(this).attr('href'),options);if(overlayClass.indexOf('newNote-')===0){var number=parseInt(overlayClass.replace(/^newNote-/,''))+1;$(this).attr('data-overlay-class','newNote-'+number);}return false;});$(document).undelegate('#noteList form','submit').delegate('#noteList form','submit',function(){$.post($('#noteList').attr('rel'),$(this).serialize(),function(data){$overlayDiv.html(data);});}).undelegate('#createNote form [type=submit]','click').delegate('#createNote form [type=submit]','click',function(e){e.preventDefault();$(this).parents('form').submit();}).undelegate('#createNote form','submit').delegate('#createNote form','submit',function(e){e.preventDefault();var $thisObj=$(this);$.ajax({url:$(this).attr('rel'),type:"post",data:$thisObj.serialize(),dataType:"json",error:function(){fadeBox(LocalizationStrings.error,true);},success:function(data){if(data.error!=null){fadeBox(data.error,true);}else{if($('#popupContent').length){$(window).unbind("beforeunload.checkChanges");location.href=$thisObj.attr('rel')+"&popup=1";}else{if($thisObj.parents('.overlayDiv').is(':visible')){$thisObj.parents('.overlayDiv').dialog('option','close',function(){$(this).remove();}).dialog('close');}if(data.success!=null){fadeBox(data.success,false);}$overlayDiv.load($overlayDiv.find('#noteList').attr('rel'));}}}});return false;}).undelegate('#createNote .textBox','keyup touchstart change').delegate('#createNote .textBox','keyup touchstart change',function(){var sum=$(this).val().length;var max=$(this).attr('data-max-length');if(sum>max){var range=$(this).getSelection();$(this).val($(this).val().substr(0,max));sum=max;$(this).setSelection(range);}$(this).parents("form").find(".cntChars").text(sum);});$(window).unbind("beforeunload.checkChanges").bind("beforeunload.checkChanges",function(){var hasChanges=false;$('#createNote form').each(function(){if(formHasChanges(this)){hasChanges=true;}});if(hasChanges){return locaNotes.changesNotSaved;}});}function getAjaxEventbox(){$.get(ajaxEventboxURI,reloadEventbox,"text");}function reloadEventbox(data){var evalData;if(typeof data==='string'){evalData=$.parseJSON(data);}else{evalData=data;}var type=typeof evalData["eventText"];var actionSum=parseInt(evalData["friendly"])+parseInt(evalData["neutral"])+parseInt(evalData["hostile"]);if(actionSum>0){var $eventList;var $eventDetails=$('<p class="event_list">');if($('body').attr('id')==='galaxy'){$eventDetails.append('<span class="next_event">'+eventboxLoca.nextEvent+': <span class="countdown" id="tempcounter" name="countdown"></span></span>').append('<span class="next_event">'+eventboxLoca.nextEventText+': <span class="'+evalData["eventType"]+'">'+evalData["eventText"]+'</span></span>');$eventList=$eventDetails;}else{var missions=actionSum===1?eventboxLoca.mission:eventboxLoca.missions;$eventList=$('<p class="event_list">'+actionSum+' '+missions+': </p>');if(evalData["friendly"]){$eventList.append('<span class="undermark">'+evalData["friendly"]+' '+eventboxLoca.friendly+'</span>');}if(evalData["neutral"]){if(evalData["friendly"]){$eventList.append(', ');}$eventList.append('<span class="middlemark">'+evalData["neutral"]+' '+eventboxLoca.neutral+'</span>');}if(evalData["hostile"]){if(evalData["friendly"]||evalData["neutral"]){$eventList.append(', ');}$eventList.append('<span class="overmark">'+evalData["hostile"]+' '+eventboxLoca.hostile+'</span>');}$eventDetails.append('<span class="next_event">'+eventboxLoca.nextEvent+': <span class="countdown" id="tempcounter" name="countdown"></span></span>').append('<span class="next_event">'+eventboxLoca.nextEventText+': <span class="'+evalData["eventType"]+'">'+evalData["eventText"]+'</span></span>');$eventList.append($eventDetails);}$('#eventboxFilled p.event_list').remove();$('#eventboxFilled').prepend($eventList);}if(type==="string"||type==="undefined"){$("#eventboxLoading").hide();if(actionSum>0){$("#eventboxBlank").hide();$("#eventboxFilled").show();// Dieser Countdown sorgt dafuer, dass nach dem Ablauf des aktuell angezeigten Events jeweils das naechste
// geladen wird. Das 3 Sek. Delay sorgt dafuer, dass es nicht beliebig haeufig deswegen neu laedt...
// Da es immer nur eine Eventbox gibt, muss der Kram im Gegensatz zu der Eventliste nicht weiter
// abgesichert werden.
new simpleCountdown(getElementByIdWithCache("tempcounter"),evalData["eventTime"],function(){setTimeout(getAjaxEventbox,3000);});}else{$("#eventboxBlank").show();$("#eventboxFilled").hide();}}}(function($){$(document).undelegate('.eventToggle','click').delegate('.eventToggle','click',function(){toggleEvents();return false;});$(document).undelegate('#eventboxContent .toggleDetails','click').delegate('#eventboxContent .toggleDetails','click',function(){toggleDetails.call(this);return false;});$(function(){if($("#eventboxContent").is(":visible")){toggleEvents.loaded=true;$('#js_eventDetailsClosed').hide();$('#js_eventDetailsOpen').show();}if(window.isStandalonePage===undefined||window.isStandalonePage===false){getAjaxEventbox();}});})(jQuery);/**
 * Created by florianer on 04.07.16.
 */if(ogame===undefined){var ogame={};}ogame.Notify=function(title,text,options){this.canNotify=false;this.title=title||'OGame';this.options=options||{};this.options.body=text||'';// Let's check if the browser supports notifications
if(!("Notification"in window)){// alert("This browser does not support system notifications");
return false;}// Let's check whether notification permissions have already been granted
else if(Notification.permission==="granted"){// If it's okay let's create a notification
this.canNotify=true;}// Otherwise, we need to ask the user for permission
else if(Notification.permission!=='denied'){Notification.requestPermission(function(permission){// If the user accepts, let's create a notification
if(permission==="granted"){this.canNotify=true;}});}};ogame.Notify.prototype.setImage=function(image){this.options.icon=image;};ogame.Notify.prototype.setTag=function(tag){this.options.tag=tag;};ogame.Notify.prototype.show=function(){if(this.canNotify){this.notification=new Notification(this.title,this.options);setTimeout(this.notification.close.bind(this.notification),5000);}};function scrollToTopOfDialog(dialog){$('html, body').stop().animate({scrollTop:Math.max(0,dialog.offset().top-300)},200);}function openOverlay(url,dialogParams){if($(".ui-dialog span.ui-dialog-title:contains('"+dialogParams.title+"')").length){return;}if(typeof openOverlay.index=="undefined"){openOverlay.index=0;}else{openOverlay.index++;}var currentIndex=openOverlay.index;var dialogParams=dialogParams||{};if((typeof dialogParams.type=='undefined'||dialogParams.type!='inline')&&!url.match(new RegExp("^("+ogameUrl+"|"+startpageUrl+")"))){window.open('redir.php?url='+encodeURIComponent(url),'_newtab');return;}if(typeof dialogParams.height=='undefined'){dialogParams.height="auto";}if(typeof dialogParams.width=='undefined'){dialogParams.width="auto";}if(typeof dialogParams.position=='undefined'){if(isMobile&&!isMobileApp){dialogParams.position={my:"top",at:"top"};}else{dialogParams.position={my:"center",at:"center"};}}dialogParams.closeText="";if($(".overlayDiv").length&&!isMobile){var lastOverlay=$(".overlayDiv:last");var offset=lastOverlay.offset();dialogParams.position={my:"left top",at:"left+"+(offset.left+10)+" top+"+(offset.top+10)};}function positionDialog(dialog){var $dialogParent=dialog.parent(".ui-dialog");if($dialogParent.length){$dialogParent.css('top',Math.max(0,parseInt($dialogParent.css('top').replace(/px$/,'')))).css('left',Math.max(0,parseInt($dialogParent.css('left').replace(/px$/,''))));}}var type=dialogParams.type;delete dialogParams.type;if(type!='inline'){var loadImage=$(document.createElement('img')).attr('src','//gf1.geo.gfsrv.net/cdnc6/4161a64a933a5345d00cb9fdaa25c7.gif').attr('alt',LocalizationStrings.loading);var centerDiv=$(document.createElement('div')).css('text-align','center').css('margin-top','20px').append(loadImage);var dialog=$(document.createElement("div")).addClass('overlayDiv').css('display','none').append(centerDiv).appendTo("body");var defaultClose=function(){dialog.find('select').ogameDropDown('destroy');dialog.remove();Tipped.hideAll();};switch(typeof dialogParams.close){case'function':// Nothing to do
break;case'string':var closeCallbacks=dialogParams.close.split(' ');dialogParams.close=function(){$.each(closeCallbacks,function(i,e){if(e=='__default'){defaultClose();}else{window[e]();}});};break;default:dialogParams.close=defaultClose;break;}}if(typeof url=='string'){var queryObject=$.deparam($.param.querystring(url));if(typeof queryObject.page!='undefined'){dialog.attr('data-page',queryObject.page);}if(!isMobile&&$.inArray(queryObject.page,popupWindows)!=-1){var top=Math.max(0,Math.floor($(window).height()/2-dialogParams.popupHeight/2));var left=Math.max(0,Math.floor($(window).width()/2-dialogParams.popupWidth/2));var popup=window.open(url+'&popup=1',queryObject.page,"width="+dialogParams.popupWidth+","+"height="+dialogParams.popupHeight+","+"scrollbars=yes,"+"resizable=yes,"+"top="+top+","+"left="+left);dialog.remove();popup.focus();return;}}if(typeof dialogParams['class']!='undefined'){var overlayClass=dialogParams['class'].split(' ').join('.');if($(".overlayDiv."+overlayClass).length){$.get(url,{},function(data){$(".overlayDiv."+dialogParams['class']).empty().append(data).dialog("moveToTop");});dialog.remove();dialog=$(".overlayDiv."+overlayClass);if(typeof queryObject.page!='undefined'){dialog.attr('data-page',queryObject.page);}if(typeof dialogParams['title']!='undefined'){dialog.dialog('option','title',dialogParams['title']);}scrollToTopOfDialog(dialog);return true;}else{dialog.addClass(dialogParams['class']);}}if(type=='inline'){dialog=$(url);}if(isNaN(dialogParams.dragStart)&&isNaN(dialogParams.dragStop)){var background;dialogParams.dragStart=function(){$('html').data('noclick',true);dialog.dialog('option','width',dialog.width()).dialog('option','height',dialog.height());background={'bg':dialog.css('background'),'image':dialog.css('background-image'),'x':dialog.css('background-position-x'),'y':dialog.css('background-position-y'),'position':dialog.css('background-position')};dialog.find('select').ogameDropDown('hide');dialog.children().hide();// da die dropdowns nun ausserhalb sind, muessen sie auch separat versteckt und wieder angezeigt werden
var dropDowns=dialog.find('.markItUpDropMenu[id]');for(var i=0;i<dropDowns.length;++i){var $myDropDown=$('body>ul[rel='+dropDowns[i].id+']');// Anpassung beim 1. Mal:
var adjustTop=typeof $myDropDown.attr('old_left')=='undefined'?-18:0;var adjustLeft=typeof $myDropDown.attr('old_left')=='undefined'?-6:0;$myDropDown.attr('old_top',dialog.offset()['top']+adjustTop).attr('old_left',dialog.offset()['left']+adjustLeft).hide();// Werte merken fuer dragStop
}dialog.css('background','#000000');};dialogParams.dragStop=function(){setTimeout(function(){$('html').data('noclick',false);},100);// try to use the different css properties of different browsers
if(typeof dialog.bg=='undefined'||dialog.bg.length==0){dialog.css('background-image',background.image);if(typeof background.position=='undefined'||background.position.length==0){dialog.css('background-position-x',background.x).css('background-position-y',background.y);}else{dialog.css('background-position',background.position);}}else{dialog.css('background',background.bg);}dialog.children().show();// verschiebe die Dropdowns in der gleichen Weise wie den Dialog selbst
var dropDowns=dialog.find('.markItUpDropMenu[id]');for(var i=0;i<dropDowns.length;++i){var $innerUl=$('body>ul[rel='+dropDowns[i].id+']');$innerUl.css({'top':parseInt($innerUl.css('top'))-$innerUl.attr('old_top')+dialog.offset()['top']+'px','left':parseInt($innerUl.css('left'))-$innerUl.attr('old_left')+dialog.offset()['left']+'px'});if($(dropDowns[i]).attr('data-opened')==1){$innerUl.show();}}dialog.dialog('option','width',dialogParams.width).dialog('option','height',dialogParams.height);positionDialog(dialog);};}if(isNaN(dialogParams.resizable)){dialogParams.resizable=false;}if(isMobile){dialogParams.draggable=false;//        dialogParams.modal = true;
}if(dialogParams.modal){dialogParams.open=function(){$('.ui-widget-overlay').css('height','').css('width','');};}switch(type){case'iframe':var width=overlayWidth;var height=overlayHeight;if(typeof dialogParams.iframeWidth!='undefined'){width=dialogParams.iframeWidth;delete dialogParams.iframeWidth;}if(typeof dialogParams.iframeHeight!='undefined'){height=dialogParams.iframeHeight;delete dialogParams.iframeHeight;}dialog.html("<iframe allowTransparency='true'"+"frameborder='0' hspace='0' src='"+url+"' "+"id='TB_iframeContent' name='TB_iframeContent"+Math.round(Math.random()*1000)+"' "+"style='width:"+(width+25)+"px;height:"+(height+1)+"px;' >"+"</iframe>").dialog(dialogParams).dialog("moveToTop");positionDialog(dialog);break;case'inline':var inlineObject=$(url);var $dialogParent=inlineObject.parent();inlineObject.addClass('overlayDiv').dialog(dialogParams).dialog("moveToTop");positionDialog(inlineObject);break;default:dialog.dialog(dialogParams).dialog("moveToTop");$.get(url,{}).done(function(data){dialog.empty().append(data).dialog('option','position',dialog.dialog('option','position'));setTimeout(function(){dialog.dialog('option','position',dialog.dialog('option','position'));positionDialog(dialog);},100);$(document).trigger('ajaxShowOverlay');}).fail(function(){});}Tipped.hideAll();$("select").ogameDropDown('hide');if(!isMobile){$(window).bind('resize.overlay'+currentIndex,function(){if(dialog.is(':data(dialog)')){dialog.dialog('option','position',dialog.dialog('option','position'));positionDialog(dialog);}else{$(window).unbind('resize.overlay'+currentIndex);}});}}// checks if any overlay is there at all
function isOverlayOpen(){return $(".overlayDiv").length>0;}function initOverlays(){$(document).undelegate('a[href*="overlay=1"], button[data-target*="overlay=1"], a.overlay, button.overlay','click').delegate('a[href*="overlay=1"], button[data-target*="overlay=1"], a.overlay, button.overlay','click',function(e){e.preventDefault();var url=$(this).attr('href')||$(this).attr('data-target');if($(this).data('overlay-same')){var $uiDialog=$(this).parents('.ui-dialog');var $overlayDiv=$uiDialog.find('.overlayDiv');if($(this).data('overlay-same')&&$overlayDiv.length>0){$.get(url,{},function(data){removeTooltip($overlayDiv.find(getTooltipSelector()));$overlayDiv.empty()// force repaint (ie 8 bug q.q)
.append(data)// force repaint (ie 8 bug -.-)
.dialog('moveToTop');$overlayDiv.dialog("option","position",$overlayDiv.dialog("option","position"));$uiDialog.hide();// force repaint (ie 9/10 bug ~=[,,_,,]:3)
$uiDialog.show();// force repaint...  ie 9/10 bug (/  )/ ~ 
});return false;}}var dialogParams={zIndex:4000};if($(this).data('overlay-title')){dialogParams.title=$(this).data('overlay-title');}else if(typeof $(this).attr('title')!='undefined'&&$(this).attr('title').length){dialogParams.title=$(this).attr('title');}else if($(this).data('tipped_restore_title')){dialogParams.title=$(this).data('tipped_restore_title').replace(/^.+\|/,'');}if($(this).data('overlay-class')){dialogParams['class']=$(this).data('overlay-class');}if($(this).data('overlay-width')){dialogParams.width=$(this).data('overlay-width');}if($(this).data('overlay-height')){dialogParams.height=$(this).data('overlay-height');}if($(this).data('overlay-popup-width')){dialogParams.popupWidth=$(this).data('overlay-popup-width');}if($(this).data('overlay-popup-height')){dialogParams.popupHeight=$(this).data('overlay-popup-height');}if($(this).data('overlay-modal')){dialogParams.modal=$(this).data('overlay-modal');dialogParams.resizable=false;dialogParams.draggable=false;}if($(this).data('overlay-iframe')){dialogParams.type='iframe';if($(this).data('iframe-width')){dialogParams.iframeWidth=$(this).data('iframe-width');}if($(this).data('iframe-height')){dialogParams.iframeHeight=$(this).data('iframe-height');}}else if($(this).data('overlay-inline')){dialogParams.type='inline';url=$(this).data('overlay-inline');}if($(this).data('overlay-close')){dialogParams.close=$(this).data('overlay-close');}openOverlay(url,dialogParams);return false;});}function initOverview(){$(".cancelMove").click(function(){var thisObj=$(this);var locationObj=window.location;errorBoxDecision(planetMoveLoca["askTitle"],planetMoveLoca["askCancel"],planetMoveLoca["yes"],planetMoveLoca["no"],function(){$.ajax({method:"get",url:thisObj.attr("rel"),dataType:"json",cache:false,success:function(data){if(data.error.length>0){fadeBox(data.error,true);}else{location.href=getRedirectLink();}},error:function(){fadeBox(planetMoveLoca["error"],true);}});});});$(document).undelegate('#planetMaintenanceDelete','submit').delegate('#planetMaintenanceDelete','submit',function(e){e.preventDefault();ajaxFormSubmit('planetMaintenanceDelete',$(this).attr('action'),planetGivenup);}).undelegate('#abandonplanet #block','click').delegate('#abandonplanet #block','click',function(e){e.preventDefault();if(!hasAPassword){var question=$("#giveupHeadline").attr('rel')==3?loca.moonGiveupQuestion:loca.planetGiveupQuestion;question=question.replace("%planetName%",$("#giveupName").text()).replace("%planetCoordinates%",$("#giveupCoordinates").text());errorBoxDecision($("#giveupHeadline").text(),question,LocalizationStrings.yes,LocalizationStrings.no,function(){$('#planetMaintenanceDelete').submit();});}else{show_hide_menus('#validate');show_hide_menus('#giveUpNotification');}}).undelegate('.openPlanetRenameGiveupBox','click').delegate('.openPlanetRenameGiveupBox','click',function(e){e.stopPropagation();openPlanetRenameGiveupBox();});}function clearField(){currentValue=$("#planetName").val();if(defaultName==currentValue){clearInput("#planetName");}}function fillField(){currentValue=$("#planetName").val();if(currentValue==""){$("#planetName").val(defaultName);}}function openBuddyOverlay(url,title){openOverlay(url,{'class':'buddies','title':title});}function planetGivenup(data){var data=$.parseJSON(data);errorBoxAsArray(data["errorbox"]);if(typeof data["newToken"]=='string'){$("#planetMaintenanceDelete input[name='token']").val(data["newToken"]);}if(typeof data["password_checked"]!="undefined"&&data["password_checked"]){// correct password
// change the action of the form to TemplateHelper::getLink("planetGiveup")
$("#planetMaintenanceDelete").attr('action',data["intend"]);}}// https://tc39.github.io/ecma262/#sec-array.prototype.find
if(!Array.prototype.find){Object.defineProperty(Array.prototype,'find',{value:function(predicate){// 1. Let O be ? ToObject(this value).
if(this==null){throw new TypeError('"this" is null or not defined');}var o=Object(this);// 2. Let len be ? ToLength(? Get(O, "length")).
var len=o.length>>>0;// 3. If IsCallable(predicate) is false, throw a TypeError exception.
if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
var thisArg=arguments[1];// 5. Let k be 0.
var k=0;// 6. Repeat, while k < len
while(k<len){// a. Let Pk be ! ToString(k).
// b. Let kValue be ? Get(O, Pk).
// c. Let testResult be ToBoolean(? Call(predicate, T,  kValue, k, O )).
// d. If testResult is true, return kValue.
var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return kValue;}// e. Increase k by 1.
k++;}// 7. Return undefined.
return undefined;},configurable:true,writable:true});}// https://tc39.github.io/ecma262/#sec-array.prototype.findindex
if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,'findIndex',{value:function(predicate){// 1. Let O be ? ToObject(this value).
if(this==null){throw new TypeError('"this" is null or not defined');}var o=Object(this);// 2. Let len be ? ToLength(? Get(O, "length")).
var len=o.length>>>0;// 3. If IsCallable(predicate) is false, throw a TypeError exception.
if(typeof predicate!=='function'){throw new TypeError('predicate must be a function');}// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
var thisArg=arguments[1];// 5. Let k be 0.
var k=0;// 6. Repeat, while k < len
while(k<len){// a. Let Pk be ! ToString(k).
// b. Let kValue be ? Get(O, Pk).
// c. Let testResult be ToBoolean(? Call(predicate, T,  kValue, k, O )).
// d. If testResult is true, return k.
var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return k;}// e. Increase k by 1.
k++;}// 7. Return -1.
return-1;},configurable:true,writable:true});}function initPreferences(){$('.category').click(function(){document.prefs.reset();});// Generell immer die erste Gruppe ffnen
// WICHTIG ZUM DURCHKLICKEN DER TABS
$('div.wrap > div.group').hide();$('div.wrap > div.group:first,'+'div.wrap:eq(1) > div.group:eq(0),'+'div.wrap:eq(2) > div.group:eq(0),'+'div.wrap:eq(3) > div.group:eq(0)').show();$('div.wrap > div.bar').click(function(){$(this).next('div.group:hidden').slideDown('fast',function(){Tipped.show($(':input:visible'));}).siblings('div.group:visible').slideUp('fast',function(){Tipped.hide($(':input:not(:visible)'));});$('.formError').validationEngine('closePrompt');});$('.content .bar').hover(function(){$(this).addClass('bar-hover');},function(){$(this).removeClass('bar-hover');});$('#newpass1').bind('keyup',function(){var value=$(this).val();var length=value.length;var hasSpecialChars=value.match(/[^A-Za-z\d]/);var hasNumbers=value.match(/\d/);var hasMixedCase=value.match(/[a-z]/)&&value.match(/[A-Z]/);var score=0;var maxScore=4;var fulfilled={'length':false,'mixed-case':false,'special-chars':false,'numbers':false};if(length>=passwordMinLength&&length<=passwordMaxLength){fulfilled['length']=true;score++;}if(hasMixedCase){fulfilled['mixed-case']=true;score++;}if(hasNumbers){fulfilled['numbers']=true;score++;}if(hasSpecialChars){fulfilled['special-chars']=true;score++;}for(var name in fulfilled){var isFulfilled=fulfilled[name];var element=$('#password-meter-status-'+name);element.find('img.status-checked').css('visibility',isFulfilled?'visible':'hidden');}var rating=Math.floor(score/maxScore*2);var levels=new Array('low','medium','high');for(var i in levels){if(i!=rating){$('#password-meter-rating-'+levels[i]).removeClass('arrow');}else{$('#password-meter-rating-'+levels[i]).addClass('arrow');}}});$(".contentzs").tabs({beforeActivate:function(event,ui){$("input#selectedTab").val($(ui.tab).parent().prevAll().length);},activate:function(){Tipped.hide($('input:not(:visible)'));Tipped.show($('input:visible'));},active:selectedTab});$("#sortSetting").unbind('change').bind('change',function(){var name="settings_order";if($(this).val()==customSorting){var $sortOrder=$("#sortOrder");$sortOrder.attr("disabled","disabled").attr("name","");$("#sortOrderHidden").attr("name",name).val($sortOrder.val());$("#sortOrder").next(".dropdown").addClass('disabled');}else{$("#sortOrder").next(".dropdown").removeClass('disabled');var $sortOrderHidden=$("#sortOrderHidden");$sortOrderHidden.attr("name","");$("#sortOrder").removeClass('disabled').attr("name",name).removeAttr("disabled").val($sortOrderHidden.val());}}).trigger('change');//initFormValidation();
if(moveInProgress){$("form#prefs").on('submit',function(e){var $thisObj=$(this);if($thisObj.find('input#urlaubs_modus.notOnVacation:checked').length){errorBoxDecision(LocalizationStrings.attention,preferenceLoca.planetMoveQuestion,LocalizationStrings.yes,LocalizationStrings.no,function(){$thisObj.off('submit').submit();});e.preventDefault();return false;}});}if(hasAPassword){$("#prefs").bind('submit',function(){var $thisObj=$(this);var nameChange=$("#db_character",$thisObj);if(!$thisObj.data('asking')&&nameChange.val()!=undefined&&nameChange.val().length){$thisObj.data('asking',true);errorBoxDecision(preferenceLoca.changeNameTitle,preferenceLoca.changeNameQuestion.replace("%newName%",$("#db_character",$thisObj).val()),LocalizationStrings.yes,LocalizationStrings.no,function(){$thisObj.submit();$thisObj.data('asking',false);},function(){$thisObj.data('asking',false);});return false;}});}// Im aktiven Tab aber die richtige Auswahl ffnen
if(tabsDisabled){$(".contentzs").tabs("option","disabled",[1,2]);$("#tabGeneral, #tabRepresentation").attr("title",preferenceLoca.tabDisabled).attr("class","tooltip");}$('div.wrap:visible > div.bar:eq('+openGroup+')').click();}function display_info(type){if(document.getElementById("infoInput").innerHTML==""||document.getElementById("infoInput").innerHTML!=get_displayText(type)){document.getElementById("infoInput").innerHTML=get_displayText(type);}}function display_error(type){if(document.getElementById("errorInput").innerHTML==""||document.getElementById("errorInput").innerHTML!=get_errorText(type)){document.getElementById("errorInput").innerHTML=get_errorText(type);document.getElementById("error").style.display="block";}}function hide_error(type){document.getElementById("errorInput").innerHTML="";document.getElementById("error").style.display="none";}function checkUsername(){var username=document.forms['new'].elements['username'].value;if(username.length<3||username.length>=20){display_error("username");}else{hide_error();}}function checkEmail(){var email=document.forms['new'].elements['email'].value;validate=email.match(/[a-zA-Z0-9]+@+[a-zA-Z0-9]+[.]+[a-zA-Z0-9]{2,4}/);if(email.length<3||email.length>=64||!validate){display_error("email");}else{hide_error();}}/**
 * Created by christian.wiedemann on 15.03.2016.
 */var TECHID_REPAIR_DOCK=36;var burnUpCountDownForStationScreen={};var repairTimeDownForStationScreen={};function displayBurnUpEnquiry(){var button=$("input.burnUpButton");errorBoxDecision(button.data("loca_box_text"),button.data("loca_decision_text"),button.data("loca_yes"),button.data("loca_no"),function(){$.ajax({url:button.data("url"),success:function(result){var decoded=jQuery.parseJSON(result);if(decoded.success){fadeBox(decoded.reason,false,function(){});redirectSpaceDock();}else{fadeBox(decoded.reason,true,function(){});}}});},function(){});}function startWreckFieldRepairs(){var button=$("input.startRepairsButton");$.ajax({url:button.data("url"),success:function(result){var decoded=jQuery.parseJSON(result);if(decoded.success){fadeBox(decoded.reason,false,function(){});redirectSpaceDock();}else{fadeBox(decoded.reason,true,function(){});}}});}function reCommissionShips(){var button=$("input.reCommissionButton");$.ajax({url:button.data("url"),success:function(result){var decoded=jQuery.parseJSON(result);if(decoded.success){fadeBox(decoded.reason,false,function(){});redirectSpaceDock();}else{fadeBox(decoded.reason,true,function(){});}}});}function registerBurnUpCountDown(elementId){var burnUpCountDownElement=$(elementId);var duration=$(elementId).data('duration');if(duration>0){if(!burnUpCountDownForStationScreen[elementId]){burnUpCountDownForStationScreen[elementId]=new simpleCountdown(burnUpCountDownElement,duration,function(){location.reload();});}}}function registerRepairTimeCountDown(elementId){var repairTimeCountDownElement=$(elementId);var duration=$(elementId).data('duration');if(duration>0){if(!repairTimeDownForStationScreen[elementId]){repairTimeDownForStationScreen[elementId]=new simpleCountdown(repairTimeCountDownElement,duration,function(){location.reload();});}}}$(document).on("click","input.burnUpButton",displayBurnUpEnquiry);$(document).on("click","input.startRepairsButton",startWreckFieldRepairs);$(document).on("click","input.reCommissionButton",reCommissionShips);$(document).on("ajaxShowElement",function(event,tid){if(tid==TECHID_REPAIR_DOCK){registerBurnUpCountDown("#burnUpCountDownForStationScreen");registerRepairTimeCountDown("#repairTimeCountDownForStationScreen");}});$(document).on("ajaxShowOverlay",function(event){registerBurnUpCountDown("#burnUpCountDownForRepairOverlay");registerRepairTimeCountDown("#repairTimeCountDownForRepairOverlay");});function initResourceTrader(){$(".big_tabs").tabs({activate:hideTipsOnTabChange});$('.resource_link').on('click',onSelectResource);$('.btn_calltrader').on('click',callTrader);}function onSelectResource(e){var $resource=$(e.currentTarget);// if trader was not previously selected
if(!$resource.hasClass('active')){// mark new resource as active
$('.resource_link').removeClass('active');$resource.addClass('active');// blue
// make the button sharp
$('.btn_calltrader').attr('disabled',false).data('offerId',$resource.data('resourceId'));var $getNewTrader=$('.getNewTraderDiv');// if the get-new-trader-button is hidden XOR we click on the resource of our last (still active) trader
if($getNewTrader.hasClass('hidden')&&!$resource.hasClass('oldTraderActive')||!$getNewTrader.hasClass('hidden')&&$resource.hasClass('oldTraderActive')){// switch visibility of get-new-trader-button and open-last-trader-button
$getNewTrader.parent().children().toggleClass('hidden');}}}function showTradeNowButton(){if($("#callTrader").hasClass("traderActive")){$("#callTrader").show();}else{$("#callTrader").hide();}}/* ******** Code from Old Trader = Resource Trader ******* */function calcCosts(id,amount){return Math.ceil(amount*factor[offer_id]/factor[id]);}function calcInputFromCosts(id,amount){return Math.max(Math.floor(amount/factor[offer_id]*factor[id]),0);}function setValue(id,value){if(offer_id==id){$("#"+id+"_value_label").html(number_format(value,0,loca['decimalPoint'],loca['thousandsSeparator']));}else{formatNumber("#"+id+'_value',value);}}function checkValue(id){setValue(id,Math.min(getValue($("#"+id+"_value").val()),Math.round(storage[id])));free_id=6-id-offer_id;offer_costs=calcCosts(free_id,getValue($("#"+free_id+"_value").val()));costs=calcCosts(id,getValue($("#"+id+"_value").val()));freeOfferCosts=Math.round(offer_amount-offer_costs);if(costs>freeOfferCosts){setValue(id,calcInputFromCosts(id,freeOfferCosts));costs=calcCosts(id,getValue($("#"+id+"_value").val()));}offer_costs=offer_costs+costs;setValue(offer_id,offer_costs);document.getElementById(id+'_storage').innerHTML=number_format(storage[id]-getValue($("#"+id+"_value").val()),0,loca['decimalPoint'],loca['thousandsSeparator']);}function setMaxValue(id){setValue(id,storage[id]);checkValue(id);}function callTrader(e){if($(e.currentTarget).attr('disabled')=='disabled'){return;}var id=$(e.currentTarget).data('offerId'),askOverwrite=$(e.currentTarget).data('askOverwrite');if(typeof askOverwrite=='undefined'){askOverwrite=true;}if(darkMatter<traderCosts){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);return;}function newTrader(){if(!$('.call_trader_box .getNewTraderDiv').hasClass('hidden')){$('.call_trader_box').children().toggleClass('hidden');}$('.resource_list .resource_link').removeClass('oldTraderActive').filter(function(index){return $(this).data('resourceId')==id;}).addClass('oldTraderActive');// remove class from all resources, add to active trader
$.post(traderCallLink,{offer_id:id,token:traderResourcesToken},function(data){data=$.parseJSON(data);traderResourcesToken=data.newToken;if(data["status"]=="1"){$('#callTrader').show().addClass('traderActive');traderObj.reloadResources();$("#callTrader").addClass("traderActive").show();openOverlay(traderOverlayLink,{'class':"traderlayer"});var $activeTrader=$("#activeTrader");var resourceName="metal";var headline=loca.traderResourceTitleMetal;switch(id){case 2:resourceName="crystal";headline=loca.traderResourceTitleCrystal;break;case 3:resourceName="deut";headline=loca.traderResourceTitleDeuterium;break;}$activeTrader.find('.left_content #material').attr('class',resourceName);$activeTrader.find('p.stimulus').html(headline);$activeTrader.show();$("#boxHeader, #boxFooter").show();}else{errorBoxAsArray(data["errorbox"]);}});}if(askOverwrite&&$("#callTrader").is(':visible')){errorBoxDecision(loca.traderResourceNewQuestionHeadline,loca.traderResourceNewQuestion,LocalizationStrings.yes,LocalizationStrings.no,newTrader);}else{newTrader();}}function tradeDone(data){data=$.parseJSON(data);traderResourcesToken=data.newToken;if(data["status"]=="1"){$(".overlayDiv.traderlayer").dialog('close');$('.call_trader_box').children().toggleClass('hidden');traderObj.reloadResources();$("#callTrader").removeClass('traderActive').hide();$('.resource_link').removeClass('oldTraderActive active');$('.btn_calltrader').attr('disabled',true);$("#activeTrader").hide();}errorBoxAsArray(data["errorbox"]);}function closeSearch(){if(currentPage!==undefined){if(currentPage=='fleet1'||currentPage=='fleet2'){$('a#continue').focus();}else if(currentPage=='fleet3'){$('a#start').focus();}}}// moved to global scope due to CDN issues
inventoryObj={currentPage:null,currentItems:null,currentItem:null,currentCategory:null,initalizeSlider:function(items,slider,width,height,doSlideIn,force,titleClass,small,buildNavigation){if(inventoryObj.currentItems==items&&typeof force=='undefined'||force==false){return;}inventoryObj.currentItems=items;// don't use slideIn on Overview
doSlideIn=doSlideIn||'slideIn';titleClass=titleClass||'tooltipHTML js_hideTipOnMobile';if(typeof small=='undefined'){small=true;}if(typeof buildNavigation=='undefined'){buildNavigation=true;}$('#'+slider+'Box').remove('.anythingSlider');var newItems=[];var counter=0;for(var key in items){var item=items[key];if(typeof item.hide!='undefined'&&item.hide){continue;}if(inventoryObj.currentPage=='shop'||inventoryObj.currentPage=='inventory'){// switch sorting horizontal <=> vertical
var modulo=counter%inventoryObj.itemsPerSlide;newItems[counter+2*(modulo%3)-2*Math.floor(modulo/3)]=item;}else{// buff bar
newItems[counter]=item;}counter++;}var slideCounter=0,i=0,$newSlider=$('<ul id="'+slider+'" />');for(var length=newItems.length;i<length;i++){if(typeof newItems[i]=='undefined'){$lastSlide.append('<div class="item_img"><div class="empty border5px"></div></div>');continue;}var item=newItems[i];if(i%inventoryObj.itemsPerSlide==0){var $lastSlide=$('<li class="slide_'+slideCounter+'" />').appendTo($newSlider);slideCounter++;}var amount,amountClass,saleBadge;if(inventoryObj.currentPage=='shop'){amount=getNumberFormatShort(item.costs,null)+' '+loca.currency[item.currency];amountClass='price';}else{amount=getNumberFormatShort(item.amount);amountClass='amount';}var imageName;if(small){imageName=item.imageLarge+'-75x.png';}else{imageName=item.imageLarge+'-100x.png';}var activationClass;if(item.canBeActivated||item.canBeBoughtAndActivated){activationClass="enabled";}else{activationClass="disabled";}if(item.isReduced){saleBadge='<div class="sale_badge '+activationClass+'"></div>';}else{saleBadge='';}var isActiveClass=item.timeLeft!=null?' js_is_active ':'';var remainingTime='';var itemTitle=item.title;if(slider.indexOf('js_activeItemSlider')!=-1){itemTitle='';// only show remaining time on active item slider AND if the item is active:
remainingTime=item.timeLeft!=null?'<span class="js_duration undermark" data-total-duration="'+item.totalTime+'">'+item.timeLeft+'</span>':'';}var pusher='';// @TODO: add the logic for this condition:
// only show pusher if we're on overview AND item is active:
if(item.timeLeft!=null&&slider.indexOf('js_activeItemSlider')!=-1){pusher='<div class="pusher"></div>';}var birthdayDiv='';if($.inArray(birthdayCategory,item.category)!=-1){birthdayDiv='<div class="event_active_hint"></div>';}$lastSlide.append('<div class="item_img r_'+item.rarity+'" style="background-image: url(/cdn/img/item-images/'+imageName+');">'+'<div class="item_img_box">'+birthdayDiv+'<div class="activation '+activationClass+isActiveClass+'"></div>'+'<a href="javascript:void(0);" tabindex="1" title="'+itemTitle+'" class="detail_button '+titleClass+' '+doSlideIn+'" ref="'+item.ref+'">'+saleBadge+'<span class="ecke"><span class="level '+amountClass+'">'+amount+'</span></span></a></div>'+remainingTime+pusher+'</div>');}$('#'+slider+'Box').prepend($newSlider);//Fill up empty Item Slots:
if(i%inventoryObj.itemsPerSlide!=0){for(var j=i%inventoryObj.itemsPerSlide;j<inventoryObj.itemsPerSlide;j++){$('#'+slider+' li:last').append('<div class="item_img"><div class="empty border5px"></div></div>');}}//Fill empty Items End
return mySlider=$('#'+slider).anythingSlider({startStopped:true,// If autoPlay is on, this can force it to start stopped
buildStartStop:false,expand:true,resizeContents:false,theme:'default',infiniteSlides:false,autoPlay:false,easing:'swing',resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,hashTags:true,buildNavigation:buildNavigation,// Callback when the plugin finished initializing (for IPad Swipe Event)
onInitialized:function(e,slider){if(isMobile){var time=1000,// allow movement if < 1000 ms (1 sec)
range=50,// swipe movement of 50 pixels triggers the slider
x=0,t=0,touch="ontouchend"in document,st=touch?'touchstart':'mousedown',mv=touch?'touchmove':'mousemove',en=touch?'touchend':'mouseup';slider.$window.bind(st,function(e){// prevent image drag (Firefox)
//e.preventDefault();
t=new Date().getTime();x=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;}).bind(en,function(e){t=0;x=0;}).bind(mv,function(e){//                            e.preventDefault();
var newx=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,r=x===0?0:Math.abs(newx-x),// allow if movement < 1 sec
ct=new Date().getTime();if(t!==0&&ct-t<time&&r>range){if(newx<x){slider.goForward();}if(newx>x){slider.goBack();}t=0;x=0;}});}}});},// End initalizeSlider
initShop:function(){var thisObj=this;$(window).unbind('.shop');$(document).undelegate('.slideIn','click.shop').delegate('.slideIn','click.shop',function(){if(thisObj.currentItem==$(this).attr('ref')){thisObj.currentItem=null;$.bbq.pushState({'item':''});}else{thisObj.currentItem=$(this).attr('ref');$.bbq.pushState({'item':$(this).attr('ref')});}});//Buttons Start:
$('button.to_shop').bind('click.shop',function(){$.bbq.pushState({'page':'shop'});});$('button.to_inventory').bind('click.shop',function(){$.bbq.pushState({'page':'inventory'});});$('button.buyResourcesLink').bind('click',function(){reload_page($(this).data('link'));});$('.to_shop, .to_inventory').hover(function(){$(this).addClass('hover');},function(){$(this).removeClass('hover');});// End Buttons
// Rebuild the Slider if another Category is selected:
$('.categoryFilter li a').bind('click.shop',function(){$.bbq.pushState({'category':$(this).attr('rel')});});$(window).unbind('hashchange.shop').bind('hashchange.shop',function(e){thisObj.onHashChange($.deparam.fragment(e.fragment));});thisObj.onHashChange($.deparam.fragment());inventoryObj.refreshResources();},onHashChange:function(url){if(typeof url['page']=='undefined'){var pushArray={page:"shop",category:$(".categoryFilter a:first").attr('rel')};if(typeof url['item']!='undefined'&&url['item']!=''){var item=inventoryObj.items_shop[url['item']];if(item.category.length>0){pushArray.category=item.category[item.category.length-1];}}$.bbq.pushState(pushArray);return;}var changePage=this.currentPage!=url['page'];if(changePage){if(url['page']=='inventory'){this.openInventory();$(".planetlink, .moonlink").fragment({"page":url["inventory"]});}else{this.openShop();$(".planetlink, .moonlink").fragment({"page":url["shop"]});}this.updateCategoryAmount();}if(typeof url["category"]=='undefined'){$.bbq.pushState({"category":$(".categoryFilter a:first").attr('rel')});return;}else{if(url["category"]!=this.currentCategory||changePage){this.changeCategory(url["category"]);}}if(typeof url["item"]=='undefined'||url['item']==''&&this.currentItem!=null){$('#itemDetails a.close_details').click();$(".planetlink, .moonlink").fragment({"item":""});}else if(this.currentItem!=url['item']){var $itemAnchor=$(".slideIn[ref='"+url["item"]+"']");if($itemAnchor.length){$itemAnchor.click();}else{// item could not be found in shop
gfSlider.slideIn(getElementByIdWithCache("detail"),url["item"]);}$(".planetlink, .moonlink").fragment({"item":url["item"]});}},initShopDetails:function(){var thisObj=this;var referrerPage=$.deparam.querystring().page;$(document).undelegate('#itemDetails .close_details','click').delegate('#itemDetails .close_details','click',function(){gfSlider.hide(getElementByIdWithCache("itemDetails"));}).undelegate('#itemDetails a.item.build-it','click').delegate('#itemDetails a.item.build-it','click',function(){$.ajax({url:$(this).attr('rel'),data:{ajax:1,token:buyToken},type:"POST",dataType:"json",error:function(){fadeBox(translation['buyError'],true);},success:function(data){buyToken=data.newToken;if(data.error){fadeBox(data.message,true);}else{fadeBox(data.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(data.item);}}});return false;}).undelegate('#itemDetails a.item.build-it_disabled.dm','click').delegate('#itemDetails a.item.build-it_disabled.dm','click',function(){errorBoxDecision(LocalizationStrings.error,loca.buyDMDecision,LocalizationStrings.yes,LocalizationStrings.no,function(){if($("a.dm_button").length>0){$("a.dm_button").click();}else{window.location.href=$("#darkmatter_box a").attr("href");}});}).undelegate('#itemDetails a.activateItem.build-it','click').delegate('#itemDetails a.activateItem.build-it','click',function(){var $thisObj=$(this);function upgradeItemAjax(){$.ajax({url:$thisObj.attr('rel'),data:{ajax:1,token:activateToken,referrerPage:referrerPage},type:"POST",dataType:"json",error:function(){fadeBox(translation['buyError'],true);$('#itemDetails a.activateItem').removeClass('build-it').addClass('build-it_disabled');},success:function(data){activateToken=data.newToken;if(data.error){fadeBox(data.message,true);$('#itemDetails a.activateItem').removeClass('build-it').addClass('build-it_disabled');}else{var reload=data.message.reload;data=data.message;fadeBox(data.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(data.item);if(reload){// reload shop
location.reload();//location.href = getRedirectLink(["category", "page"])
// keep old link for reference
//location.href = getRedirectLink() + '#category=' + $.deparam.fragment().category + '&page=' + $.deparam.fragment().page;
return;}}}});}if($thisObj.hasClass('isUpgrade')){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,upgradeItemAjax);}else if($thisObj.hasClass('isCharacterClassItem')){var name=$thisObj.data('itemName');errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.activateItemQuestion.replace('#characterClassName#',name),LocalizationStrings.yes,LocalizationStrings.no,upgradeItemAjax);}else{upgradeItemAjax();}return false;}).undelegate('#itemDetails a.buyAndActivate.build-it','click').delegate('#itemDetails a.buyAndActivate.build-it','click',function(){var $thisObj=$(this);function upgradeItemAjax(){$.ajax({url:$thisObj.attr('rel'),data:{ajax:1,token:activateToken,referrerPage:referrerPage},type:"POST",dataType:"json",error:function(){fadeBox(translation['buyError'],true);$('#itemDetails a.activateItem').removeClass('build-it').addClass('build-it_disabled');},success:function(data){activateToken=data.newToken;if(data.error){fadeBox(data.message,true);$('#itemDetails a.activateItem').removeClass('build-it').addClass('build-it_disabled');}else{if(data.message.reload){location.reload();return;}data=data.message;fadeBox(data.message,false);inventoryObj.refreshResources();inventoryObj.refreshItemData(data.item);}}});}if($thisObj.hasClass('isUpgrade')){errorBoxDecision(LocalizationStrings.activateItem.upgradeItemQuestionHeader,LocalizationStrings.activateItem.upgradeItemQuestion,LocalizationStrings.yes,LocalizationStrings.no,upgradeItemAjax);}else if($thisObj.hasClass('isCharacterClassItem')){var name=$thisObj.data('itemName');var price=$thisObj.data('itemPrice');errorBoxDecision(LocalizationStrings.notice,LocalizationStrings.characterClassItem.buyAndActivateItemQuestion.replace('#characterClassName#',name).replace('#darkmatter#',tsdpkt(price)),LocalizationStrings.yes,LocalizationStrings.no,upgradeItemAjax);}else{upgradeItemAjax();}return false;});},refreshResources:function(){getAjaxResourcebox(function(resources){$(".to_dark_matter .level").text(gfNumberGetHumanReadable(resources.darkmatter.amount,isMobile));});},refreshItemData:function(itemData){var uuid=itemData.ref;changeTooltip($(".detail_button[ref='"+uuid+"']"),itemData.title);$(".detail_button[ref='"+uuid+"'] span.amount, "+"#itemDetails[data-uuid='"+uuid+"'] span.amount").html(tsdpkt(itemData.amount));if(typeof inventoryObj.items_inventory!="undefined"){if(inventoryObj.items_inventory.length==0){inventoryObj.items_inventory={};}else if(itemData.amount<=0){delete inventoryObj.items_inventory[uuid];}else{inventoryObj.items_inventory[uuid]=itemData;}}if(typeof inventoryObj.items_shop!="undefined"){if(inventoryObj.items_shop.length==0){inventoryObj.items_shop={};}inventoryObj.items_shop[uuid]=itemData;}changeTooltip($('#itemDetails[data-uuid="'+uuid+'"] a.activateItem, #itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate'),itemData.activationTitle);if(itemData.hasEnoughCurrency){$('#itemDetails[data-uuid="'+uuid+'"] a.item').addClass('build-it').removeClass('build-it_disabled');}else{$('#itemDetails[data-uuid="'+uuid+'"] a.item').removeClass('build-it').addClass('build-it_disabled');}if(itemData.amount>0){$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').show();$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').hide();if(itemData.canBeActivated){$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').removeClass('build-it_disabled').addClass('build-it');}else{$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').addClass('build-it_disabled').removeClass('build-it');}}else{$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').hide();$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').show();if(itemData.canBeBoughtAndActivated&&itemData.hasEnoughCurrency){$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').removeClass('build-it_disabled').addClass('build-it');}else{$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').addClass('build-it_disabled').removeClass('build-it');}}if(isMobile){var infoText="";if($('#itemDetails[data-uuid="'+uuid+'"] a.activateItem:visible,'+'#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate:visible').hasClass('build-it_disabled')){infoText+=itemData.activationTitle;}if(itemData.buyTitle.length&&itemData.buyTitle!=itemData.activationTitle){infoText+=itemData.buyTitle;}$('#itemDetails[data-uuid="'+uuid+'"] .info_txt').text(infoText);}if(itemData.timeLeft>0&&itemData.extendable){$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem span').html(loca.extend);$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate span').html(loca.buyAndExtend);}else{$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem span').html(loca.activate);$('#itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate span').html(loca.buyAndActivate);}if(itemData.isAnUpgrade){$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem, #itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').addClass('isUpgrade');}else{$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem, #itemDetails[data-uuid="'+uuid+'"] a.buyAndActivate').removeClass('isUpgrade');}if(this.inShop===true){this.changeCategory($(".categoryFilter a.active").attr('rel'));}this.updateCategoryAmount();},boughtItemHint:function(){$('.to_inventory .bought_item_notice').show().fadeOut(1000);},openShop:function(){this.currentPage='shop';$('#js_inventorySliderBox').hide();$('#js_shopSliderBox').show();$('.to_inventory').removeClass('active');$('.to_shop').addClass('active');$('#buttonz h2').text(loca.LOCA_PREMIUM_SHOP);if(isMobile){$('.js_shopCurrentPage').html(loca.shopText);}},openInventory:function(){this.currentPage='inventory';$('#js_shopSliderBox').hide();$('#js_inventorySliderBox').show();$('.to_shop').removeClass('active');$('.to_inventory').addClass('active');$('#buttonz h2').text(loca.LOCA_PREMIUM_INVENTORY);if(isMobile){$('.js_shopCurrentPage').html(loca.inventoryText);}},changeCategory:function(category){inventoryObj.currentCategory=category;$(".planetlink, .moonlink").fragment({"category":category});$('.categoryFilter li, .categoryFilter li a').removeClass('active');$('.categoryFilter li a[rel="'+category+'"]').addClass('active').parent().addClass('active');// remove all items from active slider:
$('.anythingSlider').remove();var changeItems=function(items,slider){// select the items to rebuild the slider with:
var newItems2=[];var newItems=[];var highestIndex=0;$.each(items,function(index){if(this.category!=null){var joinedArray='$'+this.category.join('$')+'$';if(joinedArray.toLowerCase().indexOf('$'+category+'$')!=-1){newItems2[inventoryObj.item_orders[category][this.ref]]=this;if(inventoryObj.item_orders[category][this.ref]>highestIndex){highestIndex=inventoryObj.item_orders[category][this.ref];}}}});for(var i=0;i<=highestIndex;++i){// in anderes Array umschaufeln fuer IE8 noetig.
// dieser merkt sich zwar die Indizes, mit denen die Items eingefuegt wurden
// wird aber mit for(x in y) darueber iteriert, sind diese in der Einfuege-Reihenfolge.
if(newItems2[i]){newItems[i]=newItems2[i];}}inventoryObj.initalizeSlider(newItems,slider,340,340,null,null,null,false);};if(inventoryObj.currentPage=='shop'){changeItems(inventoryObj.items_shop,'js_shopSlider');}else if(inventoryObj.currentPage=='inventory'){changeItems(inventoryObj.items_inventory,'js_inventorySlider');}},updateCategoryAmount:function(){var items;if(inventoryObj.currentPage=='shop'){items=inventoryObj.items_shop;}else if(inventoryObj.currentPage=='inventory'){items=inventoryObj.items_inventory;}else{return;}var filter=$('.categoryFilter');filter.find('.amount').text(0);$.each(items,function(index){if(this.category!=null){for(var categoryIndex in this.category){var uuid=this.category[categoryIndex];var amountSpan=filter.find('a[rel="'+uuid+'"] .amount');var amount;if(inventoryObj.currentPage=='shop'){amount=1;}else if(inventoryObj.currentPage=='inventory'){amount=this.amount;}amountSpan.text(tsdpkt(getValue(amountSpan.text())+amount));}}});$.each(filter.find('li'),function(index){var pageFirstUpper=inventoryObj.currentPage.slice(0,1).toUpperCase()+inventoryObj.currentPage.slice(1);if($(this).hasClass('in'+pageFirstUpper)){$(this).show();}else{$(this).hide();if(!filter.find('li:visible .active').length){filter.find('li:visible:first a').click();}}});}};// var shopObj = {} end
function GFSlider(obj){var thisObj=this;// gekapseltes JavaScript-Objekt
//thisObj.sliderObj = obj; // betroffenes HTML Obj
//config (allgemein)
thisObj.duration=500;// in ms - gesamtdauer des slidevorgangs
thisObj.zIndex=10;thisObj.intervalTime=30;// in ms - framerate des slidens
// initialisierung
thisObj.lastTid=0;//thisObj.sliderObj.style.zIndex = thisObj.lastZIndex;
thisObj.inAction=false;thisObj.isOpen=false;thisObj.lastObj=false;thisObj.currHeight=obj.offsetHeight;thisObj.opacity=1;// extra funktionalitaet
thisObj.header=document.getElementById('header_text');thisObj.ressButton=document.getElementById('resources_button');thisObj.areaMap=document.getElementById('transImg');this.slideIn=function(obj,thisTid,reload){if(!thisObj.inAction){thisObj.slideInObj=obj;if(thisObj.lastTid!=thisTid||reload){//thisObj.header.style.position='absolute';
//thisObj.header.style.display='none';
obj.opacity=1;thisObj.lastTid=thisTid;$("#detail").html('<div id="techDetailLoading"></div>');if(!thisObj.isOpen){if(thisObj.ressButton)thisObj.ressButton.style.display='none';obj.style.height='1px';obj.style.display='block';obj.style.overflow='hidden';thisObj.inAction=true;thisObj.startTime=new Date().getTime();thisObj.slideInStep();thisObj.isOpen=true;}else{loadDetails(thisObj.lastTid);}}else{thisObj.header.style.display='block';thisObj.opacity=0;thisObj.lastTid=0;thisObj.inAction=true;thisObj.isOpen=false;thisObj.startTime=new Date().getTime();thisObj.slideOutObj=thisObj.slideInObj;thisObj.slideOutStep();}}};this.slideInStep=function(){obj=thisObj.slideInObj;var time=new Date().getTime();var height=parseInt(thisObj.currHeight*((time-thisObj.startTime)/thisObj.duration));if(height<thisObj.currHeight){obj.style.height=height+'px';obj.style.marginTop=thisObj.currHeight-1-height+'px';window.setTimeout(thisObj.slideInStep,thisObj.intervalTime);thisObj.opacity=Math.max(thisObj.opacity-0.1,0);thisObj.header.style.opacity=thisObj.opacity;//header.style.filter='alpha(opacity='+(this.opacity*100)+')';
thisObj.header.style.filter='Alpha(opacity='+0.5*100+')';}else{// Ajax Call
obj.style.height=thisObj.currHeight+'px';obj.style.marginTop='0px';thisObj.inAction=false;thisObj.header.style.display='none';loadDetails(thisObj.lastTid);if(thisObj.lastObj&&obj!=thisObj.lastObj){thisObj.hideLast();}thisObj.lastObj=obj;}};this.slideOutStep=function(){obj=thisObj.slideInObj;var time=new Date().getTime();height=parseInt(thisObj.currHeight*((time-thisObj.startTime)/thisObj.duration));if(height<thisObj.currHeight){obj.style.height=thisObj.currHeight-1-height+'px';obj.style.marginTop=height+'px';window.setTimeout(thisObj.slideOutStep,thisObj.intervalTime);thisObj.opacity=Math.max(thisObj.opacity+0.1,0);thisObj.header.style.opacity=thisObj.opacity;}else{obj.style.height=thisObj.currHeight+'px';obj.style.marginTop='0px';thisObj.opacity=1;thisObj.header.style.opacity=thisObj.opacity;if(thisObj.ressButton){thisObj.ressButton.style.display='block';}obj.style.display='none';thisObj.inAction=false;thisObj.hideLast();}};this.hideLast=function(){if(thisObj.lastObj){$(".slideIn").removeClass("active");thisObj.lastObj.style.display='none';thisObj.inAction=false;}$(document).trigger("ajaxHideElement",thisObj.lastTid);};this.hide=function(obj){$(".slideIn").removeClass("active");thisObj.slideOutObj=obj;thisObj.opacity=1;thisObj.header.style.opacity=thisObj.opacity;thisObj.header.style.display='block';if(thisObj.ressButton){thisObj.ressButton.style.display='block';}if(thisObj.areaMap){thisObj.areaMap.style.display='block';}thisObj.slideOutObj.style.display='none';thisObj.inAction=false;thisObj.lastTid=0;thisObj.isOpen=false;};}function rocketsDestroyed(data){var data=$.parseJSON(data);errorBoxAsArray(data["errorbox"]);if(!data["errorbox"].failed){$("#rocketsilo").parents('.overlayDiv').dialog('close');let technologyId=$("#technologydetails").data('technology-id');technologyDetails.show(technologyId);}}function supplyFleet(data){var data=$.parseJSON(data);if(data.status){getAjaxResourcebox();/*$("#holdingTime-" + data.id).remove();

        var $holdingTime = $('<span class="countdown holdingTime" id="holdingTime-' + data.id + '"></span>')
            .show()
            .appendTo($('#holdingTimeCell'));
*/supplyTimes[data.id]=data.time;new simpleCountdown($("#holdingTime-"+data.id),data.time);}errorBoxAsArray(data["errorbox"]);}function updateSupplyDetails(ships,costs,index){$("#shipCount").html(gfNumberGetHumanReadable(ships));$("#deutCosts").html(gfNumberGetHumanReadable(costs));$("span.countdown").hide();$("#holdingTime-"+index).show();}function initAllianceDepot(){$(".overlayDiv #allydepotlayer select").ogameDropDown();$(".holdingTime:first-child").show();for(var id in supplyTimes){new simpleCountdown($("#holdingTime-"+id),supplyTimes[id]);}$("#supplyTimeInput").focus(function(){clearInput(this);}).keyup(function(){var deuterium=getValue($('#resources_deuterium').text());var costs=getValue($("#deutCosts").text());checkIntInput(this,1,Math.floor(deuterium/costs));});}/*
 *
 *  Push Notifications codelab
 *  Copyright 2015 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */ /* eslint-env browser, es6 */'use strict';var pushButton=null;var applicationServerPublicKey='BA_ADqzYuy45TlLLbSQcBmOwbjYYaU1snQM8UtO6ZLgUon7HAOELOS_Wnwyv4kAIARi2jrLmXxtDTnx7htApqyc';var isSubscribed=false;var swRegistration=null;function urlB64ToUint8Array(base64String){var padding='='.repeat((4-base64String.length%4)%4);var base64=(base64String+padding).replace(/\-/g,'+').replace(/_/g,'/');var rawData=window.atob(base64);var outputArray=new Uint8Array(rawData.length);for(var i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i);}return outputArray;}function initializeUI(){pushButton.addEventListener('click',function(){pushButton.disabled=true;if(isSubscribed){unsubscribeUser();}else{subscribeUser();}});// Set the initial subscription value
swRegistration.pushManager.getSubscription().then(function(subscription){isSubscribed=!(subscription===null);updateSubscriptionOnServer(subscription);// if (isSubscribed) {
//     console.log('User IS subscribed.');
// } else {
//     console.log('User is NOT subscribed.');
// }
updateBtn();});}function updateBtn(){if(Notification.permission==='denied'){pushButton.textContent='Push Messaging Blocked.';pushButton.disabled=true;updateSubscriptionOnServer(null);return;}if(isSubscribed){pushButton.textContent='Disable Push Messaging';pushButton.checked=true;}else{pushButton.textContent='Enable Push Messaging';pushButton.checked=false;}pushButton.disabled=false;}function subscribeUser(){var applicationServerKey=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:applicationServerKey}).then(function(subscription){// console.log('User is subscribed.');
updateSubscriptionOnServer(subscription);isSubscribed=true;updateBtn();})['catch'](function(err){// console.log('Failed to subscribe the user: ', err);
updateBtn();});}function unsubscribeUser(){swRegistration.pushManager.getSubscription().then(function(subscription){if(subscription){return subscription.unsubscribe();}})['catch'](function(error){// console.log('Error unsubscribing', error);
}).then(function(){updateSubscriptionOnServer(null);// console.log('User is unsubscribed.');
isSubscribed=false;updateBtn();});}function updateSubscriptionOnServer(subscription){if(subscription){$.post("?page=ajax&component=subscription&action=subscribe",{subscription:JSON.stringify(subscription)});}}function initSubscriptionSystem(){pushButton=document.querySelector('.onoffswitch-checkbox');console.log(pushButton);if('serviceWorker'in navigator&&'PushManager'in window){// console.log('Service Worker and Push is supported');
pushButton.setAttribute('disabled','disabled');pushButton.classList.add('disabled');console.log(pushButton);navigator.serviceWorker.register('sw.js').then(function(swReg){// console.log('Service Worker is registered', swReg);
swRegistration=swReg;initializeUI();})['catch'](function(error){// console.error('Service Worker Error', error);
});}else{// console.warn('Push messaging is not supported');
pushButton.textContent='Push Not Supported';}}/*
 * author: Stefanie Knoth
 * description: scripts that are only needed for tablet here
 * date: 04:07:2012
 */function tabletInitOverviewAdvice(){if(!isMobile){return false;}var $adviceWrapper=$('.adviceWrapper');var $exodus=$adviceWrapper.find('#exodus-indicator, #exodus-timer');var $exodusProcessed=$adviceWrapper.find('#exodus-indicator-processed');$adviceWrapper.prev().before($exodus);$adviceWrapper.prev().before($exodusProcessed);$('#planetdata').after($adviceWrapper);}function tabletInitGalaxyDetails(){if(!isMobile){return false;}var clickEls=['js_planet','js_moon','js_debris','js_playerName','js_allyTag'];//    $('.js_detailRow').hide();
$('.js_detailRow').css('display','none');// $('.planetname, .planetname1').each(function() {
//     $newNode = $('<div class="' + $(this).attr('class') + '"/>');
//     $(this).prev().append($newNode);
//     $newNode.html($(this).html());
//     $(this).remove();
// });
$('.js_detailRow').each(function(i){i=$(this).attr('rel');for(var j=0;j<clickEls.length;j++){var currEl=$('.'+clickEls[j]+i);if(currEl===undefined||currEl.length==0){if(i==16)continue;if(i==17)continue;return;}if(currEl.attr('class').indexOf('js_no_action')>=0){continue;}currEl.unbind();currEl.bind('click.planet',function(e){if($(this).hasClass('active')){$('.row *.active').removeClass('active');//                    $('.js_detailRow').hide();
$('.js_detailRow').css('display','none');}else{$('.row *.active').removeClass('active');if($('.bdaySlotBox'))$('.bdaySlotBox .name').removeClass('active');//                    $('.js_detailRow').hide();
$('.js_detailRow').css('display','none');//Show Detailbox for clicked Element
if($(this).html().trim()){$(this).addClass('active');if($(this).attr('class').indexOf('js_planet')>=0){//                            $('.js_detailRowPlanet'+ i).toggle().find('.active_row_details_content');
elem='.js_detailRowPlanet'+i;}else if($(this).attr('class').indexOf('js_moon')>=0){//                            $('.js_detailRowMoon'+ i).toggle();
elem='.js_detailRowMoon'+i;}else if($(this).attr('class').indexOf('js_debris')>=0){//                            $('.js_detailRowDebris'+ i).toggle();
elem='.js_detailRowDebris'+i;}else if($(this).attr('class').indexOf('js_playerName')>=0){//                            $('.js_detailRowPlayer'+ i).toggle();
elem='.js_detailRowPlayer'+i;}else if($(this).attr('class').indexOf('js_allyTag')>=0){//                            $('.js_detailRowAlliance'+ i).toggle();
elem='.js_detailRowAlliance'+i;}$(elem).css('display','table-row');}}});}});$("a.planetMoveIcons").bind('click',function(e){e.stopPropagation();});}function tabletToggleTechtreeInfos(id){if(!isMobile){return false;}var $techtree=$("div.techtree[data-id='"+id+"']");var $techDiv=$techtree.find('.techImage a');$techDiv.each(function(){var $thisObj=$(this);var colorClass=$thisObj.parent().hasClass('built')?"undermark":"overmark";var techName=$thisObj.data('tech-name');var techType=$thisObj.data('tech-type');$thisObj.append('<div class="short_info" style="display: none"><span class="'+colorClass+'">'+techName+'</span><br/>'+techType+'</div>');});if($techDiv.length){$techtree.append($('<a id="toggleDetails" href="javascript:void(0)" class="btn_blue">'+LocalizationStrings.moreDetails+'</a>').click(function(){var $shortInfo=$techtree.find('.short_info');if($shortInfo.is(':visible')){$(this).text(LocalizationStrings.moreDetails);}else{$(this).text(LocalizationStrings.lessDetails);}$shortInfo.toggle();}));}}function tabletInitEmpire(){if(!isMobile){return false;}var width=$('#mainWrapper').width();width=width<1024?'1024':width;$('#outerWrapper').width(width);$('.reset').hide();}function tabletInitPayment(){if(!isMobile){return false;}$("#payment").parent('.overlayDiv').dialog('option','title',paymentLoca.title);document.addEventListener("deviceready",function(){$("#mobilePayment a.js_buyPacket").unbind('click').bind('click',function(){HostApp.StartPayment($(this).attr("ref"),userData.id,constants.name,constants.language);});HostApp.OnPaymentFinished=function(){getAjaxResourcebox(function(resources){fadeBox(paymentLoca.success,false);$("#payment").parent().dialog('close');$("#planet #content .level span").attr('class','undermark').text(gfNumberGetHumanReadable(resources.darkmatter.amount,isMobile));});};HostApp.OnPaymentFailed=function(){fadeBox(paymentLoca.error,true);};},false);}function tabletInitGalaxy(){if(!isMobile){return false;}$("#galaxyContent").wipetouch({wipeLeft:function(e){if(!$("#galaxyLoading:visible").length){submitOnKey(39);}},wipeRight:function(e){if(!$("#galaxyLoading:visible").length){submitOnKey(37);}},preventDefault:false,preventDefaultWhenTriggering:true,moveX:180,moveY:60});}function initRetinaImages(){// we only want to replace images if we're on a retina display:
if($('.js_replace2x').css('font-size')=="1px"){$('img.js_replace2x').each(function(){$(this).attr('src',$(this).attr('rel'));});}}function setupOverlay(pageLink,overlayTitle,techID){$('.build-it_premium').addClass('overlay');$('.build-it_premium').attr('href',pageLink);$('.build-it_premium').data('overlay-title',overlayTitle);$('.build-it_premium').data('techid',techID);}function setupBuildinglistForBuildItButton(allDetailNow,techID,showWarning){new baulisteCountdown(document.getElementById('possibleInTime'),buildableAt,pageToReload/*function() {
	            $("#possibleInTime").text(allDetailNow);
	            $('.build-it_disabled[data-techid=' + techID + ']')
	                .removeClass('build-it_disabled')
	                .addClass('build-it')
	                .attr('onclick', 'sendBuildRequest(null, null, ' + showWarning + '); return false;');
	            $('.detail_button[ref="' + techID + '"]').parents("li")
	                .removeClass("disabled")
	                .addClass("on");

	            $("#resources .cost").removeClass("overmark");
	        }*/);}function drawErrorbox(type,message,header,options,link,otherclass){var otherclass=otherclass==undefined?false:otherclass;var domobject=otherclass!==false?$("."+otherclass):$(".build-it_disabled");if(typeof link=="undefined"||link==""){link=document.location.href;}domobject.click(function(){if(header!==undefined&&options!==undefined&&link!==undefined){if(type=='notify'){errorBoxNotify(header,message,options.allOk,function(){window.location.href=link;});}if(type=='decision'){errorBoxDecision(header,message,options.allYes,options.allNo,function(){window.location.href=link;});}}if(type=='fadeBox'){fadeBox(message,true);}});}function initializeBuildItButton(){// params aus der techDetails_ajax.tpl.php
if(hasCommander&&buildableAt>0){setupBuildinglistForBuildItButton(loca.allDetailNow,techID,showSlotWarning);}if(buttonState){$('.build-it').on('click',function(){sendBuildRequest(null,null,showSlotWarning);});}else{// noroomleft message todo!!!
//		if(!showNoPremiumError) {
//			// Premiumfehler anzeigen
//			console.log(showNoPremiumError)
//		}
if(couldBeBuild){$errorCount=showErrors();}else{$errorCount=99;// dont match conditions
}if((error==null||error==0)&&$errorCount==0){$('.build-it_premium').on('click',function(){var amount=$('#build_amount').val();if(typeof amount=='undefined'){amount=1;}var newHref=links.overlay+"&amount="+amount;setupOverlay(newHref,overlayTitle,techID);});}}$(document).off('keypress.submitBuild').on('keypress.submitBuild','#contentWrapper #inhalt #number',function(event){if(event.keyCode!=13){return;}event.stopPropagation();var $premiumBuildButton=$('.build-it_premium');if($premiumBuildButton.length){$premiumBuildButton.trigger('click');}else{$('.build-it').trigger('click');}});}function showErrors(){var options={'allYes':loca.allYes,'allNo':loca.allNo,'allOk':loca.allOk};if(isBuildlistNeeded){if(!hasCommander&&!(isShip||isRocket)){drawErrorbox('decision',loca.infoBuildlist,loca.allError,options,links.decisionCommander,'build-it_premium');return 1;}if(isRocketAndStorageNotFree){drawErrorbox('notify',loca.noRocketsiloCapacity,loca.allError,options,links.notify);return 1;}}else{if(error!==null&&error!==0){if(premiumerror){if(showErrorOnPremiumbutton){drawErrorbox('decision',errorlist[error],loca.allError,options,links[error],buttonClass);return 1;}else{drawErrorbox('decision',errorlist[error],loca.allError,options,links[error]);return 1;}}else if(isRocketAndStorageNotFree){drawErrorbox('notify',loca.noRocketsiloCapacity,loca.allError,options,links.notify);return 1;}else if(isBusy){return 1;}else{drawErrorbox('notify',errorlist[error],loca.allError,options,'');return 1;}}}return 0;}function initTechDetailsAjax(){initializeBuildItButton();refreshBars('bar_container','filllevel_bar');}function initGlobalTechtree(id){var $techtree=$("div.graph[data-id='"+id+"']");$techtree.find(".headline").unbind('click').bind('click',function(){$(this).next().toggle(function(){var $dialog=$techtree.parents('.ui-dialog');$dialog.hide();$(this).toggleClass("open");$dialog.show();});/*$(this).next().slideToggle("slow", function() {
                $(this).toggleClass("open");

                $dialog.css('zoom', 1.1);
                setTimeout(function() {
                    $dialog.css('zoom', 1);
                }, 1000);
            });*/});if(openTree=='all'){$techtree.find('.techtree_content').show(0,function(){$(this).addClass('open');});}else if(openTree!=null){$techtree.find('.techtree_content_'+openTree).show(0,function(){$(this).addClass('open');});}}function initOverlayName(){let title=$('#technologytree').data('title');$("#technologytree").closest(".ui-dialog").find('.ui-dialog-title').html(title);}function drawArrows(id){var $techtree=$("div.graph[data-id='"+id+"']");var rowHeight=$techtree.find('.techImage').outerHeight(true);var overallWidth=20;$techtree.find('.techWrapper.depth1').each(function(){overallWidth+=$(this).outerWidth();});$techtree.css('width',overallWidth);var newTree=jsPlumb.getInstance();newTree.Defaults.Container=$techtree;// for round edges set corner radius below
newTree.Defaults.Connector=["Flowchart",{cornerRadius:20}];newTree.Defaults.Endpoint=["Rectangle",{cssClass:"endpoint",width:1,height:1}];// default anchors. in most cases a bad idea, only as backup.
// Continuous Anchors may produce partially overlapping connections
newTree.Defaults.Anchors=["ContinuousTop","ContinuousBottom"];// coordinates: an array containing the coordinates of each endpoint in pixels as [left,top]
var coordinates={};// endpoints-array is set in singleTree.tpl.php. the values are techIds.
$.each(endpoints,function(){var $elem=$techtree.find(".tech"+this.toString());newTree.addEndpoint($elem);var elemLeft=Math.floor($elem.find('a').offset().left);var elemTop=Math.floor($elem.find('a').offset().top);coordinates[this]=[elemLeft,elemTop];});var changedSomething;do{// for every connection:
// check if the source is below the target on the screen. if not, move the source downwards one row
changedSomething=false;$.each(connections,function(){var $source=$techtree.find(".tech"+this.source+" a");var $target=$techtree.find(".tech"+this.target+" a");if($source.offset().top>=$target.offset().top-10&&$source.offset().top<=$target.offset().top+10){$source.parent().css('margin-top',parseInt($source.parent().css('margin-top').replace(/px/,''))+rowHeight);// we just moved a tech downwards... we have to adjust all corresponding coordinates
// the surrounding div with class depth* is the second parent
$source.parent().parent().find('a[data-tech-id]').each(function(){coordinates[$(this).attr('data-tech-id')][1]+=rowHeight;// 1 == top
//console.log("RESET "+$(this).attr('data-tech-id') + " "+(coordinates[$(this).attr('data-tech-id')][1]));
});changedSomething=true;}});}while(changedSomething);// columns and rows: these 2 arrays will contain all different left- and top-values of the endpoint coordinates
var columns=[];var rows=[];for(var elem in coordinates){if(columns.indexOf(coordinates[elem][0])==-1){columns.push(coordinates[elem][0]);}if(rows.indexOf(coordinates[elem][1])==-1){rows.push(coordinates[elem][1]);}}columns.sort(function(a,b){return a>b?1:-1;});rows.sort(function(a,b){return a>b?1:-1;});// now the 2 arrays contain a numeric sorted list
// translated: an array containing the same keys as the coordinates-array, but the values aren't pixels anymore.
// they are the numbers of the row/column containing that endpoint
// with this information, it will be possible to test whether the path for a connection-line is free or not.
var translated={};for(var elem2 in coordinates){translated[elem2]={'left':columns.indexOf(coordinates[elem2][0]),'top':rows.indexOf(coordinates[elem2][1])};}//console.dir(translated);
// unfortunately, it matters in which order you put the connections into the drawing algorithm.
// (because every line that is drawn blocks 1 anchor place at its 2 endpoints)
// lines that will be drawn straight upwards have to be protected and drawn first..
// -> sort by the minimum column distance
connections.sort(function(a,b){return Math.abs(translated[a.source]['left']-translated[a.target]['left'])<Math.abs(translated[b.source]['left']-translated[b.target]['left'])?-1:1;});// connection styling, see http://jsplumbtoolkit.com/doc/paint-styles
var connectStyles={hasRequirements:{strokeStyle:"#015100",lineWidth:3},hasNotRequirements:{strokeStyle:"#510009",lineWidth:3}};// our anchors, format: [x-coordinate 0-1, y-coordinate 0-1, dx {-1;+1}, dy {-1;+1}
// the first two parameters mark the point where the line starts at the endpoint
// (change if you need, or add more entries),
// the last two parameters give the initial direction of the line (do not change).
// the anchors at the beginning of the anchor-arrays will be used first (try to keep it symmetrical)
var leftAnchors=[[0,0.5,-1,0],[0,0.3,-1,0],[0,0.7,-1,0],[0,0.9,-1,0]];var rightAnchors=[[1,0.5,1,0],[1,0.3,1,0],[1,0.7,1,0],[1,0.9,1,0]];var bottomAnchors=[[0.5,1,0,1],[0.3,1,0,1],[0.7,1,0,1],[0.9,1,0,1]];var topAnchors=[[0.5,0,0,-1],[0.3,0,0,-1],[0.7,0,0,-1],[0.9,0,0,-1]];// 0.9 is used in tech TECH_NETZTECHNIK. i guess that's the only one
// we do not want to use the same anchor twice. so we have to remember which of the anchors was already used
var alreadyUsedAnchors={};function chooseAnchor(elemId,orientation,anchors,alreadyUsedAnchors){if(!alreadyUsedAnchors[elemId]){alreadyUsedAnchors[elemId]={};}if(alreadyUsedAnchors[elemId][orientation]==undefined){alreadyUsedAnchors[elemId][orientation]=0;}// a stupid algorithm perhaps, but we only track the number of already used anchors.
// one after we other is used. could be modified in the future; should be enough for now.
++alreadyUsedAnchors[elemId][orientation];return anchors[alreadyUsedAnchors[elemId][orientation]-1];}// draw each connection
$.each(connections,function(){var $source=$techtree.find(".tech"+this.source+" a");var $target=$techtree.find(".tech"+this.target+" a");var connectOptions={source:$source,target:$target,overlays:[["Arrow",{location:-5,paintStyle:connectStyles[this.paintStyle],width:8,length:8,foldback:0.8}],["Label",{label:this.label,cssClass:"label "+this.paintStyle,location:0.85}]],paintStyle:connectStyles[this.paintStyle],hoverPaintStyle:{strokeStyle:"rgb(255, 255, 0)"}};// if you want to change options
// consult the documentation at http://jsplumbtoolkit.com for details
//var sourcePosition = $source.offset();
//var targetPosition = $target.offset();
//console.info("source:" + $source.attr('data-tech-name') + ", target: " + $target.attr('data-tech-name') + ". pos " + sourcePosition.left + "|" + sourcePosition.top + " vs pos " + targetPosition.left + "|" + targetPosition.top);
//#############################################
// search for the path that we line should take
// it may not go through other endpoints/techs
// it should use the shortest path and should not change directions too often (1-2)
if(translated[this.target].left<translated[this.source].left){// target is left of the source
if(!lineInCoordinatesBlocked(translated,translated[this.source].left,translated[this.source].top,translated[this.source].left,translated[this.target].top)&&!positionInCoordinatesBlocked(translated,translated[this.source].left,translated[this.target].top)&&!lineInCoordinatesBlocked(translated,translated[this.source].left,translated[this.target].top,translated[this.target].left,translated[this.target].top)){// vertical, horizontal
connectOptions.anchors=[chooseAnchor(this.source,'top',topAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'right',rightAnchors,alreadyUsedAnchors)];//console.log("chose top right");
}else{// horizontal, vertical
connectOptions.anchors=[chooseAnchor(this.source,'left',leftAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'bottom',bottomAnchors,alreadyUsedAnchors)];connectOptions.overlays[1][1]=readableVersionOfLabel(connectOptions.overlays[1][1],alreadyUsedAnchors[this.target].bottom);//console.log("chose left bottom");
}}else if(translated[this.target].left>translated[this.source].left){// target is right of the source
if(!lineInCoordinatesBlocked(translated,translated[this.source].left,translated[this.source].top,translated[this.source].left,translated[this.target].top)&&!positionInCoordinatesBlocked(translated,translated[this.source].left,translated[this.target].top)&&!lineInCoordinatesBlocked(translated,translated[this.source].left,translated[this.target].top,translated[this.target].left,translated[this.target].top)){// vertical, horizontal
connectOptions.anchors=[chooseAnchor(this.source,'top',topAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'left',leftAnchors,alreadyUsedAnchors)];//console.log("chose top left");
}else{// horizontal, vertical
connectOptions.anchors=[chooseAnchor(this.source,'right',rightAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'bottom',bottomAnchors,alreadyUsedAnchors)];connectOptions.overlays[1][1]=readableVersionOfLabel(connectOptions.overlays[1][1],alreadyUsedAnchors[this.target].bottom);//console.log("chose right bottom");
}}else{// target is above the source
if(translated[this.target].top<translated[this.source].top-1&&lineInCoordinatesBlocked(translated,translated[this.source].left,translated[this.source].top,translated[this.target].left,translated[this.target].top)){// but it's far away and some tech/endpoint would block our path for a direct line
connectOptions.anchors=[chooseAnchor(this.source,'left',leftAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'left',leftAnchors,alreadyUsedAnchors)];//console.log("chose left left");
// NOTE: i didn't find a case where this occurred,
// but it could be possible that 2 connections on the same column could overlap with this rule
// in this case, "right,right" should be chosen
}else{// the target is right above us. shoot it.
connectOptions.anchors=[chooseAnchor(this.source,'top',topAnchors,alreadyUsedAnchors),chooseAnchor(this.target,'bottom',bottomAnchors,alreadyUsedAnchors)];connectOptions.overlays[1][1]=readableVersionOfLabel(connectOptions.overlays[1][1],alreadyUsedAnchors[this.target].bottom);//console.log("chose top bottom");
}}// else: default.
newTree.connect(connectOptions);});}function initTechtree(id){(function($){drawArrows(id);})(jQuery);tabletToggleTechtreeInfos(id);}/**
 *
 * @param labelObject object
 * @param useCount int
 * @returns string
 */function readableVersionOfLabel(labelObject,useCount){labelObject.location=-0.05*useCount+0.85;var split=labelObject.label.indexOf('/');if(split){//        label = label.substring(0,split) + '<br/>/<br/>' + label.substring(split + 1);
}return labelObject;}/**
 * check single line of the matrix if a line could be drawn. does not check start or end of the line
 * @param coordinates array containing the positions of the endpoints
 * @param sourceLeft int x-coordinate of the source
 * @param sourceTop int y-coordinate of the source
 * @param targetLeft int x-coordinate of the target
 * @param targetTop int y-coordinate of the target
 * @return bool if the path is blocked by an element
 */function lineInCoordinatesBlocked(coordinates,sourceLeft,sourceTop,targetLeft,targetTop){if(sourceLeft==targetLeft){// check column (target is above. every time!)
for(var i in coordinates){if(coordinates[i].left==sourceLeft&&sourceTop>coordinates[i].top&&targetTop<coordinates[i].top){return true;}}}else if(sourceTop==targetTop&&sourceLeft>targetLeft){// check row to the left
for(var j in coordinates){if(coordinates[j].top==sourceTop&&sourceLeft>coordinates[j].left&&targetLeft<coordinates[j].left){return true;}}}else if(sourceTop==targetTop&&sourceLeft<targetLeft){// check row to the right
for(var k in coordinates){if(coordinates[k].top==sourceTop&&sourceLeft<coordinates[k].left&&targetLeft>coordinates[k].left){return true;}}}return false;}/**
 * check if a single spot in the coordinates array is blocked by an element. used for edges of the connection line
 * @param coordinates the coordinates matrix data
 * @param left x-coordinate to check
 * @param top y-coordinate to check
 * @returns {boolean}
 */function positionInCoordinatesBlocked(coordinates,left,top){for(var i in coordinates){if(coordinates[i].left==left&&coordinates[i].top==top){return true;}}return false;}var javascriptAvailable=true;var days=new Array('Mon','Tus','Wed','Thu','Fri','Sat','Sun');var months=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");function getFormatedDate(timestamp,format){var currTime=new Date();currTime.setTime(timestamp);str=format;str=str.replace('[d]',dezInt(currTime.getDate(),2));str=str.replace('[D]',days[currTime.getDay()]);str=str.replace('[m]',dezInt(currTime.getMonth()+1,2));str=str.replace('[M]',months[currTime.getMonth()]);str=str.replace('[j]',parseInt(currTime.getDate()));str=str.replace('[Y]',currTime.getFullYear());str=str.replace('[y]',currTime.getFullYear().toString().substr(2,4));str=str.replace('[G]',currTime.getHours());str=str.replace('[H]',dezInt(currTime.getHours(),2));str=str.replace('[i]',dezInt(currTime.getMinutes(),2));str=str.replace('[s]',dezInt(currTime.getSeconds(),2));return str;}/**
 * adds prefix digits to a number ('2'->'02')
 *
 * @param int   number
 * @param int   digits
 * @param str   prefix, default is '0'
 */function dezInt(num,size,prefix){prefix=prefix?prefix:"0";var minus=num<0?"-":"",result=prefix=="0"?minus:"";num=Math.abs(parseInt(num,10));size-=(""+num).length;for(var i=1;i<=size;i++){result+=""+prefix;}result+=(prefix!="0"?minus:"")+num;return result;}function getFormatedTime(time){hours=Math.floor(time/3600);timeleft=time%3600;minutes=Math.floor(timeleft/60);timeleft=timeleft%60;seconds=timeleft;return dezInt(hours,2)+":"+dezInt(minutes,2)+":"+dezInt(seconds,2);}function tsdpkt(f){var vz="";if(f<0){vz="-";}f=Math.abs(f);var r=f%1000;while(f>=1000){var k1="";if(f%1000<100){k1="0";}if(f%1000<10){k1="00";}if(f%1000==0){k1="00";}f=Math.abs((f-f%1000)/1000);r=f%1000+LocalizationStrings['thousandSeperator']+k1+r;}r=vz+r;return r;}function formatTime(seconds){var hours=Math.floor(seconds/3600);seconds-=hours*3600;var minutes=Math.floor(seconds/60);seconds-=minutes*60;if(minutes<10)minutes="0"+minutes;if(seconds<10)seconds="0"+seconds;return hours+":"+minutes+":"+seconds;}function round(x,n){if(n<1||n>14)return false;var e=Math.pow(10,n);var k=(Math.round(x*e)/e).toString();if(k.indexOf('.')==-1)k+='.';k+=e.toString().substring(1);return k.substring(0,k.indexOf('.')+n+1);}function show_hide_menus(element){if($(element).is(':visible')){$(element).hide();}else{$(element).show();}}function change_class(ele){if(document.getElementById(ele).className=="closed"){document.getElementById(ele).className="opened";}else{document.getElementById(ele).className="closed";}}function show_hide_tbl(id){var el=document.getElementById(id);try{if(el)el.style.display=el.style.display=="none"?"table-row":"none";}catch(e){// Der IE bis V7 kann kein table-row, deshalb Fallback auf 'Block'
el.style.display="block";}}function cntchar(inputField,m){var $inputField=$(inputField);if($inputField.val().length>m){$inputField.val($inputField.val().substr(0,m));}$inputField.parents("form").find(".cntChars").text($inputField.val().length);}function showGalaxy(galaxy,system,planet){openParentLocation("index.php?page=ingame&component=galaxy&no_header=1&galaxy="+galaxy+"&system="+system+"&planet="+planet);}function openParentLocation(url){try{window.opener.document.location.href=url;}catch(error){try{window.parent.document.location.href=url;}catch(error){document.location.href=url;}}}function submitOnEnter(ev){var keyCode;if(window.event){keyCode=window.event.keyCode;}else if(ev){keyCode=ev.which;}else{return true;}if(keyCode==13){trySubmit();return false;}else{return true;}}function setMaxIntInput(formElement,data){for(var techID in data){if(!$(formElement).find("#ship_"+techID).attr("disabled")){$(formElement).find("#ship_"+techID).val(data[techID]);checkIntInput($(formElement).find("ship_"+techID),0,data[techID]);}}}function clearInput(id){$(id).val("");}function checkIntInput(id,minVal,maxVal){var value=$(id).val();if(typeof value!="undefined"&&value!=""){intVal=Math.abs(getValue(value));if(maxVal!=null){intVal=Math.min(intVal,maxVal);}$(id).val(intVal);}}function clampInt(val,minVal,maxVal,allowEmpty){if(allowEmpty&&(val===''||val===0)){return'';}let intVal=parseInt(val);if(isNaN(intVal)){return minVal;}intVal=Math.min(intVal,maxVal);intVal=Math.max(intVal,minVal);return intVal;}function clampFloat(val,minVal,maxVal){let floatVal=parseFloat(val);if(isNaN(floatVal)){return minVal;}floatVal=Math.max(floatVal,minVal);floatVal=Math.min(floatVal,maxVal);return floatVal;}function handlerToSubmitAjaxForm(form){var submitFunction="submit_"+String(form);if($.isFunction(window[submitFunction])){window[submitFunction]();}return false;}function ajaxCall(url,targetSelector,callback){if(typeof targetSelector==='string'){let $targetHTMLObj=$(targetSelector);$targetHTMLObj.find('select').ogameDropDown('destroy');$targetHTMLObj.html('<p class=\"ajaxLoad\"></p>');}$.post(url,function(data){if(typeof targetSelector==='string'){let $targetHTMLObj=$(targetSelector);$targetHTMLObj.html(data);$targetHTMLObj.find('select').ogameDropDown();}if(typeof callback==='function'){callback();}});}function ajaxSubmit(url,formDataOrSelector,targetSelector,callback){if(typeof targetSelector==='string'){let $targetHTMLObj=$(targetSelector);$targetHTMLObj.find('select').ogameDropDown('destroy');$targetHTMLObj.html("<p class=\"ajaxLoad\"><?=LOCA_ALL_AJAXLOAD ?></p>");}let formData=typeof formDataOrSelector==='string'?$(formDataOrSelector).serialize():formDataOrSelector;$.post(url,formData,function(data){if(typeof targetSelector==='string'){let $targetHTMLObj=$(targetSelector);$targetHTMLObj.html(data);$targetHTMLObj.find('select').ogameDropDown();}if(typeof callback==='function'){callback();}});}Number.prototype.isBetween=function(min,max){return this>=min&&this<=max;};function getValue(value){result=parseInt(value.toString().replace(/^k$/,"1000").replace(/k/,"000").replace(/^0+/,"").replace(/[^0-9]/g,""));return isNaN(result)?0:result;}/**
 * loads an external js script and calls a function when it is loaded
 * @param url url of the script to load
 * @param callback function to call when script is loaded
 * @url http://www.nczonline.net/blog/2009/07/28/the-best-way-to-load-external-javascript/
 */function loadScript(url,callback){if(typeof loadScript.loadedScripts=='undefined'){loadScript.loadedScripts={};}if(typeof loadScript.loadedScripts[url]=='undefined'){loadScript.loadedScripts[url]=true;var script=document.createElement("script");script.type="text/javascript";if(script.readyState){//IE
script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;callback();}};}else{//Others
script.onload=function(){callback();};}script.src=url;var head=document.getElementsByTagName("head")[0];head.appendChild(script);}else{callback();}}function formatNumber(object,value){var formattedValue=number_format(getValue(value),0,LocalizationStrings['decimalPoint'],LocalizationStrings['thousandsSeparator']);var $thisObj=$(object);var range=$thisObj.getSelection();if($thisObj.val()!=formattedValue){if($thisObj.val().length!=formattedValue.length){range.start=range.start+(formattedValue.length-$thisObj.val().length);range.end=range.end+(formattedValue.length-$thisObj.val().length);}}$thisObj.val(formattedValue);if($thisObj.is(":focus")){$thisObj.setSelection(range);}}function initToggleHeader(name){$('a.toggleHeader[data-name='+name+']').click(function(e){e.preventDefault();let toggleState=$(e.currentTarget).closest('.planet-header').hasClass('shortHeader');$(e.currentTarget).closest('.planet-header').toggleClass('shortHeader');$(".c-left").toggleClass('shortCorner');$(".c-right").toggleClass('shortCorner');changeSetting('headerImage',name+'|'+toggleState);});}function initFormValidation(){$("form.formValidation").validationEngine({validationEventTrigger:"keyup blur",promptPosition:"centerRight"});}Function.prototype.clone=function(){var fct=this;var clone=function(){return fct.apply(this,arguments);};clone.prototype=fct.prototype;for(var property in fct){if(fct.hasOwnProperty(property)&&property!=='prototype'){clone[property]=fct[property];}}return clone;};function hideTipsOnTabChange(){$("select").ogameDropDown('hide');Tipped.hideAll();}jQuery.fn.slideFadeToggle=function(speed,easing,callback){return this.animate({opacity:'toggle',width:'toggle'},speed,easing,callback);};function focusOnTabChange(element,focusOnReady){var focusFunction=function(){$(element).focus();};if(focusOnReady==true){$(document).ready(focusFunction);}$(window).unbind('blur').bind('blur',focusFunction);}/**
 * @see http://obvcode.blogspot.de/2007/11/easiest-way-to-check-ie-version-with.html
 * @return {Number}
 */function getIEVersion(){var version=999;if(navigator.appVersion.indexOf("MSIE")!=-1)version=parseFloat(navigator.appVersion.split("MSIE")[1]);return version;}ogame.tools={/**
     * adds a hover effect to given selectors
     * @param {String} selector - selector with elements to apply the style to
     * @returns {undefined}
     */addHover:function(selector){$(selector).on({mouseenter:function(){$(this).addClass("over");},mouseleave:function(){$(this).removeClass("over");}});},/**
     * shows a "to top" button on long pages
     *
     * @returns {undefined}
     */scrollToTop:function(){var $scrollToTop=$('.scroll_to_top');$(window).on('scroll.scrollToTop',function(){$('.scroll_to_top').css({visibility:$scrollToTop.offset().top>window.innerHeight?'visible':'hidden'},600);});$scrollToTop.on('click.scrollToTop',function(){$('body, html').animate({scrollTop:0},600);});}};/**
 * Common UI Components, that are reused across the Game
 *
 **/ /**
 * Fill level bar display for storage rooms and cargo space
 *
 * @param barContainerClass
 * @param barClass
 * @param premiumBarClass - if additional premium bar is wanted
 *
 **/function refreshBars(barContainerClass,barClass,premiumBarClass){var $barContainer=$('.'+barContainerClass);$barContainer.each(function(){var $this=$(this),amountFull=$this.data('currentAmount'),capacity=$this.data('capacity'),wPercent=amountFull/capacity*100,$bar=$this.find('.'+barClass);if(wPercent>100){wPercent=100;}else if(wPercent==0){wPercent=0;}else if(wPercent<1.3){wPercent=1.3;}$bar.css('width',wPercent+'%');if(wPercent<90){$bar.attr('class',barClass+' filllevel_undermark');}else if(wPercent>90&&wPercent<100){$bar.attr('class',barClass+' filllevel_middlemark');}else{$bar.attr('class',barClass+' filllevel_overmark');}if(premiumBarClass){var $premiumBar=$this.find('.'+premiumBarClass),wPercentPremium=$premiumBar.data('premiumPercent');if(wPercent+wPercentPremium>100){wPercentPremium=100-wPercent;}$premiumBar.css('width',wPercentPremium+'%');}});}function changeTooltip(object,title){var $object=$(object);if($object.length==0){return;}removeTooltip($object);$object.attr('title',title);initTooltips($object);}function removeTooltip(object){var $object=$(object);$object.each(function(){if($(this).data('tooltipLoaded')){$(this).data('tooltipLoaded',false);Tipped.remove($(this)[0]);}});}function getTooltipOptions(element){var $thisObj=$(element);var options={skin:'cloud',size:'x-small',maxWidth:400,closeButton:false,hideOn:{element:'mouseleave',tooltip:'mouseenter'},hideOnClickOutside:true};// we need longer tooltips on galaxy
if(window.location.href.indexOf('galaxy')!==-1){options.maxWidth=400;}if($thisObj.hasClass('tooltipPremium')){options.skin='premium';}if($thisObj.hasClass('tooltipLeft')){options.position={target:'leftmiddle',tooltip:'righttop'};}else if($thisObj.hasClass('tooltipRight')){options.position={target:'rightmiddle',tooltip:'lefttop'};}else if($thisObj.hasClass('tooltipBottom')){options.position={target:'bottommiddle',tooltip:'topmiddle'};}if($thisObj.data('tooltip-width')){options.maxWidth=$thisObj.data('tooltip-width');}if(isMobile||$thisObj.hasClass('tooltipClose')){options.hideOthers=true;options.hideOn=false;}if($thisObj.hasClass('hideOthers')){options.hideOthers=true;}options.afterUpdate=function(content,element){if(isMobile&&$thisObj.data('tooltip-button')){var $buttonDiv=$(document.createElement('div')).addClass('tooltipButton');$(document.createElement('a')).addClass('btn_blue').attr('href','javascript:void(0);').html($thisObj.data('tooltip-button')).bind('click',function(e){if($(element).not('a')&&$(element).find('a').length){element=$(element).find('a')[0];}var event=document.createEvent("MouseEvents");event.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);element.dispatchEvent(event);}).appendTo($buttonDiv);$(content).append($buttonDiv);}if(isMobile||$thisObj.hasClass('tooltipClose')){var $closeBtn=$(document.createElement('div')).addClass('close-tooltip');$(content).prepend($closeBtn);}Tipped.refresh(element);};return options;}function getTooltipSelector(selector){var standardSelector=".tooltipPremium, .tooltip, .tooltipRight, .tooltipLeft, .tooltipBottom, .tooltipClose, .tooltipHTML, .tooltipRel, .tooltipAJAX, .tooltipCustom, .markItUpButton a";if(typeof selector=='undefined'){selector=standardSelector;}else if(typeof selector=='string'&&!selector.match(/\.tooltip/)){var standardSelectorArray=standardSelector.split(', ');var previousSelector=selector;for(i in standardSelectorArray){selector+=", "+previousSelector+" "+standardSelectorArray[i];}}return selector;}function sanitizeTooltip(text){return text.replace(/<\s*script/g,'&lt;script');}function initTooltips(selector){initTooltipSkins();selector=getTooltipSelector(selector);function generateHTML(text){var element={};var splitted=text.split("|");var title=$(document.createElement('h1')).html(splitted[0]);var splitLine=$(document.createElement('div')).addClass('splitLine');if(typeof splitted[2]!=="undefined"&&typeof splitted[3]!=="undefined"){var title2=$(document.createElement('h1')).html(splitted[2]);var splitLine2=$(document.createElement('div')).addClass('splitLine');element=$(document.createElement('div')).css('display','none').addClass('htmlTooltip').append(title).append(splitLine).append(splitted[1]+"</br>").append(title2).append(splitLine2).append(splitted[3]);}else{element=$(document.createElement('div')).css('display','none').addClass('htmlTooltip').append(title).append(splitLine).append(splitted[1]);}return element[0];}removeTooltip(selector);function addTooltip(object){var $thisObj=$(object);if($thisObj.data('tooltipLoaded')){return;}$thisObj.data('tooltipLoaded',true);if(isMobile&&$thisObj.hasClass('js_hideTipOnMobile')){$thisObj.attr('title','');return;}var options=getTooltipOptions($thisObj);if($thisObj.hasClass('tooltipCustom')){if(options.hideOn!=false){options.hideOn={element:'mouseleave',tooltip:'mouseleave'};}options.afterUpdate=function(content){$(content).find('.tooltipCustom').each(function(i,element){var options=getTooltipOptions($thisObj);if($(this).hasClass('tooltipHTML')){options.inline=true;options.hideOthers=false;Tipped.create(this,generateHTML(sanitizeTooltip($(this).attr('title'))),options);}else{options.hideOthers=false;Tipped.create(this,sanitizeTooltip($(this).attr('title')),options);}});};}if($thisObj.hasClass('tooltipHTML')){if(typeof $thisObj.attr('title')=='undefined'||$thisObj.attr('title').trim().length==0){return;}Tipped.create($thisObj[0],generateHTML(sanitizeTooltip($thisObj.attr('title'))),options);return;}if($thisObj.hasClass('tooltipRel')){options.inline=$thisObj.attr('rel');Tipped.create($thisObj[0],undefined,options);return;}if($thisObj.hasClass('tooltipAJAX')){$.get($thisObj.attr('rel'),{},function(data){Tipped.create($thisObj[0],data,options);});return;}if(typeof $thisObj.attr('title')=='undefined'||$thisObj.attr('title').trim().length==0){return;}Tipped.create($thisObj[0],sanitizeTooltip($thisObj.attr('title')),options);}$(document).undelegate(selector,'touchstart.tooltipClick').delegate(selector,'touchstart.tooltipClick',function(e){if(Tipped.visible(this)){var event=document.createEvent("MouseEvents");event.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);this.dispatchEvent(event);e.preventDefault();e.stopPropagation();}});// this fixes tooltips not being closed
$(document).undelegate('.t_Tooltip.t_visible .close-tooltip','click').delegate('.t_Tooltip.t_visible .close-tooltip','click',function(e){Tipped.hide($(e.currentTarget).closest('.t_Tooltip')[0]);});if(typeof selector=="string"){$(document).undelegate(selector,'mouseenter.tooltipLoad touchstart.tooltipLoad').delegate(selector,'mouseenter.tooltipLoad touchstart.tooltipLoad',function(e){addTooltip(this);Tipped.show(this);});}else{$(selector).each(function(){addTooltip(this);});}}$(function(){initTooltips();});function initTooltipSkins(){jQuery.extend(Tipped.Skins,{'cloud':{offset:{x:0,y:-1,mouse:{x:-12,y:-12// only defined in the base class
}},stem:{height:6,width:11,offset:{x:5,y:5},spacing:0}},'premium':{offset:{x:0,y:-1,mouse:{x:-12,y:-12// only defined in the base class
}},stem:{height:6,width:11,offset:{x:5,y:5},spacing:0}}});}function initTrader(){var disableAnimationOnce=false;var url=$.deparam.fragment();if(typeof url["animation"]!='undefined'){if(url["animation"]=='false'){disableAnimationOnce=true;}}// toggle overview-panel
var toggleDisplay={$link:null,$panel:null,close:function(){this.$panel.hide();},setPanel:function(){this.$panel=$('#js_togglePanel'+traderObj.traderId.replace(/#div_trader/,''));},init:function(traderId){var $wrapper=$(traderId+' .selectWrapper');traderId=traderId.replace(/#div_trader/,'');if(!$wrapper)return;this.$link=$('#js_toggleLink'+traderId);this.$panel=$('#js_togglePanel'+traderId);var $panel=this.$panel;// hide panel initially
$panel.hide();// bind toggle fn
this.$link.unbind('click.selectLink').bind('click.selectLink',function(e){traderId=traderObj.traderId.replace(/#div_trader/,'');if($(this).hasClass('honor')){return false;}if($panel.find('ul.active').has('li').length){$panel.toggle();}return false;});//event for planet or moon select
$('.selectWrapper .source').unbind('click.selectPlanetOrMoon').bind('click.selectPlanetOrMoon',function(e){toggleDisplay.selectPlanetOrMoon(this);});// event for list item, use live instead of bind, because list elements can be created dynamically
$('#'+$panel.attr('id')).find('li').unbind('click.selectSource').bind('click.selectSource',function(e){traderObj.selectSource(this);return false;});// click outside of panel
toggleDisplay.outerClick($wrapper,$panel);// delayed panel self-closing
var timeoutID=null,delay=8000;$wrapper.unbind('mouseout.closeSelect').bind('mouseout.closeSelect',function(e){// custom mouseleave event
e=e||window.event;var reltg=e.relatedTarget?e.relatedTarget:e.toElement;if(reltg==$wrapper||toggleDisplay.isChildOf(reltg,$wrapper)){return;}// hide after timeout
timeoutID=setTimeout(function(){$panel.hide();},delay);}).unbind('mouseover.clearTimeout').bind('mouseover.clearTimeout',function(){if(timeoutID){clearTimeout(timeoutID);}});},// helper function for custom mouseleave
//TODO: is this still needed?
isChildOf:function(child,parent){parent=parent[0];while(child&&child!=parent){child=child.parentNode;}return child==parent;},outerClick:function($wrapper,$panel){$('body').bind('click.outerClick',function(e){if(!e){e=window.event;}if(!($(e.target).closest('.selectWrapper')==$wrapper)&&$panel.is(':visible')!=false){$panel.toggle();}});},selectPlanetOrMoon:function(elem){var planet;if($(elem).hasClass("selected")){return false;}var selectedContent='',selectedPlanetId=null;if($(elem).hasClass('js_honor')){$(traderObj.traderId+' .selectWrapper .source').removeClass('selected');$(traderObj.traderId+' .js_honor').addClass('selected');$(traderObj.traderId+' .toggleLink').addClass('honor');var selectedContent='<img height="18" src="//gf1.geo.gfsrv.net/cdnfc/f35675179214f8f6f0f8d75740d7db.png" alt="'+loca.honorPoints+'"/>'+'<span class="option_source">'+loca.honorPoints+'</span>';$(traderObj.traderId+' .js_valSourcePlanet').html(selectedContent);$(traderObj.traderId+' .normalResource').hide();$(traderObj.traderId+' .honorResource').show();return false;}var $togglePanel=$(traderObj.traderId+' .togglePanel');var className='planet';if($(elem).hasClass('js_moon')){var moonCounter=0;className='moon';for(planet in traderObj.planets){if(traderObj.planets[planet].isMoon)moonCounter++;}if(moonCounter==0)return false;}var currentPlanet=traderObj.planets[traderObj.current.planet];$togglePanel.find('ul').hide().removeClass('active');$togglePanel.find('ul.'+className).show().addClass('active');$(traderObj.traderId+' .toggleLink').removeClass('honor');$(traderObj.traderId+' .selectWrapper .source').removeClass('selected');$(traderObj.traderId+' .js_'+className).addClass('selected');if($(elem).hasClass('js_moon')?currentPlanet.isMoon:!currentPlanet.isMoon){selectedPlanetId=traderObj.current.planet;}else if(currentPlanet.otherPlanet!=null&&typeof traderObj.planets[currentPlanet.otherPlanet]!="undefined"){selectedPlanetId=currentPlanet.otherPlanet;}else{selectedPlanetId=$togglePanel.find('ul.'+className+' li:first').attr('id');}$(traderObj.traderId+' .normalResource').show();$(traderObj.traderId+' .honorResource').hide();$togglePanel.find('ul li#'+selectedPlanetId).click();return false;},setToggleLink:function(link){// we need to redefine the traderId here so we act on the right $link and $panel:
var traderId=traderObj.traderId.replace(/#div_trader/,''),$span=$(link).find('span'),planetName=traderObj.planets[$(link).attr('id')].name;if(planetName!=$span.text()){$span.attr('title',planetName.replace(/\|/g,'&#124;'));}this.$link=$('#js_toggleLink'+traderId);this.$link.html($(link).html());}};/*
     * Object for Auctioneer and ImportExport Slider
     */traderObj={traderBGPos:{'#div_traderResources':'0px 0px','#div_traderAuctioneer':'-546px 0px','#div_traderScrap':'0px -220px','#div_traderImportExport':'-546px -220px'},timer:500,// Wenn direkt auf Unterseite -> timer = 0
planets:{},honorOutput:0,price:0,deficit:0,priceImportExport:0,sumResources:0,traderId:null,resources:['Metal','Crystal','Deuterium'],current:{planet:currentPlanetId,resource:'',sliderValue:''},barXPos:-180,// start Position
barYPos:0,percentPaid:0,switchingTrader:false,checkOverbidden:function(){if(playerBid==false||playerBid>=getValue($('.detail_value.currentSum').html())){$('.overbid_text').hide();}else{$('.overbid_text').show();}},/*
         * This function updates only the current slider.
         * It gets called whenever a slider was changed so we will
         * calculate the total sum here:
         */refresh:function(){var traderId=traderObj.traderId;// Check that we're in the right context:
if('#'+$(this).closest('.div_trader').attr('id')!==traderId)return;// Get the css-class that identifies the current slider:
var myClass=$(this).attr('class');var re=new RegExp(/\b(js_slider\w*)\b/);myClass=re.test(myClass)?RegExp.$1:false;if(!myClass)return;// Update current values:
traderObj.current.sliderValue=$(this).slider("value");traderObj.current.resource=myClass.replace('js_slider','').toLowerCase();if(traderObj.current.resource=='honor'){traderObj.honorOutput=traderObj.current.sliderValue;}else{traderObj.planets[traderObj.current.planet].output[traderObj.current.resource]=traderObj.current.sliderValue;}formatNumber($(traderId+' .js_amount.js_'+traderObj.current.resource),traderObj.current.sliderValue);if(traderId=='#div_traderAuctioneer'){traderObj.price=getValue($(traderId+' .js_price').html());//traderObj.deficit = getValue($( traderId + ' .js_deficit' ).html());
traderObj.sumAuctioneer();traderObj.checkOverbidden();}else if(traderId=='#div_traderImportExport'){traderObj.sumImportExport();}},// 	refresh: function() end
/*
         * Whenever the view changes to another trader, all inputFields, Sliders, outputvalues
         * and selected planed have to be resetted:
         */resetValues:function(traderId,resetCurrentPlanet){traderId=traderId||traderObj.traderId;resetCurrentPlanet=resetCurrentPlanet||false;/* for( planet in traderObj.planets ) funktioniert im IE7/8 nicht!! */ // Reset output values:
for(var planet in traderObj.planets){for(var resource in traderObj.planets[planet].output){traderObj.planets[planet].output[resource]=0;}}traderObj.honorOutput=0;// Reset input fields:
$('.js_amount').val(0);// reset sums
if(traderObj.traderId=='#div_traderAuctioneer'){traderObj.sumAuctioneer();}else if(traderObj.traderId=='#div_traderImportExport'){traderObj.sumImportExport();}// Reset display of selected planet to currentPlanetId
if(resetCurrentPlanet){traderId=traderId.replace(/#div_trader/,'');$('#js_togglePanel'+traderId).find("li#"+currentPlanetId).click();}toggleDisplay.close();},/*
         * Update the shown max-amount of planet resource
         */resetMaxAmount:function(planetResources,honor){var traderId=traderObj.traderId;var resources=traderObj.resources;for(var planetId in traderObj.planets){for(var i=0;i<resources.length;i++){var resToLower=resources[i].toLowerCase();traderObj.planets[planetId].input[resToLower]=planetResources[planetId][resToLower];}}for(var j=0;j<resources.length;j++){resToLower=resources[j].toLowerCase();var planetMax=traderObj.planets[traderObj.current.planet].input[resToLower];$(traderId+' .max_planet_'+resToLower).html(number_format(planetMax,0));}honorScore=honor;$(traderId+' .max_planet_honor').html(number_format(Math.max(0,honor),0));toggleDisplay.close();},/*
         * Update all fields with selected source:
         */selectSource:function(selectedSource){// save selected source:
traderObj.current.planet=$(selectedSource).attr('id');//set first source to selected source
toggleDisplay.close();toggleDisplay.setToggleLink($(selectedSource));var traderId=traderObj.traderId;var currPlanet=traderObj.current.planet;var resources=traderObj.resources;// update maximum and current values of all sliders and input fields:
for(var i=0;i<resources.length;i++){var resToLower=resources[i].toLowerCase();var planetMax=traderObj.planets[currPlanet].input[resToLower];if(traderId=='#div_traderImportExport'){var outputMax=traderObj.priceImportExport/multiplier[resToLower]-traderObj.sumResources+traderObj.planets[currPlanet].output[resToLower];var currMax=Math.min(planetMax,outputMax);}$(traderId+' .max_planet_'+resToLower).html(number_format(planetMax,0));$(traderId+' .js_amount.js_'+resToLower).val(number_format(traderObj.planets[currPlanet].output[resToLower],0));}},/*
         * Overview Image Animation
         */selectTrader:function(myTrader,timer,tab){timer=timer||traderObj.timer;$.bbq.pushState({'page':myTrader,'animation':'false'});$(".planetlink, .moonlink").fragment({'page':myTrader,'animation':'false'});traderObj.traderId='#div_'+myTrader;var traderId=traderObj.traderId,$backToOverview=$('.back_to_overview');var showTrader=function(){if(traderId=='#div_traderAuctioneer'||traderId=='#div_traderImportExport'){traderObj.resetValues(null,true);}var changeTraderFunction=function(){$('#traderOverview').find('.c-left, .c-right').addClass('c-small');$backToOverview.show();if(traderId=='#div_traderAuctioneer'||traderId=='#div_traderImportExport'){$backToOverview.addClass('left');$backToOverview.removeClass('right');}else if(traderId=='#div_traderResources'||traderId=='#div_traderScrap'){$backToOverview.addClass('right');$backToOverview.removeClass('left');}$('#planet #header_text h2').html(loca[myTrader]).parent().show();};if(animation&&!disableAnimationOnce){$('#traderOverview').find('.c-left, .c-right').hide();$('#planet').animate({backgroundPosition:traderObj.traderBGPos[traderId],height:'250px'},timer,function(){$('#planet').addClass('detail');$('#traderOverview').find('.c-left, .c-right').show();changeTraderFunction();if(traderId=='#div_traderResources'){showTradeNowButton();}});}else{disableAnimationOnce=false;$('#planet').css('background-position',traderObj.traderBGPos[traderId]).css('height','250px');changeTraderFunction();if(traderId=='#div_traderResources'){showTradeNowButton();}}toggleDisplay.setPanel();$('#planet').addClass('detail');$('.js_trader').hide();$(traderId).show();if(traderId=='#div_traderResources'&&typeof tab!='undefined'){$(traderId+' .ui-tabs').tabs('option','active',tab);}traderObj.switchingTrader=false;};if($(traderObj.traderId).length==0){var traderString=myTrader.toLowerCase().replace(/^trader/,'');$.ajax({url:traderUrl,type:'POST',data:{show:traderString,ajax:1},beforeSend:function(){$('#loadingOverlay').addClass(traderString).show();},success:function(data){$("#inhalt").append(data);$('#loadingOverlay').hide().removeClass(traderString);showTrader();},error:function(){fadeBox(loca['error'],true);$('#loadingOverlay').hide().removeClass(traderString);}});}else{showTrader();}},submitAuction:function(){var traderId=traderObj.traderId;var sum=getValue($(traderId+' .js_auctioneerSum').html());if(!$(traderId+' .right_box .pay').hasClass('disabled')&&traderObj.price>0&&traderObj.deficit<=0){$(traderId+' .right_box .pay').addClass('disabled');var bidArray={planets:{},honor:traderObj.honorOutput};for(var planetId in traderObj.planets){bidArray.planets[planetId]=traderObj.planets[planetId].output;}$.ajax({url:auctionUrl,type:'POST',data:{bid:bidArray,token:auctioneerToken,ajax:1},dataType:"json",success:function(data){auctioneerToken=data.newToken;fadeBox(data.message,data.error);if(!data.error){traderObj.resetValues(traderId,false);traderObj.resetMaxAmount(data.planetResources,data.honor);traderObj.reloadResources();}},error:function(){fadeBox(loca['error'],true);}});}return false;},submitImportExport:function(){if(!$(traderObj.traderId+' .right_box .pay').hasClass('disabled')){$(traderObj.traderId+' .right_box .pay').addClass('disabled');var bidArray={planets:{},honor:traderObj.honorOutput};for(planetId in traderObj.planets){bidArray.planets[planetId]=traderObj.planets[planetId].output;}$.ajax({url:importUrl,type:'POST',data:{action:"trade",bid:bidArray,token:importToken,ajax:1},dataType:"json",success:function(data){importToken=data.newToken;fadeBox(data.message,data.error);if(!data.error){for(planetId in traderObj.planets){traderObj.planets[planetId].output={metal:0,crystal:0,deuterium:0};}$(traderObj.traderId+' .bargain_overlay').show();$(traderObj.traderId+' .payment').hide();$(traderObj.traderId+' .image_140px a').addClass("slideIn");traderObj.reloadResources();traderObj.updateImportItem(data.item);traderObj.refresh();}},error:function(){fadeBox(loca['error'],true);}});}return false;},reloadResources:function(callback){getAjaxResourcebox(callback);},changeImportItem:function(){if($(traderObj.traderId+' .import_bargain.change').hasClass('disabled')){if(darkMatter<importChangeCost){errorBoxDecision(LocalizationStrings.error,loca.errorNotEnoughDM,LocalizationStrings.yes,LocalizationStrings.no,redirectPremium);}}else{$(traderObj.traderId+' .import_bargain.change').addClass('disabled');$.ajax({url:importUrl,type:'POST',data:{action:"bargain",token:importToken,ajax:1},dataType:"json",success:function(data){importToken=data.newToken;fadeBox(data.message,data.error);if(!data.error){traderObj.updateImportItem(data.item);traderObj.reloadResources(function(){if(data.item.offersLeft>0&&darkMatter>=importChangeCost){$(traderObj.traderId+' .import_bargain.change').removeClass('disabled');}else{$(traderObj.traderId+' .import_bargain.change').addClass('disabled');}});traderObj.refresh();}},error:function(){fadeBox(loca['error'],true);}});}return false;},updateImportItem:function(itemData){$(traderObj.traderId+' .got_item_text').html(itemData.itemText);$(traderObj.traderId+' .bargain_text').html(itemData.bargainText);$(traderObj.traderId+' .bargain_cost').html(itemData.bargainCostText);importChangeCost=itemData.bargainCost;$(traderObj.traderId+' .image_140px img').attr("src","/cdn/img/item-images/"+itemData.image+"-140x.png");removeTooltip($(traderObj.traderId+' .image_140px a'));$(traderObj.traderId+' .image_140px a').attr("ref",itemData.uuid).removeClass("tooltip").addClass("tooltipHTML").attr("title",itemData.tooltip);initTooltips($(traderObj.traderId+' .image_140px a'));$(traderObj.traderId+' .detail_button .amount').text(itemData.amount);},takeImportItem:function(){if(!$(traderObj.traderId+' .import_bargain.take').hasClass('disabled')){$(traderObj.traderId+' .import_bargain.change').addClass('disabled');$(traderObj.traderId+' .import_bargain.take').addClass('disabled');$(traderObj.traderId+' .import_bargain.change').addClass('hidden');$(traderObj.traderId+' .import_bargain.take').addClass('hidden');$(traderObj.traderId+' .bargain_cost').addClass('hidden');$.ajax({url:importUrl,type:'POST',data:{action:"takeItem",token:importToken,ajax:1},dataType:"json",success:function(data){importToken=data.newToken;fadeBox(data.message,data.error);if(!data.error){var uuid=data.item.ref;changeTooltip($(".detail_button[ref='"+uuid+"']"),data.item.title);$(".detail_button[ref='"+uuid+"'] span.amount, "+"#itemDetails[data-uuid='"+uuid+"'] span.amount").html(tsdpkt(data.item.amount));if(data.item.canBeActivated){$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').removeClass('build-it_disabled').addClass('build-it');}else{$('#itemDetails[data-uuid="'+uuid+'"] a.activateItem').addClass('build-it_disabled').removeClass('build-it');}if(data.item.newOffer==false){$(traderObj.traderId+' .bargain_text').html(data.item.noOfferMessage);}else{traderObj.resetImport(data.item.newOffer);}}},error:function(){fadeBox(loca['error'],true);}});}return false;},resetImport:function(importData){importChangeCost=importData.bargainCost;if(darkMatter>=importChangeCost){$(traderObj.traderId+' .import_bargain.change').removeClass('disabled');}else{$(traderObj.traderId+' .import_bargain.change').addClass('disabled');}$(traderObj.traderId+' .import_bargain.take').removeClass('disabled');$(traderObj.traderId+' .import_bargain.change').removeClass('hidden');$(traderObj.traderId+' .import_bargain.take').removeClass('hidden');$(traderObj.traderId+' .bargain_cost').removeClass('hidden');$(traderObj.traderId+' .bargain_overlay').hide();$(traderObj.traderId+' .payment').show();$(traderObj.traderId+' .image_140px img').attr("src","/cdn/img/trader/container_"+importData.rarity+".jpg");$(traderObj.traderId+' .image_140px a').removeClass("slideIn").attr("ref","").removeClass("tooltipHTML").addClass("tooltip").removeClass('r_common_140px').removeClass('r_uncommon_140px').removeClass('r_rare_140px').removeClass('r_epic_140px').removeClass('r_buddy_140px').addClass('r_'+importData.rarity+'_140px');changeTooltip($(traderObj.traderId+' .image_140px a'),importData.tooltip);$(traderObj.traderId+' .js_import_price').removeClass('green_text').text(number_format(importData.price,0));$(traderObj.traderId+' .image_140px .amount').text("?");traderObj.priceImportExport=getValue($('.js_import_price').html());traderObj.resetValues(null,true);traderObj.init();},/*
         * add all values from all sources:
         * sum has to be initialized with 0 every time, because we add the total amount of resources every time, not just the change
         */sumAuctioneer:function(){var traderId=traderObj.traderId;var price=traderObj.price;if(price==0){$('#div_traderAuctioneer .js_amount').attr('disabled','disabled');}else{$('#div_traderAuctioneer .js_amount').removeAttr('disabled');}var sum=0;for(var planetId in traderObj.planets){var output=traderObj.planets[planetId].output;sum+=parseInt(output.metal)*multiplier.metal+parseInt(output.crystal)*multiplier.crystal+parseInt(output.deuterium)*multiplier.deuterium;}sum+=parseInt(traderObj.honorOutput)*multiplier.honor;sum=Math.floor(sum);traderObj.deficit=Number(auctioneer.calculateDeficit())-Number(sum);if(traderObj.deficit>0){$(' .js_deficit').html(number_format(traderObj.deficit,0));}else{$(' .js_deficit').html(number_format(0,0));}if(sum>0){$('#div_traderAuctioneer .js_auctioneerSum').html('+ '+number_format(sum,0));}else{$('#div_traderAuctioneer .js_auctioneerSum').html('');}$('#div_traderAuctioneer .js_alreadyBidden').html(number_format(Math.floor(playerBid+sum),0));//bid ok?
if(price>0&&traderObj.deficit<=0){$('#div_traderAuctioneer .right_box .pay').removeClass('disabled');}else{$('#div_traderAuctioneer .right_box .pay').addClass('disabled');}},sumImportExport:function(){var traderId=traderObj.traderId;var sumMetal=0;var sumCrystal=0;var sumDeuterium=0;traderObj.sumResources=0;for(var planetId in traderObj.planets){var output=traderObj.planets[planetId].output;sumMetal+=parseInt(output.metal)*multiplier.metal;sumCrystal+=parseInt(output.crystal)*multiplier.crystal;sumDeuterium+=parseInt(output.deuterium)*multiplier.deuterium;}var sumHonor=traderObj.honorOutput*multiplier.honor;traderObj.sumResources+=sumMetal+sumCrystal+sumDeuterium+sumHonor;if(traderObj.sumResources>=traderObj.priceImportExport){traderObj.sumResources=traderObj.priceImportExport;}$(traderId+' .js_sum_price').html(number_format(Math.floor(traderObj.sumResources),0));//price ok?
if(traderObj.sumResources>=traderObj.priceImportExport){$(traderId+' .js_import_price').addClass('green_text');$(traderId+' .right_box .pay').removeClass('disabled');}else{$(traderId+' .js_import_price').removeClass('green_text');$(traderId+' .right_box .pay').addClass('disabled');}},/*
         * Update all values of current slider depending on which button was clicked:
         */updateValues:function($elem){var traderId=traderObj.traderId;if(traderId!=='#'+$elem.closest('.div_trader').attr('id'))return;var myClass=$elem.attr('class');var re=new RegExp(/\b(js_slider\w*)\b/);myClass=re.test(myClass)?RegExp.$1:false;if(!myClass)return;var currPlanet=traderObj.current.planet;var action,value,sliderId;if(myClass.indexOf('More')!=-1){sliderId=myClass.replace('More','');action='More';}else if(myClass.indexOf('Max')!=-1){sliderId=myClass.replace('Max','');action='Max';}traderObj.current.resource=sliderId.replace('js_slider','').toLowerCase()||null;var currResource=traderObj.current.resource;var currInputValue=0;if(currResource=='honor'){currInputValue=Math.max(0,honorScore);}else{currInputValue=traderObj.planets[currPlanet].input[currResource];}value=getValue($(traderId+' .'+sliderId+'Input').val());if(action=='More'){if(traderId=='#div_traderImportExport'){if(traderObj.sumResources<=traderObj.priceImportExport-1000*multiplier[currResource]){value+=1000;}else if(traderObj.sumResources<traderObj.priceImportExport){value+=Math.ceil((traderObj.priceImportExport-traderObj.sumResources)/multiplier[currResource]);}}else if(traderId=='#div_traderAuctioneer'&&traderObj.price>0){value+=1000;}if(value>=currInputValue){value=Math.max(0,currInputValue);}}else if(action=='Max'){if(traderId=='#div_traderImportExport'){if(traderObj.sumResources==0){value=Math.min(currInputValue,Math.ceil(traderObj.priceImportExport/multiplier[currResource]));}else if(traderObj.sumResources.isBetween(0,traderObj.priceImportExport-1)){value=Math.min(currInputValue,value+Math.ceil((traderObj.priceImportExport-traderObj.sumResources)/multiplier[currResource]));value=Math.max(0,value);}}else if(traderId=='#div_traderAuctioneer'&&traderObj.price>0){value=Math.min(currInputValue,Math.ceil(getValue($(traderId+' .js_deficit').html())/multiplier[currResource]+value));}if(currResource=='honor'&&value<0)value=0;}// update valueObject and slider with the new value:
$(traderId+' .js_amount.'+sliderId+'Input').val(number_format(value,0));if(currResource=='honor'){traderObj.honorOutput=value;}else{traderObj.planets[currPlanet].output[currResource]=value;}if(traderId=='#div_traderImportExport'){traderObj.sumImportExport();}else if(traderId=='#div_traderAuctioneer'&&traderObj.price>0){traderObj.sumAuctioneer();traderObj.checkOverbidden();}},updateValuesInputCanged:function($elem){var traderId=traderObj.traderId;if(traderId!=='#'+$elem.closest('.div_trader').attr('id'))return;var myClass=$elem.attr('class');var re=new RegExp(/\b(js_slider\w*)\b/);myClass=re.test(myClass)?RegExp.$1:false;if(!myClass)return;var sliderId=myClass.replace('Input','');var currResource=sliderId.replace('js_slider','').toLowerCase();var currPlanet=traderObj.current.planet;var currInputValue=0;if(currResource=='honor'){currInputValue=Math.max(0,honorScore);}else{currInputValue=parseInt(traderObj.planets[currPlanet].input[currResource]);}//update traderObj
// value may be max either max ress on planet or the price devided by multiplier
var value=0;if(traderId=='#div_traderImportExport'){var sum=0;for(var planetId in traderObj.planets){var output=traderObj.planets[planetId].output;if(currResource!='metal'){sum+=Math.floor(parseInt(output.metal)*multiplier.metal);}if(currResource!='crystal'){sum+=Math.floor(parseInt(output.crystal)*multiplier.crystal);}if(currResource!='deuterium'){sum+=Math.floor(parseInt(output.deuterium)*multiplier.deuterium);}//if(currResource != 'honor') { sum += Math.floor(parseInt(output.honor) * multiplier.honor); }
}value=Math.min(getValue($elem.val()),Math.ceil((traderObj.priceImportExport-sum)/multiplier[currResource]));}else if(traderId=='#div_traderAuctioneer'){value=getValue($elem.val());}value=Math.min(value,currInputValue);traderObj.planets[currPlanet].output[currResource]=value;if(currResource=='honor'){traderObj.honorOutput=value;}else{traderObj.planets[currPlanet].output[currResource]=value;}if(traderId=='#div_traderImportExport'){traderObj.sumImportExport();}else if(traderId=='#div_traderAuctioneer'){traderObj.sumAuctioneer();traderObj.checkOverbidden();}formatNumber(traderId+' .js_amount.'+sliderId+'Input',value);},init:function(){$(".honorResource").hide();$("#menuTable a.trader").unbind("click.gotoTrader").bind("click.gotoTrader",function(e){e.preventDefault();traderObj.switchTrader("traderResources");});$(window).unbind("hashchange.switchTrader").bind("hashchange.switchTrader",function(e){var url=$.deparam.fragment(e.fragment);if(typeof url['page']=='undefined'||url['page']==''&&traderObj.traderId!=null){traderObj.returnToOverview();}else{traderObj.switchTrader(url['page']);}});$('.small_back_to_overview').unbind('mouseenter').unbind('mouseout').bind('mouseenter',function(){$('#header_text').css('background-position','0 -250px');}).bind('mouseout',function(){$('#header_text').css('background-position','0 0');});},initSliderTrader:function(traderId){// Unbind the events:
$(traderId+' .js_valButton').unbind('click.valControl');$(traderId+' .js_amount').unbind('keyup.inputVal');toggleDisplay.init(traderId);$(traderId+' .js_valButton').bind('click.valControl',function(e){traderObj.updateValues($(this));e.stopPropagation();});$(traderId+' .js_amount').bind('keyup.inputVal',function(e){traderObj.updateValuesInputCanged($(this));e.stopPropagation();});},initImportExport:function(){traderObj.planets=planetResources;traderObj.priceImportExport=getValue($('.js_import_price').html());traderObj.initSliderTrader('#div_traderImportExport');$('#div_traderImportExport .right_box .pay').bind('click',function(){traderObj.submitImportExport();});$('#div_traderImportExport .import_bargain.change').bind('click',function(){traderObj.changeImportItem();});$('#div_traderImportExport .import_bargain.take').bind('click',function(){traderObj.takeImportItem();});},switchTrader:function(traderId){if(traderObj.switchingTrader){return;}traderObj.switchingTrader=true;Tipped.hideAll();$('#planet .close_details:visible').click();if("#div_"+traderId==traderObj.traderId){return;}if(traderObj.traderId!=null||traderId==''||traderId==null){traderObj.returnToOverview();if(animation&&!disableAnimationOnce){setTimeout(function(){traderObj.selectTrader(traderId);},500);}else{traderObj.selectTrader(traderId);}}else{traderObj.selectTrader(traderId);}},returnToOverview:function(){Tipped.hideAll();// reset trader header
$('#planet #header_text h2').empty().parent().hide();$('#traderOverview').find('.c-left, .c-right').hide();var traderId=traderObj.traderId;if(!traderId)return;$(traderId).hide();$("#callTrader").hide();if(animation&&!disableAnimationOnce){$('#planet h2').hide();$('#planet').animate({backgroundPosition:'-273px 0px',height:'470px'},500,function(){$('#planet h2').show();$('#planet').removeClass('detail');$('#traderOverview').find('.c-left, .c-right').show();$('.js_trader').show();});}else{$('#planet').removeClass('detail').css('background-position','-273px 0px').css('height','470px');$('.js_trader').show();}$('#planet a').show();$('#planet .back_to_overview').hide();removeTooltip($('#planet .back_to_overview'));$('#traderOverview').find('.c-left, .c-right').removeClass('c-small');traderObj.traderId=null;traderObj.switchingTrader=false;}};breakerObj={costs:null,offer:null,ships:{},locked:false,lastTechId:null,initialize:function(){this.offer=parseInt($('.scrap_offer_amount').html());this.costs=breakerCosts;var thisObj=this;/* ****** Scrotthndler AnythingSlider ******* */$('#js_anythingSliderShips, #js_anythingSliderDefense').anythingSlider({startStopped:true,// If autoPlay is on, this can force it to start stopped
buildStartStop:false,expand:true,resizeContents:false,theme:'default',infiniteSlides:false,autoPlay:false,easing:'swing',resizeContents:true,stopAtEnd:true,playRtl:isRTLEnabled,buildNavigation:false,// Callback when the plugin finished initializing (for IPad Swipe Event)
onInitialized:function(e,slider){if(isMobile){var time=1000,// allow movement if < 1000 ms (1 sec)
range=50,// swipe movement of 50 pixels triggers the slider
x=0,t=0,touch="ontouchend"in document,st=touch?'touchstart':'mousedown',mv=touch?'touchmove':'mousemove',en=touch?'touchend':'mouseup';slider.$window.bind(st,function(e){// prevent image drag (Firefox)
//e.preventDefault();
t=new Date().getTime();x=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;}).bind(en,function(e){t=0;x=0;}).bind(mv,function(e){e.preventDefault();var newx=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,r=x===0?0:Math.abs(newx-x),// allow if movement < 1 sec
ct=new Date().getTime();if(t!==0&&ct-t<time&&r>range){if(newx<x){slider.goForward();}if(newx>x){slider.goBack();}t=0;x=0;}});}}});// end slider 1 initialize
$('#js_anythingSliderDefense').parent().parent().hide();$('.scrap_defense').bind('click.tabDefense',function(){$('.scrap_ships').removeClass('selected');$(this).addClass('selected');$('#js_anythingSliderShips').parent().parent().hide();$('#js_anythingSliderDefense').parent().parent().show();});$('.scrap_ships').bind('click.tabShips',function(){$('.scrap_defense').removeClass('selected');$(this).addClass('selected');$('#js_anythingSliderDefense').parent().parent().hide();$('#js_anythingSliderShips').parent().parent().show();});$('.buildingimg a').each(function(){var techId=$(this).attr('ref').substr(6,3);var $level=$(this).find('.level');var $amount=$level.contents().filter(function(){return this.nodeType==3;});thisObj.ships[techId]=$amount.text().replace(/^\s+|\s+$/g,'');$amount.remove();$level.append(tsdpkt(thisObj.ships[techId]));});$('#js_scrapBargain').unbind('click').bind('click',function(){if(!$(this).hasClass('disabled')){thisObj.bargain(thisObj);}return false;});$('#js_scrapScrapIT').unbind('click').bind('click',function(){if(!$(this).hasClass('disabled')){thisObj.trade(thisObj);}return false;});$('input.ship_amount').unbind('focus').bind('focus',function(){thisObj.lastTechId=$(this).attr('name').substr(2,3);$(this).val('');});$('input.ship_amount').unbind('keyup change').bind('keyup change',function(event){thisObj.lastTechId=$(this).attr('name').substr(2,3);formatNumber(this,$(this).val());var $this=$(this);clearTimeout($this.data('timer'));$this.data('timer',setTimeout(function(){$this.removeData('timer');thisObj.updateResources(thisObj);},300));});$('.buildingimg a').unbind('click').bind('click',function(){return false;});$('.js_maxShips').unbind('click').bind('click',function(){if(!isMobile){$($(this).attr('ref')).focus();}var shipAmount=thisObj.ships[$(this).attr('ref').substr(6,3)];$($(this).attr('ref')).val(tsdpkt(shipAmount)).trigger('change');thisObj.updateResources(thisObj);return false;});$('.sendAll').unbind('click').bind('click',function(){$('.anythingSlider ul:visible input').each(function(){thisObj.lastTechId=$(this).attr('name').substr(2,3);var shipAmount=thisObj.ships[thisObj.lastTechId];$(this).val(tsdpkt(shipAmount));});thisObj.updateResources(thisObj,function(data){if(data.error){$('.anythingSlider ul:visible input').val('');$('#div_traderScrap .resource_amount').text(0);thisObj.checkShips(thisObj);}});});$('.sendNone').unbind('click').bind('click',function(){$('.anythingSlider ul:visible input').each(function(){thisObj.lastTechId=$(this).attr('name').substr(2,3);$(this).val('');});thisObj.updateResources(thisObj);});$('#js_bargainCost').text(tsdpkt(this.costs));this.checkMoney(this);this.checkShips(this);this.updateBargain(this);},bargain:function(thisObj){$('#js_scrapBargain').addClass('disabled');$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{bargain:1,token:breakerToken},beforeSend:function(){thisObj.lock(thisObj);},success:function(data){thisObj.unlock(thisObj);breakerToken=data.newToken;fadeBox(data.message,data.error);if(!data.error){thisObj.costs=data.bargainPrice;thisObj.offer=data.percentage;darkMatter=data.resources.dm;thisObj.updateBargain(thisObj);thisObj.updateResources(thisObj);traderObj.reloadResources(function(){thisObj.checkMoney(thisObj);Tipped.show($('#js_scrapBargain')[0]);});}$(".scrap_trader_quote").text(data.quote);},error:function(){thisObj.unlock(thisObj);}});},trade:function(thisObj){thisObj.lock(thisObj);var tradeArray=thisObj.getTradeArray();var getBreakerQuestion=function getBreakerQuestion(){var questionString=loca.breakerQuestion+'<br/><br/><div style="text-align: left; margin-left: 30px">';var counter=0;$.each(tradeArray,function(techId){questionString+=this+"x "+loca.shipNames[techId]+", ";counter++;if(counter%2==0){questionString+="<br/>";}});questionString=questionString.replace(/, (<br\/>)?$/,'');questionString+='</div>';return questionString;};errorBoxDecision(loca.breaker,getBreakerQuestion(),LocalizationStrings.yes,LocalizationStrings.no,function(){$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:thisObj.lastTechId,finishTrade:1,trade:tradeArray,token:breakerToken},success:function(data){thisObj.unlock(thisObj);breakerToken=data.newToken;if(data.error){fadeBox(data.message,true);}else{fadeBox(data.message,false);thisObj.offer=data.percentage;thisObj.costs=data.bargainPrice;thisObj.resetForm();thisObj.updateBargain(thisObj);$("#js_scrapAmountMetal").html(0);$("#js_scrapAmountCrystal").html(0);$("#js_scrapAmountDeuterium").html(0);traderObj.reloadResources(function(){thisObj.updateShips(thisObj);});}$(".scrap_trader_quote").text(data.quote);},error:function(){thisObj.unlock(thisObj);fadeBox(loca['error'],true);}});},function(){thisObj.unlock(thisObj);});},updateResources:function(thisObj,callback){if(thisObj.locked){return;}$.ajax({url:breakerCallLink,type:"POST",dataType:"json",data:{lastTechId:thisObj.lastTechId,trade:thisObj.getTradeArray(),token:breakerToken},beforeSend:function(){thisObj.lock(thisObj);},success:function(data){breakerToken=data.newToken;if(data.error){fadeBox(data.message,true);}thisObj.locked=false;var reloadShips=false;for(var techId in data.techAmount){$("#ship_"+techId).val(tsdpkt(data.techAmount[techId]));if(!reloadShips&&$("#ship_"+techId).val()!=thisObj.ships[techId]){reloadShips=true;}}$("#js_scrapAmountMetal").html(tsdpkt(data.resources.metal));$("#js_scrapAmountCrystal").html(tsdpkt(data.resources.crystal));$("#js_scrapAmountDeuterium").html(tsdpkt(data.resources.deuterium));if(!thisObj.notFirstOffer){$(".scrap_trader_quote").text(loca.breakerFirstOffer);thisObj.notFirstOffer=true;}if(reloadShips){thisObj.updateShips(thisObj);}else{thisObj.unlock(thisObj);}if(typeof callback=='function'){callback(data);}},error:function(){thisObj.unlock(thisObj);}});},updateShips:function(thisObj){$.ajax({url:techUrl,type:"POST",dataType:"json",beforeSend:function(){thisObj.lock(thisObj);},success:function(data){$('#div_traderScrap .item').each(function(){var techId=$(this).attr('id').substr(6,3);if(typeof data[techId]!='undefined'){// Sometimes, somehow we get null in the arrays. Workaround: shipcount shall be 0
var shipCount=0;if(data[techId]!=null){shipCount=getValue(data[techId]);}thisObj.ships[techId]=shipCount;var $level=$(this).find('.level');$level.contents().filter(function(){return this.nodeType==3;}).remove();$level.append(tsdpkt(shipCount));// if we've got that magical null, we don't want to touch the button colors
// because we don't want to grey out any buttons that possibly were colored before
if(data[techId]!=null){var $button=$("#button"+techId);$button.removeClass('on').removeClass('off');if(shipCount>0){$button.addClass('on');}else{$button.addClass('off');}}}});thisObj.unlock(thisObj);},error:function(){thisObj.unlock(thisObj);}});},getTradeArray:function(){var tradeArray={};$('input.ship_amount').each(function(){var techId=$(this).attr('name').substr(2,3);if(getValue($(this).val())!=0){tradeArray[techId]=getValue($(this).val());}});return tradeArray;},resetForm:function(){$('input.ship_amount').each(function(){$(this).val('0');});removeTooltip($('#js_scrapBargain'));$('#js_scrapBargain').removeClass('tooltip').removeAttr('title');},checkMoney:function(thisObj){if(darkMatter<thisObj.costs){$('#js_scrapBargain').addClass('disabled');}else if(breakerMaximumPercent<=thisObj.offer){$('#js_scrapBargain').addClass('disabled').addClass('tooltip').attr('title',loca.infoMaxBargain);initTooltips($('#js_scrapBargain'));}else{$('#js_scrapBargain').removeClass('disabled');}},checkShips:function(thisObj){var hasValue=false;$('input.ship_amount').each(function(){if($(this).val().length>0&&getValue($(this).val())>0){hasValue=true;}});if(!hasValue){$('#js_scrapScrapIT').addClass('disabled');}else{$('#js_scrapScrapIT').removeClass('disabled');}},updateBargain:function(thisObj){$('.scrap_offer_amount').css('height',thisObj.offer/100*$('.scrap_offer_amount').parent().css('height').replace('px',''));$('.scrap_offer_amount').html(thisObj.offer+"%");$('.js_bargainCost').text(tsdpkt(thisObj.costs));},lock:function(thisObj){$('#js_scrapBargain').addClass('disabled');$('#js_scrapScrapIT').addClass('disabled');thisObj.locked=true;},unlock:function(thisObj){thisObj.locked=false;thisObj.checkShips(thisObj);thisObj.checkMoney(thisObj);}};/*
         * Auctioneer socket functions
         */auctioneer={socket:null,connected:false,timeout:null,retryInterval:5000,historyShown:false,initConnection:function(){try{var thisObj=auctioneer;this.socket=new io.connect("/auctioneer",nodeParams);this.socket.on('connect',function(){thisObj.connected=true;clearTimeout(this.timeout);});this.socket.on('disconnect',function(){thisObj.connected=false;thisObj.retryConnection();});this.socket.on("new auction",function(data){auctionId=data.auctionId;// put last auction into history
var playerName=$('#div_traderAuctioneer .detail_value.currentPlayer').html();if(data.oldAuction.player==null){playerName=loca['auctionNotSold'];}else{playerName="<a href=\""+data.oldAuction.player.link+"\">"+data.oldAuction.player.name+"</a>";}removeTooltip($('#div_traderAuctioneer .image_140px .detail_button'));var title=$('#div_traderAuctioneer .image_140px .detail_button').attr('title');var className=$('.auction_history li:first').hasClass('even')?'odd':'even';var newAuctionElement="\
                        <li class=\""+className+"\" style=\"display: none\">\
                            <a href=\"javascript:void(0);\"\
                               class=\"slideIn\"\
                               ref=\""+data.oldAuction.item.uuid+"\">\
                                <img height=\"30\" width=\"30\"\
                                     src=\"/cdn/img/item-images/"+data.oldAuction.item.imageSmall+"-small.png\"\
                                     alt=\"\" title=\""+title+"\"\
                                     class=\"item_img tooltipHTML tooltipLeft r_"+data.oldAuction.item.rarity+"\"/>\
                            </a>\
                            <span class=\"detail sum\">"+number_format(data.oldAuction.sum,0)+"</span>\
                            <span class=\"detail player\">"+playerName+"</span>\
                            <span class=\"detail date_time\">"+data.oldAuction.time+"</span>\
                        </li>";$('.auction_history .history_content ul').prepend(newAuctionElement);$('.auction_history .history_content li:first').slideDown("slow");// remove tha last history entry
var historyLength=$('#div_traderAuctioneer .auction_history li').length;if(historyLength>3){$('.auction_history .history_content li:last').slideUp("slow",function(){$('.auction_history .history_content li:eq(21)').remove();var $thirdAuction=$('.auction_history .history_content li:eq(3)');$thirdAuction.addClass('more_auctions_li');if(auctioneer.historyShown){$thirdAuction.show();}});$('#div_traderAuctioneer .auction_history .more').show();}// set new auction
$('#div_traderAuctioneer .image_140px .detail_button').attr('ref',data.item.uuid).attr('title','').removeClass('r_common_140px').removeClass('r_uncommon_140px').removeClass('r_rare_140px').removeClass('r_epic_140px').addClass('r_'+data.item.rarity+'_140px');$('#div_traderAuctioneer .image_140px img').attr('src',"/cdn/img/item-images/"+data.item.image+"-140x.png");$('#div_traderAuctioneer .left_header h2').html(loca.auctionRunning);thisObj.setItemTooltip($('#div_traderAuctioneer .image_140px .detail_button'));thisObj.setData({price:1000,sum:0,player:null,bids:0,info:data.info});$('#div_traderAuctioneer .js_alreadyBidden').html(number_format(0,0));$('.noAuctionOverlay').hide();traderObj.resetValues('#div_traderAuctioneer',false);traderObj.checkOverbidden();});this.socket.on("new bid",function(data){if(data.player.id==playerId){playerBid=data.sum;// set auctionid for function "calculateDeficit", otherwise the actual minimum bid is shown
AuctionIdOflastPlayerBid=data.auctionId;$('#div_traderAuctioneer .js_alreadyBidden').html(number_format(Math.floor(playerBid),0));}thisObj.setData({price:data.price,sum:data.sum,player:data.player,bids:data.bids});traderObj.checkOverbidden();});this.socket.on("auction finished",function(data){thisObj.setData({price:0,player:data.player,bids:data.bids,info:data.info});traderObj.resetValues('#div_traderAuctioneer',false);$('#div_traderAuctioneer .js_alreadyBidden').html(number_format(0,0));$('#div_traderAuctioneer .js_auctioneerSum').html('');$('#div_traderAuctioneer .left_header h2').html(loca.auctionFinished);if(data.player!=null){if(data.player.id==playerId){thisObj.setItemTooltip($('#div_traderAuctioneer .image_140px .detail_button'));}}$('.noAuctionOverlay').show();traderObj.checkOverbidden();});this.socket.on("timeLeft",function(data){thisObj.setData({info:data});});}catch(e){}},setItemTooltip:function(object){$.ajax({url:detailUrl,data:{getDetails:1,type:$(object).attr('ref'),ajax:1},dataType:"json",success:function(data){changeTooltip(object,data.title);$("#itemDetails[data-uuid='"+$(object).attr('ref')+"'] .amount,"+"a.detail_button[ref='"+$(object).attr('ref')+"'] .amount").html(tsdpkt(data.amount));},error:function(){fadeBox(loca['error'],true);}});},initialize:function(){traderObj.initSliderTrader('#div_traderAuctioneer');traderObj.planets=planetResources;traderObj.price=getValue($('.js_price').html());$('#div_traderAuctioneer .right_box .pay').bind('click',function(){traderObj.submitAuction();});$('#div_traderAuctioneer .auction_history .more').bind('click',function(){if(auctioneer.historyShown){$(this).text("["+loca['auctionShowMore']+"]");}else{$(this).text("["+loca['auctionShowLess']+"]");}auctioneer.historyShown=!auctioneer.historyShown;$('#div_traderAuctioneer .auction_history .more_auctions_li').slideToggle('slow');});traderObj.sumAuctioneer();traderObj.checkOverbidden();this.initCountdown();loadScript(nodeUrl,this.initConnection);},retryConnection:function(){var thisObj=this;setTimeout(function(){thisObj.initConnection();},5000);},setData:function(data){var somethingChanged=false;if(typeof data.player!='undefined'){if(data.player==null){$('#div_traderAuctioneer .detail_value.currentPlayer').text("");$('#div_traderAuctioneer .detail_value.currentPlayer').attr("href","");}else{$('#div_traderAuctioneer .detail_value.currentPlayer').text(data.player.name);$('#div_traderAuctioneer .detail_value.currentPlayer').attr("href",data.player.link);$('#div_traderAuctioneer .detail_value.currentPlayer').attr("data-player-id",data.player.id);$('#div_traderAuctioneer .detail_value.currentPlayer').data("playerId",data.player.id);}somethingChanged=true;}if(typeof data.price!=='undefined'){traderObj.price=data.price;$('#div_traderAuctioneer .js_price').html(number_format(Math.floor(data.price),0));somethingChanged=true;}if(typeof data.sum!=='undefined'){$('#div_traderAuctioneer .detail_value.currentSum').html(number_format(Math.floor(data.sum),0));somethingChanged=true;}if(typeof data.bids!=='undefined'){$('#div_traderAuctioneer .detail_value.numberOfBids').html(number_format(data.bids,0));somethingChanged=true;}if(typeof data.info!=='undefined'&&$.trim($('#div_traderAuctioneer .auction_info').html())!=data.info){$('#div_traderAuctioneer .auction_info').html(data.info);this.initCountdown();somethingChanged=true;}if(somethingChanged){this.flash();traderObj.sumAuctioneer();}},initCountdown:function(){if(typeof this.nextAuctionTimer=='object'){timerHandler.removeCallback(this.nextAuctionTimer.timer);}if($('.nextAuction').length>0){this.nextAuctionTimer=new simpleCountdown($('.nextAuction').get(0),$('.nextAuction').text());}},flash:function(){if(traderObj.traderId=='#div_traderAuctioneer'){$('#div_traderAuctioneer .overlay').fadeIn('normal',function(){$(this).fadeOut('normal');});}},calculateDeficit:function(){var deficit=0;if(Math.floor(traderObj.price)==0){deficit=0;}else if(auctionId!=AuctionIdOflastPlayerBid){deficit=Math.floor(traderObj.price);}else{deficit=Math.floor(traderObj.price)-Math.floor(playerBid);}return Math.floor(deficit);}};/* TraderOverview Image Hover Styles */$('.js_trader').hover(function(){var clickedTrader=$(this).attr('id').replace('js_trader','').toLowerCase();$(this).addClass(clickedTrader+'_link_hover');},function(){var clickedTrader=$(this).attr('id').replace('js_trader','').toLowerCase();$('.trader_link').each(function(index,element){$(this).removeClass(clickedTrader+'_link_hover');});});/* **** Hover Stile ******* */$('.right_box .pay, .value-control, .ui-slider-handle, .bargain, .scrap_it, .source').hover(function(){$(this).addClass("hover");},function(){$(this).removeClass("hover");});traderObj.init();/*
     * Click event: back to trader overview:
     */$(document).undelegate('.js_trader','click').delegate('.js_trader','click',function(){var id=$(this).attr('id').replace('js_','');traderObj.switchTrader(id);}).undelegate('#planet .js_backToOverview','click').delegate('#planet .js_backToOverview','click',function(){$.bbq.pushState({'page':'','animation':''});$(".planetlink, .moonlink").fragment({'page':'','animation':''});});var url=$.deparam.fragment();if(typeof url["page"]!='undefined'&&url["page"]!=''){traderObj.selectTrader(url["page"],undefined,url["tab"]);}}function CharacterClassBoxes(params){this.loca=params.loca;this.init();}CharacterClassBoxes.prototype.init=function(){$(document).on('click','.characterclass.boxes .buttons .freeselect',this.onClickFreeSelect.bind(this));$(document).on('click','.characterclass.boxes .buttons .darkmatter',this.onClickDarkMatter.bind(this));$(document).on('click','.characterclass.boxes .buttons .deactivate',this.onClickDeactivate.bind(this));$(document).on('click','.characterclass.boxes .buttons .nodarkmatter',this.onClickNoDarkMatter.bind(this));$(document).on('click','.characterclass.boxes .buttons .classchangeitem',this.onClickClassChangeItem.bind(this));};CharacterClassBoxes.prototype.hasActiveSelection=function(){return $('.characterclass.box.selected').length>0;};CharacterClassBoxes.prototype.executeActionWithRedirect=function(url){let that=this;$.post(url).done(function(data){var json=$.parseJSON(data);if(json.status==='success'){fadeBox(json.message,false,function(){window.location.replace(json.redirectUrl);},2000);}else{that.displayErrors(json);}});};CharacterClassBoxes.prototype.onClickFreeSelect=function(e){let that=this;let url=$(e.currentTarget).attr('rel');$.post(url).done(function(data){var json=$.parseJSON(data);if(json.status==='success'){fadeBox(json.message,false,function(){window.location.replace(json.redirectUrl);},2000);}else{that.displayErrors(json);}});};CharacterClassBoxes.prototype.onClickDarkMatter=function(e){let that=this;let url=$(e.currentTarget).attr('rel');let characterClassBox=$(e.currentTarget).closest('.characterclass.box');let name=characterClassBox.data('characterClassName');let price=characterClassBox.data('characterClassPrice');let label=this.loca.LOCA_CHARACTER_CLASS_NOTE_ACTIVATE_WITH_DM.replace('#characterClassName#',name).replace('#darkmatter#',tsdpkt(price));errorBoxDecision(this.loca.LOCA_ALL_NOTICE,label,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){that.executeActionWithRedirect(url);});};CharacterClassBoxes.prototype.onClickNoDarkMatter=function(e){let that=this;let urlDarkMatter=$(e.currentTarget).attr('rel');errorBoxDecision(this.loca.LOCA_ALL_NOTICE,this.loca.LOCA_ALL_ERROR_LACKING_DM,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,redirectPremium);};CharacterClassBoxes.prototype.onClickDeactivate=function(e){let that=this;let url=$(e.currentTarget).attr('rel');let characterClassBox=$(e.currentTarget).closest('.characterclass.box');let name=characterClassBox.data('characterClassName');let label=this.loca.LOCA_CHARACTER_CLASS_NOTE_DEACTIVATE.replace('#characterClassName#',name);errorBoxDecision(this.loca.LOCA_ALL_NOTICE,label,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){that.executeActionWithRedirect(url);});};CharacterClassBoxes.prototype.onClickClassChangeItem=function(e){let that=this;let url=$(e.currentTarget).attr('rel');let characterClassBox=$(e.currentTarget).closest('.characterclass.box');let name=characterClassBox.data('characterClassName');let label=this.loca.LOCA_CHARACTER_CLASS_NOTE_ACTIVATE_WITH_ITEM.replace('#characterClassName#',name);errorBoxDecision(this.loca.LOCA_ALL_NOTICE,label,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){let token=activateToken;let params={token:token};$.post(url,params).done(function(data){var json=$.parseJSON(data);activateToken=json.newToken;if(json.error===false){window.location.reload();}else{that.displayErrors(json);}});});};CharacterClassBoxes.prototype.displayErrors=function(data){let errorCode=data.errorCode||0;let errorMessage=data.errorMessage||'';fadeBox(errorMessage,true);};const FLEET_DISPATCH_PAGE1='fleet1';const FLEET_DISPATCH_PAGE2='fleet2';const FLEET_DISPATCH_PAGE3='fleet3';function getResourcesFromHeader(resourceId){let value=$('#resources_'+resourceId).data('raw');return parseInt(value);}function getKeyCode(e){if(window.event){return window.event.keyCode;}else if(e){return e.which;}return null;}function FleetDispatcher(cfg){this.fleetHelper=new FleetHelper(cfg);this.checkTargetUrl=cfg.checkTargetUrl;this.sendFleetUrl=cfg.sendFleetUrl;this.fleetSendingToken=cfg.fleetSendingToken||null;this.currentPlanet=cfg.currentPlanet;this.targetPlanet=cfg.targetPlanet||null;this.targetInhabited=cfg.targetInhabited||false;this.targetPlayerId=cfg.targetPlayerId||this.fleetHelper.PLAYER_ID_SPACE;this.targetPlayerName=cfg.targetPlayerName||'';this.targetPlayerColorClass=cfg.targetPlayerColorClass||'';this.targetPlayerRankIcon=cfg.targetPlayerRankIcon||'';this.cargoCapacity=cfg.cargoCapacity;this.fuelCapacity=cfg.fuelCapacity;this.currentPage=FLEET_DISPATCH_PAGE1;this.shipsOnPlanet=cfg.shipsOnPlanet||[];this.shipsToSend=cfg.shipsToSend||[];this.planets=cfg.planets||[];this.standardFleets=cfg.standardFleets||[];this.unions=cfg.unions||[];this.orders=[];this.orderNames=cfg.orderNames||[];this.orderDescriptions=cfg.orderDescriptions||[];this.mission=cfg.mission||this.fleetHelper.MISSION_NONE;this.union=0;this.targetIsStrong=false;this.targetIsOutlaw=false;this.targetIsBuddyOrAllyMember=false;this.playerIsOutlaw=false;this.retreatAfterDefenderRetreat=false;this.holdingTime=cfg.holdingTime;this.expeditionTime=cfg.expeditionTime;this.speedPercent=10;this.cargoMetal=0;this.cargoCrystal=0;this.cargoDeuterium=0;this.prioMetal=1;this.prioCrystal=2;this.prioDeuterium=3;this.metalOnPlanet=cfg.metalOnPlanet;this.crystalOnPlanet=cfg.crystalOnPlanet;this.deuteriumOnPlanet=cfg.deuteriumOnPlanet;this.fleetCount=cfg.fleetCount;this.maxFleetCount=cfg.maxFleetCount;this.expeditionCount=cfg.expeditionCount;this.maxExpeditionCount=cfg.maxExpeditionCount;this.warningsEnabled=cfg.warningsEnabled;this.playerId=cfg.playerId;this.hasAdmiral=cfg.hasAdmiral;this.hasCommander=cfg.hasCommander;this.isOnVacation=cfg.isOnVacation;this.moveInProgress=cfg.moveInProgress;this.planetCount=cfg.planetCount;this.explorationCount=cfg.explorationCount;this.apiCommonData=cfg.apiCommonData;this.apiTechData=cfg.apiTechData;this.apiDefenseData=cfg.apiDefenseData;this.loca=cfg.loca;this.locadyn=cfg.locadyn;this.errorCodeMap=cfg.errorCodeMap;this.urlFleetCheck=cfg.urlFleetCheck;this.timerTimes=null;}FleetDispatcher.prototype.init=function(){this.initFleet1();this.initFleet2();this.initFleet3();let that=this;$('#fleetdispatchcomponent').on('keypress',function(e){if(getKeyCode(e)===13){e.preventDefault();e.stopPropagation();if($('#fleet1').is(':visible')){that.trySubmitFleet1();}else if($('#fleet2').is(':visible')){that.trySubmitFleet2();}else{that.updateCargo();that.refreshCargo();that.trySubmitFleet3();}return false;}});};FleetDispatcher.prototype.displayErrors=function(errors){// only display the first error
let error=errors[0]||undefined;if(error){fadeBox(error.message,true);}};FleetDispatcher.prototype.refresh=function(){switch(this.currentPage){case FLEET_DISPATCH_PAGE1:this.refreshFleet1();break;case FLEET_DISPATCH_PAGE2:this.refreshFleet2();break;case FLEET_DISPATCH_PAGE3:this.refreshFleet3();break;}};FleetDispatcher.prototype.switchToPage=function(page){let that=this;if(page===this.currentPage){return;}if(page===FLEET_DISPATCH_PAGE1){this.currentPage=page;$('#'+FLEET_DISPATCH_PAGE1).show();$('#'+FLEET_DISPATCH_PAGE2).hide();$('#'+FLEET_DISPATCH_PAGE3).hide();that.focusSubmitFleet1();}if(page===FLEET_DISPATCH_PAGE2){this.currentPage=page;$('#'+FLEET_DISPATCH_PAGE1).hide();$('#'+FLEET_DISPATCH_PAGE2).show();$('#'+FLEET_DISPATCH_PAGE3).hide();that.focusSubmitFleet2();}if(page===FLEET_DISPATCH_PAGE3){this.currentPage=page;$('#'+FLEET_DISPATCH_PAGE1).hide();$('#'+FLEET_DISPATCH_PAGE2).hide();$('#'+FLEET_DISPATCH_PAGE3).show();that.focusSubmitFleet3();}if(this.currentPage===FLEET_DISPATCH_PAGE1&&this.timerTimes!==null){clearInterval(this.timerTimes);this.timerTimes=null;}// create timer to refresh fleet arrival and return times
if(this.currentPage===FLEET_DISPATCH_PAGE2||this.currentPage===FLEET_DISPATCH_PAGE3){if(this.timerTimes===null){this.timerTimes=setInterval(function(){that.refreshFleetTimes();},1000);}}this.refresh();};FleetDispatcher.prototype.startLoading=function(){$('#fleetdispatchcomponent .ajax_loading').show();};FleetDispatcher.prototype.stopLoading=function(){$('#fleetdispatchcomponent .ajax_loading').hide();};FleetDispatcher.prototype.updateToken=function(tokenNew){this.fleetSendingToken=tokenNew;};FleetDispatcher.prototype.appendTokenParams=function(params){params.token=this.fleetSendingToken;};FleetDispatcher.prototype.appendShipParams=function(params){this.shipsToSend.forEach(function(ship){params['am'+ship.id]=ship.number;});};FleetDispatcher.prototype.appendTargetParams=function(params){params.galaxy=this.targetPlanet.galaxy;params.system=this.targetPlanet.system;params.position=this.targetPlanet.position;params.type=this.targetPlanet.type;};FleetDispatcher.prototype.appendCargoParams=function(params){params.metal=this.cargoMetal;params.crystal=this.cargoCrystal;params.deuterium=this.cargoDeuterium;};FleetDispatcher.prototype.appendPrioParams=function(params){params.prioMetal=this.prioMetal;params.prioCrystal=this.prioCrystal;params.prioDeuterium=this.prioDeuterium;};/**
 * FLEET 1
 */FleetDispatcher.prototype.initFleet1=function(){initToggleHeader('fleet1');let that=this;let elem=$('#fleet1');elem.find('select.combatunits').ogameDropDown();that.refresh();elem.on('click','#continueToFleet2',function(e){e.preventDefault();that.trySubmitFleet1();});elem.on('keyup','#technologies li input',function(e){e.preventDefault();let shipId=parseInt($(e.currentTarget).closest('li').data('technology'));let number=getValue($(e.currentTarget).val());that.selectShip(shipId,number);that.refresh();});elem.on('click','#technologies li .icon',function(e){e.preventDefault();let shipId=parseInt($(e.currentTarget).closest('li').data('technology'));if(that.getNumberOfShipsSelected(shipId)<that.getNumberOfShipsOnPlanet(shipId)){that.selectMaxShips(shipId);}else{that.selectShip(shipId,0);}that.refresh();that.focusSubmitFleet1();});elem.on('click','#sendall',function(e){e.preventDefault();that.selectAllShips();that.refresh();that.focusSubmitFleet1();});elem.on('click','#resetall',function(e){e.preventDefault();that.resetShips();that.refresh();that.focusSubmitFleet1();});elem.on('change','#standardfleet',function(e){let standardFleetId=getValue($('select.combatunits').val());that.selectStandardFleet(standardFleetId);that.refresh();});};FleetDispatcher.prototype.focusSubmitFleet1=function(){$('#continueToFleet2').focus();};FleetDispatcher.prototype.hasShipsSelected=function(){return this.getTotalNumberOfShipsSelected()>0;};FleetDispatcher.prototype.hasFreeSlots=function(){return this.maxFleetCount-this.fleetCount>0;};FleetDispatcher.prototype.hasEnoughFuel=function(){return this.deuteriumOnPlanet>=this.getConsumption();};FleetDispatcher.prototype.validateFleet1=function(onError,onSuccess){if(!this.hasShipsSelected()){this.displayErrors([{message:this.loca.LOCA_FLEET_NO_SELECTION}]);return false;}if(!this.hasFreeSlots()){this.displayErrors([{message:this.loca.LOCA_FLEET_NO_FREE_SLOTS}]);return false;}return true;};FleetDispatcher.prototype.trySubmitFleet1=function(){if(this.validateFleet1()===false){return;}this.switchToPage(FLEET_DISPATCH_PAGE2);};FleetDispatcher.prototype.refreshFleet1=function(){this.refreshNavigationFleet1();this.refreshShips();this.refreshAPIData();this.refreshStatusBarFleet();};FleetDispatcher.prototype.refreshNavigationFleet1=function(){let invalidInfo='';if(!this.hasShipsSelected()){$('#continueToFleet2').attr('class','continue off');invalidInfo=this.loca.LOCA_FLEET_NO_SELECTION;}else if(!this.hasFreeSlots()){$('#continueToFleet2').attr('class','continue off');invalidInfo=this.loca.LOCA_FLEET_NO_FREE_SLOTS;}else{$('#continueToFleet2').attr('class','continue on');}$('#allornone .info').html(invalidInfo);};FleetDispatcher.prototype.refreshShips=function(){let that=this;$('#fleet1 #technologies li').each(function(i,elem){let shipId=$(elem).data('technology');let ship=that.findShip(shipId);if(ship){let number=ship.number||0;$(elem).find('input').val(number);}else{$(elem).find('input').val('');}});};FleetDispatcher.prototype.refreshAPIData=function(){let apiShipData=this.shipsToSend.map(function(ship){return[ship.id,ship.number];});let apiData=[].concat(this.apiCommonData).concat(this.apiTechData).concat(apiShipData).concat(this.apiDefenseData).map(function(item){return item.join(';');}).join('|');let title=this.loca.LOCA_API_FLEET_DATA+'<br/><input id="FLEETAPI" value="'+apiData+'" readonly onclick="select()" style="width: 360px;"></input>';changeTooltip($(".show_fleet_apikey"),title);};/**
 * SHIP LOGIC
 */FleetDispatcher.prototype.selectShip=function(shipId,number){let shipsAvailable=this.getNumberOfShipsOnPlanet(shipId);number=Math.min(shipsAvailable,number);if(number<=0){this.removeShip(shipId);}else if(this.hasShip(shipId)){this.updateShip(shipId,number);}else{this.addShip(shipId,number);}this.resetCargo();};FleetDispatcher.prototype.addShip=function(shipId,number){this.shipsToSend.push({id:shipId,number:number});};FleetDispatcher.prototype.findShip=function(shipId){return this.shipsToSend.find(function(ship){return ship.id===shipId;});};FleetDispatcher.prototype.getNumberOfShipsSelected=function(shipId){let ship=this.findShip(shipId);if(ship!==undefined){return ship.number;}return 0;};FleetDispatcher.prototype.hasShip=function(shipId){return this.findShip(shipId)!==undefined;};FleetDispatcher.prototype.hasColonizationShip=function(){return this.hasShip(this.SHIP_ID_COLONIZATION);};FleetDispatcher.prototype.hasRecycler=function(){return this.hasShip(this.SHIP_ID_RECYCLER);};FleetDispatcher.prototype.hasValidTarget=function(){return(this.targetPlanet.galaxy!==this.currentPlanet.galaxy||this.targetPlanet.system!==this.currentPlanet.system||this.targetPlanet.position!==this.currentPlanet.position||this.targetPlanet.type!==this.currentPlanet.type)&&this.targetPlanet.galaxy>0&&this.targetPlanet.system>0&&this.targetPlanet.position>0;};FleetDispatcher.prototype.removeShip=function(shipId){let shipIndex=this.shipsToSend.findIndex(function(ship){return ship.id===shipId;});if(shipIndex!=-1){this.shipsToSend.splice(shipIndex,1);}};FleetDispatcher.prototype.updateShip=function(shipId,number){let ship=this.findShip(shipId);if(ship){ship.number=number;}};FleetDispatcher.prototype.getNumberOfShipsOnPlanet=function(shipId){let ship=this.shipsOnPlanet.find(function(ship){return ship.id===shipId;});if(ship){return ship.number;}return 0;};FleetDispatcher.prototype.getTotalNumberOfShipsSelected=function(){let numberOfShipsSelected=0;this.shipsToSend.forEach(function(ship){numberOfShipsSelected+=ship.number;});return numberOfShipsSelected;};FleetDispatcher.prototype.getShipIds=function(){return this.shipsToSend.map(function(ship){return ship.id;});};FleetDispatcher.prototype.resetShips=function(){this.shipsToSend=[];};FleetDispatcher.prototype.selectAllShips=function(){let that=this;this.shipsOnPlanet.forEach(function(ship){that.selectShip(ship.id,ship.number);});};FleetDispatcher.prototype.selectMaxShips=function(shipId){let number=this.getNumberOfShipsOnPlanet(shipId);this.selectShip(shipId,number);};FleetDispatcher.prototype.selectShips=function(ships){for(let shipId in ships){let number=ships[shipId];this.selectShip(parseInt(shipId),number);}};FleetDispatcher.prototype.selectStandardFleet=function(standardFleetId){let standardFleet=this.standardFleets.find(function(item){return item.id===standardFleetId;});if(standardFleet===undefined||standardFleet.ships===undefined){return;}this.selectShips(standardFleet.ships);};/**
 * FLEET 2
 */FleetDispatcher.prototype.initFleet2=function(){// @todo jquery is loaded twice
addPercentageBarPlugin();initToggleHeader('fleet2');let that=this;let elem=$('#fleet2').off();$('#speedPercentage').percentageBar().on('change',function(e){that.setFleetPercent(e.value);that.refresh();that.focusSubmitFleet2();});elem.find('#slbox').ogameDropDown();elem.find('#aksbox').ogameDropDown();elem.on('keypress',function(e){if(getKeyCode(e)===13){e.preventDefault();e.stopPropagation();that.trySubmitFleet2();return false;}});// back and forth navigation
elem.on('click','#continueToFleet3',function(e){e.preventDefault();that.trySubmitFleet2();});elem.on('click','#backToFleet1',function(e){e.preventDefault();that.switchToPage(FLEET_DISPATCH_PAGE1);});// clear inputs on focus
elem.on('focus','#galaxy',function(){clearInput('#galaxy');that.targetPlanet.galaxy='';that.refreshFleet2();});elem.on('focus','#system',function(){clearInput('#system');that.targetPlanet.system='';that.refreshFleet2();});elem.on('focus','#position',function(){clearInput('#position');that.targetPlanet.position='';that.refreshFleet2();});elem.on('keyup','#galaxy, #system, #position',function(e){that.updateTarget();that.updateTargetDropDowns();that.refresh();});elem.on('click','#pbutton',function(e){e.preventDefault();that.setTargetType(that.fleetHelper.PLANETTYPE_PLANET);that.updateTargetDropDowns();that.refresh();that.focusSubmitFleet2();});elem.on('click','#mbutton',function(e){e.preventDefault();that.setTargetType(that.fleetHelper.PLANETTYPE_MOON);that.updateTargetDropDowns();that.refresh();that.focusSubmitFleet2();});elem.on('click','#dbutton',function(e){e.preventDefault();that.setTargetType(that.fleetHelper.PLANETTYPE_DEBRIS);that.updateTargetDropDowns();that.refresh();that.focusSubmitFleet2();});elem.on('change','#slbox',function(e){e.preventDefault();that.selectShortLink($(e.currentTarget));that.updateTarget();that.refresh();that.focusSubmitFleet2();});elem.on('change','#aksbox',function(e){e.preventDefault();that.selectCombatUnion($(e.currentTarget));that.updateTarget();that.refresh();that.focusSubmitFleet2();});};FleetDispatcher.prototype.focusSubmitFleet2=function(){$('#continueToFleet3').focus();};FleetDispatcher.prototype.validateFleet2=function(){if(!this.hasValidTarget()){return false;}return true;};
FleetDispatcher.prototype.trySubmitFleet2=function() {
    let that = this;
    if (this.validateFleet2() === false) {
        return;
    }
    let params = {};
    this.appendShipParams(params);
    this.appendTargetParams(params);
    params.union = this.union;
    if (this.hasColonizationShip()) {
        params.cs = 1;
    }
    if (this.hasRecycler()) {
        params.recycler = 1;
    }
    that.switchToPage(FLEET_DISPATCH_PAGE3);
};
FleetDispatcher.prototype.refreshFleet2=function(){this.refreshNavigationFleet2();this.refreshTarget();this.refreshBriefing();this.refreshStatusBarFleet();};FleetDispatcher.prototype.refreshNavigationFleet2=function(){let invalidInfo='';if(!this.hasShipsSelected()){$('#continueToFleet3').attr('class','continue off');invalidInfo=this.loca.LOCA_FLEET_NO_SELECTION;}else if(!this.hasEnoughFuel()){$('#continueToFleet3').attr('class','continue off');invalidInfo=this.loca.LOCA_FLEETSENDING_NOT_ENOUGH_FOIL;}else if(!this.hasFreeSlots()){$('#continueToFleet3').attr('class','continue off');invalidInfo=this.loca.LOCA_FLEET_NO_FREE_SLOTS;}else if(!this.hasValidTarget()){invalidInfo=this.loca.LOCA_FLEETSENDING_NO_TARGET;$('#continueToFleet3').attr('class','continue off');}else{$('#continueToFleet3').attr('class','continue on');}$('#allornone .info').html(invalidInfo);};FleetDispatcher.prototype.refreshTarget=function(){if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_PLANET){$('#pbutton').attr('class','planet_selected');}else{$('#pbutton').attr('class','planet');}if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_DEBRIS){$('#dbutton').attr('class','debris_selected');}else{$('#dbutton').attr('class','debris');}if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_MOON){$('#mbutton').attr('class','moon_selected');}else{$('#mbutton').attr('class','moon');}$('#galaxy').val(this.targetPlanet.galaxy);$('#system').val(this.targetPlanet.system);$('#position').val(this.targetPlanet.position);$('#type').val(this.targetPlanet.type);$('#distanceValue').html(tsdpkt(this.getDistance()));let planetName=this.getOwnPlanetName(this.targetPlanet,this.targetPlanet.type);if(planetName!==undefined&&planetName!==''){$('#targetPlanetName').html(planetName);}else if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_PLANET){$('#targetPlanetName').html(this.loca.LOCA_ALL_PLANET);}else if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_DEBRIS){$('#targetPlanetName').html(this.loca.LOCA_FLEET_DEBRIS);}else if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_MOON){$('#targetPlanetName').html(this.loca.LOCA_ALL_MOON);}};FleetDispatcher.prototype.refreshBriefing=function(){this.refreshTargetPlanet();this.refreshDuration();this.refreshConsumption();this.refreshStorage();this.refreshFleetTimes();this.refreshMaxSpeed();};FleetDispatcher.prototype.refreshTargetPlanet=function(){let planetIcon=this.getPlanetIcon(this.targetPlanet.type,false);let label='['+this.targetPlanet.galaxy+':'+this.targetPlanet.system+':'+this.targetPlanet.position+'] '+planetIcon+this.targetPlanet.name;let elem=$('#fleet3 #targetPlanet');let tooltip=this.targetInhabited===true?this.loca.LOCA_ALL_PLAYER+': '+this.targetPlayerName:'';elem.toggleClass('tooltip',this.targetInhabited).toggleClass('active',this.targetInhabited).attr('title',tooltip).html(label);changeTooltip(elem);};FleetDispatcher.prototype.refreshDuration=function(){let duration=this.getDuration();$('#fleet2 #duration, #fleet3 #duration').html(formatTime(duration)+' h');};FleetDispatcher.prototype.refreshConsumption=function(){let fuelCapacity=this.getFuelCapacity();let deuterium=getResourcesFromHeader('deuterium');let consumption=this.getConsumption();let styleClass=consumption>fuelCapacity||consumption>deuterium?'overmark':'undermark';let fuelLevel=Math.ceil(100*consumption/fuelCapacity);let htmlConsumption='<span class="'+styleClass+'">'+tsdpkt(consumption)+' ('+fuelLevel+'%)</span>';$('#fleet2 #consumption, #fleet3 #consumption').html(htmlConsumption);};FleetDispatcher.prototype.refreshStorage=function(){let cargoSpace=this.getFreeCargoSpace();let styleClass=cargoSpace<0?'overmark':'undermark';let htmlStorage='<span class="'+styleClass+'">'+tsdpkt(cargoSpace)+'</span>';$('#storage').html(htmlStorage);};FleetDispatcher.prototype.refreshFleetTimes=function(){let duration=this.getDuration();let holdingTime=0;if(this.mission===this.fleetHelper.MISSION_EXPEDITION){holdingTime=this.expeditionTime*3600;}if(this.mission===this.fleetHelper.MISSION_HOLD){holdingTime=this.holdingTime*3600;}let arrivalTime=getFormatedDate(serverTime.getTime()+duration*1000,'[d].[m].[y] [G]:[i]:[s]');let returnTime=getFormatedDate(serverTime.getTime()+(2*duration+holdingTime)*1000,'[d].[m].[y] [G]:[i]:[s]');$('#fleet2 #arrivalTime, #fleet3 #arrivalTime').html(arrivalTime);$('#fleet2 #returnTime, #fleet3 #returnTime').html(returnTime);if(this.mission===this.fleetHelper.MISSION_UNIONATTACK){let union=this.getUnionData(this.union);if(union!==null){let durationAKS=parseInt(union.time-serverTime.getTime()/1000);let unionArrivalTime=formatTime(durationAKS);$('#durationAKS').html(unionArrivalTime);}}};FleetDispatcher.prototype.refreshMaxSpeed=function(){let maxSpeed=this.getMaxSpeed();$('#maxspeed').html(tsdpkt(maxSpeed));};FleetDispatcher.prototype.getPlanetIcon=function(planetType,showTooltip){showTooltip=showTooltip||true;let className='';let name='';switch(planetType){case this.fleetHelper.PLANETTYPE_MOON:className="moon";name=this.loca.LOCA_ALL_MOON;break;case this.fleetHelper.PLANETTYPE_DEBRIS:className="tf";name=this.loca.LOCA_FLEET_DEBRIS;break;case this.fleetHelper.PLANETTYPE_PLANET:default:className="planet";name=this.loca.LOCA_ALL_PLANET;}let title='';if(showTooltip){className+=" tooltip js_hideTipOnMobile";title=' title="'+name+'"';}return'<figure class="planetIcon '+className+'"'+title+'></figure>';};FleetDispatcher.prototype.updateTarget=function(){let galaxy=clampInt(getValue($('#galaxy').val()),1,this.fleetHelper.MAX_GALAXY,true);let system=clampInt(getValue($('#system').val()),1,this.fleetHelper.MAX_SYSTEM,true);let position=clampInt(getValue($('#position').val()),1,this.fleetHelper.MAX_POSITION,true);this.targetPlanet.galaxy=galaxy;this.targetPlanet.system=system;this.targetPlanet.position=position;if(this.targetPlanet.position===this.fleetHelper.EXPEDITION_POSITION){this.targetPlanet.type=this.fleetHelper.PLANETTYPE_PLANET;}};FleetDispatcher.prototype.updateTargetDropDowns=function(){this.resetDropDown("#slbox");this.resetDropDown("#aksbox");};FleetDispatcher.prototype.resetDropDown=function(elementId){let coords=[this.targetPlanet.galaxy,this.targetPlanet.system,this.targetPlanet.position,this.targetPlanet.type].join('#');let selection=$(elementId).find("option[value^=\""+coords+"\"]");if(selection.length===0){$(elementId).ogameDropDown('select','-');}};FleetDispatcher.prototype.selectShortLink=function(elem){let value=elem.val();let parts=value.split('#');if(parts instanceof Array&&parts.length>=5){$('#galaxy').val(parts[0]);$('#system').val(parts[1]);$('#position').val(parts[2]);this.setTargetType(parseInt(parts[3]));}};FleetDispatcher.prototype.setTargetType=function(type){this.targetPlanet.type=type;};FleetDispatcher.prototype.selectCombatUnion=function(elem){let value=elem.val();let parts=value.split('#');if(parts instanceof Array&&parts.length>=5){$('#galaxy').val(parts[0]);$('#system').val(parts[1]);$('#position').val(parts[2]);this.setTargetType(parseInt(parts[3]));this.union=parseInt(parts[5]);}else{this.mission=this.fleetHelper.MISSION_NONE;this.union=0;}};FleetDispatcher.prototype.setFleetPercent=function(speedPercent){this.speedPercent=speedPercent;};FleetDispatcher.prototype.findOwnPlanet=function(coords,type){if(!coords)return undefined;if(!type)return undefined;let planet=this.planets.find(function(elem){if(elem.galaxy!=coords.galaxy)return false;if(elem.system!=coords.system)return false;if(elem.position!=coords.position)return false;if(elem.type!=type)return false;return true;});return planet;};FleetDispatcher.prototype.getOwnPlanetName=function(coords,type){if(!coords)return undefined;if(!type)return undefined;let planet=this.findOwnPlanet(coords,type);if(planet){return planet.name;}return undefined;};FleetDispatcher.prototype.getDistance=function(){return this.fleetHelper.calcDistance(this.currentPlanet,this.targetPlanet);};FleetDispatcher.prototype.getMaxSpeed=function(){let shipIds=this.getShipIds();return this.fleetHelper.getMaxSpeed(shipIds);};FleetDispatcher.prototype.getConsumption=function(){return this.fleetHelper.calcConsumption(this.shipsToSend,this.getDistance(),this.speedPercent,this.getHoldingTime());};FleetDispatcher.prototype.getDuration=function(){let distance=this.getDistance();let maxSpeed=this.getMaxSpeed();return this.fleetHelper.calcDuration(distance,maxSpeed,this.speedPercent);};FleetDispatcher.prototype.getHoldingTime=function(){switch(this.mission){case this.fleetHelper.MISSION_EXPEDITION:return this.expeditionTime;case this.fleetHelper.MISSION_HOLD:return this.holdingTime;default:return 0;}};FleetDispatcher.prototype.getMaxSpeed=function(){let shipIds=this.getShipIds();return this.fleetHelper.getMaxSpeed(shipIds);};FleetDispatcher.prototype.getCargoCapacity=function(){let that=this;let cargoCapacity=0;this.shipsToSend.forEach(function(ship){cargoCapacity+=that.fleetHelper.calcCargoCapacity(ship.id,ship.number);});return Math.floor(cargoCapacity);};FleetDispatcher.prototype.getFuelCapacity=function(){let that=this;let fuelCapacity=0;this.shipsToSend.forEach(function(ship){fuelCapacity+=that.fleetHelper.calcFuelCapacity(ship.id,ship.number);});return Math.floor(fuelCapacity);};FleetDispatcher.prototype.getFreeCargoSpace=function(){return this.getCargoCapacity()-this.cargoMetal-this.cargoCrystal-this.cargoDeuterium;};FleetDispatcher.prototype.getUsedCargoSpace=function(){return this.cargoMetal+this.cargoCrystal+this.cargoDeuterium;};FleetDispatcher.prototype.setOrders=function(ordersNew){this.orders=ordersNew;};FleetDispatcher.prototype.setTargetInhabited=function(inhabitedNew){this.targetInhabited=inhabitedNew;};FleetDispatcher.prototype.setTargetPlayerId=function(targetPlayerIdNew){this.targetPlayerId=targetPlayerIdNew;};FleetDispatcher.prototype.setTargetPlayerName=function(targetPlayerNameNew){this.targetPlayerName=targetPlayerNameNew;};FleetDispatcher.prototype.setTargetIsStrong=function(targetIsStrongNew){this.targetIsStrong=targetIsStrongNew;};FleetDispatcher.prototype.setTargetIsOutlaw=function(targetIsOutlawNew){this.targetIsOutlaw=targetIsOutlawNew;};FleetDispatcher.prototype.setTargetIsBuddyOrAllyMember=function(targetIsBuddyOrAllyMemberNew){this.targetIsBuddyOrAllyMember=targetIsBuddyOrAllyMemberNew;};FleetDispatcher.prototype.setPlayerIsOutlaw=function(playerIsOutlawNew){this.playerIsOutlaw=playerIsOutlawNew;};FleetDispatcher.prototype.setTargetPlayerColorClass=function(targetPlayerColorClassNew){this.targetPlayerColorClass=targetPlayerColorClassNew;};FleetDispatcher.prototype.setTargetPlayerRankIcon=function(targetPlayerRankIconNew){this.targetPlayerRankIcon=targetPlayerRankIconNew;};FleetDispatcher.prototype.setTargetPlanet=function(targetPlanetNew){this.targetPlanet=targetPlanetNew;};/**
 * FLEET 3
 */FleetDispatcher.prototype.initFleet3=function() {
    initToggleHeader('fleet3');
    let that = this;
    let elem = $('#fleet3').off();
    elem.find('select[name=expeditiontime]').ogameDropDown();
    elem.find('select[name=holdingtime]').ogameDropDown();
    elem.on('click', '#sendFleet', function (e) {
        e.preventDefault();
        that.trySubmitFleet3();
    });
    elem.on('click', '#backToFleet2', function (e) {
        e.preventDefault();
        that.switchToPage(FLEET_DISPATCH_PAGE2);
    });
    elem.on('click', '#selectMaxMetal', function (e) {
        e.preventDefault();
        that.selectMaxMetal();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#selectMinMetal', function (e) {
        e.preventDefault();
        that.selectMinMetal();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#selectMaxCrystal', function (e) {
        e.preventDefault();
        that.selectMaxCrystal();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#selectMinCrystal', function (e) {
        e.preventDefault();
        that.selectMinCrystal();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#selectMaxDeuterium', function (e) {
        e.preventDefault();
        that.selectMaxDeuterium();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#selectMinDeuterium', function (e) {
        e.preventDefault();
        that.selectMinDeuterium();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '#allresources', function (e) {
        e.preventDefault();
        that.selectMaxAll();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('keyup', '#metal', function (e) {
        that.updateMetal();
        that.refresh();
    });
    elem.on('change', '#metal', function (e) {
        that.updateMetal();
        that.refresh();
    });
    elem.on('keyup', '#crystal', function (e) {
        that.updateCrystal();
        that.refresh();
    });
    elem.on('change', '#crystal', function (e) {
        that.updateCrystal();
        that.refresh();
    });
    elem.on('keyup', '#deuterium', function (e) {
        that.updateDeuterium();
        that.refresh();
    });
    elem.on('change', '#deuterium', function (e) {
        that.updateDeuterium();
        that.refresh();
    });
    elem.on('click', '#missions > li > a', function (e) {
        e.preventDefault();
        let mission = parseInt($(e.currentTarget).data('mission') || this.fleetHelper.MISSION_NONE);
        that.selectMission(mission);
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('change', 'input[name=retreatAfterDefenderRetreat]', function (e) {
        that.selectRetreatAfterDefenderRetreat($(e.currentTarget).is(':checked'));
    });
    elem.on('change keyup', '#holdingtime', function () {
        that.updateHoldingTime();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('change keyup', '#expeditiontime', function (e) {
        that.updateExpeditionTime();
        that.refresh();
        that.focusSubmitFleet3();
    });
    elem.on('click', '.prioButton', function (e) {
        e.preventDefault();
        let type = $(e.currentTarget).attr('data-resource-type');
        let priority = parseInt($(e.currentTarget).attr('data-resource-prio'));
        that.selectPriority(type, priority);
        that.refresh();
        that.focusSubmitFleet3();
    });
};
 FleetDispatcher.prototype.focusSubmitFleet3=function(){$('#sendFleet').focus();};
 FleetDispatcher.prototype.validateFleet3=function(){return true;};
FleetDispatcher.prototype.trySubmitFleet3 = function () {
    let that = this;
    if (this.validateFleet3() === false) {
        return;
    }
    if (this.moveInProgress) {
        errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION, this.loca.LOCA_PLANETMOVE_BREAKUP_WARNING, this.loca.LOCA_ALL_YES, this.loca.LOCA_ALL_NO, function () {
            that.submitFleet3();
        });
    } else if (this.warningsEnabled && this.targetIsStrong && !this.targetIsOutlaw && !this.targetIsBuddyOrAllyMember && !this.playerIsOutlaw && this.fleetHelper.isAggressiveMission(this.mission)) {
        errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION, this.locadyn.locaAllOutlawWarning, this.loca.LOCA_ALL_YES, this.loca.LOCA_ALL_NO, function () {
            that.submitFleet3();
        });
    } else if (this.mission === this.fleetHelper.MISSION_COLONIZE && this.fleetHelper.COLONIZATION_ENABLED === true && !this.hasFreePlanetSlots()) {
        errorBoxDecision(this.loca.LOCA_ALL_NOTICE, this.loca.LOCA_FLEETSENDING_MAX_PLANET_WARNING, this.loca.LOCA_ALL_YES, this.loca.LOCA_ALL_NO, function () {
            that.submitFleet3();
        });
    } else {
        this.submitFleet3();
    }
};
 FleetDispatcher.prototype.submitFleet3= function (force) {

     this.switchToPage(FLEET_DISPATCH_PAGE1);

 };FleetDispatcher.prototype.refreshFleet3=function(){this.refreshNavigationFleet3();this.refreshStatusBarFleet();this.refreshMissions();this.refreshCargo();this.refreshPriorities();this.refreshBriefing();this.updateHoldingTime();this.updateExpeditionTime();};
FleetDispatcher.prototype.refreshNavigationFleet3 = function () {
    let invalidInfo = '';
    if (!this.hasShipsSelected()) {
        invalidInfo = this.loca.LOCA_FLEET_NO_SELECTION;
    } else if (!this.hasFreeSlots()) {
        invalidInfo = this.loca.LOCA_FLEET_NO_FREE_SLOTS;
    } else if (!this.hasMission()) {
        invalidInfo = this.loca.fleetNoMission;
    }
    $('#sendFleet').attr('class', 'start on');
    $('#allornone .info').html(invalidInfo);
};
FleetDispatcher.prototype.refreshStatusBarFleet=function(){this.hasValidTarget();let missionData=this.getMissionData(this.mission);let missionName=missionData!==null?missionData.name:this.loca.LOCA_FLEET_NO_SELECTION;let planetIcon=this.getPlanetIcon(this.targetPlanet.type,false);let targetName='['+this.targetPlanet.galaxy+':'+this.targetPlanet.system+':'+this.targetPlanet.position+'] '+planetIcon+this.targetPlanet.name;$('#statusBarFleet .missionName').text(missionName);$('#statusBarFleet .targetName').html(targetName);let elemTargetPlayerName=$('#statusBarFleet .targetPlayerName');if(this.targetPlanet.type===this.fleetHelper.PLANETTYPE_DEBRIS){elemTargetPlayerName.closest('li').hide();elemTargetPlayerName.html('');}else{let targetPlayerName='';if(this.targetPlayerId===0||this.fleetHelper.isPlayerSpace(this.targetPlayerId)){targetPlayerName=this.loca.LOCA_EVENTH_ENEMY_INFINITELY_SPACE;}else if(this.targetPlayerId===this.playerId){targetPlayerName=this.targetPlayerName;}else{targetPlayerName=this.targetPlayerRankIcon+'<span class="status_abbr_{color}">{name}</span>';targetPlayerName=targetPlayerName.replace('{color}',this.targetPlayerColorClass);targetPlayerName=targetPlayerName.replace('{name}',this.targetPlayerName);}elemTargetPlayerName.closest('li').show();elemTargetPlayerName.html(targetPlayerName);}};FleetDispatcher.prototype.refreshMissions=function(){$('#missions>li>a.selected').removeClass('selected');// refresh mission buttons
for(let mission in this.orders){let missionData=this.getMissionData(mission);$('#missions>li#button'+mission).toggleClass('on',missionData.isAvailable===true).toggleClass('off',missionData.isAvailable===false);}// @TODO LOCA_FLEET_NO_SELECTION when no mission selected
// refresh mission
let missionData=this.getMissionData(this.mission);if(missionData!==null) {
        $('.missionName').text(missionData.name);
        $('.mission_description').text(missionData.description);
        $('#missions>li#button' + this.mission + '>a').toggleClass('selected', true);
        $('.briefing_overlay').hide();
        $('#missionNameWrapper').removeClass('off');
    }else{$('.missionName').text(this.loca.LOCA_FLEET_NO_SELECTION);}$('form input[name="mission"]').val(this.mission);$('#fightAfterRetreat,'+'#aks,'+'#holdtimeline,'+'#expeditiontimeline,'+'.prioButton').hide();if(this.mission===this.fleetHelper.MISSION_ATTACK){$('#fightAfterRetreat').show();$('.prioButton').show();}if(this.mission===this.fleetHelper.MISSION_UNIONATTACK){$('#aks').show();$('.prioButton').show();}if(this.mission===this.fleetHelper.MISSION_HOLD){$('#holdtimeline').show();}if(this.mission===this.fleetHelper.MISSION_EXPEDITION){$('#expeditiontimeline').show();}//@TODO hide holdingtime or expeditiontime when mission is not selected
};FleetDispatcher.prototype.refreshCargo=function(){formatNumber($('#metal'),this.cargoMetal);formatNumber($('#crystal'),this.cargoCrystal);formatNumber($('#deuterium'),this.cargoDeuterium);let cargoSpaceUsed=this.getUsedCargoSpace();let cargoSpaceFree=this.getFreeCargoSpace();let cargoCapacity=this.getCargoCapacity();let styleClass=cargoSpaceFree<0?'overmark':'undermark';$('#remainingresources').html('<span class="'+styleClass+'">'+tsdpkt(cargoSpaceFree)+'</style>');$('#maxresources').html(tsdpkt(cargoCapacity));$('#loadRoom .bar_container').data('currentAmount',cargoSpaceUsed).data('capacity',cargoCapacity);refreshBars('bar_container','filllevel_bar');};FleetDispatcher.prototype.refreshPriorities=function(){$('form input[name="prioMetal"]').val(this.prioMetal);$('form input[name="prioCrystal"]').val(this.prioCrystal);$('form input[name="prioDeuterium"]').val(this.prioDeuterium);$('#prioM1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioM2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioM3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(this.prioMetal){case 1:$('#prioM1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioM2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioM3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}$('#prioC1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioC2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioC3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(this.prioCrystal){case 1:$('#prioC1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioC2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioC3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}$('#prioD1').attr('src','//gf1.geo.gfsrv.net/cdn91/4b53e83f8b8583ea279fd26f3a55a5.gif');$('#prioD2').attr('src','//gf3.geo.gfsrv.net/cdn26/8afbd59ffe091239a7c6f1e961b267.gif');$('#prioD3').attr('src','//gf1.geo.gfsrv.net/cdn0a/4acc67e1ca4d8debb1b114abcb7c1e.gif');switch(this.prioDeuterium){case 1:$('#prioD1').attr('src','//gf1.geo.gfsrv.net/cdn9c/b357323b99e20a46fc0b2495728351.gif');break;case 2:$('#prioD2').attr('src','//gf3.geo.gfsrv.net/cdnb1/f8959fe540cd329f3a764ad9aeaf93.gif');break;case 3:$('#prioD3').attr('src','//gf1.geo.gfsrv.net/cdnf2/823b3270ed0f4a243287c12d4ee5f8.gif');break;}};FleetDispatcher.prototype.isMissionAvailable=function(missionId){return this.orders[missionId]===true;};FleetDispatcher.prototype.hasMission=function(){return this.fleetHelper.isMissionValid(this.mission)&&this.isMissionAvailable(this.mission);};FleetDispatcher.prototype.hasFreePlanetSlots=function(){return this.planetCount<this.fleetHelper.MAX_NUMBER_OF_PLANETS;};FleetDispatcher.prototype.getAvailableMissions=function(){let missions=[];for(let mission in this.orders){if(this.orders[mission]===true){missions.push(parseInt(mission));}}return missions;};FleetDispatcher.prototype.isOnlyMissionAvailable=function(missionId){let missionsAvailable=this.getAvailableMissions();return missionsAvailable.length===1&&missionsAvailable[0]===missionId;};FleetDispatcher.prototype.getMissionData=function(missionId){if(missionId===this.fleetHelper.MISSION_NONE){return null;}return{isAvailable:this.orders[missionId]||false,name:this.orderNames[missionId]||'',description:this.orderDescriptions[missionId]||''};};FleetDispatcher.prototype.getUnionData=function(unionId){for(let i=0;i<this.unions.length;++i){if(this.unions[i].id===unionId){return this.unions[i];}}return null;};FleetDispatcher.prototype.selectMaxMetal=function(){let amount;amount=this.getCargoCapacity()-this.cargoCrystal-this.cargoDeuterium;amount=Math.max(amount,0);amount=Math.min(amount,this.metalOnPlanet);this.cargoMetal=Math.max(this.cargoMetal,amount);};FleetDispatcher.prototype.selectMinMetal=function(){this.cargoMetal=0;};FleetDispatcher.prototype.selectMaxCrystal=function(){let amount;amount=this.getCargoCapacity()-this.cargoMetal-this.cargoDeuterium;amount=Math.max(amount,0);amount=Math.min(amount,this.crystalOnPlanet);this.cargoCrystal=Math.max(this.cargoCrystal,amount);};FleetDispatcher.prototype.getDeuteriumOnPlanetWithoutConsumption=function(){return Math.max(0,this.deuteriumOnPlanet-this.getConsumption());};FleetDispatcher.prototype.selectMinCrystal=function(){this.cargoCrystal=0;};FleetDispatcher.prototype.selectMaxDeuterium=function(){let amount;amount=this.getCargoCapacity()-this.cargoMetal-this.cargoCrystal;amount=Math.max(amount,0);amount=Math.min(amount,this.getDeuteriumOnPlanetWithoutConsumption());this.cargoDeuterium=Math.max(this.cargoDeuterium,amount);};FleetDispatcher.prototype.selectMinDeuterium=function(){this.cargoDeuterium=0;};FleetDispatcher.prototype.selectMaxAll=function(){this.cargoMetal=0;this.cargoCrystal=0;this.cargoDeuterium=0;this.selectMaxDeuterium();this.selectMaxCrystal();this.selectMaxMetal();};FleetDispatcher.prototype.resetCargo=function(){this.cargoMetal=0;this.cargoCrystal=0;this.cargoDeuterium=0;};FleetDispatcher.prototype.updateCargo=function(){this.updateMetal();this.updateCrystal();this.updateDeuterium();};FleetDispatcher.prototype.updateMetal=function(){let amount=getValue($('#metal').val());let cargoSpace=this.getCargoCapacity()-this.cargoCrystal-this.cargoDeuterium;this.cargoMetal=Math.min(amount,this.metalOnPlanet,cargoSpace);};FleetDispatcher.prototype.updateCrystal=function(){let amount=getValue($('#crystal').val());let cargoSpace=this.getCargoCapacity()-this.cargoMetal-this.cargoDeuterium;this.cargoCrystal=Math.min(amount,this.crystalOnPlanet,cargoSpace);};FleetDispatcher.prototype.updateDeuterium=function(){let amount=getValue($('#deuterium').val());let cargoSpace=this.getCargoCapacity()-this.cargoMetal-this.cargoCrystal;let deuteriumOnPlanetWithoutConsumption=this.getDeuteriumOnPlanetWithoutConsumption();this.cargoDeuterium=Math.min(amount,this.deuteriumOnPlanet,cargoSpace,deuteriumOnPlanetWithoutConsumption);};FleetDispatcher.prototype.selectMission=function(mission){if(this.fleetHelper.isMissionValid(mission)){this.mission=mission;}this.updateHoldingTime();this.updateExpeditionTime();};FleetDispatcher.prototype.selectRetreatAfterDefenderRetreat=function(retreatAfterDefenderRetreat){this.retreatAfterDefenderRetreat=retreatAfterDefenderRetreat;};FleetDispatcher.prototype.updateHoldingTime=function(){if(this.mission===this.fleetHelper.MISSION_HOLD){this.holdingTime=getValue($('#fleet3 #holdingtime').val());}else{this.holdingTime=0;}};FleetDispatcher.prototype.updateExpeditionTime=function(){if(this.mission===this.fleetHelper.MISSION_EXPEDITION){this.expeditionTime=getValue($('#fleet3 #expeditiontime').val());}else{this.expeditionTime=0;}};FleetDispatcher.prototype.selectPriority=function(type,priority){switch(type){case'metal':if(this.prioMetal===priority)break;if(this.prioCrystal===priority)this.prioCrystal=this.prioMetal;if(this.prioDeuterium===priority)this.prioDeuterium=this.prioMetal;this.prioMetal=priority;break;case'crystal':if(this.prioCrystal===priority)break;if(this.prioMetal===priority)this.prioMetal=this.prioCrystal;if(this.prioDeuterium===priority)this.prioDeuterium=this.prioCrystal;this.prioCrystal=priority;break;case'deuterium':if(this.prioDeuterium===priority)break;if(this.prioMetal===priority)this.prioMetal=this.prioDeuterium;if(this.prioCrystal===priority)this.prioCrystal=this.prioDeuterium;this.prioDeuterium=priority;break;}};function FleetHelper(cfg){// player specific ship data
this.shipsData=cfg.shipsData;// game constants
this.COLONIZATION_ENABLED=cfg.COLONIZATION_ENABLED;this.MAX_NUMBER_OF_PLANETS=cfg.MAX_NUMBER_OF_PLANETS;this.PLAYER_ID_LEGOR=cfg.PLAYER_ID_LEGOR;this.PLAYER_ID_SPACE=cfg.PLAYER_ID_SPACE;// mission constants
this.MISSION_NONE=cfg.missions.MISSION_NONE;this.MISSION_ATTACK=cfg.missions.MISSION_ATTACK;this.MISSION_UNIONATTACK=cfg.missions.MISSION_UNIONATTACK;this.MISSION_TRANSPORT=cfg.missions.MISSION_TRANSPORT;this.MISSION_DEPLOY=cfg.missions.MISSION_DEPLOY;this.MISSION_HOLD=cfg.missions.MISSION_HOLD;this.MISSION_ESPIONAGE=cfg.missions.MISSION_ESPIONAGE;this.MISSION_COLONIZE=cfg.missions.MISSION_COLONIZE;this.MISSION_RECYCLE=cfg.missions.MISSION_RECYCLE;this.MISSION_DESTROY=cfg.missions.MISSION_DESTROY;this.MISSION_MISSILEATTACK=cfg.missions.MISSION_MISSILEATTACK;this.MISSION_EXPEDITION=cfg.missions.MISSION_EXPEDITION;// galaxy related constants
this.DONUT_GALAXY=cfg.DONUT_GALAXY;this.DONUT_SYSTEM=cfg.DONUT_SYSTEM;this.MAX_GALAXY=cfg.MAX_GALAXY;this.MAX_SYSTEM=cfg.MAX_SYSTEM;this.MAX_POSITION=cfg.MAX_POSITION;this.EXPEDITION_POSITION=cfg.EXPEDITION_POSITION;// fleet related constants
this.SPEEDFAKTOR_FLEET=cfg.SPEEDFAKTOR_FLEET;this.FLEET_DEUTERIUM_SAVE_FACTOR=cfg.FLEET_DEUTERIUM_SAVE_FACTOR;// target types
this.PLANETTYPE_PLANET=cfg.PLANETTYPE_PLANET;this.PLANETTYPE_DEBRIS=cfg.PLANETTYPE_DEBRIS;this.PLANETTYPE_MOON=cfg.PLANETTYPE_MOON;}FleetHelper.prototype.isPlayerSpace=function(playerId){return playerId===this.PLAYER_ID_SPACE;};FleetHelper.prototype.isPlayerLegor=function(playerId){return playerId===this.PLAYER_ID_LEGOR;};FleetHelper.prototype.calcDistance=function(from,to){let diffGalaxy=Math.abs(from.galaxy-to.galaxy);let diffSystem=Math.abs(from.system-to.system);let diffPlanet=Math.abs(from.position-to.position);if(diffGalaxy!=0){let diff2=Math.abs(diffGalaxy-this.MAX_GALAXY);if(this.DONUT_GALAXY==1&&diff2<diffGalaxy){return diff2*20000;}else{return diffGalaxy*20000;}}else if(diffSystem!=0){let diff2=Math.abs(diffSystem-this.MAX_SYSTEM);if(this.DONUT_SYSTEM==1&&diff2<diffSystem){return diff2*5*19+2700;}else{return diffSystem*5*19+2700;}}else if(diffPlanet!=0){return diffPlanet*5+1000;}else{return 5;}};FleetHelper.prototype.calcDuration=function(distance,maxSpeed,speedPercent){return Math.max(Math.round((35000/speedPercent*Math.sqrt(distance*10/maxSpeed)+10)/this.SPEEDFAKTOR_FLEET),1);};FleetHelper.prototype.calcConsumption=function(ships,distance,speedPercent,holdingTime){let that=this;let consumption=0;let holdingCosts=0;let shipIds=ships.map(function(ship){return ship.id;});let maxSpeed=this.getMaxSpeed(shipIds);let duration=this.calcDuration(distance,maxSpeed,speedPercent);let speedValue=Math.max(1,duration*this.SPEEDFAKTOR_FLEET-10);ships.forEach(function(ship){let shipData=that.getShipData(ship.id);let shipSpeedValue=35000/speedValue*Math.sqrt(distance*10/shipData.speed);holdingCosts+=shipData.fuelConsumption*ship.number*holdingTime;consumption+=shipData.fuelConsumption*ship.number*distance/35000*(shipSpeedValue/10+1)*(shipSpeedValue/10+1);});consumption=Math.round(consumption)+1;consumption+=holdingTime>0?Math.max(Math.floor(holdingCosts/10),1):0;return consumption;};FleetHelper.prototype.calcCargoCapacity=function(shipId,number){let shipData=this.getShipData(shipId);return shipData.baseCargoCapacity*number;};FleetHelper.prototype.calcFuelCapacity=function(shipId,number){let shipData=this.getShipData(shipId);return shipData.baseFuelCapacity*number;};FleetHelper.prototype.getMaxSpeed=function(shipIds){let that=this;let speeds=[];shipIds.forEach(function(shipId){let shipData=that.getShipData(shipId);if(shipData&&shipData.speed)speeds.push(shipData.speed);});let maxSpeed=speeds.reduce(function(a,b){return Math.min(a,b);},1000000000);return maxSpeed;};FleetHelper.prototype.getShipData=function(shipId){return this.shipsData[shipId]||null;};FleetHelper.prototype.isAggressiveMission=function(mission){switch(mission){case this.MISSION_ATTACK:case this.MISSION_UNIONATTACK:case this.MISSION_ESPIONAGE:case this.MISSION_DESTROY:return true;}return false;};FleetHelper.prototype.isMissionValid=function(mission){switch(mission){case this.MISSION_ATTACK:case this.MISSION_UNIONATTACK:case this.MISSION_TRANSPORT:case this.MISSION_DEPLOY:case this.MISSION_HOLD:case this.MISSION_ESPIONAGE:case this.MISSION_COLONIZE:case this.MISSION_RECYCLE:case this.MISSION_DESTROY:case this.MISSION_MISSILEATTACK:case this.MISSION_EXPEDITION:return true;}return false;};var cancelProduction_id;var production_listid;function cancelProduction(id,listid,question){cancelProduction_id=id;production_listid=listid;errorBoxDecision(loca.LOCA_ALL_NETWORK_ATTENTION,""+question+"",loca.LOCA_ALL_YES,loca.LOCA_ALL_NO,cancelProductionStart);}function cancelProductionStart(){window.location.replace(urlCancleBuilding+'&techid='+cancelProduction_id+'&listid='+production_listid);}function submitOnKey(keyCode){if(keyCode==37){system=system>1?parseInt(system)-1:maxSystems;loadContent(galaxy,system,true);}else if(keyCode==39){system=system<maxSystems?parseInt(system)+1:1;loadContent(galaxy,system,true);}else if(keyCode==40){galaxy=galaxy>1?parseInt(galaxy)-1:maxGalaxies;loadContent(galaxy,system,true);}else if(keyCode==38){galaxy=galaxy<maxGalaxies?parseInt(galaxy)+1:1;loadContent(galaxy,system,true);}}function keyevent(ev){var keyCode;if($(":focus").closest('.ui-dialog').length){return true;}if($(":focus").closest('.chat_box_textarea').length){return true;}if(window.event){keyCode=window.event.keyCode;}else if(ev){keyCode=ev.which;}else{return true;}submitOnKey(keyCode);}function launchMissiles(data){var data=$.parseJSON(data);if(data["status"]){$("#missileValue").html(data["rockets"]);getAjaxEventbox();}errorBoxAsArray(data["errorbox"]);$("#rocketattack").closest('.ui-dialog-content').dialog('close');}function errorBoxSubmitYes(){location.href=officersLink;}function movePlanet(url,reloadPage){function movePlanetExecute(){$.post(url,function(data){if(data==""||data==null){fadeBox(galaxyLoca.reservationSuccess,false);setTimeout('reload_page("'+reloadPage+'")',3000);}else{fadeBox(data,true);}});}errorBoxDecision(galaxyLoca.questionTitle,galaxyLoca.question,LocalizationStrings.yes,LocalizationStrings.no,movePlanetExecute);}function addToTable(strDataResult,strClass,shipCount){var text=strDataResult;if(shipCount!=null){text+=" ("+tsdpkt(shipCount)+") "+LocalizationStrings.ok;}if(isMobile){fadeBox(text,strClass!="success");return;}var currentTime=new Date();var id='fleetstatus'+currentTime.getTime();var idHtml='id="'+id+'"';var myClass='class="'+strClass+'"';var div='<div '+idHtml+' '+myClass+'>'+text+'</div>';if($('#fleetstatusrow').has('div').length){$('#fleetstatusrow').empty();}$(div).prependTo('#fleetstatusrow').fadeOut(3000,function(){$(this).remove();});}function setShips(ship,count){var e=document.getElementById(ship);e.innerHTML=count;}function displayContentGalaxy(data){// var selector = getTooltipSelector("#inhalt");
//removeTooltip(selector);
var json=$.parseJSON(data);$("#galaxyContent").html(json.galaxy);$('galaxyContent').find('script').each(function(){// http://perfectionkills.com/global-eval-what-are-the-options/
$.globalEval($(this).text());});tabletInitGalaxyDetails();//just for the event
eventBDayInitGalaxy();$("#galaxyLoading").hide();if(preserveSystemOnPlanetChange){$(".planetlink, .moonlink").querystring({galaxy:galaxy,system:system});}reloadResources(json.resources);displayDebrisAtExpeditionSlot(json);}function displayDebrisAtExpeditionSlot(data){var html=data.debrisAtExpeditionSlot||'';$('#debrisAtExpeditionSlot').html(html);}function submitForm(){galaxy=$("#galaxy_input").val();system=$("#system_input").val();if(0===galaxy.length||!$.isNumeric(+galaxy)){galaxy=1;}if(0===system.length||!$.isNumeric(+system)){system=1;}loadContent(galaxy,system,true);}function loadContent(galaxy,system,buildList){$("#galaxyLoading").show();if(0===galaxy.length||!$.isNumeric(+galaxy)){galaxy=1;}if(0===system.length||!$.isNumeric(+system)){system=1;}$("#galaxy_input").val(galaxy);$("#system_input").val(system);//removeTooltip($('#galaxytable tbody *'));
//if(buildList) {
//    $.each(buildListCountdowns, function() {
//        timerHandler.removeCallback(this.timer);
//    });
//}
$.post(contentLink,{galaxy:galaxy,system:system},displayContentGalaxy);// getAjaxResourcebox();
}function errorBoxDeuterium(){fadeBox(galaxyLoca.deuteriumNeeded,true);// getAjaxResourcebox();
}function doScan(position,planettype){sendShips(constants.espionage,galaxy,system,position,planettype,spionageAmount);}function initPhalanx(){getAjaxResourcebox();$('.eventFleet:odd').addClass('odd');$('.partnerInfo:even').addClass('part-even');$(".toggleInfos").click(function(){id=$(this).attr("rel");if($(this).attr("class")=="toggleInfos infosOpen"){$(this).removeClass("infosOpen");$(this).addClass("infosClosed");$(this).children().attr("src",'//gf2.geo.gfsrv.net/cdn10/de1e5f629d9e47d283488eee0c0ede.gif');$("."+id).attr("style","display: none;");}else{$(this).addClass("infosOpen");$(this).removeClass("infosClosed");$(this).children().attr("src",'//gf3.geo.gfsrv.net/cdnb6/577565fadab7780b0997a76d0dca9b.gif');$("."+id).attr("style","display: block;");}});var $titleBar=$(".overlayDiv.phalanx").siblings('.ui-dialog-titlebar');if($titleBar.find('.refreshPhalanxLink').length){$("#phalanxWrap .refreshPhalanxLink").remove();}else{$titleBar.find('.ui-dialog-title').append($("#phalanxWrap .refreshPhalanxLink"));}}function initMissleAttackLayer(){$("#rocketattack").closest('.ui-dialog-content').dialog('option','title',$('#rocketattack').data('title'));$("#rocketattack input#missileCount").keyup(function(){checkIntInput($(this),1,$(this).data("max"));}).change(function(){checkIntInput($(this),1,$(this).data("max"));}).focus();$("#rocketattack #number").bind('click',function(){var $input=$("#rocketattack input#missileCount");if(parseInt($input.val())!=$input.data('max')){$input.val($input.data('max'));}else{$input.val('1');}});$("#rocketattack #priority a").bind('click',function(){var $this=$(this);var $primaryTarget=$('#primaryTarget');$("#rocketattack #priority a").not($this).removeClass('active');if($this.hasClass('active')){$this.removeClass('active');$primaryTarget.val('');$("#noPriorityInfo").show();}else{$this.addClass('active');$primaryTarget.val($this.attr('ref'));$("#noPriorityInfo").hide();}});$("form#rocketForm").submit(function(){ajaxFormSubmit('rocketForm',$(this).attr("action"),launchMissiles);return false;});function updateArrivalTime(){var $timer=$("#rocketattack #arrivalTime #timer");$timer.html(getFormatedDate(serverTime.getTime()+1000*$timer.data('duration'),'[d].[m].[y] [G]:[i]:[s]'));}timerHandler.appendCallback(updateArrivalTime);updateArrivalTime();}function displayMiniFleetMessage(response){var message=response.message;if(typeof response.coordinates!='undefined'){message+=' ['+response.coordinates.galaxy+':'+response.coordinates.system+':'+response.coordinates.position+']';}if(response.success){var symbolSelector='#ownFleetStatus_'+response.coordinates.position+'_'+response.planetType;switch(response.type){case 1:$(symbolSelector).removeClass("fleetNeutral");$(symbolSelector).attr('title',galaxyLoca.fleetAttacking).addClass('fleetHostile').addClass('tooltip');break;case 2:$(symbolSelector).attr('title',galaxyLoca.fleetUnderway).addClass('fleetNeutral').addClass('tooltip');break;}addToTable(message,"success",response.shipsSent);$("#slotUsed").html(tsdpkt(response.slots));setShips("probeValue",tsdpkt(response.probes));setShips("recyclerValue",tsdpkt(response.recyclers));setShips("missileValue",tsdpkt(response.missiles));}else{addToTable(message,"error");}shipsendingDone=1;}function filterToggle(event){var filterTarget=event.target;var filterClass;switch(filterTarget.id){case'filter_empty':filterClass='.empty_filter';break;case'filter_inactive':filterClass='.inactive_filter';break;case'filter_vacation':filterClass='.vacation_filter';break;case'filter_strong':filterClass='.strong_filter';break;case'filter_newbie':filterClass='.newbie_filter';break;}filterTarget=$(filterTarget);if(filterTarget.hasClass('filter_active')){filterTarget.removeClass('filter_active');$(filterClass).each(function(i,obj){$(this).removeClass('filtered_'+$(event.target)[0].id);});sendFilterToggle($(event.target)[0].id,0);event.stopPropagation();}else{filterTarget.addClass('filter_active');$(filterClass).each(function(i,obj){$(this).addClass('filtered_'+$(event.target)[0].id);});sendFilterToggle($(event.target)[0].id,1);event.stopPropagation();}}function sendFilterToggle(id,state){$.ajax({type:'POST',url:'?page=togglefilter',dataType:'json',data:{id:id,state:state},success:function(data){},error:function(){}});}function OGameLineChart(container,data){this.container=container;this.dataPoints=data.dataPoints||[];this.deltaY=data.deltaY||1;this.digitsY=data.digitsY||0;this.title=data.title||'';this.titleFont=data.titleFont||'Bold 13px Verdana, Arial, SunSans-Regular, Sans-Serif';this.titleColor=data.titleColor||'#6f9fc8';this.titleBaseline=data.titleBaseline||'middle';this.labelFontY=data.labelFont||'11px Verdana, Arial, SunSans-Regular, Sans-Serif';this.labelColorY=data.labelColor||'#6f9fc8';this.labelBaselineY=data.labelBaseline||'middle';this.labelLineHeightY=data.labelLineHeightY||11;this.labelSpacingY=data.labelSpacingY||20;this.labelHeightY=data.labelHeightY||20;this.labelFontX=data.labelFont||'11px Verdana, Arial, SunSans-Regular, Sans-Serif';this.labelColorX=data.labelColor||'#6f9fc8';this.labelBaselineX=data.labelBaseline||'middle';this.labelLineHeightX=data.labelLineHeightX||11;this.guidesStyle=data.guidesStyle||'#6f9fc8';this.lineStyles=data.lineStyles||{};this.lineWidths=data.lineWidths||{};this.lineStyleHighlight=data.lineStyleHighlight||'#aaffaa';this.lineWidthHighlight=data.lineWidthHighlight||5;this.lineThresholdHighlight=data.lineThresholdHighlight||10;this.tooltips=data.tooltips||{};this.dataKeyHighlight=null;this.marginLeft=data.marginLeft||60;this.marginRight=data.marginRight||30;this.marginTop=data.marginTop||20;this.marginBottom=data.marginBottom||110;this.visibility=data.visibility||{};}OGameLineChart.epsilon=0.0001;OGameLineChart.prototype.init=function(){let html='<div class="og-linechart"><canvas></canvas><div class="tooltip"></div></div>';this.container.html(html);this.canvas=this.container.find('canvas')[0];this.tooltip=this.container.find('.tooltip');this.fixDPI();this.context=this.canvas.getContext('2d');this.context.imageSmoothingEnabled=true;this.container.on('mousemove',this.handleMouseMove.bind(this));this.container.on('mouseleave',this.handleMouseLeave.bind(this));};OGameLineChart.prototype.handleMouseMove=function(e){let mousePosition=this.transformEventToCanvas(e);this.updateHighlight(mousePosition);this.updateTooltip(mousePosition);if(this.onMouseMove){this.onMouseMove(e,this);}this.render();};OGameLineChart.prototype.handleMouseLeave=function(e){this.setHighlight(null);this.render();};OGameLineChart.prototype.updateHighlight=function(p){let line=this.getClosestLine(p,this.lineThresholdHighlight);let key=line?line.key:null;this.setHighlight(key);};OGameLineChart.prototype.updateTooltip=function(p){let pnt=this.getClosestDataPoint(p,this.lineThresholdHighlight);if(pnt===null){this.hideTooltip();}else{let a=this.transformDataPointToCanvas(pnt.index,pnt.dataPoint.y);let tooltipText=(this.tooltips[pnt.key]||'')+':'+pnt.dataPoint.y.toFixed(2);this.tooltip.html(tooltipText);this.tooltip.css({left:a.x-20,top:a.y});this.showTooltip();}//let dataPoints = this.getClosestDataPoint(p,key)
};OGameLineChart.prototype.showTooltip=function(){this.tooltip.show();};OGameLineChart.prototype.hideTooltip=function(){this.tooltip.hide();};OGameLineChart.prototype.getClosestLine=function(p,threshold){let currentKey=null;let currentDistance=null;let currentIndex=null;for(let key in this.dataPoints){let dataPoints=this.dataPoints[key];for(let i=0;i<dataPoints.length-1;++i){let a=this.transformDataPointToCanvas(i,dataPoints[i].y);let b=this.transformDataPointToCanvas(i+1,dataPoints[i+1].y);let d=this.orthogonalDistanceFromLineSegment(p,a,b);if(d===null||d>threshold){continue;}if(currentDistance===null||currentDistance>d){currentKey=key;currentDistance=d;currentIndex=i;}}}if(currentKey!==null){return{key:currentKey,distance:currentDistance,index:currentIndex};}return null;};OGameLineChart.prototype.getClosestDataPoint=function(p,threshold){let line=this.getClosestLine(p,threshold);if(line===null){return null;}let currentDistance=null;let currentDataPoint=null;let currentIndex=null;let dataPoints=this.getDataPoints(line.key);if(dataPoints){for(let i=0;i<dataPoints.length;++i){let a=this.transformDataPointToCanvas(i,dataPoints[i].y);let d=this.distance(a,p);if(d>threshold){continue;}if(currentDistance===null||currentDistance>d){currentDataPoint=dataPoints[i];currentDistance=d;currentIndex=i;}}}if(currentDataPoint!==null){return{key:line.key,index:currentIndex,dataPoint:currentDataPoint};}return null;};OGameLineChart.prototype.render=function(){this.height=$(this.canvas).outerHeight();this.width=$(this.canvas).outerWidth();this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.renderTitle();this.renderLabels();this.renderData();};OGameLineChart.prototype.renderTitle=function(){this.context.save();this.context.font=this.titleFont;this.context.fillStyle=this.titleColor;this.context.textBaseline=this.titleBaseline;let px=this.marginLeft;let py=Math.floor(this.marginTop/2);this.context.fillText(this.title,px,py);this.context.restore();};OGameLineChart.prototype.renderLabels=function(){this.renderAxis();this.renderVerticalLabels();this.renderHorizontalLabels();};OGameLineChart.prototype.renderAxis=function(){let sx=this.marginLeft;let sy=this.marginTop;let ex=this.marginLeft;let ey=this.height-this.marginBottom;this.context.save();this.context.strokeStyle=this.guidesStyle;this.context.beginPath();this.context.moveTo(sx,sy);this.context.lineTo(ex,ey);this.context.stroke();this.context.closePath();sx=ex;sy=ey;ex=this.width-this.marginRight;ey=this.height-this.marginBottom;this.context.beginPath();this.context.moveTo(sx,sy);this.context.lineTo(ex,ey);this.context.stroke();this.context.closePath();this.context.restore();};OGameLineChart.prototype.renderVerticalLabels=function(){let drawMinY=this.marginTop;let drawMaxY=this.height-this.marginBottom;let numLabels=Math.floor((drawMaxY-drawMinY)/(this.labelLineHeightY+this.labelSpacingY))+1;let drawDeltaY=Math.floor((drawMaxY-drawMinY)/(numLabels-1));let minY=Math.floor(this.getMinY()/this.deltaY);let maxY=Math.ceil(this.getMaxY()/this.deltaY);let deltaY=Math.floor((maxY-minY)/(numLabels-1));let px=0;let py=drawMaxY;this.context.save();this.context.font=this.labelFontY;this.context.fillStyle=this.labelColorY;this.context.textBaseline=this.labelBaselineY;for(let i=0;i<numLabels;++i){let y=minY+deltaY*i;let label=tsdpkt(y.toFixed(this.digitsY));let labelWidth=this.context.measureText(label).width;let dx=Math.floor(this.marginLeft/2-labelWidth/2);let py=drawMaxY-drawDeltaY*i;this.context.fillText(label,px+dx,py);}this.context.restore();};OGameLineChart.prototype.renderHorizontalLabels=function(){let keys=this.getDataKeys();if(keys.length===0){return;}let key=keys[0];let dataPoints=this.getDataPoints(key);if(dataPoints.length<2){return;}let drawMinX=this.marginLeft;let drawMaxX=this.width-this.marginRight;let drawDeltaX=Math.floor((drawMaxX-drawMinX)/(dataPoints.length-1));let px=this.marginLeft;let py=this.height-this.marginBottom+this.labelHeightY;this.context.save();this.context.font=this.labelFontX;this.context.fillStyle=this.labelColorX;this.context.textBaseline=this.labelBaselineX;for(let i=0;i<dataPoints.length;++i){let label=dataPoints[i].x.toString();let labelWidth=this.context.measureText(label).width;let dx=Math.floor(labelWidth/2);// draw rotated text
this.context.save();this.context.translate(px,py);this.context.rotate(Math.PI*0.375);this.context.fillText(label,0,0);this.context.restore();px+=drawDeltaX;}this.context.restore();};OGameLineChart.prototype.renderData=function(){for(let key in this.dataPoints){if(this.dataKeyHighlight===key){continue;}this.renderDataPoints(key,this.dataPoints[key]);}// render highlighted data set on top
if(this.dataKeyHighlight!==null){this.renderDataPoints(this.dataKeyHighlight,this.dataPoints[this.dataKeyHighlight]);}};OGameLineChart.prototype.renderDataPoints=function(key,dataPoints){if(!this.isDataSetVisible(key)){return;}this.context.save();this.context.strokeStyle=this.getLineStyle(key);this.context.lineWidth=this.getLineWidth(key);this.context.beginPath();for(let i=0;i<dataPoints.length-1;++i){let s=this.transformDataPointToCanvas(i,dataPoints[i].y);let e=this.transformDataPointToCanvas(i+1,dataPoints[i+1].y);this.context.moveTo(s.x,s.y);this.context.lineTo(e.x,e.y);}this.context.stroke();this.context.closePath();this.context.restore();};OGameLineChart.prototype.transformDataPointToCanvas=function(x,y){let minY=Math.ceil(this.getMinY()/this.deltaY);let maxY=Math.floor(this.getMaxY()/this.deltaY);let numDataPoints=this.getNumDataPoints();if(y===undefined)throw'Y is undefined';let drawMinY=this.marginTop;let drawMaxY=this.height-this.marginBottom;let drawMinX=this.marginLeft;let drawMaxX=this.width-this.marginRight;let drawDeltaX=Math.floor((drawMaxX-drawMinX)/(numDataPoints-1));let scaleY=(drawMaxY-drawMinY)/(maxY-minY);let cx=Math.floor(drawDeltaX*x+drawMinX);let cy=Math.floor(-(y-minY)*scaleY+drawMaxY);return{x:cx,y:cy};};OGameLineChart.prototype.transformEventToCanvas=function(e){let canvasOffset=$(this.canvas).offset();let x=e.pageX-canvasOffset.left;let y=e.pageY-canvasOffset.top;return{x:x,y:y};};OGameLineChart.prototype.getMinY=function(){let value=null;for(let k in this.dataPoints){let points=this.dataPoints[k];for(let i=0;i<points.length;++i){if(value===null||value>points[i].y){value=points[i].y;}}}if(value===null){return 0;}return value-1;};OGameLineChart.prototype.getMaxY=function(){let value=null;for(let k in this.dataPoints){let points=this.dataPoints[k];for(let i=0;i<points.length;++i){if(value===null||value<points[i].y){value=points[i].y;}}}if(value===null){return 4;}return value+1;};OGameLineChart.prototype.getDataKeys=function(){let keys=[];for(let k in this.dataPoints){keys.push(k);}return keys;};OGameLineChart.prototype.getDataPoints=function(key){if(this.dataPoints[key]!==undefined){return this.dataPoints[key];}return[];};OGameLineChart.prototype.getNumDataPoints=function(){let numDataPoints=0;for(let k in this.dataPoints){if(numDataPoints<this.dataPoints[k].length){numDataPoints=this.dataPoints[k].length;}}return numDataPoints;};OGameLineChart.prototype.setHighlight=function(key){this.dataKeyHighlight=key;};OGameLineChart.prototype.setDataSetVisible=function(key,visible){this.visibility[key]=visible===true;};OGameLineChart.prototype.isDataSetVisible=function(key){if(this.visibility[key]!==undefined){return this.visibility[key];}return true;};OGameLineChart.prototype.getLineStyle=function(key){if(key===this.dataKeyHighlight){return this.lineStyleHighlight;}return this.lineStyles[key]||'#ffffff';};OGameLineChart.prototype.getLineWidth=function(key){if(key===this.dataKeyHighlight){return this.lineWidthHighlight;}return this.lineWidths[key]||1;};OGameLineChart.prototype.fixDPI=function(){let dpi=window.devicePixelRatio;let that=this;//create a style object that returns width and height
let style={height:function(){return+getComputedStyle(that.canvas).getPropertyValue('height').slice(0,-2);},width:function(){return+getComputedStyle(that.canvas).getPropertyValue('width').slice(0,-2);}//set the correct attributes for a crystal clear image!
};this.canvas.setAttribute('width',style.width()*dpi);this.canvas.setAttribute('height',style.height()*dpi);};OGameLineChart.prototype.crossProduct=function(a,b,c){return(c.y-a.y)*(b.x-a.x)-(c.x-a.x)*(b.y-a.y);};OGameLineChart.prototype.dotProduct=function(a,b){return a.x*b.x+a.y*b.y;};OGameLineChart.prototype.addVector2=function(a,b){return{x:a.x+b.x,y:a.y+b.y};};OGameLineChart.prototype.subVector2=function(a,b){return{x:a.x-b.x,y:a.y-b.y};};OGameLineChart.prototype.scaleVector2=function(v,s){return{x:v.x*s,y:v.y*s};};OGameLineChart.prototype.distance=function(a,b){let delta=this.subVector2(a,b);return Math.sqrt(this.dotProduct(delta,delta));};OGameLineChart.prototype.projectOntoLineSegment=function(p,a,b){let ap=this.subVector2(p,a);let ab=this.subVector2(b,a);let c=this.dotProduct(ap,ab)/this.dotProduct(ab,ab);if(c<0||c>1){return null;}return this.addVector2(a,this.scaleVector2(ab,c));};OGameLineChart.prototype.orthogonalDistanceFromLineSegment=function(p,a,b){let c=this.projectOntoLineSegment(p,a,b);if(c===null){return null;}let cp=this.subVector2(p,c);let sq=this.dotProduct(cp,cp);return Math.sqrt(sq);};(function($){$.fn.ogameLineChart=function(data){if(this.length>0){let that=$(this[0]);let lineChart=that.data('ogameLineChart');if(lineChart==null){lineChart=new OGameLineChart(that,data);$(this).data('ogameLineChart',lineChart);lineChart.init();lineChart.render();}return lineChart;}return null;};})(jQuery);function OGameLoadingIndicator(container){this.container=container;}OGameLoadingIndicator.prototype.init=function(){let html='<div class="og-loading"><div class="og-loading-overlay"><div class="og-loading-indicator"></div></div></div>';this.element=$(html);this.container.append(this.element);};OGameLoadingIndicator.prototype.show=function(){this.element.show();};OGameLoadingIndicator.prototype.hide=function(){this.element.hide();};(function($){$.fn.ogameLoadingIndicator=function(data){if(this.length>0){let that=$(this[0]);let loadingIndicator=that.data('ogameLoadingIndicator');if(loadingIndicator==null){loadingIndicator=new OGameLoadingIndicator(that,data);$(this).data('ogameLoadingIndicator',loadingIndicator);loadingIndicator.init();}return loadingIndicator;}return null;};})(jQuery);var LazyLoader;(function($){LazyLoader={"pendingCssFiles":[],"loadedCssFiles":[],"pendingJsFiles":[],"loadedJsFiles":[],"_downloadCompleteHandler":function(type,path){switch(type){case"css":LazyLoader.pendingCssFiles=$.grep(LazyLoader.pendingCssFiles,function(value){return value!=path;});LazyLoader.loadedCssFiles.push(path);if(LazyLoader.pendingCssFiles.length===0){$(document).trigger("cssComplete");}break;case"js":LazyLoader.pendingJsFiles=$.grep(LazyLoader.pendingJsFiles,function(value){return value!=path;});LazyLoader.loadedJsFiles.push(path);if(LazyLoader.pendingJsFiles.length===0){$(document).trigger("jsComplete");}break;}if(LazyLoader.pendingCssFiles.length===0&&LazyLoader.pendingJsFiles.length===0){$(document).trigger("allComplete");}},"_loadCssFiles":function(cssFiles){var linkTags=[];$.each(cssFiles,function(key,value){if($.inArray(value,LazyLoader.pendingCssFiles)>-1||$.inArray(value,LazyLoader.loadedCssFiles)>-1){return true;}LazyLoader.pendingCssFiles.push(value);linkTags.push($("<link />").attr("href",value).attr("rel","stylesheet").on("load",{"path":value},function(event){LazyLoader._downloadCompleteHandler("css",event.data.path);}));});if(linkTags.length===0){return{"status":"done"};}$(linkTags).map($.fn.toArray).appendTo("head");return{"status":"queued"};},"_loadJsFiles":function(jsFiles){var newScripts=false;$.each(jsFiles,function(key,value){if($.inArray(value,LazyLoader.pendingJsFiles)>-1||$.inArray(value,LazyLoader.loadedJsFiles)>-1){return true;}newScripts=true;LazyLoader.pendingJsFiles.push(value);$.ajax({"cache":true,"url":value,"dataType":"script"}).success(function(){LazyLoader._downloadCompleteHandler("js",value);});});if(!newScripts){return{"status":"done"};}return{"status":"queued"};},"loadFiles":function(cssFiles,jsFiles){var loadCssFiles=LazyLoader._loadCssFiles(cssFiles);var loadJsFiles=LazyLoader._loadJsFiles(jsFiles);if(loadCssFiles.status==="done"&&loadJsFiles.status==="done"){$(document).trigger("allComplete");}}};$(document).ready(function(){$('#mainmenucomponent li.has-sub > a').on('click',function(){$(this).removeAttr('href');var element=$(this).parent('li');if(element.hasClass('open')){element.removeClass('open');element.find('li').removeClass('open');element.find('ul').slideUp(50);}else{element.addClass('open');element.children('ul').slideDown(50);element.siblings('li').children('ul').slideUp(50);element.siblings('li').removeClass('open');element.siblings('li').find('li').removeClass('open');element.siblings('li').find('ul').slideUp(50);}});$('[data-link]').on('click',function(){$.ajax({url:$(this).data('link'),statusCode:{404:function(){alert("page not found");}}}).done(function(data){var json=$.parseJSON(data);$(document).off("allComplete").on("allComplete",{"json":json},function(event){/* remove injected components */$('.injectedComponent').remove();/* replace main content with target content and evaluate inline JavaScript */$('.maincontent').children('div:first-child').replaceWith(event.data.json.content[event.data.json.target]);$('.maincontent').attr('id',event.data.json.target+'component');/* add injected components */delete event.data.json.content[event.data.json.target];$.each(event.data.json.content,function(key,value){$('#'+event.data.json.target+'component').after(value);});/* modify browser history for easier user navigation */history.pushState(event.data.json.page.stateObj,event.data.json.page.title,event.data.json.page.url);/* setting global js infos */currentPage=event.data.json.target;serverTime=new Date(event.data.serverTime);});LazyLoader.loadFiles(json.files.css,json.files.js);});});});})(jQuery);/* BEFORE git cherry-pick b6a1d2180536b9c2e09b635cf874b0fbac5f5fef
( function( $ ) {
$( document ).ready(function() {
$('#mainmenucomponent li.has-sub>a').on('click', function(){
        $(this).removeAttr('href');
        var element = $(this).parent('li');
        if (element.hasClass('open')) {
            element.removeClass('open');
            element.find('li').removeClass('open');
            element.find('ul').slideUp();
        }
        else {
            element.addClass('open');
            element.children('ul').slideDown();
            element.siblings('li').children('ul').slideUp();
            element.siblings('li').removeClass('open');
            element.siblings('li').find('li').removeClass('open');
            element.siblings('li').find('ul').slideUp();
        }
    });
});
} )( jQuery );
*/function Marketplace(cfg){this.tab=cfg.tab||'';this.loca=cfg.loca;this.constants=cfg.marketConstants;this.token=cfg.token;this.initMap={'buying':this.initTabBuying.bind(this),'selling':this.initTabSelling.bind(this),'overview':this.initTabOverview.bind(this),'statistics':this.initTabStatistics.bind(this),'history_buying':this.initTabHistoryBuying.bind(this),'history_selling':this.initTabHistorySelling.bind(this),'create_offer':this.initTabCreateOffer.bind(this)};if(this.initMap[this.tab]){this.initMap[this.tab](cfg);}}Marketplace.prototype.onAjaxDone=function(){this.loadingIndicator.hide();};Marketplace.prototype.onAjaxError=function(){};Marketplace.prototype.updateToken=function(token){this.token=token;};//
// Item tabs general
//
Marketplace.prototype.initItemsCommon=function(cfg){this.itemsWrapper=$('.marketplace .items_wrapper');//this.itemsWrapper.mCustomScrollbar({theme: 'ogame'})
this.loadingIndicator=this.itemsWrapper.ogameLoadingIndicator();this.items=$('.marketplace .items');this.table=this.items.closest('.og-table');};Marketplace.prototype.refreshItems=function(htmlItems){this.items.html(htmlItems);this.table.toggleClass('isScrollbarVisible',this.items.children().length>5);};Marketplace.prototype.getSorting=function(){let sorting={playerName:this.sortPlayerName.getOrder(),price:this.sortPrice.getOrder(),deliveryTime:this.sortDelivery.getOrder()};return sorting;};Marketplace.prototype.getFilters=function(){let filters={};filters.resourceId=$('#filterResources').val();filters.shipId=$('#filterShips').val();filters.tradableItemId=$('#filterItems').val();filters.priceType=$('#filterPriceType').val();return filters;};Marketplace.prototype.getPagination=function(){let pagination={};pagination.page=this.pagination.getPage();return pagination;};//
// Tab: buying
//
Marketplace.prototype.initTabBuying=function(cfg){this.initItemsCommon(cfg);this.urlFetchBuyingItems=cfg.urlFetchBuyingItems||null;this.urlAccept=cfg.urlAccept;this.sortPlayerName=$('#sortPlayerName').ogameSortable({allowUnsorted:true,order:'',token:this.token,onChange:this.onSortChangeBuying.bind(this)});this.sortDelivery=$('#sortDelivery').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeBuying.bind(this)});this.sortPrice=$('#sortPrice').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeBuying.bind(this)});this.pagination=$('.marketplace .pagination_wrapper').ogamePaginatable({page:1,numPages:1,token:this.token,onChange:this.onPaginationChangeBuying.bind(this)});$('#showFilterResources, #showFilterShips, #showFilterItems, #filterResources, #filterShips, #filterItems, #filterPriceType').on('change',this.onFilterChangeBuying.bind(this));this.items.on('click','.item a.og-button.submit',this.onClickBuyingItem.bind(this));this.fetchBuyingItems();};Marketplace.prototype.onClickPriceMin=function(e){e.preventDefault();let price=$(e.currentTarget).data('priceMin');this.inputPrice.val(price);if(this.quantity>0){this.setPrice(parseFloat(price));}else{this.setPrice(0);}};Marketplace.prototype.onClickPriceMax=function(e){e.preventDefault();let price=$(e.currentTarget).data('priceMax');this.inputPrice.val(price);if(this.quantity>0){this.setPrice(parseFloat(price));}else{this.setPrice(0);}};Marketplace.prototype.onClickBuyingItem=function(e){e.preventDefault();let marketItemId=$(e.currentTarget).data('itemid');let itemToken=$(e.currentTarget).data('token');this.submitAcceptBuying(marketItemId,itemToken);};Marketplace.prototype.onSortChangeBuying=function(e){this.token=e.token;this.fetchBuyingItems();};Marketplace.prototype.onFilterChangeBuying=function(e){this.token=e.token;this.fetchBuyingItems();};Marketplace.prototype.onPaginationChangeBuying=function(e){this.token=e.token;this.fetchBuyingItems();};Marketplace.prototype.onPaginationChangeHistoryBuying=function(e){this.token=e.token;this.fetchHistoryBuyingItems();};Marketplace.prototype.onPaginationChangeHistorySelling=function(e){this.token=e.token;this.fetchHistorySellingItems();};Marketplace.prototype.fetchBuyingItems=function(){this.loadingIndicator.show();let data={sorting:this.getSorting(),filters:this.getFilters(),pagination:this.getPagination(),token:this.token};$.getJSON(this.urlFetchBuyingItems,data,this.onFetchBuyingItems.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.onFetchBuyingItems=function(data){let htmlItems=data.content[data.target];this.updateToken(data.newToken);this.refreshItems(htmlItems);};Marketplace.prototype.submitAcceptBuying=function(marketItemId,itemToken){let params={marketItemId:marketItemId,token:itemToken};this.loadingIndicator.show();$.post(this.urlAccept,params,this.handleSubmitAcceptBuyingResponse.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.handleSubmitAcceptBuyingResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';this.updateToken(data.newToken);if(status==='success'){this.fetchBuyingItems();fadeBox(data.message,false);getAjaxEventbox();getAjaxResourcebox();}else{this.displayErrors(data.errors);}};//
// Tab: selling
//
Marketplace.prototype.initTabSelling=function(cfg){this.initItemsCommon(cfg);this.urlFetchSellingItems=cfg.urlFetchSellingItems||null;this.urlAccept=cfg.urlAccept;this.sortPlayerName=$('#sortPlayerName').ogameSortable({allowUnsorted:true,order:'',token:this.token,onChange:this.onSortChangeSelling.bind(this)});this.sortDelivery=$('#sortDelivery').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeSelling.bind(this)});this.sortPrice=$('#sortPrice').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeSelling.bind(this)});this.pagination=$('.marketplace .pagination_wrapper').ogamePaginatable({page:1,numPages:1,token:this.token,onChange:this.onPaginationChangeSelling.bind(this)});$('#showFilterResources, #showFilterShips, #showFilterItems, #filterResources, #filterShips, #filterItems, #filterPriceType').on('change',this.onFilterChangeSelling.bind(this));this.items.on('click','.item .og-button.submit',this.onClickSellingItem.bind(this));this.fetchSellingItems();};Marketplace.prototype.onClickSellingItem=function(e){e.preventDefault();let marketItemId=$(e.currentTarget).data('itemid');let itemToken=$(e.currentTarget).data('token');this.submitAcceptSelling(marketItemId,itemToken);};Marketplace.prototype.onSortChangeSelling=function(e){this.token=e.token;this.fetchSellingItems();};Marketplace.prototype.onFilterChangeSelling=function(e){this.token=e.token;this.fetchSellingItems();};Marketplace.prototype.onPaginationChangeSelling=function(e){this.token=e.token;this.fetchSellingItems();};Marketplace.prototype.fetchSellingItems=function(){this.loadingIndicator.show();let data={sorting:this.getSorting(),filters:this.getFilters(),pagination:this.getPagination(),token:this.token};$.getJSON(this.urlFetchSellingItems,data,this.onFetchSellingItems.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.onFetchSellingItems=function(data){let htmlItems=data.content[data.target];this.updateToken(data.newToken);this.refreshItems(htmlItems);};Marketplace.prototype.submitAcceptSelling=function(marketItemId,itemToken){let params={marketItemId:marketItemId,token:itemToken};this.loadingIndicator.show();$.post(this.urlAccept,params,this.handleSubmitAcceptSellingResponse.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.handleSubmitAcceptSellingResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';this.updateToken(data.newToken);if(status==='success'){this.fetchSellingItems();fadeBox(data.message,false);getAjaxEventbox();getAjaxResourcebox();}else{this.displayErrors(data.errors);}};//
// Tab: overview
//
Marketplace.prototype.initTabOverview=function(cfg){this.initItemsCommon();this.urlFetchOverviewItems=cfg.urlFetchOverviewItems||null;this.items.on('click','.og-button.delete',this.onClickDeleteItem.bind(this));this.sortType=$('#sortType').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeOverview.bind(this)});this.sortPrice=$('#sortPrice').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeOverview.bind(this)});this.pagination=$('.marketplace .pagination_wrapper').ogamePaginatable({page:1,numPages:1,token:this.token,onChange:this.onPaginationChangeOverview.bind(this)});this.fetchOverviewItems();};Marketplace.prototype.getOverviewSorting=function(){let sorting={type:this.sortType.getOrder(),price:this.sortPrice.getOrder()};return sorting;};Marketplace.prototype.onSortChangeOverview=function(e){this.token=e.token;this.fetchOverviewItems();};Marketplace.prototype.onPaginationChangeOverview=function(e){this.token=e.token;this.fetchOverviewItems();};Marketplace.prototype.onClickDeleteItem=function(e){e.stopPropagation();e.preventDefault();this.loadingIndicator.show();let urlDelete=e.currentTarget.href;let params={token:this.token};let that=this;errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION,this.loca.LOCA_MARKET_CANCELLATION_NOTE,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){$.post(urlDelete,params,that.handleSubmitDeleteResponse.bind(that)).done(that.onAjaxDone.bind(that));},function(){that.loadingIndicator.hide();});};Marketplace.prototype.handleSubmitDeleteResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';this.updateToken(data.newToken);if(status==='success'){this.fetchOverviewItems();getAjaxEventbox();getAjaxResourcebox();}else{this.displayErrors(data.errors);}};Marketplace.prototype.onItemDeleted=function(){this.onAjaxDone();};Marketplace.prototype.fetchOverviewItems=function(){this.loadingIndicator.show();let data={sorting:this.getOverviewSorting(),pagination:this.getPagination(),token:this.token};$.getJSON(this.urlFetchOverviewItems,data,this.onFetchOverviewItems.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.onFetchOverviewItems=function(data){let htmlItems=data.content[data.target];this.updateToken(data.newToken);this.refreshItems(htmlItems);};//
// Tab: statistics
//
Marketplace.prototype.initTabStatistics=function(cfg){let statisticsChartData=cfg.statisticsChartData||null;this.lineChart=$('#chart_container').ogameLineChart(statisticsChartData);$('#showRatioMetal').on('change',this.refreshLineChart.bind(this));$('#showRatioCrystal').on('change',this.refreshLineChart.bind(this));$('#showRatioDeuterium').on('change',this.refreshLineChart.bind(this));this.refreshLineChart();};Marketplace.prototype.refreshLineChart=function(){this.lineChart.setDataSetVisible('metal',$('#showRatioMetal').is(':checked'));this.lineChart.setDataSetVisible('crystal',$('#showRatioCrystal').is(':checked'));this.lineChart.setDataSetVisible('deuterium',$('#showRatioDeuterium').is(':checked'));this.lineChart.render();};//
// Tab: history_buying
//
Marketplace.prototype.initTabHistoryBuying=function(cfg){this.initItemsCommon();this.urlCollectItem=cfg.urlCollectItem;this.urlCollectPrice=cfg.urlCollectPrice;this.urlFetchHistoryBuyingItems=cfg.urlFetchHistoryBuyingItems||null;this.sortPayment=$('#sortPayment').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeHistoryBuying.bind(this)});this.sortDate=$('#sortDate').ogameSortable({allowUnsorted:true,order:'desc',align:'center',token:this.token,onChange:this.onSortChangeHistoryBuying.bind(this)});this.pagination=$('.marketplace .pagination_wrapper').ogamePaginatable({page:1,numPages:1,token:this.token,onChange:this.onPaginationChangeHistoryBuying.bind(this)});this.items.on('click','.item a.og-button.submit.collect-item',this.onClickCollectItem.bind(this));this.items.on('click','.item a.og-button.submit.collect-price',this.onClickCollectPrice.bind(this));this.fetchHistoryBuyingItems();};Marketplace.prototype.onClickCollectItem=function(e){e.preventDefault();let marketTransactionId=$(e.currentTarget).data('transactionid');let itemToken=$(e.currentTarget).data('token');this.submitCollectItem(marketTransactionId,itemToken);};Marketplace.prototype.submitCollectItem=function(marketTransactionId,itemToken){let params={marketTransactionId:marketTransactionId,token:itemToken};this.loadingIndicator.show();$.post(this.urlCollectItem,params,this.handleSubmitCollectItemResponse.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.handleSubmitCollectItemResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';let statusMessage=data.statusMessage||'';let marketTransactionId=data.marketTransactionId||0;this.updateToken(data.newToken);if(status==='success'){$('.row.item[data-transactionid="'+marketTransactionId+'"] .col.date').show();$("a[data-token]").each(function(){$(this).data('token',data.newToken);$(this).attr("data-token",data.newToken);});$('.collect-item[data-transactionid="'+marketTransactionId+'"]').parent().hide();fadeBox(data.message,false);getAjaxResourcebox();}else{this.displayErrors(data.errors);}};Marketplace.prototype.onClickCollectPrice=function(e){e.preventDefault();let marketTransactionId=$(e.currentTarget).data('transactionid');let itemToken=$(e.currentTarget).data('token');this.submitCollectPrice(marketTransactionId,itemToken);};Marketplace.prototype.submitCollectPrice=function(marketTransactionId,itemToken){let params={marketTransactionId:marketTransactionId,token:itemToken};this.loadingIndicator.show();$.post(this.urlCollectPrice,params,this.handleSubmitCollectPriceResponse.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.handleSubmitCollectPriceResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';let statusMessage=data.statusMessage||'';let marketTransactionId=data.marketTransactionId||0;this.updateToken(data.newToken);if(status==='success'){$('.row.item[data-transactionid="'+marketTransactionId+'"] .col.date').show();$("a[data-token]").each(function(){$(this).data('token',data.newToken);$(this).attr("data-token",data.newToken);});$('.collect-price[data-transactionid="'+marketTransactionId+'"]').parent().hide();fadeBox(data.message,false);getAjaxResourcebox();}else{this.displayErrors(data.errors);}};Marketplace.prototype.getHistorySorting=function(){return{price:this.sortPayment.getOrder(),date:this.sortDate.getOrder()};};Marketplace.prototype.fetchHistoryBuyingItems=function(){this.loadingIndicator.show();let data={sorting:this.getHistorySorting(),pagination:this.getPagination(),token:this.token};$.getJSON(this.urlFetchHistoryBuyingItems,data,this.onFetchHistoryBuyingItems.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.onFetchHistoryBuyingItems=function(data){let htmlItems=data.content[data.target];this.updateToken(data.newToken);this.refreshItems(htmlItems);};Marketplace.prototype.onSortChangeHistoryBuying=function(e){this.token=e.token;this.fetchHistoryBuyingItems();};//
// Tab: history_selling
//
Marketplace.prototype.initTabHistorySelling=function(cfg){this.initItemsCommon();this.urlCollectItem=cfg.urlCollectItem;this.urlCollectPrice=cfg.urlCollectPrice;this.sortPayment=$('#sortPayment').ogameSortable({allowUnsorted:true,order:'',align:'center',token:this.token,onChange:this.onSortChangeHistorySelling.bind(this)});this.sortDate=$('#sortDate').ogameSortable({allowUnsorted:true,order:'desc',align:'center',token:this.token,onChange:this.onSortChangeHistorySelling.bind(this)});this.pagination=$('.marketplace .pagination_wrapper').ogamePaginatable({page:1,numPages:1,token:this.token,onChange:this.onPaginationChangeHistorySelling.bind(this)});this.urlFetchHistorySellingItems=cfg.urlFetchHistorySellingItems||null;this.items.on('click','.item a.og-button.submit.collect-item',this.onClickCollectItem.bind(this));this.items.on('click','.item a.og-button.submit.collect-price',this.onClickCollectPrice.bind(this));this.fetchHistorySellingItems();};Marketplace.prototype.fetchHistorySellingItems=function(){this.loadingIndicator.show();let data={sorting:this.getHistorySorting(),pagination:this.getPagination(),token:this.token};$.getJSON(this.urlFetchHistorySellingItems,data,this.onFetchHistorySellingItems.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.onFetchHistorySellingItems=function(data){let htmlItems=data.content[data.target];this.updateToken(data.newToken);this.refreshItems(htmlItems);};Marketplace.prototype.onSortChangeHistorySelling=function(e){this.token=e.token;this.fetchHistorySellingItems();};//
// Tab: create_offer
//
Marketplace.prototype.initTabCreateOffer=function(cfg){this.content=$('.marketplace .content');this.loadingIndicator=this.content.ogameLoadingIndicator();this.ITEM_TYPE_SHIP=cfg.itemTypes.ITEM_TYPE_SHIP;this.ITEM_TYPE_RESOURCE=cfg.itemTypes.ITEM_TYPE_RESOURCE;this.ITEM_TYPE_TRADABLE_ITEM=cfg.itemTypes.ITEM_TYPE_TRADABLE_ITEM;this.MARKET_ITEM_TYPE_SELL_ORDER=cfg.marketItemTypes.SELL_ORDER;this.MARKET_ITEM_TYPE_BUY_ORDER=cfg.marketItemTypes.BUY_ORDER;this.RESOURCE_TYPE_METAL=cfg.resourceTypes.RESOURCE_TYPE_METAL;this.RESOURCE_TYPE_CRYSTAL=cfg.resourceTypes.RESOURCE_TYPE_CRYSTAL;this.RESOURCE_TYPE_DEUTERIUM=cfg.resourceTypes.RESOURCE_TYPE_DEUTERIUM;this.urlSubmitOffer=cfg.urlSubmitOffer;this.marketItemTypes=cfg.marketItemTypes;this.formSteps=cfg.formSteps;this.itemTypes=cfg.itemTypes;this.itemOptions=cfg.itemOptions;this.priceTypeOptions=cfg.priceTypeOptions;this.currentRatio=cfg.priceValidation.currentRatio;this.priceRangeLower=cfg.priceValidation.priceRangeLower;this.priceRangeUpper=cfg.priceValidation.priceRangeUpper;this.defaultPriceRange=cfg.defaultPriceRange;this.marketFee=cfg.marketFee;this.itemBox=$('.marketplace #itemBox');this.inputMarketItemType=$('.marketplace input[name="type"]');this.inputItemType=$('.marketplace input[name="itemType"]');this.inputQuantity=$('.marketplace input[name="quantity"]');this.inputPrice=$('.marketplace input[name="price"]');this.priceLimit=$('.marketplace #priceLimit');this.priceLimitMin=$('.marketplace #priceLimit #priceMin');this.priceLimitMax=$('.marketplace #priceLimit #priceMax');this.priceInformation=$('#orderPriceInformation');this.priceToPay=$('#priceToPay');this.priceInTotal=$('#priceInTotal');this.priceRangeValue=$('#priceRangeValue');this.marketFeeElem=$('.marketplace #marketFee');this.marketFeeColElem=$('.marketplace #colMarketFee');this.dropDownItemId=$('.marketplace #itemId');this.dropDownPriceType=$('.marketplace #priceType');this.dropDownPriceRange=$('.marketplace #priceRange');this.btnSubmitOffer=$('#submitOffer');this.dropDownPriceType.ogameDropDown();this.dropDownPriceRange.ogameDropDown();this.btnOptSellRequest=$('#btnOptSellRequest');this.btnOptBuyRequest=$('#btnOptBuyRequest');this.btnOptSellOrder=$('#btnOptSellOrder');this.btnOptBuyOrder=$('#btnOptBuyOrder');this.btnOptShips=$('#btnOptShips');this.btnOptResources=$('#btnOptResources');this.btnOptItems=$('#btnOptItems');this.btnSubmitOffer.on('click',this.onClickSubmitOffer.bind(this));this.inputMarketItemType.on('change',this.onChangeMarketItemType.bind(this));this.inputItemType.on('change',this.onChangeItemType.bind(this));this.inputQuantity.on('blur',this.onChangeQuantity.bind(this));this.inputQuantity.on('focus',this.onFocusQuantity.bind(this));this.inputQuantity.on('keyup',this.onKeyInputQuantity.bind(this));this.inputPrice.on('blur',this.onChangePrice.bind(this));this.inputPrice.on('focus',this.onFocusPrice.bind(this));this.inputPrice.on('keyup',this.onKeyInputPrice.bind(this));this.dropDownItemId.on('change',this.onChangeItemId.bind(this));this.dropDownPriceType.on('change',this.onChangePriceType.bind(this));this.dropDownPriceRange.on('change',this.onChangePriceRange.bind(this));this.priceLimitMin.on('click',this.onClickPriceMin.bind(this));this.priceLimitMax.on('click',this.onClickPriceMax.bind(this));this.resetPriceType();this.resetMarketItemType();this.resetItemType();this.refreshAvailableItemTypes();this.resetPrice();this.resetPriceRange();this.refreshMarketItemTypes();this.refreshFormSteps();this.refreshItemTypes();this.refreshItemIdOptions();this.refreshItemId();this.refreshItemBox();this.refreshPriceRangeVisiblity();this.refreshPrice();};Marketplace.prototype.onClickSubmitOffer=function(e){e.preventDefault();this.submitOffer();};Marketplace.prototype.refreshAvailableItemTypes=function(){let minQuantity=this.getMinQuantityByItemType(this.ITEM_TYPE_SHIP);let itemOptions=this.getItemOptionsByItemType(this.ITEM_TYPE_SHIP,minQuantity);if(this.MARKET_ITEM_TYPE_SELL_ORDER===this.marketItemType){this.marketFeeColElem.show();if(itemOptions.length==0){this.btnOptShips.attr('disabled','disabled');$("label[for='btnOptShips']").addClass('disabled');}}else if(this.MARKET_ITEM_TYPE_BUY_ORDER===this.marketItemType){this.marketFeeColElem.hide();this.btnOptShips.removeAttr('disabled');$("label[for='btnOptShips']").removeClass('disabled');}minQuantity=this.getMinQuantityByItemType(this.ITEM_TYPE_TRADABLE_ITEM);itemOptions=this.getItemOptionsByItemType(this.ITEM_TYPE_TRADABLE_ITEM,minQuantity);if(this.MARKET_ITEM_TYPE_SELL_ORDER===this.marketItemType){this.marketFeeColElem.show();if(itemOptions.length==0){this.btnOptItems.attr('disabled','disabled');$("label[for='btnOptItems']").addClass('disabled');}}else if(this.MARKET_ITEM_TYPE_BUY_ORDER===this.marketItemType){this.marketFeeColElem.hide();this.btnOptItems.removeAttr('disabled');$("label[for='btnOptItems']").removeClass('disabled');}};Marketplace.prototype.submitOffer=function(){let params={marketItemType:this.marketItemType,itemType:this.itemType,itemId:this.itemId,quantity:this.quantity,priceType:this.priceType,price:this.price,token:this.token};if(this.isOrder()){params.priceRange=this.priceRange;}this.loadingIndicator.show();$.post(this.urlSubmitOffer,params,this.handleSubmitOfferResponse.bind(this)).done(this.onAjaxDone.bind(this));};Marketplace.prototype.handleSubmitOfferResponse=function(response){let data=JSON.parse(response);let status=data.status||'failure';this.updateToken(data.newToken);if(status==='success'){window.location=data.redirectUrl;}else{this.displayErrors(data.errors);}};Marketplace.prototype.resetMarketItemType=function(){this.setMarketItemType(this.getFirstMarketItemType());};Marketplace.prototype.setMarketItemType=function(marketItemType){let marketItemTypeOld=this.marketItemType;this.marketItemType=parseInt(marketItemType);if(this.marketItemType!==marketItemTypeOld){if(this.marketItemType===this.MARKET_ITEM_TYPE_BUY_ORDER){this.priceInformation.show();}if(this.marketItemType===this.MARKET_ITEM_TYPE_SELL_ORDER){this.priceInformation.hide();}this.resetItemType();this.resetItemId();this.refreshAvailableItemTypes();this.refreshItemTypes();this.refreshItemIdOptions();this.refreshItemId();this.refreshItemBox();this.refreshFormSteps();this.refreshPriceRangeVisiblity();}};Marketplace.prototype.resetItemType=function(){this.setItemType(this.getFirstItemType());};Marketplace.prototype.setItemType=function(itemType){let itemTypeOld=this.itemType;this.itemType=parseInt(itemType);if(itemTypeOld!==this.itemType){this.resetItemId();this.resetPriceTypeOnEqualResource();this.refreshItemTypes();this.refreshItemIdOptions();this.refreshItemId();this.refreshItemBox();}};Marketplace.prototype.resetItemId=function(){this.setItemId(this.getFirstItemId(this.itemType));};Marketplace.prototype.setItemId=function(itemId){// tradable items use string ids
if(this.itemType!==this.ITEM_TYPE_TRADABLE_ITEM){itemId=parseInt(itemId);}let itemIdOld=this.itemId;this.itemId=itemId;if(itemIdOld!==this.itemId){this.refreshItemBox();this.resetQuantity();this.resetPriceTypeOnEqualResource();}};Marketplace.prototype.resetPriceTypeOnEqualResource=function(){// can not trade e.g. metal for metal
if(this.itemType===this.ITEM_TYPE_RESOURCE&&this.itemId===this.priceType){switch(this.itemId){case this.RESOURCE_TYPE_METAL:this.setPriceType(this.RESOURCE_TYPE_CRYSTAL);break;case this.RESOURCE_TYPE_CRYSTAL:this.setPriceType(this.RESOURCE_TYPE_DEUTERIUM);break;case this.RESOURCE_TYPE_DEUTERIUM:this.setPriceType(this.RESOURCE_TYPE_METAL);break;}}};Marketplace.prototype.getDefaultQuantity=function(){let itemOption=this.getItemOption(this.itemType,this.itemId);return itemOption.minQuantity;};Marketplace.prototype.resetQuantity=function(){this.setQuantity(this.getDefaultQuantity(),true);};Marketplace.prototype.setQuantity=function(quantity,refresh){refresh=refresh||false;let quantityOld=this.quantity;let itemOption=this.getItemOption(this.itemType,this.itemId);let quantityMax=itemOption!==undefined?Math.min(itemOption.quantity,itemOption.maxQuantity):0;quantityMax=Math.min(quantityMax,this.constants.MARKET_MAX_QUANTITY);if(this.isSelling()){this.quantity=clampInt(quantity,itemOption.minQuantity,quantityMax);}if(this.isBuying()){this.quantity=clampInt(quantity,itemOption.minQuantity,this.constants.MARKET_MAX_QUANTITY);}if(this.quantity!==quantityOld||this.quantity!==parseInt(quantity)||refresh===true){this.resetPrice();this.refreshQuantity();this.refreshPrice();this.refreshPriceLimit();}};Marketplace.prototype.resetPrice=function(){let price=this.getPriceCalculated(this.quantity);this.setPrice(price);};Marketplace.prototype.setPrice=function(price){let priceOld=this.price;let priceCalculated=this.getPriceCalculated(this.quantity);let priceMin=this.getPriceMin(this.quantity);let priceMax=this.getPriceMax(this.quantity);if(priceCalculated===undefined||priceMin===undefined||priceMax===undefined||this.quantity===0){this.price=0;}else{this.price=clampFloat(price,priceMin,priceMax);}if(this.price!==priceOld||this.price!==price){this.refreshPrice();this.refreshPriceValidation();this.refreshPriceLimit();}};Marketplace.prototype.resetPriceType=function(){this.setPriceType(this.getFirstResourceType());this.refreshPriceType();};Marketplace.prototype.setPriceType=function(priceType){let priceTypeOld=this.priceType;this.priceType=parseInt(priceType);if(this.priceType!==priceTypeOld){this.resetPrice();this.refreshPriceType();}};Marketplace.prototype.resetPriceRange=function(){this.setPriceRange(this.defaultPriceRange);};Marketplace.prototype.setPriceRange=function(priceRange){let priceRangeOld=this.priceRange;this.priceRange=parseInt(priceRange);if(this.priceRange!==priceRangeOld){this.refreshPrice();}};Marketplace.prototype.onChangeMarketItemType=function(e){this.setMarketItemType($('.marketplace input[name="type"]:checked').val());};Marketplace.prototype.onChangeItemType=function(e){this.setItemType($('.marketplace input[name="itemType"]:checked').val());};Marketplace.prototype.onChangeItemId=function(e){this.setItemId(this.dropDownItemId.val());};Marketplace.prototype.onChangeQuantity=function(e){this.setQuantity(this.inputQuantity.val());};Marketplace.prototype.onFocusQuantity=function(e){this.inputQuantity.val('');};Marketplace.prototype.onKeyInputQuantity=function(e){if(e.which==75){let val=parseInt($(e.target).val())||0;if(val==0){val=1;}val=val+'000';$(e.target).val(val);}};Marketplace.prototype.onChangePrice=function(e){if(this.quantity>0){this.setPrice(parseFloat(this.inputPrice.val()));}else{this.setPrice(0);}};Marketplace.prototype.onFocusPrice=function(e){this.inputPrice.val('');};Marketplace.prototype.onKeyInputPrice=function(e){if(e.which==75){let val=parseInt($(e.target).val())||0;if(val==0){val=1;}val=val+'000';$(e.target).val(val);}};Marketplace.prototype.onChangePriceType=function(e){this.setPriceType(this.dropDownPriceType.val());};Marketplace.prototype.onChangePriceRange=function(e){this.setPriceRange(this.dropDownPriceRange.val());this.refreshPriceInformation();};Marketplace.prototype.refreshMarketItemTypes=function(){this.btnOptSellOrder.prop('checked',this.marketItemType===this.MARKET_ITEM_TYPE_SELL_ORDER);this.btnOptBuyOrder.prop('checked',this.marketItemType===this.MARKET_ITEM_TYPE_BUY_ORDER);};Marketplace.prototype.refreshFormSteps=function(){let formSteps=this.formSteps[this.marketItemType]||[];$('.marketplace .og-sub-step.sub-step-1').html(formSteps[0]||'');$('.marketplace .og-sub-step.sub-step-2').html(formSteps[1]||'');$('.marketplace .og-sub-step.sub-step-3').html(formSteps[2]||'');};Marketplace.prototype.refreshItemTypes=function(){this.btnOptShips.prop('checked',this.itemType===this.ITEM_TYPE_SHIP);this.btnOptResources.prop('checked',this.itemType===this.ITEM_TYPE_RESOURCE);this.btnOptItems.prop('checked',this.itemType===this.ITEM_TYPE_TRADABLE_ITEM);};Marketplace.prototype.refreshItemBox=function(){let itemOption=this.getItemOption(this.itemType,this.itemId);if(itemOption){let html='';if(itemOption.type===this.ITEM_TYPE_TRADABLE_ITEM){html='<img src="'+itemOption.itemImage+'"/>';}else{html='<div class="sprite '+itemOption.cssClass+'"></div>';}this.itemBox.find('.thumbnail').html(html);this.itemBox.find('.quantity').html(tsdpkt(itemOption.quantity));}else{this.itemBox.find('.thumbnail').html('');this.itemBox.find('.quantity').html('-');}};Marketplace.prototype.refreshItemIdOptions=function(){this.dropDownItemId.ogameDropDown('destroy');this.dropDownItemId.html('');let htmlOptions='';if(this.ITEM_TYPE_SHIP===this.itemType&&this.MARKET_ITEM_TYPE_SELL_ORDER===this.marketItemType){this.itemOptions.ships.forEach(function(option){if(option.quantity>0){htmlOptions+='<option value="'+option.value+'">'+option.name+'</option>';}});}if(this.ITEM_TYPE_SHIP===this.itemType&&this.MARKET_ITEM_TYPE_BUY_ORDER===this.marketItemType){this.itemOptions.ships.forEach(function(option){htmlOptions+='<option value="'+option.value+'">'+option.name+'</option>';});}if(this.ITEM_TYPE_RESOURCE===this.itemType){this.itemOptions.resources.forEach(function(option){htmlOptions+='<option value="'+option.value+'">'+option.name+'</option>';});}if(this.ITEM_TYPE_TRADABLE_ITEM===this.itemType&&this.MARKET_ITEM_TYPE_SELL_ORDER===this.marketItemType){this.itemOptions.items.forEach(function(option){if(option.quantity>0){htmlOptions+='<option value="'+option.value+'">'+option.name+'</option>';}});}if(this.ITEM_TYPE_TRADABLE_ITEM===this.itemType&&this.MARKET_ITEM_TYPE_BUY_ORDER===this.marketItemType){this.itemOptions.items.forEach(function(option){htmlOptions+='<option value="'+option.value+'">'+option.name+'</option>';});}this.dropDownItemId.html(htmlOptions).ogameDropDown();};Marketplace.prototype.refreshItemId=function(){this.dropDownItemId.find('option').removeAttr('selected');if(this.itemId){this.dropDownItemId.find('option[value="'+this.itemId+'"]').attr('selected','selected');}};Marketplace.prototype.refreshQuantity=function(){this.inputQuantity.val(this.quantity);};Marketplace.prototype.refreshPriceRangeVisiblity=function(){if(this.isOrder()){$('#colPriceRange').show();}else{$('#colPriceRange').hide();}};Marketplace.prototype.refreshPrice=function(){this.refreshPriceRange();let priceTotal=parseInt(this.price);this.inputPrice.val(priceTotal);this.refreshPriceLimit();this.refreshMarketFee();this.refreshPriceInformation();};Marketplace.prototype.refreshPriceType=function(){this.dropDownPriceType.find('option').removeAttr('selected');if(this.priceType){this.dropDownPriceType.val(this.priceType);this.dropDownPriceType.find('option[value="'+this.priceType+'"]').attr('selected','selected');this.dropDownPriceType.ogameDropDown('refresh');}};Marketplace.prototype.refreshPriceRange=function(){this.dropDownPriceRange.find('option').removeAttr('selected');if(this.priceRange){this.dropDownPriceRange.find('option[value="'+this.priceRange+'"]').attr('selected','selected');this.dropDownPriceRange.val(this.priceRange);this.dropDownPriceRange.ogameDropDown('refresh');}};Marketplace.prototype.refreshPriceLimit=function(){let priceMin=this.getPriceMin(this.quantity);let priceMax=this.getPriceMax(this.quantity);if(priceMin===undefined||priceMax===undefined){this.priceLimitMin.html('');this.priceLimitMax.html('');this.priceLimitMin.data('priceMin',0);this.priceLimitMax.data('priceMax',0);}else{this.priceLimitMin.html(tsdpkt(priceMin));this.priceLimitMin.data('priceMin',priceMin);this.priceLimitMax.html(tsdpkt(priceMax));this.priceLimitMax.data('priceMax',priceMax);}};Marketplace.prototype.refreshPriceValidation=function(){};Marketplace.prototype.refreshMarketFee=function(){let priceTypeOption=this.getPriceTypeOption(this.priceType);if(this.isOrder()){let priceMin=this.getPriceMin(this.quantity);let priceMax=this.getPriceMax(this.quantity);let feeMin=Math.floor(this.price*(1.0-this.priceRange/100)*this.marketFee);let feeMax=Math.floor(this.price*(1.0+this.priceRange/100)*this.marketFee);this.marketFeeElem.html(tsdpkt(feeMin)+' - '+tsdpkt(feeMax)+' '+priceTypeOption.name);}else{let fee=Math.floor(this.price*this.marketFee);this.marketFeeElem.html(tsdpkt(fee)+' '+priceTypeOption.name);}};Marketplace.prototype.refreshPriceInformation=function(){let priceToPayCalc=Math.floor(this.price*(1+$("#priceRange option:selected").val()/100));this.priceToPay.html(tsdpkt(priceToPayCalc));this.priceInTotal.html(tsdpkt(this.price));this.priceRangeValue.html($("#priceRange option:selected").text());};Marketplace.prototype.getFirstMarketItemType=function(){return parseInt(this.marketItemTypes[Object.keys(this.marketItemTypes)[0]]);};Marketplace.prototype.getFirstItemType=function(){let itemType=parseInt(this.itemTypes[Object.keys(this.itemTypes)[0]]);let minQuantity=this.getMinQuantityByItemType(itemType);let itemOptions=this.getItemOptionsByItemType(itemType,minQuantity);if(itemOptions.length==0){return this.ITEM_TYPE_RESOURCE;}return parseInt(this.itemTypes[Object.keys(this.itemTypes)[0]]);};Marketplace.prototype.getMinQuantityByItemType=function(itemType){if((this.ITEM_TYPE_TRADABLE_ITEM===itemType||this.ITEM_TYPE_SHIP===itemType)&&this.MARKET_ITEM_TYPE_SELL_ORDER===this.marketItemType){return 1;}return 0;};Marketplace.prototype.getItemOptionsByItemType=function(itemType,minQuantity){let itemOptionsSelected=[];if(itemType===undefined){return itemOptionsSelected;}let items;switch(itemType){case this.ITEM_TYPE_SHIP:items=this.itemOptions.ships;break;case this.ITEM_TYPE_RESOURCE:items=this.itemOptions.resources;break;case this.ITEM_TYPE_TRADABLE_ITEM:items=this.itemOptions.items;break;}for(let i=0;i<items.length;i++){if(items[i].quantity>=minQuantity){itemOptionsSelected.push(items[i]);}}return itemOptionsSelected;};Marketplace.prototype.getFirstItemId=function(itemType){let minQuantity=this.getMinQuantityByItemType(itemType);let itemOptions=this.getItemOptionsByItemType(itemType,minQuantity);return itemOptions.length>0?itemOptions[0].value:undefined;};Marketplace.prototype.getItemOption=function(itemType,itemId){if(itemType===undefined){return undefined;}let minQuantity=this.getMinQuantityByItemType(itemType);let itemOptions=this.getItemOptionsByItemType(itemType,minQuantity);return itemOptions.find(function(itemOption){return itemOption.value===itemId;});};Marketplace.prototype.getPriceTypeOption=function(priceType){return this.priceTypeOptions.find(function(priceTypeOption){return priceTypeOption.value===priceType;});};Marketplace.prototype.getFirstResourceType=function(){return this.itemOptions.resources[0].value;};Marketplace.prototype.isOrder=function(){return this.marketItemType===this.MARKET_ITEM_TYPE_BUY_ORDER||this.marketItemType===this.MARKET_ITEM_TYPE_SELL_ORDER;};Marketplace.prototype.isBuying=function(){return this.marketItemType===this.MARKET_ITEM_TYPE_BUY_ORDER;};Marketplace.prototype.isSelling=function(){return this.marketItemType===this.MARKET_ITEM_TYPE_SELL_ORDER;};Marketplace.prototype.displayErrors=function(errors){// only display the first error
let error=errors[0]||undefined;if(error){fadeBox(error.message,true);}};Marketplace.prototype.isPriceValid=function(){let priceCalculated=this.getPriceCalculated(this.quantity);let priceMin=this.getPriceMin(this.quantity);let priceMax=this.getPriceMax(this.quantity);if(priceCalculated===undefined||priceMin===undefined||priceMax===undefined){return false;}return priceMin<priceCalculated&&priceCalculated<priceMax;};Marketplace.prototype.getPriceCalculated=function(quantity){let itemOption=this.getItemOption(this.itemType,this.itemId);if(itemOption===undefined){return undefined;}return Math.floor(this.convertMCDTo(itemOption.priceCalculatedInMCD*quantity,this.priceType));};Marketplace.prototype.getPriceMin=function(quantity){let priceCalculated=this.getPriceCalculated(quantity);if(priceCalculated!==undefined){return this.calcMinPrice(priceCalculated);}return undefined;};Marketplace.prototype.getPriceMax=function(quantity){let priceCalculated=this.getPriceCalculated(quantity);if(priceCalculated!==undefined){return this.calcMaxPrice(priceCalculated);}return undefined;};Marketplace.prototype.convertMCDTo=function(mcd,priceType){switch(priceType){case this.RESOURCE_TYPE_METAL:return this.convertMCDToMetal(mcd);case this.RESOURCE_TYPE_CRYSTAL:return this.convertMCDToCrystal(mcd);case this.RESOURCE_TYPE_DEUTERIUM:return this.convertMCDToDeuterium(mcd);}return 0;};Marketplace.prototype.convertMCDToMetal=function(mcd){return mcd;};Marketplace.prototype.convertMCDToCrystal=function(mcd){return mcd*(this.currentRatio.crystal/this.currentRatio.metal);};Marketplace.prototype.convertMCDToDeuterium=function(mcd){return mcd*(this.currentRatio.deuterium/this.currentRatio.metal);};Marketplace.prototype.calcMinPrice=function(priceCalculated){return Math.max(Math.floor(priceCalculated*(1.0-this.priceRangeLower)),1);};Marketplace.prototype.calcMaxPrice=function(priceCalculated){return Math.floor(priceCalculated*(1.0+this.priceRangeUpper));};Marketplace.prototype.getMetalAvailable=function(){return this.getResourceAvailable(this.RESOURCE_TYPE_CRYSTAL);};Marketplace.prototype.getCrystalAvailable=function(){return this.getResourceAvailable(this.RESOURCE_TYPE_CRYSTAL);};Marketplace.prototype.getDeuteriumAvailable=function(){return this.getResourceAvailable(this.RESOURCE_TYPE_CRYSTAL);};Marketplace.prototype.getResourceAvailable=function(resourceType){let itemOption=this.getItemOption(this.ITEM_TYPE_RESOURCE,resourceType);return itemOption!==undefined?itemOption.quantity:0;};$(function(){$('.slideIn').on('click',function(){loadDetails($(this).data('type'));});$('#detail').on('click','.close_details',function(){$('#detail').hide();});});var textDestination=[];textDestination[0]="diameterField";textDestination[1]="diameterContentField";textDestination[2]="temperatureField";textDestination[3]="temperatureContentField";textDestination[4]="positionField";textDestination[5]="positionContentField";textDestination[6]="scoreField";textDestination[7]="scoreContentField";textDestination[8]="honorField";textDestination[9]="honorContentField";function type(){if(animatedOverview){var destination=document.getElementById(textDestination[currentIndex]);if(destination){if(textContent[currentIndex].substr(currentChar,1)=="<"&&linetwo!=1){while(textContent[currentIndex].substr(currentChar,1)!=">"){currentChar++;}}if(linetwo==1){destination.innerHTML=textContent[currentIndex];currentChar=destination.innerHTML=textContent[currentIndex].length+1;}else{destination.innerHTML=textContent[currentIndex].substr(0,currentChar)+"_";currentChar++;}if(currentChar>textContent[currentIndex].length){destination.innerHTML=textContent[currentIndex];currentIndex++;currentChar=0;if(currentIndex<textContent.length){type();}}else{setTimeout("type()",15);}}}else{for(var i=0;i<textDestination.length;i++){document.getElementById(textDestination[i]).innerHTML=textContent[i];}}}function initType(){type();}function OGamePaginatable(container,data){this.container=container;this.page=data.page||0;this.numPages=data.numPages||0;this.size=data.size||10;this.token=data.token||null;this.onChange=data.onChange||null;}OGamePaginatable.prototype.init=function(){let label=this.container.text();let html='<ul class="og-paginatable"></ul>';this.element=$(html);this.container.html(this.element);$(this.element).on('click','li',this.handleClick.bind(this));this.refresh();};OGamePaginatable.prototype.handleClick=function(e){let page=$(e.currentTarget).data('page');switch(page){case'page-first':this.page=1;break;case'page-left':this.page=clampInt(parseInt(this.page-1),1,this.numPages);break;case'page-last':this.page=this.numPages;break;case'page-right':this.page=clampInt(parseInt(this.page+1),1,this.numPages);break;default:this.page=clampInt(parseInt(page),1,this.numPages);break;}this.refresh();this.notifyChange();};OGamePaginatable.prototype.update=function(data){this.page=data.page||this.page;this.numPages=data.numPages||this.numPages;this.token=data.token||this.token;this.refresh();};OGamePaginatable.prototype.getPage=function(){return this.page;};OGamePaginatable.prototype.getNumPages=function(){return this.numPages;};OGamePaginatable.prototype.notifyChange=function(){if(this.onChange){this.onChange({page:this.page,numPages:this.numPages,token:this.token});}};OGamePaginatable.prototype.refresh=function(){if(this.numPages===0){this.element.html('-');return;}let pageStart=this.page-Math.floor(this.size/2);let pageEnd=pageStart+this.size;if(pageStart<1){let delta=1-pageStart;pageStart+=delta;pageEnd+=delta;}else if(pageEnd>this.numPages){let delta=this.numPages-pageEnd;pageStart+=delta;pageEnd+=delta;}pageStart=clampInt(pageStart,1,this.numPages);pageEnd=clampInt(pageEnd,1,this.numPages);let pages=[];pages.push('<li data-page="page-first">&lt;&lt;</li>');pages.push('<li data-page="page-left">&lt;</li>');for(let page=pageStart;page<=pageEnd;++page){let stateClass=page===this.page?'active':'';pages.push('<li data-page="'+page+'" class="'+stateClass+'">'+page+'</li>');}pages.push('<li data-page="page-right">&gt;</li>');pages.push('<li data-page="page-last">&gt;&gt;</li>');this.element.html(pages.join(''));};(function($){$.fn.ogamePaginatable=function(data){if(this.length>0){let that=$(this[0]);let localData=data||{};let paginatable=that.data('ogamePaginatable');if(paginatable==null){paginatable=new OGamePaginatable(that,localData);$(this).data('ogamePaginatable',paginatable);paginatable.init();}return paginatable;}return null;};})(jQuery);function PercentageBar(elem){this.elem=$(elem);this.elem.data('percentageBarInstance',this);this.elem.disableSelection();this.value=parseInt(this.elem.attr('value')||10);this.minValue=parseInt(this.elem.attr('minValue')||1);this.steps=parseInt(this.elem.attr('steps')||10);this.stepSize=parseInt(this.elem.attr('stepSize')||10);this.valueOnEnter=null;this.isDragging=false;this.init();this.updateBar();}PercentageBar.prototype.init=function(){this.initBar();this.initSteps();if(document.createTouch===undefined){this.elem.on('mouseup',this.onMouseUp.bind(this));this.elem.on('mousemove',this.onMouseMove.bind(this));this.elem.on('mouseenter',this.onMouseEnter.bind(this));this.elem.on('mouseleave',this.onMouseLeave.bind(this));}else{this.elem.on('touchstart',this.onTouchStart.bind(this));this.elem.on('touchmove',this.onTouchMove.bind(this));this.elem.on('touchend',this.onTouchEnd.bind(this));}};PercentageBar.prototype.initSteps=function(){let html='<div class="steps">';for(let i=0;i<this.steps;++i){let label=(i+1)*this.stepSize;html+='<div class="step"  style="cursor: pointer" onclick="" data-step="'+(i+1)+'">'+label+'</div>';}this.elem.append(html);};PercentageBar.prototype.initBar=function(){let html='<div class="bar"></bar>';this.elem.append(html);};PercentageBar.prototype.updateDrag=function(e){let xMin=this.elem.offset().left;let xMax=xMin+this.elem.outerWidth();let xCurrent=e.pageX;let value=this.calcValue(xCurrent,xMin,xMax);this.setValue(value);};PercentageBar.prototype.onMouseUp=function(e){if(this.valueOnEnter){this.valueOnEnter=this.getValue();this.setValue(this.valueOnEnter);}this.updateDrag(e);};PercentageBar.prototype.onMouseMove=function(e){this.updateDrag(e);};PercentageBar.prototype.onMouseEnter=function(e){this.valueOnEnter=this.getValue();};PercentageBar.prototype.onMouseLeave=function(e){if(this.valueOnEnter>0){this.setValue(this.valueOnEnter);}};/**
 * TOUCH EVENTS
 */PercentageBar.prototype.onTouchStart=function(e){this.startDrag();};PercentageBar.prototype.onTouchMove=function(e){};PercentageBar.prototype.onTouchEnd=function(e){if(this.valueOnEnter){this.valueOnEnter=this.getValue();this.setValue(this.valueOnEnter);}this.updateDragTouch(e);this.stopDrag();};PercentageBar.prototype.startDrag=function(){this.isDragging=true;this.valueOnEnter=this.getValue();};PercentageBar.prototype.stopDrag=function(){this.isDragging=false;};PercentageBar.prototype.updateDragTouch=function(e){if(this.isDragging===true){let xMin=this.elem.offset().left;let xMax=xMin+this.elem.outerWidth();let xCurrent=e.originalEvent.pageX;if(xCurrent===0){xCurrent=e.originalEvent.changedTouches[0].pageX;}let value=this.calcValue(xCurrent,xMin,xMax);this.setValue(value);}};PercentageBar.prototype.calcValue=function(xCurrent,xMin,xMax){let x=clampInt(xCurrent,xMin,xMax);let percent=(x-xMin)/(xMax-xMin);let valueMin=Math.floor(percent*this.steps);let valueMax=Math.ceil(percent*this.steps);let value=Math.round((valueMax+valueMin)/2);return value;};PercentageBar.prototype.setValue=function(valueNew){let valueOld=this.value;this.value=clampInt(valueNew,this.minValue,this.steps);if(valueOld!==valueNew){this.elem.trigger($.Event('change',{value:this.value}));}this.updateBar();};PercentageBar.prototype.getValue=function(){return this.value;};PercentageBar.prototype.updateBar=function(){let xMin=this.elem.offset().left;let xMax=xMin+this.elem.outerWidth();let width=parseInt(this.value/this.steps*(xMax-xMin));this.elem.find('.bar').width(width);this.elem.find('.step').toggleClass('selected',false);this.elem.find('.step[data-step="'+this.value+'"]').toggleClass('selected',true);};function addPercentageBarPlugin(){(function(jQ){jQ.fn.percentageBar=function(options){let percentageBarInstance=new PercentageBar(this,options);return this;};})(jQuery);}$(function(){$(".percentSelector").each(function(){PercentSelector.initBar(this);});});var PercentSelector={};PercentSelector.fallbackMode=false;//($.browser.msie && $.browser.version < 9);
//This will init a bar (calling this directly is useful for re-doing a bar's sizes in the event it's been resized).
PercentSelector.initBar=function(bar){if(!bar)return;var $bar=$(bar);var height=$bar.innerHeight();$bar.children(".PBcolorGrad").remove();$bar.children(".PBoverlay").remove();var opcAttr=$bar.attr("onpercentchange");if(opcAttr){if(typeof opcAttr=="function"){$bar.get(0).onpercentchange=opcAttr;}else if(typeof opcAttr=="string"){if(/^function/.test(opcAttr)){eval("$bar.get(0).onpercentchange = "+opcAttr);}else{eval("$bar.get(0).onpercentchange = function() {"+opcAttr+"}");}}}if(!PercentSelector.fallbackMode){$bar.append($("<canvas class='PBoverlay'></canvas>").css("height",height).css("width",$bar.innerWidth()));$bar.append($("<div class='PBcolorGrad'></div>").css("height",height*20).css("top",-(2*height)));PercentSelector.createOverlay($bar);}else{$bar.addClass("fallback");$bar.append($("<div class='PBfallbackColor'></div>").css("height",height).css("width",$bar.innerWidth()));//$bar.append($("<div class='PBfallbackOverlay'></div>").css("height", height).css("width", $bar.innerWidth()).css("margin-top", -$bar.innerHeight()));
}if($bar.attr("percent")!=null){//ok, I know this is odd. It's because setPercent ignores the change if it's changing to the percent
// the bar is already at. It remembers what percent it's at using the percent attribute. So trying to
// initialize it to the percent attribute causes problems. So I just "reset" the attribute to 100% and then
// re-initialize to the percent given.
var percent=parseInt($bar.attr("percent"));$bar.attr("percent",100);PercentSelector.setPercent($bar,percent,true);}if(!bar.isBound){if(!($bar.attr("enabled")&&$bar.attr("enabled").toLowerCase()=="false")){var $bindBar=$bar;if(document.createTouch==undefined){$bindBar.bind("mousedown",PercentSelector.handlers.mouseDown);$bindBar.bind("mousemove",PercentSelector.handlers.mouseMove);$bindBar.bind("mouseup",PercentSelector.handlers.mouseUp);$bindBar.bind("mouseout",PercentSelector.handlers.mouseOut);}else{$bindBar.bind("touchstart",PercentSelector.handlers.touchStart);$bindBar.bind("touchmove",PercentSelector.handlers.touchMove);$bindBar.bind("touchend",PercentSelector.handlers.touchEnd);}}bar.isBound=true;//to prevent multi-binding!
}};PercentSelector.setPercent=function(bar,newPercent,animate){var $bar=$(bar);var step=$bar.attr("step");if(!step)step=1;else step=parseInt(step);newPercent=Math.round(newPercent/step)*step;//short circuit if the percent is not changing!
if(newPercent==parseInt($bar.attr("percent")))return;$bar.attr("percent",newPercent);if(PercentSelector.fallbackMode){$bar.children(".PBfallbackColor").css("width",$bar.innerWidth()*newPercent/100.0);//console.log("setting percent to: " + newPercent);
}else{if(animate){$bar.children(".PBcolorGrad").css("-webkit-transition","-webkit-transform 0.6s ease-in");$bar.children(".PBcolorGrad").css("-moz-transition","-moz-transform 0.6s ease-in");}else{$bar.children(".PBcolorGrad").css("-webkit-transition","-webkit-transform 0.1s ease-in");//turn off the animation in case it's on!
$bar.children(".PBcolorGrad").css("-moz-transition","-moz-transform 0.1s ease-in");//turn off the animation in case it's on!
}var yTrans=Math.round($bar.children(".PBcolorGrad").outerHeight()*.90*(100-newPercent)/100.0);var xTrans=Math.round($bar.children(".PBcolorGrad").innerWidth()*((100-newPercent)/100.0));if(animate){setTimeout(function(){$bar.children(".PBcolorGrad").css("-webkit-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");$bar.children(".PBcolorGrad").css("-moz-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");$bar.children(".PBcolorGrad").css("-ms-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");},1);}else{$bar.children(".PBcolorGrad").css("-webkit-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");$bar.children(".PBcolorGrad").css("-moz-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");$bar.children(".PBcolorGrad").css("-ms-transform","translate(-"+xTrans+"px, -"+yTrans+"px)");}}};PercentSelector.setPercentFromPageX=function(bar,page_x,animate){var $bar=$(bar);var x=page_x-$bar.offset().left;var width=$bar.outerWidth();var percent=100*x/width;if(percent>100)percent=100;if(percent<10)percent=10;percent=Math.round(percent);PercentSelector.setPercent(bar,percent,animate);};PercentSelector.createOverlay=function(bar){var $bar=$(bar);$overlay=$bar.children(".PBoverlay");var width=$overlay.innerWidth();var height=$overlay.innerHeight();var canvas=$overlay.get(0);canvas.width=width;canvas.height=height;var ctx=canvas.getContext("2d");//Create the plastic overlay
var lingrad=ctx.createLinearGradient(0,0,0,height);lingrad.addColorStop(0,'rgba(0,0,0,0.05)');lingrad.addColorStop(1,'rgba(0,0,0,0.3)');ctx.fillStyle=lingrad;ctx.fillRect(0,0,width,height);ctx.clearRect(3,3,width-6,height-6);lingrad=ctx.createLinearGradient(0,0,0,height);lingrad.addColorStop(0,'rgba(0,0,0,0.2)');lingrad.addColorStop(1,'rgba(0,0,0,0.05)');ctx.fillStyle=lingrad;ctx.fillRect(3,3,width-6,height-6);//create the steps
var step=$bar.attr("step");if(!step)step=100;ctx.lineWidth=1;var maxWidth=width/step;var stepWith=width/step;for(var curStep=0;curStep*step<100;curStep+=1){var x=Math.floor(curStep*step*width/100)-.5;ctx.beginPath();ctx.font="12px serif";ctx.fillStyle='white';ctx.strokeStyle='black';ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(((curStep+1)*10).toString(),x+stepWith/2,height/2,maxWidth);// ctx.strokeText(((curStep + 1) * 10).toString(), x + stepWith/2, height * 1, maxWidth);
ctx.moveTo(x,height);ctx.lineTo(x,height*.75);ctx.closePath();ctx.stroke();}};PercentSelector.handlers={};/**** touch handling ****/PercentSelector.handlers.touchDragging=false;PercentSelector.handlers.touchStart=function(event){var touches=event.originalEvent.touches;if(touches.length>1)return;event.preventDefault();PercentSelector.handlers.touchDragging=false;};PercentSelector.handlers.touchEnd=function(event){touches=event.originalEvent.touches;if(touches.length==0)touches=event.originalEvent.changedTouches;if(touches.length>1)return;var bar=touches[0].target.parentNode;PercentSelector.setPercentFromPageX(bar,touches[0].pageX,true);if(bar.onpercentchange!=undefined){bar.onpercentchange($(bar).attr("percent"));}event.preventDefault();};PercentSelector.handlers.touchMove=function(event){PercentSelector.handlers.touchDragging=true;var touches=event.originalEvent.touches;if(touches.length>1)return;event.preventDefault();PercentSelector.setPercentFromPageX(touches[0].target.parentNode,touches[0].pageX);};/*** mouse handling ***/PercentSelector.handlers.mouseDragging=false;PercentSelector.handlers.mouseDown=function(event){PercentSelector.handlers.mouseDragging=true;};PercentSelector.handlers.mouseOut=function(event){if(PercentSelector.handlers.mouseDragging){var bar=PercentSelector.fallbackMode?event.currentTarget:event.originalEvent.target.parentNode;//         if (bar.onpercentchange != undefined) {
//             var x = eval(bar.onpercentchange);
// console.debug(x);
//             if (typeof x == 'function') {
//                 x($(bar).attr("percent"));
//             }
//             // bar.onpercentchange($(bar).attr("percent"));
//         }
}PercentSelector.handlers.mouseDragging=false;};PercentSelector.handlers.mouseUp=function(event){PercentSelector.handlers.mouseDragging=false;var bar=PercentSelector.fallbackMode?event.currentTarget:event.originalEvent.target.parentNode;PercentSelector.setPercentFromPageX(bar,event.pageX,true);// if (bar.onpercentchange != undefined) {
//     var x = eval(bar.onpercentchange);
//
//     if (typeof x == 'function') {
//         x($(bar).attr("percent"));
//     }
//     // bar.onpercentchange($(bar).attr("percent"));
// }
// if(bar.onpercentchange != undefined) {
//     bar.onpercentchange($(bar).attr("percent"));
// }
};PercentSelector.handlers.mouseMove=function(event){if(PercentSelector.handlers.mouseDragging){event.preventDefault();var bar=PercentSelector.fallbackMode?event.currentTarget:event.originalEvent.target.parentNode;PercentSelector.setPercentFromPageX(bar,event.pageX);}};$(function(){jQuery('.planetlink').hover(function(){jQuery(this).parent().addClass('hoverPlanet');},function(){jQuery(this).parent().removeClass('hoverPlanet');});jQuery('.moonlink').hover(function(){jQuery(this).parent().addClass('hoverMoon');},function(){jQuery(this).parent().removeClass('hoverMoon');});});var buildUrl;function sendBuildRequest(url,ev,showSlotWarning){if(ev!=undefined){var keyCode;if(window.event){keyCode=window.event.keyCode;}else if(ev){keyCode=ev.which;}else{return true;}if(keyCode!=13){return true;}}function build(){if(url==null){//sendForm();
}else{fastBuild();}}if(url==null){//fallBackFunc = sendForm;
}else{fallBackFunc=build;buildUrl=url;}if(planetMoveInProgress){errorBoxDecision(LOCA_ALL_NETWORK_ATTENTION,LOCA_PLANETMOVE_BREAKUP_WARNING,LOCA_ALL_YES,LOCA_ALL_NO,fallBackFunc);}else{if(showSlotWarning){if(lastBuildingSlot['showWarning']){errorBoxDecision(LOCA_ALL_NETWORK_ATTENTION,lastBuildingSlot['slotWarning'],LOCA_ALL_YES,LOCA_ALL_NO,build);}else{build();}}else{build();}}return false;}function fastBuild(){location.href=buildUrl;return false;}function cancelResearch(id,listId,question){errorBoxDecision(LOCA_ALL_NETWORK_ATTENTION,""+question+"",LOCA_ALL_YES,LOCA_ALL_NO,function(){window.location.replace(urlResearchCancel+"&techid="+id+"&listid="+listId);});}var metalTicker=undefined;var crystalTicker=undefined;var deuteriumTicker=undefined;function ResourceTicker(){this.timerObj=undefined;}ResourceTicker.Metal='metal';ResourceTicker.Crystal='crystal';ResourceTicker.Deuterium='deuterium';ResourceTicker.Energy='energy';ResourceTicker.prototype.reload=function(data){this.techs=data.techs||{};this.resources=data.resources||{};changeTooltip($("#metal_box"),data.resources.metal.tooltip);changeTooltip($("#crystal_box"),data.resources.crystal.tooltip);changeTooltip($("#deuterium_box"),data.resources.deuterium.tooltip);changeTooltip($("#darkmatter_box"),data.resources.darkmatter.tooltip);changeTooltip($("#energy_box"),data.resources.energy.tooltip);this.refresh();};ResourceTicker.prototype.start=function(){if(this.timerObj===undefined){this.timerObj=timerHandler.appendCallback(this.update.bind(this));}};ResourceTicker.prototype.stop=function(){if(this.timerObj!==undefined){timerHandler.removeCallback(this.timerObj);delete this.timerObj;}};ResourceTicker.prototype.restart=function(){this.stop();this.start();};ResourceTicker.prototype.update=function(){let productionFactor=this.getProductionFactor();let production=this.calcProduction(productionFactor);if(this.resources.metal.amount<this.resources.metal.storage){this.resources.metal.amount=Math.min(this.resources.metal.amount+production.metal,this.resources.metal.storage);}if(this.resources.crystal.amount<this.resources.crystal.storage){this.resources.crystal.amount=Math.min(this.resources.crystal.amount+production.crystal,this.resources.crystal.storage);}if(this.resources.deuterium.amount<this.resources.deuterium.storage){this.resources.deuterium.amount=Math.min(this.resources.deuterium.amount+production.deuterium,this.resources.deuterium.storage);}this.refresh();};ResourceTicker.prototype.refresh=function(){let elements={metal:$('#resources_metal'),crystal:$('#resources_crystal'),deuterium:$('#resources_deuterium'),darkmatter:$('#resources_darkmatter'),energy:$('#resources_energy')// metal
};elements.metal.html(gfNumberGetHumanReadable(this.resources.metal.amount.toFixed(0),isMobile));elements.metal.removeClass('overmark middlemark');storageClass=this.getStorageClass(this.resources.metal.amount,this.resources.metal.storage);if(storageClass){elements.metal.toggleClass(storageClass,true);}// crystal
elements.crystal.html(gfNumberGetHumanReadable(this.resources.crystal.amount.toFixed(0),isMobile));elements.crystal.removeClass('overmark middlemark');storageClass=this.getStorageClass(this.resources.crystal.amount,this.resources.crystal.storage);if(storageClass){elements.crystal.toggleClass(storageClass,true);}// deuterium
elements.deuterium.html(gfNumberGetHumanReadable(this.resources.deuterium.amount.toFixed(0),isMobile));elements.deuterium.removeClass('overmark middlemark');storageClass=this.getStorageClass(this.resources.deuterium.amount,this.resources.deuterium.storage);if(storageClass){elements.deuterium.toggleClass(storageClass,true);}// darkmatter
elements.darkmatter.html(gfNumberGetHumanReadable(this.resources.darkmatter.amount,isMobile));// energy
elements.energy.html(gfNumberGetHumanReadable(this.resources.energy.amount.toFixed(0),isMobile));elements.energy.toggleClass('overmark',this.resources.energy.amount<0);};ResourceTicker.prototype.getStorageClass=function(amount,storage){if(amount>=storage){return'overmark';}else if(amount>=storage*0.9){return'middlemark';}return undefined;};ResourceTicker.prototype.getProduction=function(resource){let production=0;for(let techId in this.techs){let tech=this.techs[techId];if(this.hasResourcesAvailable(tech.consumption)){production+=tech.production[resource]||0;}}return production;};ResourceTicker.prototype.getConsumption=function(resource){let consumption=0;for(let techId in this.techs){let tech=this.techs[techId];if(this.hasResourcesAvailable(tech.consumption)){consumption+=tech.consumption[resource]||0;}}return consumption;};ResourceTicker.prototype.calcProduction=function(productionFactor){let production={metal:0,crystal:0,deuterium:0};for(let techId in this.techs){let tech=this.techs[techId];if(this.hasResourcesAvailable(tech.consumption)){for(let resource in production){production[resource]+=tech.production[resource]||0;production[resource]-=tech.consumption[resource]||0;}}}production=this.scaleResources(production,productionFactor);//base production
for(let resource in production){production[resource]+=this.resources[resource].baseProduction||0;}return production;};ResourceTicker.prototype.hasResourcesAvailable=function(resources){for(let resource in resources){if(resource!=="energy"&&resources[resource]>0&&this.resources[resource].amount<resources[resource]){return false;}}return true;};ResourceTicker.prototype.getProductionFactor=function(){let energyProduced=this.getProduction(ResourceTicker.Energy);let energyNeeded=this.getConsumption(ResourceTicker.Energy);let factor=energyNeeded>0?energyProduced/energyNeeded:1;factor=Math.min(1,factor);return factor;};ResourceTicker.prototype.scaleResources=function(resources,scale){let resourcesScaled={};for(let resource in resources){resourcesScaled[resource]=resources[resource]*scale;}return resourcesScaled;};var resourcesBar=new ResourceTicker();function reloadResources(data,callback){if(typeof data=='string'){data=$.parseJSON(data);}resourcesBar.reload(data);if(data.vacation===true){resourcesBar.stop();}else{resourcesBar.restart();}honorScore=data.honorScore;darkMatter=data.resources.darkmatter.amount;if(typeof callback=='function'){callback(data.resources);}}function getAjaxResourcebox(callback){$.get(ajaxResourceboxURI,function(data){reloadResources(data,callback);},"text");}ogame.retrieveEmail={send:function(){$.ajax({type:"POST",url:window.location.href+'&'+$.param({action:'get'}),data:{username:$('#username').val(),password:$('#password').val()},dataType:"json",success:function(data){$('#response').html(data.response).removeClass().addClass(data.type);}});}};$(document).ready(function(){$('#retrieveEmailComponent #username').off().keypress(function(event){if(event.which==13){event.preventDefault();$('#retrieveEmailComponent #password').focus();}});$('#retrieveEmailComponent #password').off().keypress(function(event){if(event.which==13){event.preventDefault();ogame.retrieveEmail.send();}});$('#retrieve').off().on('click',function(){ogame.retrieveEmail.send();});});function OGameSortable(container,data){this.container=container;this.state=(data.state||'active')==='active'?'active':'inactive';this.order=data.order||'';this.align=data.align||'';this.allowUnsorted=data.allowUnsorted||false;this.token=data.token||null;this.onChange=data.onChange||null;}OGameSortable.prototype.init=function(){let label=this.container.text();let html='<div class="og-sortable"><h3>'+label+'</h3><div class="icon"></div></div>';this.element=$(html);this.container.html(this.element);this.icon=this.element.find('.icon');$(this.element).on('click',this.handleClick.bind(this));this.refresh();};OGameSortable.prototype.handleClick=function(){if(this.state==='active'){if(this.order==='asc'){this.order='desc';}else if(this.order==='desc'&&this.allowUnsorted===false){this.order='asc';}else if(this.order==='desc'&&this.allowUnsorted===true){this.order='';}else if(this.order===''){this.order='asc';}this.refresh();this.notifyChange();}};OGameSortable.prototype.notifyChange=function(){if(this.onChange){this.onChange({order:this.order,state:this.state,token:this.token});}};OGameSortable.prototype.activate=function(){this.state='active';this.refresh();this.notifyChange();};OGameSortable.prototype.deactivate=function(){this.state='inactive';this.refresh();this.notifyChange();};OGameSortable.prototype.isValidOrder=function(order){if(this.allowUnsorted===true){return['','asc','desc'].indexOf(order)!==-1;}else{return['asc','desc'].indexOf(order)!==-1;}};OGameSortable.prototype.setOrder=function(order){if(this.isValidOrder(order)){this.order=order;this.refresh();this.notifyChange();}};OGameSortable.prototype.getOrder=function(){return this.order;};OGameSortable.prototype.refresh=function(){this.refreshAlign();this.refreshState();this.refreshOrder();};OGameSortable.prototype.refreshAlign=function(){this.element.toggleClass('left',this.align==='left');this.element.toggleClass('center',this.align==='center');this.element.toggleClass('right',this.align==='right');};OGameSortable.prototype.refreshState=function(){this.element.toggleClass('active',this.state==='active');this.element.toggleClass('inactive',this.state==='inactive');};OGameSortable.prototype.refreshOrder=function(){this.element.toggleClass('asc',this.order==='asc');this.element.toggleClass('desc',this.order==='desc');};OGameSortable.prototype.update=function(data){this.token=data.token||this.token;};(function($){$.fn.ogameSortable=function(data){if(this.length>0){let that=$(this[0]);let localData=data||{};let sortable=that.data('ogameSortable');if(sortable==null){sortable=new OGameSortable(that,localData);$(this).data('ogameSortable',sortable);sortable.init();}return sortable;}return null;};})(jQuery);function initStandardFleet(){$(".list tr:even").addClass("alt");$(".standardFleetSubmit").unbind('click').bind('click',function(){$(this).parents('form').submit();});$(".standardFleetReset").unbind('click').bind('click',function(){$(this).parents('form')[0].reset();});$('.changeFleet').unbind('click').bind('click',function(){$('.combatunits').val($(this).attr('rel')).trigger('change');$(this).parents('.ui-dialog').find('.ui-dialog-titlebar-close').click();});}function setShipsFleet(ships,tempName,techId){$("#template_id").val(techId);$("#template_name").val(tempName);for(var techID in ships){$("#ship"+techID).val(ships[techID]);}}$(function(){$('.techdetail').on('click',function(){loadDetails($(this).data('techid'));});$('#detail').on('click','.close_details',function(){$('#detail').hide();});$('#detail').on('click','.build-it',function(){var value=+$('#detail input[name=menge]').val();var amount=1;if(isNaN(value)){amount=1;}else if(value<=0){amount=1;}else{amount=value;}$.ajax({url:urlQueueAdd,data:{type:$('#detail > input[name=type]').val(),menge:amount},statusCode:{404:function(){alert("page not found");}},beforeSend:function(){}}).done(function(data){document.open();document.write(data);document.close();});});});function TechnologyDetails(params){this.setParams(params);}TechnologyDetails.prototype.init=function(){$(document).on('click','.technology.hasDetails:not(.showsDetails) .icon',this.onClickShow.bind(this));$(document).on('click','#technologydetails .close, .showsDetails',this.onClickHide.bind(this));$(document).on('change','#technologydetails .build_amount',this.onChangeAmount.bind(this));$(document).on('keypress','#technologydetails .build_amount',this.onKeyPressAmount.bind(this));$(document).on('click','#technologydetails button.upgrade',this.onClickUpgrade.bind(this));$(document).on('click','#technologydetails a.upgrade',this.onClickUpgradeStorage.bind(this));$(document).on('click','#technologydetails a.build-it_premium',this.onClickBuyCommander.bind(this));$(document).on('click','#technologydetails button.downgrade',this.onClickDowngrade.bind(this));$(document).on('click','#technologydetails button.cancel',this.onClickCancel.bind(this));$(document).on('click','#technologydetails button.maximum',this.onClickMaximum.bind(this));$(document).on('click','#technologydetails .button.select_class',this.onClickSelectClass.bind(this));$(document).on('click','#technologydetails .button.deselect_class',this.onClickDeselectClass.bind(this));$(document).on('click','#technologydetails button[data-target]:not(#technologydetails button[data-target*="overlay=1"], #technologydetails button.overlay)',function(){});};TechnologyDetails.prototype.setParams=function(params){this.loca=params.loca;this.upgradeEndpoint=params.upgradeEndpoint;this.downgradeEndpoint=params.downgradeEndpoint;this.technologyDetailsEndpoint=params.technologyDetailsEndpoint;this.cancelBuildingEndpoint=params.cancelBuildingEndpoint;this.cancelResearchEndpoint=params.cancelResearchEndpoint;this.selectCharacterClassEndpoint=params.selectCharacterClassEndpoint;this.deselectCharacterClassEndpoint=params.deselectCharacterClassEndpoint;};TechnologyDetails.prototype.onChangeAmount=function(e){let $input=$(e.currentTarget);let minVal=parseInt($input.attr('min'));let maxVal=parseInt($input.attr('max'));let val=parseInt(getValue($input.val()))||0;if(typeof minVal!=='undefined'){val=Math.max(val,minVal);}if(typeof maxVal!=='undefined'){val=Math.min(val,maxVal);}$input.val(val);};TechnologyDetails.prototype.onKeyPressAmount=function(e){if(getKeyCode(e)==13){$('#technologydetails button.upgrade').click();}};TechnologyDetails.prototype.onClickUpgrade=function(e){if(!this.upgradeEndpoint){return;}let technologyId=$(e.currentTarget).data('technology');let amount=$('#build_amount').val()||1;let upgradeEndpoint=this.upgradeEndpoint.replace('TECHNOLOGY_ID',technologyId).replace('AMOUNT',amount);if(planetMoveInProgress){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.planetMoveBreakUpWarning,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.replace(upgradeEndpoint);});}else if(lastBuildingSlot.showWarning==false){document.location.replace(upgradeEndpoint);}else{errorBoxDecision(LocalizationStrings.notice,lastBuildingSlot.slotWarning,LocalizationStrings.yes,LocalizationStrings.no,function(){document.location.replace(upgradeEndpoint);});}};TechnologyDetails.prototype.onClickUpgradeStorage=function(e){let technologyUrl=$(e.currentTarget).data('url');let technologyQuestion1=$(e.currentTarget).data('title');let technologyQuestion2=$(e.currentTarget).data('question');errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION,technologyQuestion1+' - '+technologyQuestion2,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){document.location.replace(technologyUrl);});};TechnologyDetails.prototype.onClickBuyCommander=function(e){let technologyUrl=$(e.currentTarget).data('url');let technologyQuestion=$(e.currentTarget).data('question');let buyResourceOverlayHref=$(e.currentTarget).attr("href");let amount=$('#build_amount').val();if(technologyUrl&&technologyQuestion){errorBoxDecision(this.loca.LOCA_ALL_NOTICE,technologyQuestion,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){document.location.replace(technologyUrl);});}else if(buyResourceOverlayHref){$(e.currentTarget).attr("href",buyResourceOverlayHref+"&amount="+amount);}};TechnologyDetails.prototype.handleDowngrade=function(technologyId,technologyName){let downgradeEndpoint=this.downgradeEndpoint.replace('TECHNOLOGY_ID',technologyId);errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION,this.loca.locaDemolishStructureQuestion.replace('TECHNOLOGY_NAME',technologyName)+'<br><br>'+$('#demolition_costs_tooltip').html(),this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){document.location.replace(downgradeEndpoint);});};TechnologyDetails.prototype.onClickDowngrade=function(e){if(!this.downgradeEndpoint){return;}let technologyId=$(e.currentTarget).data('technology');let technologyName=$(e.currentTarget).data('name');if(planetMoveInProgress){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.planetMoveBreakUpWarning,LocalizationStrings.yes,LocalizationStrings.no,this.handleDowngrade.bind(this,technologyId,technologyName));}else{this.handleDowngrade(technologyId,technologyName);}};TechnologyDetails.prototype.onClickCancel=function(e){if(!this.cancelBuildingEndpoint&&!this.cancelResearchEndpoint){return;}let prompt=$(this).data('prompt');let technologyId=$(e.currentTarget).data('technology');let priority=$(e.currentTarget).data('priority');let type=$(e.currentTarget).data('type');let cancelEndpoint='';if(type==='building'){cancelEndpoint=this.cancelBuildingEndpoint.replace('TECHNOLOGY_ID',technologyId).replace('PRIORITY',priority);}else if(type==='research'){cancelEndpoint=this.cancelResearchEndpoint.replace('TECHNOLOGY_ID',technologyId).replace('PRIORITY',priority);}else{throw'Technology upgrade / downgrade is not cancellable';}errorBoxDecision(this.loca.LOCA_ALL_NETWORK_ATTENTION,prompt,this.loca.LOCA_ALL_YES,this.loca.LOCA_ALL_NO,function(){document.location.replace(cancelEndpoint);});};TechnologyDetails.prototype.onClickMaximum=function(e){this.setMaximumBuildableAmount();};TechnologyDetails.prototype.onClickSelectClass=function(e){e.preventDefault();let characterClassId=$(e.currentTarget).data('characterclassid');this.selectClass(characterClassId);};TechnologyDetails.prototype.onClickDeselectClass=function(e){e.preventDefault();let characterClassId=$(e.currentTarget).data('characterclassid');this.deselectClass(characterClassId);};TechnologyDetails.prototype.onClickShow=function(e){this.show($(e.currentTarget).closest('.hasDetails').data('technology'));};TechnologyDetails.prototype.onClickHide=function(e){this.hide($(e.currentTarget));};TechnologyDetails.prototype.selectClass=function(characterClassId){let that=this;let selectCharacterClassEndpoint=this.selectCharacterClassEndpoint.replace('CHARACTERCLASSID',characterClassId);$.post(selectCharacterClassEndpoint).done(function(data){var json=$.parseJSON(data);if(json.status==='success'){that.show(37);//        document.location.replace(json.redirectUrl)
}else{that.displayErrors(json);}});};TechnologyDetails.prototype.deselectClass=function(characterClassId){let that=this;let deselectCharacterClassEndpoint=this.deselectCharacterClassEndpoint.replace('CHARACTERCLASSID',characterClassId);$.post(deselectCharacterClassEndpoint).done(function(data){var json=$.parseJSON(data);if(json.status==='success'){that.show(37);//document.location.replace(json.redirectUrl)
}else{that.displayErrors(json);}});};TechnologyDetails.prototype.displayErrors=function(data){let errorCode=data.errorCode||0;let errorMessage=data.errorMessage||'';fadeBox(errorMessage,true);};TechnologyDetails.prototype.show=function(technologyId){let element=$('.technology.hasDetails[data-technology='+technologyId+']');let elemTechnologyDetailsWrapper=$('#technologydetails_wrapper');let elemTechnologyDetailsContent=$('#technologydetails_content');let elemTechnologyDetails=$('#technologydetails');elemTechnologyDetailsWrapper.toggleClass('slide-up',true);elemTechnologyDetailsWrapper.toggleClass('slide-down',false);let locationIndicator=elemTechnologyDetailsContent.ogameLoadingIndicator();locationIndicator.show();$.ajax({url:this.technologyDetailsEndpoint,data:{technology:technologyId}}).done(function(data){let json=$.parseJSON(data);$('.showsDetails').removeClass('showsDetails');element.closest('.hasDetails').addClass('showsDetails');locationIndicator.hide();let anchor=$('header[data-anchor=technologyDetails]');if(elemTechnologyDetails.length>0){removeTooltip(elemTechnologyDetails.find(getTooltipSelector()));elemTechnologyDetails.replaceWith(json.content[json.target]);elemTechnologyDetails.addClass(anchor.data('technologydetails-size')).offset(anchor.offset());}else{elemTechnologyDetailsContent.append(json.content[json.target]);elemTechnologyDetails.addClass(anchor.data('technologydetails-size')).offset(anchor.offset());}localStorage.setItem('detailsOpen',true);//techID is magically defined by setting data in the .html; not always so we check it
// and set it to harmless 0 as default. This is used for the repair dock.
$(document).trigger("ajaxShowElement",typeof technologyId==='undefined'?0:technologyId);});};TechnologyDetails.prototype.hide=function(){let elemTechnologyDetails=$('#technologydetails');removeTooltip(elemTechnologyDetails.find(getTooltipSelector()));$('#technologydetails_wrapper').removeClass('slide-up');this.startSlideDown();$('.showsDetails').removeClass('showsDetails');};TechnologyDetails.prototype.startSlideDown=function(){$('#technologydetails_wrapper').toggleClass('slide-down',true);this.timerSlideDownEnd=setTimeout(function(){this.stopSlideDown();}.bind(this),500);};TechnologyDetails.prototype.stopSlideDown=function(){$('#technologydetails_wrapper').removeClass('slide-down');clearTimeout(this.timerSlideDownEnd);this.timerSlideDownEnd=null;};TechnologyDetails.prototype.setMaximumBuildableAmount=function(){var $buildAmount=$('#technologydetails #build_amount');$buildAmount.val($buildAmount.attr('max'));};$(function(){var sheet=function(){var style=document.createElement("style");// WebKit hack
style.appendChild(document.createTextNode(""));document.head.appendChild(style);return style.sheet;}();for(var i=0;i<=100;i++){sheet.insertRule('.technology[data-status="active"][data-progress="'+i+'"] .icon::after { height: '+(100-i)+'%; }',0);}$(document).on("click",".technology .icon button.upgrade",function(event){event.preventDefault();event.stopPropagation();var buildUrl=$(this).data("target");var isSpaceProvider=$(this).data("is-spaceprovider")==1;if(planetMoveInProgress){errorBoxDecision(LocalizationStrings.attention,LocalizationStrings.planetMoveBreakUpWarning,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=buildUrl;});}else if(lastBuildingSlot.showWarning==false||isSpaceProvider){window.location.href=buildUrl;}else{errorBoxDecision(LocalizationStrings.notice,lastBuildingSlot.slotWarning,LocalizationStrings.yes,LocalizationStrings.no,function(){window.location.href=buildUrl;});}//
});var active=$('.technology[data-status="active"]');if(active.length>0){setInterval(function(){active.each(function(){var $this=$(this);$this.attr("data-progress",Math.round((1-($this.data("end")-Math.floor((Date.now()+window.timeDiff+window.timeZoneDiffSeconds*1000)/1000))/($this.data("end")-$this.data("start")))*100));});},1000);}});function Tutorial(params){this.urlGetTutorialMission=params.urlGetTutorialMission;$('#inhalt .pagination a').click(function(e){this.switchMission($(e.currentTarget).attr('ref'));}.bind(this));if(params.openStep!=null){this.switchMission(params.openStep);}}Tutorial.prototype.switchMission=function(missionID){this.showPagination();var elementTutorialStep=$('#tutorialStep_'+missionID);if(elementTutorialStep.attr('class')==='tut_new'){elementTutorialStep.attr('class','tutorial_done');}var className=elementTutorialStep.attr('class');let params={missionID:missionID};$.post(this.urlGetTutorialMission,params,function(data){this.displayMission(data);}.bind(this));$('#inhalt .pagination a').removeClass('currentpage').removeClass('tutorial_done_selected');elementTutorialStep.removeClass('tut_new');if(className==='tutorial_done'){this.markStepDoneSelected(missionID);}else{this.markStepCurrent(missionID);}};Tutorial.prototype.showPagination=function(){$('#tutorial .pagination ul').show();};Tutorial.prototype.displayMission=function(data){let json=JSON.parse(data);if(json){$('#inhalt .content').html(json.content[json.target]);}};Tutorial.prototype.markStepDone=function(missionID){this.setTutorialStepClass(missionID,'tutorial_done');};Tutorial.prototype.markStepDoneSelected=function(missionID){this.setTutorialStepClass(missionID,'tutorial_done_selected');};Tutorial.prototype.markStepCurrent=function(missionID){this.setTutorialStepClass(missionID,'currentpage');};Tutorial.prototype.setTutorialStepClass=function(missionID,className){$('#tutorialStep_'+missionID).addClass(className);};
